





<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Updated version title -->
    <title>UW assessment tool (v2.8.630)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: "Microsoft JhengHei", "Heiti TC", sans-serif; }
        /* 自定義滾動條 */
        .custom-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* 數字輸入框移除箭頭 */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; margin: 0; 
        }
        
        /* 分頁切換動畫效果 */
        .tab-content { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .disabled-input {
            background-color: #f8fafc; color: #94a3b8;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 h-screen overflow-hidden">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- ICON COMPONENTS (Lucide Style SVGs) ---
        const IconBase = ({ children, color = "currentColor", size = 18, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                {children}
            </svg>
        );

        const Split = (props) => <IconBase {...props}><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><line x1="12" y1="3" x2="12" y2="21"/></IconBase>;
        const Calculator = (props) => <IconBase {...props}><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></IconBase>;
        const FileText = (props) => <IconBase {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></IconBase>;
        const Plus = (props) => <IconBase {...props}><path d="M5 12h14"/><path d="M12 5v14"/></IconBase>;
        const Trash2 = (props) => <IconBase {...props}><path d="M3 6h18"/><path d="M19 6v14c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V6"/><path d="M8 6V4c0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></IconBase>;
        const Check = (props) => <IconBase {...props}><path d="M20 6 9 17 4 12"/></IconBase>;
        const AlertTriangle = (props) => <IconBase {...props}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></IconBase>;
        const Copy = (props) => <IconBase {...props}><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></IconBase>;
        const ClipboardList = (props) => <IconBase {...props}>
            <rect x="8" y="2" width="8" height="4" rx="1" ry="1"/>
            <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/>
            <circle cx="8" cy="12" r="1"/>
            <circle cx="8" cy="16" r="1"/>
            <path d="M11 12h6"/>
            <path d="M11 16h6"/>
        </IconBase>;

        const ArrowDownWideNarrow = (props) => <IconBase {...props}><path d="m3 16 4 4 4-4"/><path d="M7 20V4"/><path d="M11 4h10"/><path d="M11 8h7"/><path d="M11 12h4"/></IconBase>;
        const Search = (props) => <IconBase {...props}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></IconBase>;
        const RotateCw = (props) => <IconBase {...props}><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/></IconBase>;
        const Stethoscope = (props) => <IconBase {...props}><path d="M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3"/><path d="M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4"/><circle cx="20" cy="10" r="2"/></IconBase>;
        const DollarSign = (props) => <IconBase {...props}><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></IconBase>;
        const Info = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></IconBase>;
        const AlertCircle = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></IconBase>;
        const Activity = (props) => <IconBase {...props}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></IconBase>;
        const Scale = (props) => <IconBase {...props}><path d="M7 20v-7"/><path d="M17 20v-7"/><rect width="3" height="7" x="7" y="13"/><rect width="3" height="7" x="14" y="13"/><path d="M3 13l9-9 9 9"/></IconBase>;
        const CalendarClock = (props) => <IconBase {...props}><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/><path d="M16 14h-4"/><path d="M16 14v2a2 2 0 1 1-2-2"/></IconBase>;
        const ChevronDown = (props) => <IconBase {...props}><polyline points="6 9 12 15 18 9"/></IconBase>;
        const Briefcase = (props) => <IconBase {...props}><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></IconBase>;

        // --- CONSTANTS ---
        const USD_RATE = 7.8; // Used for general calculations
        const FIN_USD_RATE = 8.0; // [UPDATE Req 2] Used for Financial Requirements & TSA(All)
        const MED_CHECK_RATE = 8.0;

        const SOF_OPTIONS = ["Salary", "Income", "Saving", "Investments", "Company sale /profits", "Premium Financing", "Others"];
        const SOW_OPTIONS = ["Income-savings from salary(basic and/or bonus)", "Company sale/profits", "Sale of shares or other investments", "Sale of property", "Others"];



// ====== FNA Suitability Mapping Options (Part 2 / Part 3) ======
const FNA_P2Q1_OPTIONS = [
    { value: "A", label: "A" },
    { value: "B(iii)", label: "B (iii)" },
    { value: "C", label: "C" },
    { value: "D", label: "D" },
    { value: "E", label: "E" },
    { value: "E(iii)", label: "E (iii)" },
    { value: "F", label: "F" },
    { value: "G", label: "G" }
];

const FNA_P2_SINGLE_OPTIONS = [
    { value: "", label: "請選擇..." },
    { value: "A", label: "A" },
    { value: "B", label: "B" },
    { value: "C", label: "C" },
    { value: "D", label: "D" },
    { value: "E", label: "E" },
    { value: "F", label: "F" },
    { value: "G", label: "G" }
];
        // ==========================================================
        // Commission Spreading (Professional Investor - PI) Mapping
        // Hardcoded from PI.txt (standalone HTML requirement)
        // ==========================================================
        const COMMISSION_SPREADING_PREFIX = "(pending) Financial supporting document with certified true copy to prove that the policyholder has a portfolio of not less than HKD 8 million (Re: Submitted Request for Departure from Commission Spreading Requirement form)";

        const PI_INVESTOR_TYPES = [
            "INDIVIDUAL PROFESSIONAL INVESTOR",
            "CORPORATE PROFESSIONAL INVESTOR"
        ];

        // Each scenario/category provides a dropdown label and the requirement text to append in Case Summary -> Issue UN.
        const PI_REQUIREMENTS = {
            "INDIVIDUAL PROFESSIONAL INVESTOR": [
                {
                    key: "IND_A",
                    label: "(a) a portfolio on his/her own account(s)",
                    requirementText: [
                        "Individual Professional Investor (PI) – Scenario (a)",
                        "Eligibility threshold: Proposed Policyholder / Settlor has a portfolio of not less than HKD 8,000,000 (or its equivalent in any foreign currency).",
                        "Supporting document(s) – provide certified true copies by insurance advisor / lawyer / accountant (Provide ONE of A1–A3 within 12 months from application submission date):",
                        "A1 Statement(s) of account(s) or certificate(s) issued by a custodian (e.g. bank, securities firm, etc.)",
                        "A2 Certificate(s) issued by an auditor or a certified public accountant",
                        "A3 Public filing(s) submitted by or on behalf of the individual"
                    ].join("\n")
                },
                {
                    key: "IND_B",
                    label: "(b) a portfolio on a joint account with his/her associate",
                    requirementText: [
                        "Individual Professional Investor (PI) – Scenario (b)",
                        "Eligibility threshold: Proposed Policyholder / Settlor has a portfolio of not less than HKD 8,000,000 (or its equivalent in any foreign currency).",
                        "Supporting document(s) – provide certified true copies by insurance advisor / lawyer / accountant (Provide ONE of A1–A3 within 12 months from application submission date):",
                        "A1 Statement(s) of account(s) or certificate(s) issued by a custodian (e.g. bank, securities firm, etc.)",
                        "A2 Certificate(s) issued by an auditor or a certified public accountant",
                        "A3 Public filing(s) submitted by or on behalf of the individual",
                        "Additional documents to be required:",
                        "B1 Relationship proof for associate in the joint account (e.g. marriage certificates, birth certificate)"
                    ].join("\n")
                },
                {
                    key: "IND_C",
                    label: "(c) his/her share of a portfolio on a joint account (non-associate)",
                    requirementText: [
                        "Individual Professional Investor (PI) – Scenario (c)",
                        "Eligibility threshold: Proposed Policyholder / Settlor has a portfolio of not less than HKD 8,000,000 (or its equivalent in any foreign currency).",
                        "Supporting document(s) – provide certified true copies by insurance advisor / lawyer / accountant (Provide ONE of A1–A3 within 12 months from application submission date):",
                        "A1 Statement(s) of account(s) or certificate(s) issued by a custodian (e.g. bank, securities firm, etc.)",
                        "A2 Certificate(s) issued by an auditor or a certified public accountant",
                        "A3 Public filing(s) submitted by or on behalf of the individual",
                        "Additional documents to be required:",
                        "B2a A written agreement among the account holders specifying the individual’s share of the portfolio; OR",
                        "B2b Written confirmation that there is no agreement among account holders"
                    ].join("\n")
                },
                {
                    key: "IND_D",
                    label: "(d) a portfolio of a wholly-owned investment-holding corporation",
                    requirementText: [
                        "Individual Professional Investor (PI) – Scenario (d)",
                        "Eligibility threshold: Proposed Policyholder / Settlor has a portfolio of not less than HKD 8,000,000 (or its equivalent in any foreign currency).",
                        "Supporting document(s) – provide certified true copies by insurance advisor / lawyer / accountant (Provide ONE of A1–A3 within 12 months from application submission date):",
                        "A1 Statement(s) of account(s) or certificate(s) issued by a custodian (e.g. bank, securities firm, etc.)",
                        "A2 Certificate(s) issued by an auditor or a certified public accountant",
                        "A3 Public filing(s) submitted by or on behalf of the individual",
                        "Additional documents to be required:",
                        "B3a Proof to demonstrate the ownership of the corporation (e.g. company search result, company annual return, shareholders’ register, etc.) issued within 12 months from application submission date; AND",
                        "B3b Documents to ascertain the principal business of the corporation is to hold investments (e.g. Business Registration Certificate)"
                    ].join("\n")
                }
            ],
            "CORPORATE PROFESSIONAL INVESTOR": [
                {
                    key: "CORP_A",
                    label: "(a) corporation/partnership (portfolio ≥ HKD 8M OR total assets ≥ HKD 40M)",
                    requirementText: [
                        "Corporate Professional Investor (PI) – Category (a)",
                        "Category (a): A corporation/partnership having portfolio ≥ HKD 8,000,000 (or equivalent) OR total assets ≥ HKD 40,000,000 (or equivalent).",
                        "Supporting document(s) – provide certified true copies by insurance advisor / lawyer / accountant (Provide ONE of A1–A4):",
                        "A1 Most recent audited financial statements prepared within 16 months from application submission date; OR",
                        "A2 Statement(s) of account(s) or certificate(s) issued by a custodian within 12 months from application submission date; OR",
                        "A3 Certificate(s) issued by an auditor or a certified public accountant within 12 months from application submission date; OR",
                        "A4 Public filing(s) submitted by or on behalf of the corporation/partnership/trust corporation within 12 months from application submission date"
                    ].join("\n")
                },
                {
                    key: "CORP_B",
                    label: "(b) trust corporation (total assets ≥ HKD 40M)",
                    requirementText: [
                        "Corporate Professional Investor (PI) – Category (b)",
                        "Category (b): A trust corporation having been entrusted under the trust(s) of which it acts as trustee with total assets ≥ HKD 40,000,000 (or equivalent).",
                        "Supporting document(s) – provide certified true copies by insurance advisor / lawyer / accountant (Provide ONE of A1–A4):",
                        "A1 Most recent audited financial statements prepared within 16 months from application submission date; OR",
                        "A2 Statement(s) of account(s) or certificate(s) issued by a custodian within 12 months from application submission date; OR",
                        "A3 Certificate(s) issued by an auditor or a certified public accountant within 12 months from application submission date; OR",
                        "A4 Public filing(s) submitted by or on behalf of the corporation/partnership/trust corporation within 12 months from application submission date"
                    ].join("\n")
                },
                {
                    key: "CORP_C",
                    label: "(c) investment-holding corporation wholly owned by PI / specified PI",
                    requirementText: [
                        "Corporate Professional Investor (PI) – Category (c)",
                        "Category (c): A corporation whose principal business is to hold investments and is wholly owned by one or more qualified persons (Corporate PI / Individual PI / Specified Professional Investor).",
                        "Supporting document(s) – provide certified true copies by insurance advisor / lawyer / accountant (Provide ONE of A1–A4):",
                        "A1 Most recent audited financial statements prepared within 16 months from application submission date; OR",
                        "A2 Statement(s) of account(s) or certificate(s) issued by a custodian within 12 months from application submission date; OR",
                        "A3 Certificate(s) issued by an auditor or a certified public accountant within 12 months from application submission date; OR",
                        "A4 Public filing(s) submitted by or on behalf of the corporation/partnership/trust corporation within 12 months from application submission date",
                        "Additional documents to be required:",
                        "B1a Proof to demonstrate the ownership of the corporation (e.g. company search result, company annual return, shareholders’ register, etc.) issued within 12 months from application submission date; AND",
                        "B1b Documents to ascertain the principal business of the corporation is to hold investments (e.g. Business Registration Certificate); AND",
                        "B1c Documents to ascertain relevant information of the relevant individual(s) or corporation(s), as applicable (e.g. evidence that relevant party is Corporate PI / Individual PI / Specified Professional Investor)."
                    ].join("\n")
                },
                {
                    key: "CORP_D",
                    label: "(d) corporation wholly owns a corporation referred to in 2(a)",
                    requirementText: [
                        "Corporate Professional Investor (PI) – Category (d)",
                        "Category (d): A corporation which wholly owns a corporation referred to in category 2(a).",
                        "Supporting document(s) – provide certified true copies by insurance advisor / lawyer / accountant (Provide ONE of A1–A4):",
                        "A1 Most recent audited financial statements prepared within 16 months from application submission date; OR",
                        "A2 Statement(s) of account(s) or certificate(s) issued by a custodian within 12 months from application submission date; OR",
                        "A3 Certificate(s) issued by an auditor or a certified public accountant within 12 months from application submission date; OR",
                        "A4 Public filing(s) submitted by or on behalf of the corporation/partnership/trust corporation within 12 months from application submission date"
                    ].join("\n")
                }
            ]
        };

                // Country List updated based on country.txt
        const COUNTRY_LIST = [
            { name: "Afghanistan", risk: "High" }, { name: "Åland Islands", risk: "High" }, { name: "Albania", risk: "Medium" }, { name: "Algeria", risk: "High" },
            { name: "American Samoa", risk: "High" }, { name: "Andorra", risk: "Medium" }, { name: "Angola", risk: "High" }, { name: "Anguilla", risk: "High" },
            { name: "Antarctica", risk: "High" }, { name: "Antigua and Barbuda", risk: "High" }, { name: "Argentina", risk: "Medium" }, { name: "Armenia", risk: "Low" },
            { name: "Aruba", risk: "Medium" }, { name: "Australia", risk: "Low" }, { name: "Austria", risk: "Low" }, { name: "Azerbaijan", risk: "Medium" },
            { name: "Bahamas (the)", risk: "Medium" }, { name: "Bahrain", risk: "Low" }, { name: "Bangladesh", risk: "High" }, { name: "Barbados", risk: "Medium" },
            { name: "Belarus", risk: "High" }, { name: "Belgium", risk: "Low" }, { name: "Belize", risk: "Medium" }, { name: "Benin", risk: "High" },
            { name: "Bermuda", risk: "Medium" }, { name: "Bhutan", risk: "Medium" }, { name: "Bolivia (Plurinational State of)", risk: "High" }, { name: "Bonaire Sint Eustatius and Saba", risk: "High" },
            { name: "Bosnia and Herzegovina", risk: "Medium" }, { name: "Botswana", risk: "Medium" }, { name: "Bouvet Island", risk: "High" }, { name: "Brazil", risk: "Medium" },
            { name: "British Indian Ocean Territory (the)", risk: "High" }, { name: "Brunei Darussalam", risk: "Medium" }, { name: "Bulgaria", risk: "High" }, { name: "Burkina Faso", risk: "High" },
            { name: "Burundi", risk: "High" }, { name: "Cabo Verde", risk: "High" }, { name: "Cambodia", risk: "High" }, { name: "Cameroon", risk: "High" },
            { name: "Canada", risk: "Low" }, { name: "Cayman Islands (the)", risk: "Medium" }, { name: "Central African Republic (the)", risk: "High" }, { name: "Chad", risk: "High" },
            { name: "Chile", risk: "Medium" }, { name: "China", risk: "Medium" }, { name: "Christmas Island", risk: "High" }, { name: "Cocos (Keeling) Islands (the)", risk: "High" },
            { name: "Colombia", risk: "High" }, { name: "Comoros (the)", risk: "High" }, { name: "Congo (Republic of)", risk: "High" }, { name: "Congo (the Democratic Republic of the)", risk: "High" },
            { name: "Cook Islands (the)", risk: "Medium" }, { name: "Costa Rica", risk: "Medium" }, { name: "Côte d'Ivoire", risk: "High" }, { name: "Crimea", risk: "High" },
            { name: "Croatia", risk: "Medium" }, { name: "Cuba", risk: "High" }, { name: "Curaçao", risk: "High" }, { name: "Cyprus", risk: "Medium" },
            { name: "Czechia", risk: "Medium" }, { name: "Denmark", risk: "Low" }, { name: "Djibouti", risk: "Medium" }, { name: "Dominica", risk: "Medium" },
            { name: "Dominican Republic (the)", risk: "Medium" }, { name: "Ecuador", risk: "Medium" }, { name: "Egypt", risk: "Medium" }, { name: "El Salvador", risk: "Medium" },
            { name: "Equatorial Guinea", risk: "High" }, { name: "Eritrea", risk: "High" }, { name: "Estonia", risk: "Low" }, { name: "Eswatini", risk: "High" },
            { name: "Ethiopia", risk: "High" }, { name: "Falkland Islands (the) [Malvinas]", risk: "High" }, { name: "Faroe Islands", risk: "High" }, { name: "Fiji", risk: "High" },
            { name: "Finland", risk: "Low" }, { name: "France", risk: "Low" }, { name: "French Guiana", risk: "High" }, { name: "French Polynesia", risk: "High" },
            { name: "French Southern Territories (the)", risk: "High" }, { name: "Gabon", risk: "High" }, { name: "Gambia (the)", risk: "High" }, { name: "Georgia", risk: "Low" },
            { name: "Germany", risk: "Low" }, { name: "Ghana", risk: "Medium" }, { name: "Gibraltar", risk: "Medium" }, { name: "Greece", risk: "Low" },
            { name: "Greenland", risk: "Medium" }, { name: "Grenada", risk: "High" }, { name: "Guadeloupe", risk: "High" }, { name: "Guam", risk: "High" },
            { name: "Guatemala", risk: "High" }, { name: "Guernsey", risk: "Medium" }, { name: "Guinea", risk: "High" }, { name: "Guinea-Bissau", risk: "High" },
            { name: "Guyana", risk: "Low" }, { name: "Haiti", risk: "High" }, { name: "Heard Island and McDonald Islands", risk: "High" }, { name: "Holy See (the)", risk: "Medium" },
            { name: "Honduras", risk: "Medium" }, { name: "Hong Kong", risk: "Medium" }, { name: "Hungary", risk: "Medium" }, { name: "Iceland", risk: "Low" },
            { name: "India", risk: "Medium" }, { name: "Indonesia", risk: "Medium" }, { name: "Iran (Islamic Republic of)", risk: "High" }, { name: "Iraq", risk: "High" },
            { name: "Ireland", risk: "Low" }, { name: "Isle of Man", risk: "Medium" }, { name: "Israel", risk: "High" }, { name: "Italy", risk: "Low" },
            { name: "Jamaica", risk: "Medium" }, { name: "Japan", risk: "Low" }, { name: "Jersey", risk: "Low" }, { name: "Jordan", risk: "Medium" },
            { name: "Kazakhstan", risk: "Medium" }, { name: "Kenya", risk: "High" }, { name: "Kiribati", risk: "High" }, { name: "Korea (the Democratic People's Republic of)", risk: "High" },
            { name: "Korea (the Republic of)", risk: "Low" }, { name: "Kosovo", risk: "Medium" }, { name: "Kuwait", risk: "Medium" }, { name: "Kyrgyzstan", risk: "Medium" },
            { name: "Lao People's Democratic Republic (the)", risk: "High" }, { name: "Latvia", risk: "Medium" }, { name: "Lebanon", risk: "High" }, { name: "Lesotho", risk: "Medium" },
            { name: "Liberia", risk: "High" }, { name: "Libya", risk: "High" }, { name: "Liechtenstein", risk: "Medium" }, { name: "Lithuania", risk: "Low" },
            { name: "Luxembourg", risk: "Low" }, { name: "Macao", risk: "Medium" }, { name: "Madagascar", risk: "Medium" }, { name: "Malawi", risk: "Medium" },
            { name: "Malaysia", risk: "Medium" }, { name: "Maldives", risk: "High" }, { name: "Mali", risk: "High" }, { name: "Malta", risk: "Medium" },
            { name: "Marshall Islands (the)", risk: "Medium" }, { name: "Martinique", risk: "High" }, { name: "Mauritania", risk: "Medium" }, { name: "Mauritius", risk: "Medium" },
            { name: "Mayotte", risk: "High" }, { name: "Mexico", risk: "Medium" }, { name: "Micronesia (Federated States of)", risk: "High" }, { name: "Moldova (the Republic of)", risk: "High" },
            { name: "Monaco", risk: "High" }, { name: "Mongolia", risk: "Medium" }, { name: "Montenegro", risk: "Medium" }, { name: "Montserrat", risk: "Medium" },
            { name: "Morocco", risk: "Medium" }, { name: "Mozambique", risk: "High" }, { name: "Myanmar", risk: "High" }, { name: "Namibia", risk: "High" },
            { name: "Nauru", risk: "Medium" }, { name: "Nepal", risk: "High" }, { name: "Netherlands (the)", risk: "Low" }, { name: "Netherlands Antilles", risk: "High" },
            { name: "New Caledonia", risk: "High" }, { name: "New Zealand", risk: "Low" }, { name: "Nicaragua", risk: "High" }, { name: "Niger (the)", risk: "High" },
            { name: "Nigeria", risk: "High" }, { name: "Niue", risk: "Medium" }, { name: "Norfolk Island", risk: "High" }, { name: "North Macedonia", risk: "Medium" },
            { name: "Northern Mariana Islands (the)", risk: "High" }, { name: "Norway", risk: "Low" }, { name: "Oman", risk: "Medium" }, { name: "Pakistan", risk: "High" },
            { name: "Palau", risk: "High" }, { name: "Palestine State of", risk: "High" }, { name: "Panama", risk: "High" }, { name: "Papua New Guinea", risk: "High" },
            { name: "Paraguay", risk: "Medium" }, { name: "Peru", risk: "Medium" }, { name: "Philippines (the)", risk: "High" }, { name: "Pitcairn", risk: "High" },
            { name: "Poland", risk: "Medium" }, { name: "Portugal", risk: "Low" }, { name: "Puerto Rico", risk: "High" }, { name: "Qatar", risk: "Low" },
            { name: "Réunion", risk: "High" }, { name: "Romania", risk: "Medium" }, { name: "Russian Federation (the)", risk: "High" }, { name: "Rwanda", risk: "High" },
            { name: "Saint Barthélemy", risk: "High" }, { name: "Saint Helena - Ascension and Tristan da Cunha", risk: "High" }, { name: "Saint Kitts and Nevis", risk: "High" }, { name: "Saint Lucia", risk: "High" },
            { name: "Saint Martin (French part)", risk: "High" }, { name: "Saint Pierre and Miquelon", risk: "High" }, { name: "Saint Vincent and the Grenadines", risk: "Medium" }, { name: "Samoa", risk: "High" },
            { name: "San Marino", risk: "Low" }, { name: "Sao Tome and Principe", risk: "High" }, { name: "Saudi Arabia", risk: "Medium" }, { name: "Senegal", risk: "Medium" },
            { name: "Serbia", risk: "Medium" }, { name: "Seychelles", risk: "High" }, { name: "Sierra Leone", risk: "Medium" }, { name: "Singapore", risk: "Low" },
            { name: "Sint Maarten (Dutch part)", risk: "High" }, { name: "Slovakia", risk: "Medium" }, { name: "Slovenia", risk: "Low" }, { name: "Solomon Islands", risk: "High" },
            { name: "Somalia", risk: "High" }, { name: "South Africa", risk: "High" }, { name: "South Georgia and the South Sandwich Islands", risk: "High" }, { name: "South Sudan", risk: "High" },
            { name: "Spain", risk: "Low" }, { name: "Sri Lanka", risk: "Medium" }, { name: "Sudan (the)", risk: "High" }, { name: "Suriname", risk: "High" },
            { name: "Svalbard and Jan Mayen", risk: "High" }, { name: "Sweden", risk: "Low" }, { name: "Switzerland", risk: "Low" }, { name: "Syrian Arab Republic (the)", risk: "High" },
            { name: "Taiwan (Province of China)", risk: "Low" }, { name: "Tajikistan", risk: "Medium" }, { name: "Tanzania the United Republic of", risk: "High" }, { name: "Thailand", risk: "Medium" },
            { name: "Timor-Leste", risk: "Medium" }, { name: "Togo", risk: "High" }, { name: "Tokelau", risk: "High" }, { name: "Tonga", risk: "High" },
            { name: "Trinidad and Tobago", risk: "High" }, { name: "Tunisia", risk: "High" }, { name: "Turkey", risk: "High" }, { name: "Turkmenistan", risk: "Medium" },
            { name: "Turks and Caicos Islands (the)", risk: "High" }, { name: "Tuvalu", risk: "Medium" }, { name: "Uganda", risk: "Medium" }, { name: "Ukraine", risk: "High" },
            { name: "United Arab Emirates (the)", risk: "Medium" }, { name: "United Kingdom of Great Britain and Northern Ireland (the)", risk: "Low" }, { name: "United States Minor Outlying Islands (the)", risk: "High" }, { name: "United States of America (the)", risk: "Medium" },
            { name: "Uruguay", risk: "Low" }, { name: "Uzbekistan", risk: "Medium" }, { name: "Vanuatu", risk: "High" }, { name: "Venezuela (Bolivarian Republic of)", risk: "High" },
            { name: "Viet Nam", risk: "High" }, { name: "Virgin Islands (British)", risk: "High" }, { name: "Virgin Islands (U.S.)", risk: "High" }, { name: "Wallis and Futuna", risk: "High" },
            { name: "Western Sahara*", risk: "High" }, { name: "Yemen", risk: "High" }, { name: "Zambia", risk: "Medium" }, { name: "Zimbabwe", risk: "High" }
        ];


// [UPDATE] Resident Loading consts
// resident_loading_const.txt
// Generated from: resident loading.pdf (Underwriting Manual Jun 2025) - Section 12 Geographical Rating
// Keys: Residency (English). Values include residency zh + loadings for life and CI.

const RESIDENT_LOADING = {
  "Andorra": {
    "zh": "安道爾公國",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Australia": {
    "zh": "澳洲",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Austria": {
    "zh": "奧地利",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Argentina": {
    "zh": "阿根廷",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Bahrain": {
    "zh": "巴林",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Bangladesh (Dhaka only)": {
    "zh": "孟加拉國 (只適用城市達卡)",
    "life": {
      "type": "extra_per_1000",
      "amount": 3,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Belgium": {
    "zh": "比利時",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Belize": {
    "zh": "伯利茲",
    "life": {
      "type": "extra_per_1000",
      "amount": 3,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Bermuda": {
    "zh": "百慕達",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Brazil": {
    "zh": "巴西",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Brunei": {
    "zh": "汶萊",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Bulgaria": {
    "zh": "保加利亞",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "standard"
    }
  },
  "British Virgin Islands": {
    "zh": "英屬維爾京群島",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Canada": {
    "zh": "加拿大",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Canary Island": {
    "zh": "加那利亞群島",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Cayman Islands": {
    "zh": "開曼群島",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Chile": {
    "zh": "智利",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "China": {
    "zh": "中國",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Costa Rica": {
    "zh": "哥斯達黎加",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Curacao": {
    "zh": "庫拉索",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Cyprus (Greek)": {
    "zh": "塞浦路斯",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Czech Republic": {
    "zh": "捷克共和國",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Denmark": {
    "zh": "丹麥",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Dominica": {
    "zh": "多米尼克國",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Estonia": {
    "zh": "愛沙尼亞",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Fiji": {
    "zh": "斐濟",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Finland": {
    "zh": "芬蘭",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "France": {
    "zh": "法國",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Germany": {
    "zh": "德國",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Greece": {
    "zh": "希臘",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Greenland": {
    "zh": "格陵蘭",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Holland": {
    "zh": "荷蘭",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Honduras": {
    "zh": "洪都拉斯",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Hong Kong": {
    "zh": "香港",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Hungary": {
    "zh": "匈牙利",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "India": {
    "zh": "印度6",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "extra_per_1000",
      "amount": 8,
      "currency_symbol": "$"
    }
  },
  "Indonesia": {
    "zh": "印尼7",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Ireland": {
    "zh": "愛爾蘭",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Israel": {
    "zh": "以色列 (All except West Bank & Gaza Strip) (約旦河西岸及加沙地帶除外)",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$",
      "war_exclusion": true
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Isle of Man": {
    "zh": "馬恩島",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Italy": {
    "zh": "意大利",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Japan": {
    "zh": "日本",
    "life": {
      "type": "case_by_case"
    },
    "ci": {
      "type": "case_by_case"
    }
  },
  "Jordan": {
    "zh": "約旦",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Kuwait": {
    "zh": "科威特",
    "life": {
      "type": "extra_per_1000",
      "amount": 1,
      "currency_symbol": "$",
      "war_exclusion": true
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Kenya": {
    "zh": "肯亞",
    "life": {
      "type": "extra_per_1000",
      "amount": 3,
      "currency_symbol": "$",
      "war_exclusion": true
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Latvia": {
    "zh": "拉脫維亞",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Liechtenstein": {
    "zh": "列支敦士登",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Lithuania": {
    "zh": "立陶宛",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Luxembourg": {
    "zh": "盧森堡",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Macau": {
    "zh": "澳門",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Malaysia": {
    "zh": "馬來西亞",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Maldives": {
    "zh": "馬爾代夫",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Malta": {
    "zh": "馬耳他",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Martinique": {
    "zh": "馬提尼克",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Mexico": {
    "zh": "墨西哥",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Monaco": {
    "zh": "摩納哥",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Montserrat": {
    "zh": "蒙哲臘",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Morocco": {
    "zh": "摩洛哥",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Netherlands Antilles": {
    "zh": "荷屬安的列斯",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "New Zealand": {
    "zh": "新西蘭",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "New Caledonia": {
    "zh": "新喀里多尼亞",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Northern Mariana Islands": {
    "zh": "北馬里亞納群島",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Nigeria": {
    "zh": "尼日利亞",
    "life": {
      "type": "extra_per_1000",
      "amount": 3,
      "currency_symbol": "$",
      "war_exclusion": true
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Norway": {
    "zh": "挪威",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Oman": {
    "zh": "阿曼",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Paraguay": {
    "zh": "巴拉圭",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Peru": {
    "zh": "秘魯",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Philippines": {
    "zh": "菲律賓8",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "extra_per_1000",
      "amount": 8,
      "currency_symbol": "$"
    }
  },
  "Poland": {
    "zh": "波蘭",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Portugal": {
    "zh": "葡萄牙",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Puerto Rico": {
    "zh": "波多黎各",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Qatar": {
    "zh": "卡塔爾",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Romania": {
    "zh": "羅馬尼亞",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "standard"
    }
  },
  "San Marino": {
    "zh": "聖馬連奴",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Singapore": {
    "zh": "星加坡",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Slovakia": {
    "zh": "斯洛伐克",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Saudi Arabia": {
    "zh": "沙特阿拉伯",
    "life": {
      "type": "extra_per_1000",
      "amount": 1,
      "currency_symbol": "$",
      "war_exclusion": true
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "South Africa": {
    "zh": "南非9",
    "life": {
      "type": "extra_per_1000",
      "amount": 3,
      "currency_symbol": "$",
      "war_exclusion": true
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Solomon Island": {
    "zh": "所羅門群島",
    "life": {
      "type": "extra_per_1000",
      "amount": 3,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "South Korea": {
    "zh": "南韓",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Spain": {
    "zh": "西班牙",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Sri Lanka": {
    "zh": "斯里蘭卡",
    "life": {
      "type": "extra_per_1000",
      "amount": 3,
      "currency_symbol": "$",
      "war_exclusion": true
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "St Kitts & Nevis": {
    "zh": "聖傑氏尼維 斯",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "St Lucia": {
    "zh": "聖盧西亞",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "St Vincent & Grenadines": {
    "zh": "聖文森特和格林及納丁斯",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Sweden": {
    "zh": "瑞典",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Switzerland": {
    "zh": "瑞士",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Taiwan": {
    "zh": "台灣",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Thailand": {
    "zh": "泰國10",
    "life": {
      "type": "conditional_standard_selected_cities",
      "extra_per_1000_unselected_cities": 1,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Tonga": {
    "zh": "湯加",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Trinidad and Tobago": {
    "zh": "千里達及多巴哥",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Turkey": {
    "zh": "土耳其",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Turks & Caicos Islands": {
    "zh": "特克斯和凱科斯群島",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "United Arab Emirates (UAE)": {
    "zh": "亞聯酋",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "United Kingdom": {
    "zh": "英國",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "USA": {
    "zh": "美國",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Uruguay": {
    "zh": "烏拉圭",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Vatican City": {
    "zh": "梵蒂岡",
    "life": {
      "type": "standard"
    },
    "ci": {
      "type": "standard"
    }
  },
  "Vietnam": {
    "zh": "越南11",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Virgin Islands": {
    "zh": "美屬處女群島",
    "life": {
      "type": "extra_per_1000",
      "amount": 2,
      "currency_symbol": "$"
    },
    "ci": {
      "type": "not_applicable"
    }
  },
  "Others": {
    "zh": "其他",
    "life": {
      "type": "case_by_case"
    },
    "ci": {
      "type": "case_by_case"
    }
  }
};

// Supplementary Benefits mapping rule (based on Basic Life plan geographical rating):
const SUPP_BENEFIT_LOADING_RULE = {
  "standard": {
    "supplementary": "standard"
  },
  "extra_per_1000": {
    "1": {
      "multiplier": 1.5
    },
    "2": {
      "multiplier": 2.0
    },
    "3_or_above": {
      "supplementary": "not_acceptable"
    }
  }
};

// Optional helper: normalize input and lookup
function getResidentLoading(residency) {
  if (!residency) return null;
  const key = String(residency).trim();
  return RESIDENT_LOADING[key] || null;
}


// [UPDATE] Resident Loading formatter for UI display
function formatResidentLoadingRule(rule) {
  if (!rule || !rule.type) return null;
  switch (rule.type) {
    case "standard":
      return "Standard";
    case "case_by_case":
      return "Case by case";
    case "not_applicable":
      return "N/A";
    case "extra_per_1000": {
      const sym = rule.currency_symbol || "$";
      const war = rule.war_exclusion ? " (War exclusion)" : "";
      return `${sym}${rule.amount} per 1,000${war}`;
    }
    case "conditional_standard_selected_cities": {
      const sym = rule.currency_symbol || "$";
      const war = rule.war_exclusion ? " (War exclusion)" : "";
      return `Conditional standard (selected cities); unselected cities: ${sym}${rule.extra_per_1000_unselected_cities} per 1,000${war}`;
    }
    default:
      return rule.type;
  }
}


        // [UPDATE Req 9] Master Occupation Database containing data from all provided CSVs
                const OCCUPATION_DB = [
                { title: "農夫（一般耕作）", titleEn: "Farmer (general farming)", life: "STD", ci: "STD", wp: "STD", industry: "Agriculture & Fisheries / 漁農業" },
                { title: "農夫（飼養生禽）", titleEn: "Farmer (poultry)", life: "STD", ci: "STD", wp: "STD", industry: "Agriculture & Fisheries / 漁農業" },
                { title: "漁夫（漁塘，湖及河）", titleEn: "Fisherman (pond, lake & river)", life: "STD", ci: "STD", wp: "STD", industry: "Agriculture & Fisheries / 漁農業" },
                { title: "漁夫（在香港水域範圍內）", titleEn: "Fisherman (within Hong Kong waters)", life: "STD", ci: "STD", wp: "1.5x", industry: "Agriculture & Fisheries / 漁農業" },
                { title: "漁夫（在香港水域範圍外）", titleEn: "Fisherman (outside Hong Kong waters)", life: "2.0/M", ci: "1.5x", wp: "1.5x", industry: "Agriculture & Fisheries / 漁農業" },
                { title: "園丁", titleEn: "Gardener", life: "STD", ci: "STD", wp: "STD", industry: "Agriculture & Fisheries / 漁農業" },
                { title: "行李／貨運處理員", titleEn: "Baggage/Freight Handler", life: "STD", ci: "STD", wp: "STD", industry: "Aviation / 航空" },
                { title: "工程師（只負責地勤工作）", titleEn: "Engineer (ground duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Aviation / 航空" },
                { title: "班次／交通監督及督導", titleEn: "Flight/Traffic Superintendent & Supervisor", life: "STD", ci: "STD", wp: "STD", industry: "Aviation / 航空" },
                { title: "食物運送工人", titleEn: "Food Deliveryman", life: "STD", ci: "STD", wp: "STD", industry: "Aviation / 航空" },
                { title: "加油工人", titleEn: "Fueling Attendant", life: "STD", ci: "STD", wp: "STD", industry: "Aviation / 航空" },
                { title: "地勤空姐", titleEn: "Ground Hostess", life: "STD", ci: "STD", wp: "STD", industry: "Aviation / 航空" },
                { title: "督察（只負責地勤工作）", titleEn: "Inspector (ground duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Aviation / 航空" },
                { title: "機埸技工", titleEn: "Mechanic (airport)", life: "STD", ci: "STD", wp: "STD", industry: "Aviation / 航空" },
                { title: "飛機師（商務航機）", titleEn: "Pilot (commercial airlines)", life: "STD", ci: "STD", wp: "STD", industry: "Aviation / 航空" },
                { title: "飛機師（非商務航機－先填妥航空問卷）", titleEn: "Pilot (non commercial airlines - complete aviation questionnaire)", life: "-", ci: "-", wp: "-", industry: "Aviation / 航空" },
                { title: "清潔工人（飛機倉）", titleEn: "Plane Cleaner (inside aircraft)", life: "STD", ci: "STD", wp: "STD", industry: "Aviation / 航空" },
                { title: "飛機油漆技工", titleEn: "Plane Painter", life: "STD", ci: "STD", wp: "1.5x", industry: "Aviation / 航空" },
                { title: "挑夫／搬運行李工人", titleEn: "Porter", life: "STD", ci: "STD", wp: "STD", industry: "Aviation / 航空" },
                { title: "無線電生", titleEn: "Radio Operator", life: "STD", ci: "STD", wp: "STD", industry: "Aviation / 航空" },
                { title: "飛機維修工人（只負責地勤工作）", titleEn: "Repairman (aircraft)", life: "STD", ci: "STD", wp: "STD", industry: "Aviation / 航空" },
                { title: "飛行服務員", titleEn: "Steward, Stewardess", life: "STD", ci: "STD", wp: "STD", industry: "Aviation / 航空" },
                { title: "飛行指導員", titleEn: "Traffic Director (ground duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Aviation / 航空" },
                { title: "天氣觀察員（只負責地勤工作）", titleEn: "Weather Observer (ground duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Aviation / 航空" },
                { title: "客戶／市埸拓展主任", titleEn: "Account/Marketing Executive", life: "STD", ci: "STD", wp: "STD", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "播音員（電台及電視）", titleEn: "Announcer (radio & television)", life: "STD", ci: "STD", wp: "STD", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "安裝天線人員（住宅及辦公室－室內）", titleEn: "Antenna Erector (house & office - inside building)", life: "STD", ci: "STD", wp: "STD", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "安裝天線人員（電視訊號發送機及維修員－需高空工作）", titleEn: "Antenna Erector (transmitter & maintenance man - work ouside upper floor)", life: "4/M", ci: "-", wp: "-", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "助理編輯", titleEn: "Assistant Editor", life: "STD", ci: "STD", wp: "STD", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "統籌（只負責辦公室工作）", titleEn: "Coordinator (office duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "撰稿員", titleEn: "Copy Writer", life: "STD", ci: "STD", wp: "STD", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "節目廣播員（唱片騎師）", titleEn: "D. J.", life: "STD", ci: "STD", wp: "STD", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "設計師", titleEn: "Designer", life: "STD", ci: "STD", wp: "STD", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "編輯", titleEn: "Editor", life: "STD", ci: "STD", wp: "STD", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "工程師", titleEn: "Engineer", life: "STD", ci: "STD", wp: "STD", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "操作機械工人（印刷及出版）", titleEn: "Labourer - by Machine (printing & publishing)", life: "STD", ci: "STD", wp: "STD", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "經理（只負責辦公室工作）", titleEn: "Manager (office duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "派報紙員", titleEn: "Newspaper Deliveryman", life: "STD", ci: "STD", wp: "STD", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "攝影師", titleEn: "Photographer", life: "STD", ci: "STD", wp: "STD", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "節目製作助理", titleEn: "Production & Program Assistant", life: "STD", ci: "STD", wp: "STD", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "收音機，電視機裝置工人及修理員", titleEn: "Radio, TV Installer & Repairman", life: "STD", ci: "STD", wp: "STD", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "記者(本地)", titleEn: "Reporter (local)", life: "STD", ci: "STD", wp: "STD", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "記者(海外)", titleEn: "Reporter (overseas)", life: "IC", ci: "IC", wp: "-", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "招牌光管安裝工人", titleEn: "Sign Board Erector", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "廣告招牌製作工人（高空工作）", titleEn: "Sign Board Painter (above ground level)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "廣告招牌製作工人（只負責地面工作）", titleEn: "Sign Board Painter (ground work duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "絲網印刷工人（印刷及出版）", titleEn: "Silk Screen Maker (printing & publishing)", life: "STD", ci: "STD", wp: "STD", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "電台及演播室導播", titleEn: "Studio & Station Director", life: "STD", ci: "STD", wp: "STD", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "副編輯", titleEn: "Sub-editor", life: "STD", ci: "STD", wp: "STD", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "總機控制員", titleEn: "Switchboard Controller", life: "STD", ci: "STD", wp: "STD", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "試機員", titleEn: "Tester", life: "STD", ci: "STD", wp: "STD", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "電線安裝工人", titleEn: "Wirer", life: "STD", ci: "STD", wp: "STD", industry: "Broadcasting, Media, Printing & Publishing / 廣播，傳媒，印刷及出版" },
                { title: "冷氣工程安裝工人及修理工人（無需高空工作）", titleEn: "Air Conditioning Installer & Repairman (inside building)", life: "STD", ci: "STD", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "冷氣工程（需於高空工作）", titleEn: "Air Conditioning Installer & Repairman (work outside upper floor)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "氣鎚操作員", titleEn: "Air Hammer Operator", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "警鐘系統安裝工人", titleEn: "Alarm System Installer", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "鋁窗架安裝工人（需高空工作）", titleEn: "Aluminium Window Frame Installer (work outside upper floor)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "鋁窗架安裝工人（需室內工作）", titleEn: "Aluminium Window Frame Worker (no outside upper floor)", life: "STD", ci: "STD", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "建築師／繪圖員（只負責辦公室工作）", titleEn: "Architect/Draftsman (office duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "爆石工人及其他爆炸品處理工人", titleEn: "Blaster & Others Handling Explosives", life: "4/M", ci: "-", wp: "-", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "砌磚及水泥匠（高速公路道路建築）", titleEn: "Brick & Cement Layer (highway, road construction)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "砌磚匠，泥水匠（地盆工作）", titleEn: "Bricklayer, Mason (at construction site)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "砌磚匠，泥水匠（霸，水閘，水塘，隧道工程）", titleEn: "Bricklayer, Mason (dam, lock, reservoir, tunnels construction)", life: "4/M", ci: "-", wp: "-", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "樓宇拆卸工人", titleEn: "Building Demolition Worker", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "鏟泥機操作員", titleEn: "Bulldozer Operator", life: "STD", ci: "STD", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "木匠（在建築物內工作）", titleEn: "Carpenter (work inside building)", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "木匠（在室外高空工作）", titleEn: "Carpenter (work outside upper floor)", life: "4/M", ci: "-", wp: "-", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "落石糞工人", titleEn: "Cement Worker", life: "4/M", ci: "-", wp: "-", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "鏈條工人", titleEn: "Chainman", life: "STD", ci: "STD", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "土木工程師", titleEn: "Civil Engineer", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "清潔工人（建築物外牆及玻璃幕牆）", titleEn: "Cleaner (outside building & curtain walls)", life: "4/M", ci: "-", wp: "-", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "混凝土機操作員", titleEn: "Concrete Mixer Operator", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "判頭及細判頭（巡視一般地盤建築工作）", titleEn: "Contractor & Sub-contractor (general construction site inspection)", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "判頭及細判頭（只負責辦公室工作）", titleEn: "Contractor & Sub-contractor (office duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "判頭（隧道，行人隧道建築－巡視地盤工作）", titleEn: "Contractor (tunnel, subway construction - site inspection)", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "起重機操作員", titleEn: "Craneman", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "玻璃幕牆安裝工人", titleEn: "Curtain Wall Installer", life: "4/M", ci: "-", wp: "-", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "動臂起重機橾作員", titleEn: "Derrickman", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "設計師（只負責室內工作）", titleEn: "Designer (indoor duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "繪圖員", titleEn: "Draughtsman", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "鑽機操作員（地盤工作）", titleEn: "Driller (at construction site)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "鑽機操作員（隧道，行人隧道建築）", titleEn: "Driller (tunnel, subway construction)", life: "4/M", ci: "-", wp: "-", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "司機", titleEn: "Driver", life: "STD", ci: "STD", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "電機工程師（地盤工作）", titleEn: "Electrician (at construction site)", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "電器技師（室內）", titleEn: "Electrician (indoor only)", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "電器技師（隧道，行人隧道建築）", titleEn: "Electrician (tunnel, subway construction)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "升降機修理員，安裝工人及檢驗員", titleEn: "Elevator Repairman, Installer & Inspector", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "工程師（冷氣工程－檢查工程）", titleEn: "Engineer (air conditioning - inspecting duties)", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "工程師（冷氣工程－只負責辦公室及顧問工作）", titleEn: "Engineer (air conditioning - office & consulting duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "工程師（地盤工作）", titleEn: "Engineer (at construction site)", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "工程師（電梯－只負責辦公室及督導工作）", titleEn: "Engineer (lifts - office work & supervision only)", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "工程師（隧道，行人隧道建築，高速公路）", titleEn: "Engineer (tunnel, subway construction, highway)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "機械安裝工人（需高空工作）", titleEn: "Erector (need outside upper floor)", life: "4/M", ci: "-", wp: "-", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "升降機安裝工人，檢驗員及修理員", titleEn: "Escalator Repairmen, Installer & Inspector", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "爆炸工人", titleEn: "Explosure Handler", life: "4/M", ci: "-", wp: "-", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "機器裝配工人", titleEn: "Fitter", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "管工（高速公路，道路建築）", titleEn: "Foreman (highway, road construction)", life: "STD", ci: "STD", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "管工（隧道，行人隧道建築）", titleEn: "Foreman (tunnel, subway construction)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "平土工人", titleEn: "Grader", life: "STD", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "吊機操作員", titleEn: "Hoist Operator", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "噴殺蟲劑工人", titleEn: "Insecticide Sprayer", life: "STD", ci: "STD", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "督察（電機）", titleEn: "Inspector (electrical)", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "扎鐵工人", titleEn: "Iron Tightening Worker", life: "4/M", ci: "-", wp: "-", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "掘網根工人（不需高空工作）", titleEn: "Iron Worker (no outside upper floor)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "管理員", titleEn: "Janitor", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "工人（散工）", titleEn: "Labourer (odd job)", life: "4/M", ci: "-", wp: "-", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "平水工人", titleEn: "Leveller", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "電梯服務員／操作員", titleEn: "Lift Attendant/Operator", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "電梯維修工人", titleEn: "Lift Repairman, Installer & Inspector", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "維修工人（電機，商業樓宇及工廠）", titleEn: "Maintenance Man (electrical, in office buildings & factories)", life: "STD", ci: "STD", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "操作員（挖溝機）", titleEn: "Operator (ditching)", life: "STD", ci: "STD", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "吊車司機（在控制室）", titleEn: "Ovary Crane Operator (in control room)", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "油漆工人（室內裝修）", titleEn: "Painter (indoor decoration)", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "油漆工人（高空體力勞動）", titleEn: "Painter (manual work at height)", life: "4/M", ci: "-", wp: "-", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "油漆工人（隧道，行人隧道建築）", titleEn: "Painter (tunnel, subway construction)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "打椿機操作員", titleEn: "Pile Operator", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "水喉匠（地盤工作）", titleEn: "Plumber (at construction site)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "水喉匠（家居）", titleEn: "Plumber (domestic)", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "工料及土地測量師", titleEn: "Quantity & Land Surveyor", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "修理工人（隧道及行人隧道建築並於高空工作）", titleEn: "Repairman (tunnel & subway construction and working at great height)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "裝配繩索工人", titleEn: "Rigger", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "安全主任", titleEn: "Safety Officer", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "噴沙工人", titleEn: "Sandblaster (at construction site)", life: "STD", ci: "STD", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "搭棚工人", titleEn: "Scaffolder", life: "6/M", ci: "-", wp: "-", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "鏟泥機工人（高速公路，道路建築）", titleEn: "Scrapper (highway, road construction)", life: "STD", ci: "STD", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "地盤文員", titleEn: "Site Clerk", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "地盤工頭", titleEn: "Site Foreman", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "花灑／防火警報器安裝員", titleEn: "Sprinkler/Fire Alarm Installer", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "蒸氣輾壓機司機", titleEn: "Steam-roller Driver", life: "STD", ci: "STD", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "碎石工人", titleEn: "Stone Crushman", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "鋪石工人", titleEn: "Stone Setter", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "監督（電梯，隧道及行人隧道建築）", titleEn: "Supervisor (lift, tunnel & subway construction)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "測量師（高速公路，道路建築）", titleEn: "Surveyor (highway, road construction)", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "交通幹線噴油工人", titleEn: "Traffic Lane Painter", life: "STD", ci: "STD", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "隧道工人", titleEn: "Tunnel Worker", life: "4/M", ci: "-", wp: "-", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "看更", titleEn: "Watchman", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "電焊工人及切割工人（室內）", titleEn: "Welder & Cutter (indoor)", life: "STD", ci: "STD", wp: "1.5x", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "電焊工人及切割工人（高空工作）", titleEn: "Welder & Cutter (outside upper floor)", life: "4/M", ci: "-", wp: "-", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "工人（室內裝修）", titleEn: "Worker (decoration)", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "釘板技工(釘板)（高空工作）", titleEn: "Erect formwork (work at height)", life: "4/M", ci: "-", wp: "-", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "釘板技工(釘板)（不用高空工作）", titleEn: "Erect formwork (Not work at height)", life: "STD", ci: "STD", wp: "STD", industry: "Building Construction, Maintenance & Management / 建造，建築物維修及管理" },
                { title: "分析員（化驗室）", titleEn: "Analyst (laboratory)", life: "STD", ci: "STD", wp: "STD", industry: "Education / 教育" },
                { title: "助理（化驗室）", titleEn: "Assistant (laboratory)", life: "STD", ci: "STD", wp: "STD", industry: "Education / 教育" },
                { title: "化驗師（藥劑或化驗）", titleEn: "Chemist (pharmaceutical or laboratory)", life: "STD", ci: "STD", wp: "STD", industry: "Education / 教育" },
                { title: "圖書管理員", titleEn: "Librarian", life: "STD", ci: "STD", wp: "STD", industry: "Education / 教育" },
                { title: "音樂師（教師）", titleEn: "Musician (Teacher)", life: "STD", ci: "STD", wp: "STD", industry: "Education / 教育" },
                { title: "校長，行政人員", titleEn: "Principle, Administrator", life: "STD", ci: "STD", wp: "STD", industry: "Education / 教育" },
                { title: "家庭教師", titleEn: "Private Tutor", life: "STD", ci: "STD", wp: "1.5x", industry: "Education / 教育" },
                { title: "學生", titleEn: "Student", life: "STD", ci: "STD", wp: "STD", industry: "Education / 教育" },
                { title: "教師，講師，全職導師，教授（機械工程）", titleEn: "Teacher, Lecturer, Full-time Tutor, Professor (mechanical engineering)", life: "STD", ci: "STD", wp: "STD", industry: "Education / 教育" },
                { title: "教師，講師，全職導師，教授（體育）", titleEn: "Teacher, Lecturer, Full-time Tutor, Professor (physical education)", life: "STD", ci: "STD", wp: "STD", industry: "Education / 教育" },
                { title: "教師，講師，全職導師，教授（鋼琴，一般科目）", titleEn: "Teacher, Lecturer, Full-time Tutor, Professor (piano lesson, general subject)", life: "STD", ci: "STD", wp: "STD", industry: "Education / 教育" },
                { title: "雜技人（馬戲團）", titleEn: "Acrobat (circus)", life: "-", ci: "-", wp: "-", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "男演員及女演員（參與拍攝武打片）", titleEn: "Actor & Actress (involved in martial arts)", life: "STD", ci: "STD", wp: "1.5x", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "男演員及女演員（不參與拍攝武打片）", titleEn: "Actor & Actress (not involved in martial arts)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "男演員及女演員（臨時）", titleEn: "Actor & Actress (temporary)", life: "STD", ci: "STD", wp: "1.5x", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "健康舞導師", titleEn: "Aerobic Dance Instructor", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "馴獸師", titleEn: "Animal Trainer", life: "-", ci: "-", wp: "-", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "助理監製（電影製作業）", titleEn: "Assistant Producer (film production industry)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "服務員（電視遊戲機中心）", titleEn: "Attendant (TV games center)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "服務員（桌球室）", titleEn: "Attendant (billiard room, snooker center)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "服務員（保齡球埸）", titleEn: "Attendant (bowling alley)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "服務員（的士高）", titleEn: "Attendant (disco)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "服務員（領有牌照的浴室，按摩院）", titleEn: "Attendant (licensed baths, masseur)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "服務員（麻雀館）", titleEn: "Attendant (mahjong school)", life: "4/M", ci: "-", wp: "-", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "調酒師（的士高）", titleEn: "Bartender (disco)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "調酒師（領有牌照的高級夜總會）", titleEn: "Bartender (licenced high class night club)", life: "STD", ci: "STD", wp: "1.5x", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "美容師（健身中心）", titleEn: "Beautician (health club)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "攝影師", titleEn: "Cameraman", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "荷官（賭場）", titleEn: "Card Dealer (casino)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "收銀員（遊樂埸，保齡球埸）", titleEn: "Cashier (amusement park, bowling alley)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "收銀員（賭埸）", titleEn: "Cashier (casino)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "收銀員（桌球中心，香港賽馬會，麻雀館，領有牌照的浴室，電視遊戲機中心）", titleEn: "Cashier (snooker center, RHKJC, mahjong school, licenced baths, TV game center)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "賭場職員 (賭場經理，賭場監察主管，洗牌房員工，籌碼兌換員，電腦支援員，文員，編更部員工，音響視像技術員，賭場技術員)", titleEn: "Casino General Staff (Casino Manger, Casino Supervisor Surveillance, Card room, IT support, clerk, scheduling, AV technician, casino technician)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "賭埸護衛員", titleEn: "Casino Security", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "賭場接待員，角子機服務員，賭埸侍應", titleEn: "Casino host, slot attendant, waiter,waitress (casino)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "清潔工人（賭場）", titleEn: "Cleaner (casino)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "清潔工人（室內）", titleEn: "Cleaner (indoor)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "唱片騎師（的士高）", titleEn: "D. J. (disco)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "舞蹈員（領有牌照的高級夜總會及酒吧）", titleEn: "Dancer (licenced high class night clubs & bars)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "舞蹈員（其他較低級的夜總會及酒吧）", titleEn: "Dancer (other lower class night clubs & bars)", life: "-", ci: "-", wp: "-", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "舞蹈員（表演行業－非夜總會及酒吧）", titleEn: "Dancer (show business - not in night clubs & bars)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "黑房技術員", titleEn: "Darkroom Technician", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "導演（電影製作業）", titleEn: "Director (film production industry)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "配音員（電影製作業）", titleEn: "Dubbing (film production industry)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "木匠電影佈景製作（不需高空工作）", titleEn: "Film Carpenter (work at ground)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "木匠電影佈景製作（高空工作）", titleEn: "Film Carpenter (work at height)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "健體班導師（健身中心）", titleEn: "Fitness Instructor (health club)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "足底/穴位按摩 ( 健康/ 美容治療中心 )", titleEn: "Foot / Body Massage (Health / Beauty Centre)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "遊戲機控制員（遊樂埸）", titleEn: "Game Operator (amusement park)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "髮型師（電影製作業）", titleEn: "Hair Stylist (film production industry)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "練馬師", titleEn: "Horse Trainer", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "騎師", titleEn: "Jockey", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "博彩中介人，公關 （賭埸）", titleEn: "Junket Promoter, PR (casino)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "馬伕", titleEn: "Mafoo", life: "STD", ci: "STD", wp: "1.5x", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "維修工人", titleEn: "Maintenance Man", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "化妝師（電影製作業）", titleEn: "Make Up (film production industry)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "經理（保齡球埸，馬戲團）", titleEn: "Manager (bowling alley, circus)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "經理（戲院）", titleEn: "Manager (cinema)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "經理（的士高，高級夜總會，麻雀館，電子遊戲機中心）", titleEn: "Manager (disco, high class night club, mahjong school, TV game center)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "經理（領有牌照的浴室，按摩院）", titleEn: "Manager (licenced baths, masseur)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "經理，營業董事(賭場)", titleEn: "Manager, Operation Director (casino)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "龍虎武師（電影製作業）", titleEn: "Martial Arts Fighter (film production industry)", life: "15/M", ci: "-", wp: "-", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "武術指導（電影製作業）", titleEn: "Martial Arts Instructor (film production industry)", life: "4/M", ci: "-", wp: "-", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "按摩女郎（領有牌照的浴室，按摩院）", titleEn: "Massage Girl (licenced baths, masseur)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "按摩師（酒店）", titleEn: "Masseur (hotel)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "按摩師（沒有領牌的浴室）", titleEn: "Masseur (not in licenced baths)", life: "-", ci: "-", wp: "-", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "音樂師（音樂會，流行音樂樂隊，管弦樂團）", titleEn: "Musician (concert, pop group, orchestra)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "音樂師（酒店，的士高，餐廳，高級夜總會及酒吧）", titleEn: "Musician (hotel, disco, restaurant, high class night club & bar)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "音樂師（較低級的夜總會）", titleEn: "Musician (lower class night club)", life: "-", ci: "-", wp: "-", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "老闆，獨資老闆（電子遊戲機中心）", titleEn: "Owner, Sole Proprietor (TV games center)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "埸務員（電影製作業）", titleEn: "Position Man (film production industry)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "公關經理（領有牌照的高級夜總會）", titleEn: "Pr Manager (licenced high class night club)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "監製（電影製作業）", titleEn: "Producer (film production industry)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "放影師（戲院）", titleEn: "Projectionist (cinema)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "接待員（領有牌照的浴室，按摩院）", titleEn: "Receptionist (licenced baths, masseur)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "接待員（領有牌照的高級夜總會）", titleEn: "Receptionist (licenced high class night club)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "修理員（保齡球埸，電子遊戲機中心）", titleEn: "Repairman (bowling alley, TV game center)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "修理工人（戲院）", titleEn: "Repairman (cinema)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "護衛員（領有牌照的浴室，按摩院）", titleEn: "Security Guard (licenced baths, masseur)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "護衛員（非持械）", titleEn: "Security Guard (unarmed)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "歌星（領有牌照的高級夜總會）", titleEn: "Singer (licenced high class night club)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "獨資老闆（領有牌照的高級夜總會）", titleEn: "Sole Proprietor (licenced high class night club)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "獨資老闆（麻雀館）", titleEn: "Sole Proprietor (mahjong school)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "馬房工人（賽馬）", titleEn: "Stableman (horse racing)", life: "STD", ci: "STD", wp: "2x", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "替身", titleEn: "Stuntman", life: "15/M", ci: "-", wp: "-", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "售票員", titleEn: "Ticket Seller", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "導遊（旅行社－本地）", titleEn: "Tour Escort (travel agency - local duties)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "導遊（旅行社－海外）", titleEn: "Tour Escort (travel agency - overseas duties)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "帶位（戲院）", titleEn: "Usher (cinema)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "侍應（的士高，領有牌照的高級夜總會）", titleEn: "Waiter (disco, licenced high class night club)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "女侍應（的士高）", titleEn: "Waitress (disco)", life: "STD", ci: "STD", wp: "STD", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "女侍應（領有牌照的高級夜總會）", titleEn: "Waitress (licenced high class night club)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Entertainment, Tourism & Leisure / 娛樂事業，旅遊及消遣" },
                { title: "營業員", titleEn: "Agent", life: "STD", ci: "STD", wp: "STD", industry: "Finance & Banking / 銀行及金融業" },
                { title: "會計師", titleEn: "Accountant", life: "STD", ci: "STD", wp: "STD", industry: "Finance & Banking / 銀行及金融業" },
                { title: "精算師", titleEn: "Actuary", life: "STD", ci: "STD", wp: "STD", industry: "Finance & Banking / 銀行及金融業" },
                { title: "押款車司機", titleEn: "Armoured Car Driver", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Finance & Banking / 銀行及金融業" },
                { title: "文員（其他辦公室行政職員－只負責辦公室工作）", titleEn: "Clerk (other office admin personnel - office duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Finance & Banking / 銀行及金融業" },
                { title: "主任（只負責辦公室工作）", titleEn: "Officer (office duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Finance & Banking / 銀行及金融業" },
                { title: "護衛員（持械）", titleEn: "Security Guard (armed)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Finance & Banking / 銀行及金融業" },
                { title: "出納員", titleEn: "Teller", life: "STD", ci: "STD", wp: "STD", industry: "Finance & Banking / 銀行及金融業" },
                { title: "核保／賠償／顧客服務部職員", titleEn: "Underwriting/Claims/POS Personnel", life: "STD", ci: "STD", wp: "STD", industry: "Finance & Banking / 銀行及金融業" },
                { title: "麵包師傅", titleEn: "Baker", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "吧孃（領有牌照的酒吧）", titleEn: "Bar Girl (licensed bar)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Food & Drink Retails / 飲食業" },
                { title: "調酒師（高級酒廊，卡拉OK，的士高）", titleEn: "Bartender (high class lounge, karaoke, disco)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "調酒師（其他領有牌照的酒吧）", titleEn: "Bartender (other licensed bar)", life: "STD", ci: "STD", wp: "1.5x", industry: "Food & Drink Retails / 飲食業" },
                { title: "調酒師（星級酒店的餐廳）", titleEn: "Bartender (star-rated hotel, restaurant)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "服務生，侍應生學徒（星級酒店）", titleEn: "Bell Boy, Bus Boy (star-rated hotel)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "買手（餐廳）", titleEn: "Buyer (restaurant)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "部長（星級酒店，餐廳）", titleEn: "Captain (star-rated hotel, restaurant)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "收銀員（星級酒店，餐廳）", titleEn: "Cashier (bar inside star-rated hotel, restaurant)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "收銀員（其他領牌照的酒吧）", titleEn: "Cashier (other licensed bar)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "廚師（酒店）", titleEn: "Cook (hotel)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "廚師（餐廳）", titleEn: "Cook (restaurant)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "推點心工人", titleEn: "Dim Sum Seller", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "司間（酒店）", titleEn: "Doorman (hotel)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "搓麵粉師傳（麵包店）", titleEn: "Dough-mixer (bakeries)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "領班（酒店）", titleEn: "Headwaiter (hotel)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "管房（酒店）", titleEn: "Housekeeper (hotel)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "門口警衛（酒店）", titleEn: "Janitor (hotel)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "廚房什工（酒店）", titleEn: "Kitchen Helper (hotel)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "廚房什工（餐廳）", titleEn: "Kitchen Helper (restaurant)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "洗衣工人（酒店）", titleEn: "Laundry Worker (hotel)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "維修工人，電器技工", titleEn: "Maintenanceman, Electrician", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "經理（星級酒店內的酒吧）", titleEn: "Manager (bar inside star-rated hotel)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "經理（非領有牌照的高級酒吧）", titleEn: "Manager (bar not in licensed high class bar)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "經理（餐廳）", titleEn: "Manager (restaurant)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "音樂師（高級酒廊，卡拉OK）", titleEn: "Musician (high class lounge, karaoke)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "接待員（酒店）", titleEn: "Receptionist (hotel)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "接待員（餐廳）", titleEn: "Receptionist (restaurant)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "巡房服務員（酒店）", titleEn: "Room Attendant (hotel)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "保安人員（酒店）", titleEn: "Security Guard (hotel)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "歌星（星級酒店內的酒吧）", titleEn: "Singer (bar inside star-rated hotel)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "歌星（高級酒廊，卡拉OK）", titleEn: "Singer (high class lounge, karaoke)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "歌星（非星級酒店）", titleEn: "Singer (non star-rated hotel)", life: "IC", ci: "IC", wp: "-", industry: "Food & Drink Retails / 飲食業" },
                { title: "獨資業權人，業權人（只負責行政工作）", titleEn: "Sole Proprietor, Owner (admin duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "獨資老闆，老闆（只參與少量體力勞動）", titleEn: "Sole Proprietor, Owner (little manual work involved)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "主任（餐應）", titleEn: "Supervisor (restaurant)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "侍應（高級酒廊，卡拉OK）", titleEn: "Waiter (high class lounge, karaoke)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "待應（星級酒店，餐廳）", titleEn: "Waiter (star-rated hotel, restaurant)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "女侍應（高級酒廊，卡拉OK）", titleEn: "Waitress (high class lounge, karaoke)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "女待應（星級酒店，餐廳）", titleEn: "Waitress (star-rated hotel, restaurant)", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "食品批發", titleEn: "Wholesaler", life: "STD", ci: "STD", wp: "STD", industry: "Food & Drink Retails / 飲食業" },
                { title: "漁農署（行動組人員）", titleEn: "Agriculture & Fisheries Department (operational personnel)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "民安隊職員", titleEn: "Civil Aid Services Personnel", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "商業犯罪調查人員", titleEn: "Commercial Crime Officer", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "懲教署（總監）", titleEn: "Correctional Service Department (superintendent)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "懲教署（導師）", titleEn: "Correctional Services Department (instructor)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "懲教署（懲教主任）", titleEn: "Correctional Services Department (officer)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "懲教署（員佐級）", titleEn: "Correctional Services Department (rank & file)", life: "STD", ci: "STD", wp: "1.5x", industry: "Governmental Departments / 政府部門" },
                { title: "法庭／裁判司署（法官，律師，傳譯員）", titleEn: "Court/Magistrates Office (judge, lawyer, interpreter)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "海關（督察）", titleEn: "Customs & Excise Department (inspector)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "海關（員佐級）", titleEn: "Customs & Excise Department (rank & file)", life: "STD", ci: "STD", wp: "1.5x", industry: "Governmental Departments / 政府部門" },
                { title: "海關（總監）", titleEn: "Customs & Excise Department (superintendent)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "環境保護主任", titleEn: "Environment Protection Officer", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "消防署（總監）", titleEn: "Fire Service Department (superintendent)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "消防處（救護隊長）", titleEn: "Fire Services Department (ambulance officer)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "消防署（總長）", titleEn: "Fire Services Department (chief officer)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "消防署（司機）", titleEn: "Fire Services Department (driver)", life: "STD", ci: "STD", wp: "1.5x", industry: "Governmental Departments / 政府部門" },
                { title: "消防署（消防員）", titleEn: "Fire Services Department (fireman)", life: "STD", ci: "STD", wp: "1.5x", industry: "Governmental Departments / 政府部門" },
                { title: "消防署（通風系統主任）", titleEn: "Fire Services Department (ventilation officer)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "一般事務隊（所有級別）", titleEn: "General Duties Team (all ranks)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "衛生督察", titleEn: "Health Inspector", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "廉政公署（社區主任）", titleEn: "ICAC (community officer)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "廉政公署（調查主任）", titleEn: "ICAC (investigation officer)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "人民入境事務署（入境事務署主任／助理入境署主任）", titleEn: "Immigration Department (officer/assistant officer)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "人民入境事務署（員佐級）", titleEn: "Immigration Department (rank & file)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "人民入境事務署（總監）", titleEn: "Immigration Department (superintendent)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "救生員（海灘及游泳池）", titleEn: "Life Guard (beach and pool)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "警察（偵緝警員）", titleEn: "Police (CID)", life: "STD", ci: "STD", wp: "1.5x", industry: "Governmental Departments / 政府部門" },
                { title: "警察（輔警－請參考正職的比率）", titleEn: "Police (auxillary - also refer to full time occupation rating)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "警察（署長）", titleEn: "Police (commissioner)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "警察（督察）", titleEn: "Police (inspector)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "警察（傳譯員）", titleEn: "Police (interpretor)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "警察（水警科）", titleEn: "Police (marine division)", life: "STD", ci: "STD", wp: "1.5x", industry: "Governmental Departments / 政府部門" },
                { title: "警察（員佐級）", titleEn: "Police (rank & file)", life: "STD", ci: "STD", wp: "1.5x", industry: "Governmental Departments / 政府部門" },
                { title: "警察（警長）", titleEn: "Police (sergeant)", life: "STD", ci: "STD", wp: "1.5x", industry: "Governmental Departments / 政府部門" },
                { title: "警察（特別調查科）", titleEn: "Police (special duties unit - SDU)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Governmental Departments / 政府部門" },
                { title: "警察（警司）", titleEn: "Police (superintendent)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "郵政署（櫃台服務員）", titleEn: "Post Office (counter clerk)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "郵政署（郵差）", titleEn: "Post Office (postman)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "難民營（導師）", titleEn: "Refugee Camp (instructor)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "難民營（教師）", titleEn: "Refugee Camp (teacher)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "難民營工人", titleEn: "Refugee Camp Worker", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "社會工作者（參與青少年活動，社區發展）", titleEn: "Social Worker (involved in youth functions, community development)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "社會工作者（只負責辦公室工作）", titleEn: "Social Worker (office duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "僭建管理", titleEn: "Squatter Control", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "交通督導員", titleEn: "Traffic Warden", life: "STD", ci: "STD", wp: "STD", industry: "Governmental Departments / 政府部門" },
                { title: "行政人員（只負責辦公室工作）", titleEn: "Administrator (office duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "裝配員（電子業）", titleEn: "Assembler (electronic)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "吹玻璃工人（玻璃及鏡片製造）", titleEn: "Blower (glass & mirror)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "吹氣工人（床墊及枕頭製造）", titleEn: "Blower (mattress & pillow)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "製盒／製紙袋工人（紙及紙漿業）", titleEn: "Box/Paper Bag Maker (paper & pulp)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "買手", titleEn: "Buyer", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "製蠟燭師傅", titleEn: "Candle Maker", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "木匠", titleEn: "Carpenter", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "地氈及粗毛氈", titleEn: "Carpets & Rugs (worker)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "化學產品製造工人", titleEn: "Chemical Manufacturing Worker", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "上色工人（人造皮／花）", titleEn: "Coater (artificial leather/flower)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "混色／配色工人（人造皮／花）", titleEn: "Color Mixer/Matcher (artificial leather/flower)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "切玻璃工人（玻璃及鏡片製造）", titleEn: "Cutter (glass & mirror)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "切棉工人（床墊及枕頭製造）", titleEn: "Cutter (mattress & pillow)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "設計師（紡織）", titleEn: "Designer (textile)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "染料攪拌工人（紡織）", titleEn: "Dye Mixer (textile)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "磨邊工人（玻璃及鏡片製造）", titleEn: "Edge-grinder (glass & mirror)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "電器技師（霓虹燈招牌）", titleEn: "Electrician (neon-lights)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "電鍍工人", titleEn: "Electroplating Worker", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "刺繡（紡織－住家）", titleEn: "Embroidery (textile - at home)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "刺繡（紡織－用電腦）", titleEn: "Embroidery (textile - using computer)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "工程師（電子業）", titleEn: "Engineer (electronic)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "工程師（紡織）", titleEn: "Engineer (textile)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "信封及紙袋製造工人", titleEn: "Envelope & Paper Bag Maker", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "爆炸品製造工人", titleEn: "Explosive Manufacturing Worker", life: "4/M", ci: "-", wp: "-", industry: "Manufacturing / 製造業" },
                { title: "毛氈工人（床墊及枕頭製造）", titleEn: "Felter (mattress & pillow)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "填料工人（床墊及枕頭製造）", titleEn: "Filler (mattress & pillow)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "修飾工人（紙及紙漿業）", titleEn: "Finisher (paper & pulp)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "煙花及爆竹工人", titleEn: "Fire Works & Fire Cracker Worker", life: "4/M", ci: "-", wp: "-", industry: "Manufacturing / 製造業" },
                { title: "燧石工人（陶瓷）", titleEn: "Flinter (pottery)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "管工（人造皮／花）", titleEn: "Foreman (artificial leather/flower)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "管工（石棉製造業）", titleEn: "Foreman (asbestos)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "管工（電木業，塑膠業）", titleEn: "Foreman (bakelite, plastic)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "管工（製磚業－不參與製造工作）", titleEn: "Foreman (brick manufacture - not involved in production)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "皮草工人", titleEn: "Fur Maker", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "熔爐工人（玻璃）", titleEn: "Furnaceman (glass making)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "熔爐工人（五金）", titleEn: "Furnaceman (metal)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "傢俬製造工人", titleEn: "Furniture Maker", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "電鍍工人及錫匠", titleEn: "Galvanizer & Tinner", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "普通工人（肥皂及洗潔精製造業）", titleEn: "General Labourer (soap & detergent)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "普通工人（煉糖廠及紡織）", titleEn: "General Labourer (sugar refineries & textile industry)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "玻璃匠", titleEn: "Glass Blender", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "磨工（製磚業）", titleEn: "Grinder (brick manufacture)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "手袋製造工人", titleEn: "Handbag Maker", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "從事危險性行業的工人", titleEn: "Hazardous Industry Worker", life: "-", ci: "-", wp: "-", industry: "Manufacturing / 製造業" },
                { title: "金屬溶爐（金屬／五金行業）", titleEn: "Heating & Melter (metal industry)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "殺蟲劑製造工人（接觸有毒化學物）", titleEn: "Insecticide Worker (exposed to poisonous chemicals)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "殺蟲劑製造工人（不會接觸有毒化學物）", titleEn: "Insecticide Worker (not exposed to poisonous chemicals)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "檢查員（人造皮／花）", titleEn: "Inspector (artificial leather/flower)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "檢查員（石棉製造業）", titleEn: "Inspector (asbestos)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "熨衫（紡織）", titleEn: "Ironer (textile)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "珠寶商人", titleEn: "Jewellery Merchant", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "鑲珠寶工人", titleEn: "Jewellery Worker", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "工人（石棉，陶器）", titleEn: "Labourer (asbestos, pottery)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "工人（製電池，製磚業）", titleEn: "Labourer (battery, brick manufacture)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "工人（紡造業）", titleEn: "Labourer (knitting)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "機器操作員（製磚，輪胎製造）", titleEn: "Machine Operator (brick, tyre manufacture)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "機器操作員（床墊及枕頭製造）", titleEn: "Machine Operator (mattress & pillow)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "機器操作員（煉煻廠，煙草，雪茄及香煙製造）", titleEn: "Machine Operator (sugar refineries, tobacco, cigar & cigarette manufacture)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "機器操作員（紙及紙漿業－造紙過程）", titleEn: "Machine Tender (paper & pulp - paper making operation)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "維修工人（霓虹燈招牌）", titleEn: "Maintenance Man (neon-light signs)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "經理（只負責辦公室工作）", titleEn: "Manager (office duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "混合機操作員（製磚）", titleEn: "Mixer (brick manufacture)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "製模工人（電木業，塑膠業，製磚，輪胎製造）", titleEn: "Moulder (bakelite, plastic, brick, tyre manufacture)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "包裝工人", titleEn: "Packer (non hazardous industries)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "油漆師傅（傢俬）", titleEn: "Painter (furniture)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "切紙機操作員（紙及紙漿業）", titleEn: "Paper Cutting Machine Operator (paper & pulp)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "磨光工人（玻璃及鏡片製造）", titleEn: "Polisher (glass & mirror)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "品質控製員", titleEn: "Q. C.", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "補鞋匠", titleEn: "Repairman (shoe)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "修理工人（紡織）", titleEn: "Repairman (textile)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "翻新輪胎工人（輪胎製造）", titleEn: "Retreader (tyre manufacture)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "堆棉工人（床墊及枕頭製造）", titleEn: "Ricker (mattress & pillow)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "壓邊工人（床墊及枕頭製造）", titleEn: "Roll-edger (mattress & pillow)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "製圖章師傳", titleEn: "Rubber-stamp Maker", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "造樣版（紡織）", titleEn: "Sample Maker (textile)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "用噴沙器切割玻璃工人（陶瓷）", titleEn: "Sandblaster (pottery)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "負責挑選的工人（陶瓷）", titleEn: "Screener (pottery)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "縫盤（紡織）", titleEn: "Sewer (textile)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "補呔工人（輪胎製造）", titleEn: "Shaper (tyre manufacture)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "鞋匠", titleEn: "Shoe Maker", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "獨資老闆（參與少量體力勞動）", titleEn: "Sole Proprietor (little manual work involved)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "獨資老闆，老闆（只負責辦公室工作）", titleEn: "Sole Proprietor, Owner (office duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "貨倉工人（陶瓷）", titleEn: "Stock-bin Worker (pottery)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "督導員（電木，製磚，合成樹脂化合，五金）", titleEn: "Supervisor (bakelite, brick, plastic manufacture, metal)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "督導員（水泥，石膏及石灰製造業）", titleEn: "Supervisor (cement, gypsum & lime manufacture)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "督導員（電子，紡織業）", titleEn: "Supervisor (electronic, textile industry)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "裁縫", titleEn: "Tailor", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "技工（電子業）", titleEn: "Technician (electronics industry)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "技師（玻璃及鏡片製造）", titleEn: "Technician (glass & mirror industry)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "檢驗工人（煉煻廠）", titleEn: "Tester (sugar refineries)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "修剪工人（紙及紙漿業）", titleEn: "Trimmer (paper & pulp)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "椅墊工人（床墊及枕頭製造）", titleEn: "Upholsterer (mattress & pillow)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "硬化輪胎工人（輪胎製造）", titleEn: "Vulcanizer (tyre manufacture)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "織工（紡織）", titleEn: "Weaver (textile)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "磅重工人（煉煻廠）", titleEn: "Weigher (sugar refineries)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "工人（電木業及塑膠業－接觸塵埃或危險性化學物）", titleEn: "Worker (bakelite & plastic - exposed to dust or hazardous chemical)", life: "STD", ci: "STD", wp: "2x", industry: "Manufacturing / 製造業" },
                { title: "工人（床墊及枕頭－接觸塵埃或危險化合物）", titleEn: "Worker (mattress & pillow - exposed to dust or hazardous compounds)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "工人（肥皂及清潔劑－不用處理危險化合物）", titleEn: "Worker (no need to handle poisonous chemical compounds, soap & detergent)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "工人（油漆，力架及油光漆製造業）", titleEn: "Worker (paint, lacquer & varnish manufacturing)", life: "STD", ci: "STD", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "工人（肥皂及清潔劑－接觸危險化合物）", titleEn: "Worker (soap & detergent - exposed to poisonous chemical compounds)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Manufacturing / 製造業" },
                { title: "封套工人（紙及紙漿業）", titleEn: "Wrapper (paper & pulp)", life: "STD", ci: "STD", wp: "STD", industry: "Manufacturing / 製造業" },
                { title: "造船工人（小船）", titleEn: "Boat Builder (small boats)", life: "STD", ci: "STD", wp: "STD", industry: "Maritime / 海運" },
                { title: "貨物處理工人（船塢）", titleEn: "Cargo Handler (dock)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Maritime / 海運" },
                { title: "文員（只負責辦公室工作）", titleEn: "Clerk (office duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Maritime / 海運" },
                { title: "苦力及剷車（堆高車）操作員", titleEn: "Coolie And Forklift Operator", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Maritime / 海運" },
                { title: "船塢監督（只負責辦公室工作）", titleEn: "Dock Superintendant (office duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Maritime / 海運" },
                { title: "管工", titleEn: "Foreman (dock/finished hull construction - no need to work at height)", life: "STD", ci: "STD", wp: "STD", industry: "Maritime / 海運" },
                { title: "船長（大帆船，遊艇－在香港水域內）", titleEn: "Master (junk, launch - within HK harbour)", life: "STD", ci: "STD", wp: "STD", industry: "Maritime / 海運" },
                { title: "遠洋－船（填寫海事服務問卷）", titleEn: "Ocean-going (complete marine service questionnaire)", life: "IC", ci: "IC", wp: "-", industry: "Maritime / 海運" },
                { title: "油漆工人（船塢／船隻）", titleEn: "Painter (dock/ships)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Maritime / 海運" },
                { title: "港口領港，侍應，船長，輪機長，大副－小輪，水翼船，噴射船（不出遠洋）", titleEn: "Pilot, Steward, Master, Chief Engineer, Chief Officer (ferry, hydrofoil, jetfoil - non-ocean going)", life: "STD", ci: "STD", wp: "STD", industry: "Maritime / 海運" },
                { title: "水手，機房工人（小輪遊艇，大帆船，水翼船，噴射船－不出遠洋）", titleEn: "Sailor, Engine Room Worker (ferry, launch, junk, hydrofoil, jetfoil - non-ocean going)", life: "STD", ci: "STD", wp: "STD", industry: "Maritime / 海運" },
                { title: "船業修理工人", titleEn: "Ship Construction Repairman", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Maritime / 海運" },
                { title: "驗船官（只負責成本估計工作）", titleEn: "Ship Inspector (cost estimation only)", life: "STD", ci: "STD", wp: "STD", industry: "Maritime / 海運" },
                { title: "電焊工及切割工人", titleEn: "Welder & Cutter", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Maritime / 海運" },
                { title: "針灸中醫師", titleEn: "Acupuncturist", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "行政人員（只負責辦公室工作）", titleEn: "Administrator (office duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "女工", titleEn: "Amah", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "救護員，司機", titleEn: "Ambulance Officer, Driver", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "服務員", titleEn: "Attendant", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "輔助醫療人員", titleEn: "Auxiliary", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "化驗師", titleEn: "Chemist", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "牙科技術員", titleEn: "Dental Technician", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "牙醫", titleEn: "Dentist", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "配藥員", titleEn: "Dispenser", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "醫生", titleEn: "Doctor", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "中醫，推拿師（住家）", titleEn: "Herbalist, Chiropractor (at home)", life: "STD", ci: "STD", wp: "1.5x", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "中醫，推拿師（醫療中心）", titleEn: "Herbalist, Chiropractor (in medical center)", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "廚房工人", titleEn: "Kitchen Worker", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "洗衣房工人", titleEn: "Laundry Worker", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "護士長", titleEn: "Matron", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "護士（X 光－治療及其他用途）", titleEn: "Nurse (X-ray - therapeutic & other uses)", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "護士（精神科病房）", titleEn: "Nurse (in mental ward)", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "護士（在監獄）", titleEn: "Nurse (in prison)", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "護士，護士學生", titleEn: "Nurse, Student Nurse", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "訓練護士", titleEn: "Nursing Sister", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "眼科醫生", titleEn: "Optician", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "驗光配鏡師", titleEn: "Optometrist", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "藥劑師", titleEn: "Pharmacist", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "物理治療師", titleEn: "Physiotherapist", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "放射線治療師", titleEn: "Radiologist", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "修理人員（醫院／牙科設備）", titleEn: "Repairman (hospital/dental equipment)", life: "STD", ci: "STD", wp: "1.5x", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "外科醫生（醫院）", titleEn: "Surgeon (hospital)", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "技師（X 光設備）", titleEn: "Technician (X-ray equipment)", life: "STD", ci: "STD", wp: "1.5x", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "技師（化驗室，不需接觸X 光）", titleEn: "Technician (laboratory, no X-ray involved)", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "獸醫（外科）", titleEn: "Veterinary (surgeon)", life: "STD", ci: "STD", wp: "STD", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "獸醫助理", titleEn: "Veterinary Assistant", life: "STD", ci: "STD", wp: "1.5x", industry: "Medical, Dental & Veterinary / 醫療，牙科及獸醫" },
                { title: "鐵匠", titleEn: "Blacksmith", life: "STD", ci: "STD", wp: "1.5x", industry: "Metal Working / 金屬，五金業" },
                { title: "鍋爐製造工人", titleEn: "Boiler Maker", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Metal Working / 金屬，五金業" },
                { title: "製模工人（機器廠）", titleEn: "Die Maker (machine shop)", life: "STD", ci: "STD", wp: "1.5x", industry: "Metal Working / 金屬，五金業" },
                { title: "鑽床操作員", titleEn: "Drill Operator", life: "STD", ci: "STD", wp: "1.5x", industry: "Metal Working / 金屬，五金業" },
                { title: "電鍍工人", titleEn: "Electroplater Work", life: "STD", ci: "STD", wp: "STD", industry: "Metal Working / 金屬，五金業" },
                { title: "機器裝配工人", titleEn: "Fitter", life: "STD", ci: "STD", wp: "1.5x", industry: "Metal Working / 金屬，五金業" },
                { title: "普通工人", titleEn: "General Labourer", life: "STD", ci: "STD", wp: "1.5x", industry: "Metal Working / 金屬，五金業" },
                { title: "打金匠", titleEn: "Goldsmith", life: "STD", ci: "STD", wp: "STD", industry: "Metal Working / 金屬，五金業" },
                { title: "打磨工人", titleEn: "Grinder", life: "STD", ci: "STD", wp: "1.5x", industry: "Metal Working / 金屬，五金業" },
                { title: "鎚工", titleEn: "Hammerman", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Metal Working / 金屬，五金業" },
                { title: "手鋸木匠", titleEn: "Handsawer", life: "STD", ci: "STD", wp: "1.5x", industry: "Metal Working / 金屬，五金業" },
                { title: "水壓機操作員", titleEn: "Hydraulic Press Operator", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Metal Working / 金屬，五金業" },
                { title: "配匙", titleEn: "Key Duplicator", life: "STD", ci: "STD", wp: "STD", industry: "Metal Working / 金屬，五金業" },
                { title: "車床操作員", titleEn: "Lathe Operator", life: "STD", ci: "STD", wp: "1.5x", industry: "Metal Working / 金屬，五金業" },
                { title: "鎖匠", titleEn: "Locksmith", life: "STD", ci: "STD", wp: "STD", industry: "Metal Working / 金屬，五金業" },
                { title: "機械師（機器廠）", titleEn: "Machinist (machine shop)", life: "STD", ci: "STD", wp: "1.5x", industry: "Metal Working / 金屬，五金業" },
                { title: "技工（機器廠）", titleEn: "Mechanic (machine shop)", life: "STD", ci: "STD", wp: "1.5x", industry: "Metal Working / 金屬，五金業" },
                { title: "製造及修理銑床工人", titleEn: "Millwright", life: "STD", ci: "STD", wp: "1.5x", industry: "Metal Working / 金屬，五金業" },
                { title: "製模工人", titleEn: "Moulder", life: "STD", ci: "STD", wp: "1.5x", industry: "Metal Working / 金屬，五金業" },
                { title: "製圖案工人", titleEn: "Pattern Maker", life: "STD", ci: "STD", wp: "1.5x", industry: "Metal Working / 金屬，五金業" },
                { title: "設計（機器廠）", titleEn: "Planner (machine shop)", life: "STD", ci: "STD", wp: "1.5x", industry: "Metal Working / 金屬，五金業" },
                { title: "沖床機操作員", titleEn: "Punch-presser", life: "STD", ci: "STD", wp: "1.5x", industry: "Metal Working / 金屬，五金業" },
                { title: "推銷員（五金鋪）", titleEn: "Salesman (metal shop)", life: "STD", ci: "STD", wp: "STD", industry: "Metal Working / 金屬，五金業" },
                { title: "廢鐵商人", titleEn: "Scrap Metal Dealer", life: "STD", ci: "STD", wp: "1.5x", industry: "Metal Working / 金屬，五金業" },
                { title: "鉋床工人", titleEn: "Shaper", life: "STD", ci: "STD", wp: "1.5x", industry: "Metal Working / 金屬，五金業" },
                { title: "鐵皮工人", titleEn: "Sheet Metal Worker", life: "STD", ci: "STD", wp: "1.5x", industry: "Metal Working / 金屬，五金業" },
                { title: "插床操作員", titleEn: "Slotter", life: "STD", ci: "STD", wp: "1.5x", industry: "Metal Working / 金屬，五金業" },
                { title: "獨資老闆，老闆（只參與少量體力勞動）", titleEn: "Sole Proprietor, Owner (little manual work involved)", life: "STD", ci: "STD", wp: "STD", industry: "Metal Working / 金屬，五金業" },
                { title: "電視機修理員", titleEn: "TV Set Repairman", life: "STD", ci: "STD", wp: "STD", industry: "Metal Working / 金屬，五金業" },
                { title: "錫匠", titleEn: "Tinsmith", life: "STD", ci: "STD", wp: "1.5x", industry: "Metal Working / 金屬，五金業" },
                { title: "製工具匠", titleEn: "Toolmaker", life: "STD", ci: "STD", wp: "1.5x", industry: "Metal Working / 金屬，五金業" },
                { title: "製錶殼工人", titleEn: "Watch Case Maker", life: "STD", ci: "STD", wp: "STD", industry: "Metal Working / 金屬，五金業" },
                { title: "電焊工人", titleEn: "Welder (indoor)", life: "STD", ci: "STD", wp: "1.5x", industry: "Metal Working / 金屬，五金業" },
                { title: "軍官（只負責辦公室工作）", titleEn: "Officer (office duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Military Force Personnel / 軍隊" },
                { title: "員佐級", titleEn: "Rank And File", life: "STD", ci: "STD", wp: "1.5x", industry: "Military Force Personnel / 軍隊" },
                { title: "行政人員（只負責辦公室工作）", titleEn: "Administrator (admin duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Mining & Extraction / 採礦" },
                { title: "鏟泥機操作員", titleEn: "Bulldozer Operator", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Mining & Extraction / 採礦" },
                { title: "挖泥工人", titleEn: "Dredge Worker", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Mining & Extraction / 採礦" },
                { title: "炸藥處理員（採礦及爆石－炮王）", titleEn: "Explosive Handler (mines & quarries)", life: "6/M", ci: "-", wp: "-", industry: "Mining & Extraction / 採礦" },
                { title: "普通工人（採礦）", titleEn: "General Labourer (mining)", life: "4/M", ci: "-", wp: "-", industry: "Mining & Extraction / 採礦" },
                { title: "打磨工人", titleEn: "Grinder", life: "STD", ci: "STD", wp: "1.5x", industry: "Mining & Extraction / 採礦" },
                { title: "經理（只負責辦公室工作）", titleEn: "Manager (office duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Mining & Extraction / 採礦" },
                { title: "雲石打磨工人", titleEn: "Marble Polisher", life: "STD", ci: "STD", wp: "1.5x", industry: "Mining & Extraction / 採礦" },
                { title: "開礦井工人", titleEn: "Open Mine Worker", life: "6/M", ci: "-", wp: "-", industry: "Mining & Extraction / 採礦" },
                { title: "打椿機操作員（石礦埸及採礦）", titleEn: "Pile Operator (quarry & logging)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Mining & Extraction / 採礦" },
                { title: "打磨工人（石料）", titleEn: "Polisher (stone)", life: "STD", ci: "STD", wp: "1.5x", industry: "Mining & Extraction / 採礦" },
                { title: "爆石工人", titleEn: "Quarry Worker", life: "6/M", ci: "-", wp: "-", industry: "Mining & Extraction / 採礦" },
                { title: "雕石刻匠", titleEn: "Stone Carver", life: "STD", ci: "STD", wp: "1.5x", industry: "Mining & Extraction / 採礦" },
                { title: "拖拉機司機", titleEn: "Tractor Driver", life: "STD", ci: "STD", wp: "1.5x", industry: "Mining & Extraction / 採礦" },
                { title: "地底爆石工人", titleEn: "Underground Blaster", life: "6/M", ci: "-", wp: "-", industry: "Mining & Extraction / 採礦" },
                { title: "行政人員，經理，文員（只負責辦公室工作）", titleEn: "Administrator, Manager, Clerk (office duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "女傭，菲傭（全職）", titleEn: "Amah, Philippino Maid (full-time)", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "女傭，菲傭（兼職）", titleEn: "Amah, Philippino Maid (part-time)", life: "STD", ci: "STD", wp: "1.5x", industry: "Others / 其他" },
                { title: "學徒（理髮店／髮型屋）", titleEn: "Apprentice (barber/hair stylist)", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "藝術家（技工，陶瓷，雕刻家）", titleEn: "Artist (craftsman, potter, sculptor)", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "藝術家（自由身）", titleEn: "Artist (freelance or salaried)", life: "STD", ci: "STD", wp: "1.5x", industry: "Others / 其他" },
                { title: "助理（理髮店／髮型屋）", titleEn: "Assistant (barber/hair stylist)", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "保姆／看護", titleEn: "Babysitter/Nanny", life: "STD", ci: "STD", wp: "1.5x", industry: "Others / 其他" },
                { title: "美容顧問（髮型屋）", titleEn: "Beauty Consultant (hair saloon)", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "管家（傭人－家務）", titleEn: "Butler (servant - domestic)", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "凍倉工人", titleEn: "Cold Storage Worker", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "潛水（0 - 100 呎）", titleEn: "Diving (0-100 feet)", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "潛水（101 - 200 呎）", titleEn: "Diving (101-200 feet)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Others / 其他" },
                { title: "潛水（洞穴潛水）", titleEn: "Diving (cave divers)", life: "6/M", ci: "-", wp: "-", industry: "Others / 其他" },
                { title: "潛水（超過 200 呎以上）", titleEn: "Diving (over 200 feet)", life: "4/M", ci: "-", wp: "-", industry: "Others / 其他" },
                { title: "家庭傭工（全職）", titleEn: "Domestic Helper (full time)", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "家庭傭工（兼職）", titleEn: "Domestic Helper (part time)", life: "STD", ci: "STD", wp: "1.5x", industry: "Others / 其他" },
                { title: "算命（在市集－街邊）", titleEn: "Fortune Teller (in market place - on street)", life: "STD", ci: "STD", wp: "1.5x", industry: "Others / 其他" },
                { title: "算命（室內）", titleEn: "Fortune Teller (indoor)", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "園丁（家居）", titleEn: "Gardener (domestic)", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "理髮師／髮型師", titleEn: "Hairdresser/Hairstylist", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "家庭主婦", titleEn: "Housewife", life: "STD", ci: "STD", wp: "1.5x", industry: "Others / 其他" },
                { title: "製冰工人", titleEn: "Ice Maker", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "兒童", titleEn: "Juvenile", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "律師", titleEn: "Lawyer/Solicitor", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "信差（徒步）", titleEn: "Messenger (on foot)", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "信差（以電單車代步）", titleEn: "Messenger (on motor cycle)", life: "STD", ci: "STD", wp: "1.5x", industry: "Others / 其他" },
                { title: "傳教士", titleEn: "Missionary", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "模特兒", titleEn: "Model", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "修道士／僧侶", titleEn: "Monk", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "修女／尼姑", titleEn: "Nun", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "育嬰院工人", titleEn: "Nursery Worker", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "老闆（髮型屋）", titleEn: "Owner (hair saloon)", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "老闆（當鋪）", titleEn: "Owner (pawn shop)", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "牧師", titleEn: "Pastor", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "攝影師（影樓）", titleEn: "Photographer (photo-studio)", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "神父", titleEn: "Priest", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "私家偵探", titleEn: "Private Detective", life: "STD", ci: "STD", wp: "1.5x", industry: "Others / 其他" },
                { title: "業權人（影樓）", titleEn: "Proprietor (photo-studio)", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "研究員（化驗室）", titleEn: "Research Officer (laboratory)", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "退休", titleEn: "Retired", life: "STD", ci: "STD", wp: "1.5x", industry: "Others / 其他" },
                { title: "秘書，高級行政人員，總經理（只負責辦公室工作）", titleEn: "Secretary, Officer, Managing Director (office duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "補鞋匠", titleEn: "Shoe Repairman", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "店員／黑房工人（影樓）", titleEn: "Shop/Darkroom Worker (photo-studio)", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "捉蛇", titleEn: "Snake Catcher", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Others / 其他" },
                { title: "倉務員", titleEn: "Stock Controller", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "承辦殯葬者（製造棺櫃工人）", titleEn: "Undertaker (coffin maker)", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "承辦殯葬者（火葬埸工作人員）", titleEn: "Undertaker (crematorium attendant)", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "承辦殯葬者（防腐工人）", titleEn: "Undertaker (embalming worker)", life: "STD", ci: "STD", wp: "1.5x", industry: "Others / 其他" },
                { title: "失業", titleEn: "Unemployed", life: "STD", ci: "STD", wp: "1.5x", industry: "Others / 其他" },
                { title: "倉庫／貨倉", titleEn: "Warehouseman/Godown", life: "STD", ci: "STD", wp: "STD", industry: "Others / 其他" },
                { title: "羽毛球（教練）", titleEn: "Badminton (coach)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "羽毛球（專業運動者）", titleEn: "Badminton (professional player)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "藍球（教練）", titleEn: "Basketball (coach)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "藍球（專業運動者）", titleEn: "Basketball (professional player)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "保齡球(教練)", titleEn: "Bowling (Coach)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "保齡球(專業運動者)", titleEn: "Bowling (professional players)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "拳擊(教練)", titleEn: "Boxer (Coach)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "拳擊選手", titleEn: "Boxer (professional players)", life: "6/M", ci: "-", wp: "-", industry: "Professional Sports / 職業運動員" },
                { title: "板球(教練)", titleEn: "Cricket (Coach)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "板球(專業運動者)", titleEn: "Cricket (professional players)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "舞蹈(教練)", titleEn: "Dance (Coach)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "舞蹈(專業運動者)", titleEn: "Dance (professional players)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "足球（教練）", titleEn: "Football (coach)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "足球員（專業運動者）", titleEn: "Football (professional players)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "高爾夫球(教練)", titleEn: "Golf (Coach)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "高爾夫球（專業運動者）", titleEn: "Golf (professional players)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "體操(教練)", titleEn: "Gymnastic (Coach)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "體操（專業運動者）", titleEn: "Gymnastic (professional players)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "柔道／空手道(教練)", titleEn: "Judo/Karate (Coach)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "柔道／空手道摶擊手", titleEn: "Judo/Karate Fighter", life: "6/M", ci: "-", wp: "-", industry: "Professional Sports / 職業運動員" },
                { title: "賽車手（填寫危險運動及/或嗜好問卷）", titleEn: "Racing Car Driver (complete hazardous sports questionnaire)", life: "IC", ci: "IC", wp: "-", industry: "Professional Sports / 職業運動員" },
                { title: "壁球(教練)", titleEn: "Squash(Coach)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "壁球（專業運動者）", titleEn: "Squash (professional player)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "游泳（教練）", titleEn: "Swimming (coach)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "游泳（專業運動者）", titleEn: "Swimming (professional player)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "乒乓球(教練)", titleEn: "Table Tennis (Coach)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "乒乓球(專業運動者)", titleEn: "Table Tennis (professional player)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "網球（教練）", titleEn: "Tennis (coach)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "網球（專業運動者）", titleEn: "Tennis (professional player)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "田徑運動(教練)", titleEn: "Track and field (coach)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "田徑運動(專業運動者)", titleEn: "Track and field (professional player)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "排球（教練）", titleEn: "Volleyball (coach)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "排球（專業運動者）", titleEn: "Volleyball (professional player)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "風帆(教練)", titleEn: "Windsurfing Instructor", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "風帆(專業運動者)", titleEn: "Windsurfing (professional player)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "摔角(教練)", titleEn: "Wrestler (coach)", life: "STD", ci: "STD", wp: "1.5x", industry: "Professional Sports / 職業運動員" },
                { title: "摔角手（專業運動者）", titleEn: "Wrestler (professional player)", life: "6/M", ci: "-", wp: "-", industry: "Professional Sports / 職業運動員" },
                { title: "編接電纜工人（電力供應－管導及隧道）", titleEn: "Cable Splicer (electricity supply - conduit & tunnel)", life: "4/M", ci: "-", wp: "-", industry: "Public Utilities / 公用事業" },
                { title: "編接電纜工人（電力供應）", titleEn: "Cable Splicer (electricity supply)", life: "4/M", ci: "-", wp: "-", industry: "Public Utilities / 公用事業" },
                { title: "總工程師（發電廠及發電站）", titleEn: "Chief Engineer (power house & electrical sub-station)", life: "STD", ci: "STD", wp: "STD", industry: "Public Utilities / 公用事業" },
                { title: "司機（公眾衛生）", titleEn: "Driver (public sanitation)", life: "STD", ci: "STD", wp: "1.5x", industry: "Public Utilities / 公用事業" },
                { title: "電機工程師（只負責顧問及設計工作）", titleEn: "Electrical Engineer (consulting & designing duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Public Utilities / 公用事業" },
                { title: "電機工程師（負責視察及監督工作）", titleEn: "Electrical Engineer (inspection & supervision)", life: "STD", ci: "STD", wp: "STD", industry: "Public Utilities / 公用事業" },
                { title: "電器機師（發電廠及發電站）", titleEn: "Electrician (power house & electrical sub-station)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Public Utilities / 公用事業" },
                { title: "工程師（維修工作－室外）", titleEn: "Engineer (maintenance duties - outdoor work)", life: "STD", ci: "STD", wp: "STD", industry: "Public Utilities / 公用事業" },
                { title: "管工（公眾衛生）", titleEn: "Foreman (public sanitation)", life: "STD", ci: "STD", wp: "STD", industry: "Public Utilities / 公用事業" },
                { title: "倒垃圾工人（公眾衛生）", titleEn: "Garbageman (public sanitation)", life: "STD", ci: "STD", wp: "1.5x", industry: "Public Utilities / 公用事業" },
                { title: "石油氣（送貨工人）", titleEn: "Gas (deliveryman)", life: "STD", ci: "STD", wp: "1.5x", industry: "Public Utilities / 公用事業" },
                { title: "石油氣／煤氣（工程師）", titleEn: "Gas (engineer)", life: "STD", ci: "STD", wp: "STD", industry: "Public Utilities / 公用事業" },
                { title: "入氣體工人", titleEn: "Gas (filler)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Public Utilities / 公用事業" },
                { title: "石油氣零售商", titleEn: "Gas (shop retailer)", life: "STD", ci: "STD", wp: "STD", industry: "Public Utilities / 公用事業" },
                { title: "地底工人（電力供應－建造電纜，架空電線之操作及維修）", titleEn: "Groundman (electricity supply - electrical power line construction, maintenance & operation of overhead lines)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Public Utilities / 公用事業" },
                { title: "地底工人（電話及電報－室外，維修工作）", titleEn: "Groundman (telephone & telegram - outdoor work, maintenance)", life: "STD", ci: "STD", wp: "STD", industry: "Public Utilities / 公用事業" },
                { title: "住宅拉線工人（電話及電報－室外，維修工作）", titleEn: "Housewireman (telephone & telegram - outdoor work, maintenance)", life: "STD", ci: "STD", wp: "STD", industry: "Public Utilities / 公用事業" },
                { title: "督察（電話及電報－建造電纜，架空電線的維修與操作）", titleEn: "Inspector (electricity supply - electrical power line construction, maintenance & operation of overhead lines)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Public Utilities / 公用事業" },
                { title: "督察（發電廠及發電站）", titleEn: "Inspector (power house & sub-station)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Public Utilities / 公用事業" },
                { title: "督察（公眾衛生）", titleEn: "Inspector (public sanitation)", life: "STD", ci: "STD", wp: "STD", industry: "Public Utilities / 公用事業" },
                { title: "裝置員（電話及電報）", titleEn: "Installer (telephone & telegram)", life: "STD", ci: "STD", wp: "STD", industry: "Public Utilities / 公用事業" },
                { title: "工人（發電廠及發電站－發電超過二百五十伏特）", titleEn: "Labourer (power house & sub-station - generating over 250 volts)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Public Utilities / 公用事業" },
                { title: "拉線工人（電力供應）", titleEn: "Lineman (electricity supply)", life: "4/M", ci: "-", wp: "-", industry: "Public Utilities / 公用事業" },
                { title: "拉線工人（電話及電報－發電廠及發電站）", titleEn: "Linesman/Repairman (telephone & telegram - maintenance)", life: "STD", ci: "STD", wp: "STD", industry: "Public Utilities / 公用事業" },
                { title: "電力輸送員（電力供應－發電廠及發電站）", titleEn: "Load Dispatcher (electricity supply - power house & sub-station)", life: "STD", ci: "STD", wp: "STD", industry: "Public Utilities / 公用事業" },
                { title: "電錶安裝工人", titleEn: "Meter Installer", life: "STD", ci: "STD", wp: "STD", industry: "Public Utilities / 公用事業" },
                { title: "抄錶員", titleEn: "Meter Reader", life: "STD", ci: "STD", wp: "STD", industry: "Public Utilities / 公用事業" },
                { title: "巡邏員（發電廠及發電站）", titleEn: "Patrolman (power house & electrical sub-station)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Public Utilities / 公用事業" },
                { title: "巡邏員（建造電纜，架空電線的維修與操作）", titleEn: "Patrolman (power line construction, maintenance & operation of overhead lines)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Public Utilities / 公用事業" },
                { title: "喉管清潔工人", titleEn: "Piles Cleaner", life: "STD", ci: "STD", wp: "1.5x", industry: "Public Utilities / 公用事業" },
                { title: "發電廠監督（發電廠及發電站）", titleEn: "Plant Superintendant (power house & electrical sub-station)", life: "STD", ci: "STD", wp: "STD", industry: "Public Utilities / 公用事業" },
                { title: "電線柱及電燈柱安裝工人（建造電纜，架空電線的維修與操作）", titleEn: "Pole Setter (power line construction, maintenance & operation of overhead lines)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Public Utilities / 公用事業" },
                { title: "中斷站測試員（發電廠及發電站）", titleEn: "Relay Tester (power house & electrical sub-station)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Public Utilities / 公用事業" },
                { title: "修理工人（氣體－戶內工作）", titleEn: "Repairman (gas - indoor)", life: "STD", ci: "STD", wp: "STD", industry: "Public Utilities / 公用事業" },
                { title: "修理工人（氣體－戶外工作）", titleEn: "Repairman (gas - outdoor)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Public Utilities / 公用事業" },
                { title: "修理工人（發電廠及發電站）", titleEn: "Repairman (power house & electrical sub-station)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Public Utilities / 公用事業" },
                { title: "修理工人（煤氣，船隻）", titleEn: "Repairman (towngas supply)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Public Utilities / 公用事業" },
                { title: "裝配工人（發電廠及發電站）", titleEn: "Rigger (power house & electrical sub-station)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Public Utilities / 公用事業" },
                { title: "發電站工程師（發電廠及發電站）", titleEn: "Station Engineer (power house & electrical sub-station)", life: "STD", ci: "STD", wp: "1.5x", industry: "Public Utilities / 公用事業" },
                { title: "街道清潔工人", titleEn: "Street Cleaner", life: "STD", ci: "STD", wp: "1.5x", industry: "Public Utilities / 公用事業" },
                { title: "督導（電力供應－發電廠及發電站－發電超過二百五十伏特）", titleEn: "Supervisor (electricity supply - power house & sub-station - generating over 250 volts)", life: "STD", ci: "STD", wp: "STD", industry: "Public Utilities / 公用事業" },
                { title: "督導（電力供應－建造電纜，架空電線的維修與操作）", titleEn: "Supervisor (electricity supply - power line construction, maintenance & operation of overhead lines)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Public Utilities / 公用事業" },
                { title: "督導（垃圾處理廠及焚化爐）", titleEn: "Supervisor (garbage disposal plant & incinerator)", life: "STD", ci: "STD", wp: "STD", industry: "Public Utilities / 公用事業" },
                { title: "督導（公眾衛生）", titleEn: "Supervisor (public sanitation)", life: "STD", ci: "STD", wp: "STD", industry: "Public Utilities / 公用事業" },
                { title: "清道夫（公眾衛生）", titleEn: "Sweeper (public sanitation)", life: "STD", ci: "STD", wp: "1.5x", industry: "Public Utilities / 公用事業" },
                { title: "總機佈線工人（發電廠及發電站）", titleEn: "Switchboard-wireman (power house & electrical sub-station)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Public Utilities / 公用事業" },
                { title: "電話接線生", titleEn: "Telephone Operator", life: "STD", ci: "STD", wp: "STD", industry: "Public Utilities / 公用事業" },
                { title: "塔架安裝工人（電力供應－電纜）", titleEn: "Tower Erector (electricity supply - electrical power lines)", life: "4/M", ci: "-", wp: "-", industry: "Public Utilities / 公用事業" },
                { title: "安裝塔架工人（電話及電報－需高空工作）", titleEn: "Tower Erector (telephone & telegram - work at height)", life: "4/M", ci: "-", wp: "-", industry: "Public Utilities / 公用事業" },
                { title: "變壓器操作員（電力供應－導管及隧道）", titleEn: "Transformer (electricity supply - tunnels & conduits)", life: "4/M", ci: "-", wp: "-", industry: "Public Utilities / 公用事業" },
                { title: "變壓器操作員（發電廠及發電站）", titleEn: "Transformer Operator (power house & electrical sub-station)", life: "STD", ci: "STD", wp: "1.5x", industry: "Public Utilities / 公用事業" },
                { title: "渦輪機操作員（發電廠及發電站）", titleEn: "Turbine Operator (power house & electrical sub-station)", life: "STD", ci: "STD", wp: "1.5x", industry: "Public Utilities / 公用事業" },
                { title: "地下工作工人（公眾衛生）", titleEn: "Underground Worker (public sanitation)", life: "4/M", ci: "-", wp: "-", industry: "Public Utilities / 公用事業" },
                { title: "輪機房服務員（發電廠及發電站）", titleEn: "Wheelroom Attendant (power house & electrical sub-station)", life: "STD", ci: "STD", wp: "1.5x", industry: "Public Utilities / 公用事業" },
                { title: "行政人員（只負責辦公室工作）", titleEn: "Administrator (office duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "裝配員（鐘錶店）", titleEn: "Assembler (clock shop)", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "時裝精品店（室內推銷員）", titleEn: "Boutique (indoor salesman)", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "屠夫（屠房及超級市埸）", titleEn: "Butcher (slaughter house & supermarket)", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "收銀員（超級市埸）", titleEn: "Cashier (supermarket)", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "文員（只負責辦公室工作）", titleEn: "Clerk (admin duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "漁販（超級市埸及街市魚檔持牌人－固定攤檔）", titleEn: "Fish Monger (supermarket & stall owner at market place - fixed location)", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "漁販（批發商）", titleEn: "Fish Monger (wholesaler)", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "花店", titleEn: "Florist", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "水果商", titleEn: "Fruiterer", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "雜貨商", titleEn: "Grocer", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "小販", titleEn: "Hawker", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "經理（只負責辦公室工作）", titleEn: "Manager (admin duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "商品經紀（室外）", titleEn: "Merchandiser (outdoor)", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "寵物店（店主，店員）", titleEn: "Pet Shop (owner, shop assistant)", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "油站服務員", titleEn: "Petrol Station Attendant", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "物業顧問／經紀／磋商人（室外）", titleEn: "Property Consultant/Agent/Negotiator (outdoor)", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "老闆（參與體力勞動但無需操作機器）", titleEn: "Proprietor (manual work involved but not required to work with machinery)", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "老闆（只負責辦公室工作）", titleEn: "Proprietor (office duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "老闆（參與少量體力勞動／室外工作）", titleEn: "Proprietor (some manual work/outdoor duties involved)", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "修理工人（鐘錶店）", titleEn: "Repairman (clock shop)", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "修理工人（辦公室設施）", titleEn: "Repairman (office equipment)", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "推銷員（珠寶－室內工作）", titleEn: "Sales (jewellery - indoor)", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "推銷員（珠寶－需出外工作）", titleEn: "Sales (jewellery - outdoor)", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "營業經理（只負責辦公室工作）", titleEn: "Sales Manager (office duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "推銷員（上門推銷）", titleEn: "Salesman (door to door sales)", life: "STD", ci: "STD", wp: "1.5x", industry: "Retail & Sales / 零售業" },
                { title: "廢鐵處理（老板）", titleEn: "Scrap Metal (owner)", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "廢鐵處理（工人）", titleEn: "Scrap Metal (worker)", life: "STD", ci: "STD", wp: "1.5x", industry: "Retail & Sales / 零售業" },
                { title: "護衛員（非持械）", titleEn: "Security Guard (unarmed)", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "店員", titleEn: "Shop Assistant", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "股票／外匯經紀", titleEn: "Stock/Forex Broker", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "士多店東", titleEn: "Store Keeper", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "主任（超級市埸）", titleEn: "Supervisor (supermarket)", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "鐘錶廠工人", titleEn: "Watch Factory Worker", life: "STD", ci: "STD", wp: "STD", industry: "Retail & Sales / 零售業" },
                { title: "文員（辦公室行政職員－只負責辦公室工作）", titleEn: "Clerk (office admin personnel - office duties only)", life: "STD", ci: "STD", wp: "STD", industry: "Trading & Computer / 貿易及電腦" },
                { title: "電腦硬件維修人員", titleEn: "Hardware Maintenance Technician", life: "STD", ci: "STD", wp: "STD", industry: "Trading & Computer / 貿易及電腦" },
                { title: "程式編寫員，操作員，系統分析員", titleEn: "Programmer, Operator, System Analyst", life: "STD", ci: "STD", wp: "STD", industry: "Trading & Computer / 貿易及電腦" },
                { title: "營業員（室內）", titleEn: "Salesman (indoor)", life: "STD", ci: "STD", wp: "STD", industry: "Trading & Computer / 貿易及電腦" },
                { title: "營業員（室外）", titleEn: "Salesman (outdoor)", life: "STD", ci: "STD", wp: "STD", industry: "Trading & Computer / 貿易及電腦" },
                { title: "服務員（鐵路－地鐵，輕鐵，九港鐵路）", titleEn: "Attendant (railroad - MTR, LTR, KCR)", life: "STD", ci: "STD", wp: "STD", industry: "Transportation / 運輸" },
                { title: "巴士站站長", titleEn: "Bus Station Officer", life: "STD", ci: "STD", wp: "STD", industry: "Transportation / 運輸" },
                { title: "洗車工人", titleEn: "Car Washer (garage, service station)", life: "STD", ci: "STD", wp: "STD", industry: "Transportation / 運輸" },
                { title: "送貨工人（DHL ，快遞）", titleEn: "Deliveryman (DHL, express)", life: "STD", ci: "STD", wp: "STD", industry: "Transportation / 運輸" },
                { title: "送貨工人（電單車）", titleEn: "Deliveryman (by motor cycle)", life: "STD", ci: "STD", wp: "1.5x", industry: "Transportation / 運輸" },
                { title: "送貨工人（搬運公司）", titleEn: "Deliveryman (moving companies)", life: "STD", ci: "STD", wp: "1.5x", industry: "Transportation / 運輸" },
                { title: "司機（地鐵，輕鐵，九港鐵路及鐵路）", titleEn: "Driver (MTR, LTR, KCR, tram & railway)", life: "STD", ci: "STD", wp: "STD", industry: "Transportation / 運輸" },
                { title: "司機（巴士及旅遊車及小巴）", titleEn: "Driver (buses & coaches & light bus)", life: "STD", ci: "STD", wp: "STD", industry: "Transportation / 運輸" },
                { title: "司機（重型貨車，貨櫃車，貨車，小巴貨車等）", titleEn: "Driver (heavy goods vehicle, container trucks, lorry, trucks, vans)", life: "STD", ci: "STD", wp: "1.5x", industry: "Transportation / 運輸" },
                { title: "司機（私家車，的士）", titleEn: "Driver (private car, taxi)", life: "STD", ci: "STD", wp: "STD", industry: "Transportation / 運輸" },
                { title: "司機（鐵路及電車）", titleEn: "Driver (railroad & trams)", life: "STD", ci: "STD", wp: "STD", industry: "Transportation / 運輸" },
                { title: "教車師傳", titleEn: "Driving Instructor", life: "STD", ci: "STD", wp: "STD", industry: "Transportation / 運輸" },
                { title: "領班（運輸，速遞及搬運公司）", titleEn: "Foreman (delivery, express & moving companies)", life: "STD", ci: "STD", wp: "STD", industry: "Transportation / 運輸" },
                { title: "堆高機操作員（貨櫃）", titleEn: "Forklift Operator (container)", life: "STD", ci: "STD", wp: "1.5x", industry: "Transportation / 運輸" },
                { title: "技工（油站，車房）", titleEn: "Mechanic (service station, garage)", life: "STD", ci: "STD", wp: "STD", industry: "Transportation / 運輸" },
                { title: "店主（單車店）", titleEn: "Owner (bicycle shop)", life: "STD", ci: "STD", wp: "STD", industry: "Transportation / 運輸" },
                { title: "店主（油站，車房）", titleEn: "Owner (service station, garage)", life: "STD", ci: "STD", wp: "STD", industry: "Transportation / 運輸" },
                { title: "噴油板工人（油站，車房）", titleEn: "Painter (service station, garage)", life: "STD", ci: "STD", wp: "1.5x", industry: "Transportation / 運輸" },
                { title: "槌沙板工人（油站，車房）", titleEn: "Panel Beater (service station, garage)", life: "STD", ci: "STD", wp: "STD", industry: "Transportation / 運輸" },
                { title: "搬運督導（運輸，速遞及搬運公司－不參與運送工作）", titleEn: "Removal Supervisor (delivery, express & moving companies - no delivery work)", life: "STD", ci: "STD", wp: "STD", industry: "Transportation / 運輸" },
                { title: "搬運工人（傢俬）", titleEn: "Removal Worker (furniture)", life: "STD", ci: "STD", wp: "1.5x", industry: "Transportation / 運輸" },
                { title: "搬運工人（機器）", titleEn: "Removal Worker (machinery)", life: "STD", ci: "STD", wp: "1.5x", industry: "Transportation / 運輸" },
                { title: "搬運工人（鋼琴及夾萬）", titleEn: "Removal Worker (piano & safe)", life: "STD", ci: "STD", wp: "1.5x", industry: "Transportation / 運輸" },
                { title: "維修人員（單車店）", titleEn: "Repairman (bicycle shop)", life: "STD", ci: "STD", wp: "STD", industry: "Transportation / 運輸" },
                { title: "修理員（鐵路，地鐵，輕鐵，九港鐵路，電車）", titleEn: "Repairman (railroads, MTR, LTR, KCR, tram)", life: "2/M", ci: "1.5x", wp: "1.5x", industry: "Transportation / 運輸" },
                { title: "維修人員（油站，車房）", titleEn: "Repairman (service station & garage)", life: "STD", ci: "STD", wp: "STD", industry: "Transportation / 運輸" },
                { title: "人力車拉夫", titleEn: "Rickshawman", life: "STD", ci: "STD", wp: "STD", industry: "Transportation / 運輸" },
                { title: "車站站長（鐵路）", titleEn: "Station Supervisor (railroads)", life: "STD", ci: "STD", wp: "STD", industry: "Transportation / 運輸" },
                { title: "交通控制員（貨櫃碼頭－於高空工作）", titleEn: "Traffic Controller (container port - work above ground level)", life: "4/M", ci: "-", wp: "-", industry: "Transportation / 運輸" },
                { title: "檢查員（貨櫃碼頭）", titleEn: "Yard Checker (container port)", life: "STD", ci: "STD", wp: "1.5x", industry: "Transportation / 運輸" },
            ];

        // --- Helper Functions ---
        // [UPDATE Req 4] Updated formatMoney to handle non-integers with 2 decimal places
        const formatMoney = (num, currency = 'HKD') => {
            if (num === null || num === undefined || num === '') return '';
            const n = Number(num);
            const isInteger = Number.isInteger(n);
            return new Intl.NumberFormat('en-HK', { 
                style: 'currency', 
                currency: currency, 
                minimumFractionDigits: isInteger ? 0 : 2, 
                maximumFractionDigits: 2 
            }).format(n);
        };

        const calculateAge = (dobString, refDateString) => {
            if (!dobString || !refDateString) return "";
            const dob = new Date(dobString);
            const refDate = new Date(refDateString);
            let age = refDate.getFullYear() - dob.getFullYear();
            const m = refDate.getMonth() - dob.getMonth();
            if (m < 0 || (m === 0 && refDate.getDate() < dob.getDate())) {
                age--;
            }
            return age >= 0 ? age : 0;
        };

        const addWorkingDaysExclHolidays = (startDate, days, holidays) => {
            const result = new Date(startDate);
            if (!startDate || Number.isNaN(result.getTime()) || !Number.isFinite(days)) return null;
            let count = 0;
            while (count < days) {
                result.setDate(result.getDate() + 1);
                // Guard: Invalid Date would make toISOString() throw and blank the page
                if (Number.isNaN(result.getTime())) return null;
                const day = result.getDay();
                const iso = result.toISOString().split('T')[0];
                if (day !== 0 && day !== 6 && !holidays.includes(iso)) {
                    count++;
                }
            }
            return result;
        };

        const formatDate = (date) => {
            if (!date) return "";
            const d = new Date(date);
            const day = String(d.getDate()).padStart(2, '0');
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const year = d.getFullYear();
            return `${day}/${month}/${year}`;
        };

        const formatDateVerbose = (date) => {
            if (!date) return "";
            const d = new Date(date);
            const day = String(d.getDate()).padStart(2, '0');
            const monthNames = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
            const month = monthNames[d.getMonth()];
            const year = d.getFullYear();
            return `${day} ${month} ${year}`;
        };

        // Global clipboard helper that also triggers a toast notification
        const copyToClipboard = (text, toastMessage = 'Copied') => {
            if (!text) return;
            const textarea = document.createElement("textarea");
            textarea.value = text;
            textarea.style.position = "fixed";
            document.body.appendChild(textarea);
            textarea.focus();
            textarea.select();
            try {
                document.execCommand('copy');
            } catch (err) {
                console.error('Fallback: Oops, unable to copy', err);
            }
            document.body.removeChild(textarea);
            // Dispatch a custom event to show a toast. Other components listen for this.
            try {
                window.dispatchEvent(new CustomEvent('showToast', { detail: toastMessage }));
            } catch (e) {}
        };
        const TRUST_REASON_TEXTS = {
            Pacific: `• Referring to Trust deed, the purpose of adopting trust is for assets management. The trustee can deal with the trust asset, to purchase the purchase on behalf of the trust ant property including insurance policy.
• A trust sets up for management of the assets of Grantor (settlor) and protection of the Grantor’s (settlor) assets when the Grantor (settlor) becomes incapacitated during the Grantor’s (settlor) lifetime.
• The trustee can deal with the trust asset, to purchase the purchase on behalf of the trust any property including insurance policy`,
            Relyon: `The Settlor has transferred or will transfer to the Original Trustee or otherwise placed under its control certain property to hold the same upon the trust and with and subject to the provisions hereinafter declared.`,
            Probiz: `This is a living trust which sets up for holding property / financial planning of settlor and protection of the settlor’s hold property / financial planning when the settlor becomes incapacitated during the settlor’s lifetime.`,
            METIS: `• To ensure proceeds of the insurance to be paid to the trustees without any financial delays.
• To hold the policy under the trust because the client wan s to hold the family’s overseas estate under a trust in order to avoiding any legal delays at the time of claims, and it also ensures a smooth financial arrangement, therefore client is applying the insurance via trust.`
        };

const HK_HOLIDAYS_2025_2026 = [
            '2025-01-01', '2025-01-29', '2025-01-30', '2025-01-31', '2025-04-04', '2025-04-18', '2025-04-19', '2025-04-21', 
            '2025-05-01', '2025-05-05', '2025-05-31', '2025-07-01', '2025-10-01', '2025-10-07', '2025-10-29', '2025-12-25', '2025-12-26',
            '2026-01-01', '2026-02-17', '2026-02-18', '2026-02-19', '2026-04-03', '2026-04-04', '2026-04-06', '2026-04-07', 
            '2026-05-01', '2026-05-25', '2026-06-19', '2026-07-01', '2026-09-26', '2026-10-01', '2026-10-19', '2026-12-25', '2026-12-26'
        ];

        const PENDING_MESSAGES = [
            { prefix: '(Pending)', text: 'Agent / Broker memo to confirm how the payment is split between initial and prepayment premiums' },
            { prefix: '(Pending)', text: 'Revised illustration with the new age (xx). Settlor\'s verification is needed trust policies' },
            { prefix: '(FYI)', text: 'No back-dating for savings or prepayments' },
            { prefix: '(Pending)', text: 'Bank statement or letter showing both account number and holder’s name to confirm payment is from an approved payor' },
            { prefix: '(Pending)', text: 'Supplementary Form with Good Health Declaration as application date or last exam date is over 90 days' },
            { prefix: '(Pending)', text: 'Outstanding premium, if any. (Refer to counter offer letter for details)' },
            { prefix: '(Pending)', text: 'Agent / Broker memo clarifying the country/region of the transaction bank for the initial premium' },
            { prefix: '(Pending)', text: 'Settlor’s employer details (business card or web screenshot showing business address) for AML checking.' },
            { prefix: '(Pending)', text: 'Supplementary Form to confirm information on Premium Deposit Fund illustration (pages 1-2) is verified by the settlor' },
            { prefix: '(Pending)', text: 'Financial Questionnaire, agent / broker report, and supporting financial evidence (liquid asset proof and source of funds/wealth) for total premium over USD 1M. See underwriting manual 10.3 for details' },
            { prefix: '(Pending)', text: 'Financial supporting document with certified true copy to prove that the policyholder has a portfolio of not less than HKD 8 million (Re: Submitted Request for Departure from Commission Spreading Requirement form)' },
            { prefix: '(Pending)', text: 'Employment details (business card or web screenshot showing business address) for AML checking' },
            { prefix: '(Pending)', text: 'Special Health Questionnaire (for urinary tract infection in July 2025)' },
            { prefix: '(Pending)', text: 'Source(s) of Funds/Wealth Supplementary Information Questionnaire for Financial Supporter as part of income is a family gift' },
            { prefix: '(Pending)', text: 'Acceptance of Counter Offer' },
            { prefix: '(FYI)', text: 'There is history of hepatitis B with abnormal liver function' },
            { prefix: '(Pending)', text: 'Supplementary form to supplement the incomplete information on Application Form Part I(A) Q12' },
            { prefix: '(Pending)', text: 'Supplementary form to supplement the incomplete information on FNA Part 3 Q2a' },
            { prefix: '(Pending)', text: 'Supplementary form to confirm FNA Part 2 Q1 as life protection needed mismatched with the applying sum assured of LionPatron while LionPatron\'s death benefit is 2.3 times of sum assured' },
            { prefix: '(Pending)', text: 'Agent / Broker memo to explain reason for policy split as 2 applications are for the same product' },
            { prefix: '(Pending)', text: 'Agent / Broker memo to explain reason for applying insurance in Hong Kong as it was not mentioned in intermediary’s report' },
            { prefix: '(Pending)', text: 'Agent / Broker memo to explain policyholder’s monthly salary as the declared amount differs from typical range for this position' },
            { prefix: '(Pending)', text: 'Agent / Broker memo to explain the breakdown of average monthly income as the declared occupational income (HKD XXXXX) is not main source among the total income HKD XXXXX.' },
            { prefix: '(Pending)', text: 'Supplementary form to confirm FNA part 1 Q8 (all policies including Generali and other companies)' },
            { prefix: '(Pending)', text: 'Important Facts Statement – Policy Replacement' },
            { prefix: '(Pending)', text: 'Supplementary form to reconfirm application form Part XI' },
            { prefix: '(Pending)', text: 'Supplementary form to accept backdating to 1 day before proposed insured’s birthday as backdated illustration submitted but application form Part IX is not ticked.' },
            { prefix: '(Pending)', text: 'Initial premium (with levy) and payment slip due to bounced cheque' },
            { prefix: '(Pending)', text: 'Supplementary form to confirm FNA Part 3 Q7 as current income cannot afford all premium payments including existing policies' },
            { prefix: '(Pending)', text: 'Supplementary form to confirm means to pay total premium (including policies with other companies) after retirement age xx as net liquid assets is insufficient' },
            { prefix: '(Pending)', text: 'Agent / Broker memo to indicate personal background including education details & employment history' },
            { prefix: '(Pending)', text: 'Agent / Broker memo to indicate current occupation details including title, name of current employer, business nature, average monthly income' },
            { prefix: '(Pending)', text: 'Agent / Broker memo to indicate major event(s) that contribute significant accumulation of the customer’s wealth (if the wealth is not from employment)' },
            { prefix: '(Pending)', text: 'Full set of child health booklet with current height and weight record as insured’s body build is beyond normal range' },
            { prefix: '(Pending)', text: 'Insurance Intermediary Declaration for Mainland China Visitor Application Authentication as Important Facts Statement for Mainland Policyholders was not provided within 7 working days from the application sign date' },
            { prefix: '(Pending)', text: 'Insurance Intermediary Declaration for Trust-Related Insurance Policy' },
            { prefix: '(Pending)', text: 'Supplementary form to confirm beneficiary information. Beneficiary cannot be own estate or more than one beneficiary as “Policy Continuation” is selected' },
            { prefix: '(Pending)', text: 'Direct Debit Authorization Form as Application Form Q34 (Bank Autopay for renewal premium payment) is selected' },
            { prefix: '(Pending)', text: 'Agent / Broker memo to advise if refund cheque should be sent to broker or by mail to policyholder’s address' },
            { prefix: '(Pending)', text: 'Supplementary form to confirm Application Form Part II Q32 "Premium Payment Mode (annual or pre-payment)"' },
            { prefix: '(FYI)', text: 'For annual mode, please resubmit illustration' },
            { prefix: '(Pending)', text: 'Supplementary form to confirm date back or not. If not, please resubmit illustration for age xx' },
            { prefix: '(Pending)', text: 'Supplementary form to indicate China Taxpayer Identification Number (TIN) for Chinese ID Card holder' },
            { prefix: '(Pending)', text: 'Supplementary form to confirm Application Form Part 1(C) Q26 with email address and selection of policy correspondence' },
            { prefix: '(Pending)', text: 'Debit account proof showing account number and account holder name for initial premium payments (HKD XXX, HKDXXXXX & HKD XXXXX)' },
            { prefix: '(Pending)', text: 'Supplementary form to confirm Financial Questionnaire Part 1 Q4d Net Worth as it should not be $0' },
            { prefix: '(Pending)', text: 'Medical report / document from doctor to confirm current height and weight as insured’s body build is beyond normal range' },
            { prefix: '(Pending)', text: 'Supplementary form to confirm source of wealth as the provided FNA does not indicate this information' },
            { prefix: '(Pending)', text: 'Supplementary form to confirm source of fund and wealth as the provided FNA does not indicate these information' },
            { prefix: '(Pending)', text: 'Supplementary form to cancel “Designation of Contingent Recipient” as it is not applicable for this product' },
            { prefix: '(Pending)', text: 'Supplementary form to confirm policyholder\'s education level as inconsistence found between FNA and intermediary’s report' },
            { prefix: '(Pending)', text: 'Parent’s consent for grandparent to apply for insurance on behalf of proposed insured' },
            { prefix: '(Pending)', text: 'CTC of proposed insured and policyholder’s travel documents for non-permanent HKID holder(s)' },
            { prefix: '(Pending)', text: 'Balance of premium with levy USD XXXXXX and payment slip' },
            { prefix: '(FYI)', text: 'Case is pending for premium processing by our Finance Dept' },
            { prefix: '(FYI)', text: 'Case is pending for premium collection from credit card' },
            { prefix: '(FYI)', text: 'Trust Application is subject to compliance clearance; further requirements may be required' },
            { prefix: '(FYI)', text: 'Medical Consultant/Reinsurer is reviewing the case' },
            { prefix: '(FYI)', text: 'Case is pending for company search result' },
            { prefix: '(FYI)', text: 'Submit revised illustration with new age is required if payment date or document signed date is after policyholder\'s birthday. Settlor verification is required for trust policies.' },
            { prefix: '(FYI)', text: 'No back-dating will be allowed for saving plans or prepayments.' },
            { prefix: '(FYI)', text: 'Extra loading will be imposed due to xxxxxxx' },
            { prefix: '(FYI)', text: 'Application will be accepted with borderline standard due to xxxxx disease' },
            { prefix: '(FYI)', text: 'Payor will be required to submit Source(s) of Funds/Wealth Supplementary Information Questionnaire if premium payment is not fully made by proposed policyholder. Compliance review is also required' },
            { prefix: '(FYI)', text: 'Anonymous/cash payment is not allowed for high return products' }
        ];

        /* ========== Master Broker List Data ========== */
        // The master broker data is generated from the provided Master_Broker_List.txt. Each broker maps to one or more RMs and each RM maps to a list of support staff.
        // This structure allows us to easily search by broker name, RM name or support name and display the hierarchy accordingly.
        const MASTER_BROKER_DATA = {"10Life Financial Limited":{"JP":["Kayley"]},"1291 Group Asia Limited":{"Jessie":["Roy"]},"ACF International Insurance Broker Co., Limited":{"JP":["Kayley"]},"AEO Financial Serivices Limited":{"Lorraine":["Mathew"]},"AMG Wealth Management Limited":{"Kennis":["Mathew"]},"ASI-Union Global Assets Management Limited":{"Kennis":["Mathew"]},"Abacare Hong Kong Limited":{"Lorraine":["Mathew"]},"Abundance Global Wealth Management Limited":{"Lorraine":["Mathew"]},"Alea Insurance Ltd":{"Nik":["Kayley"]},"Alpha International Insurance Broker Limited":{"JP":["Kayley"]},"Alpha Wealth Management Limited":{"Kennis":["Mathew"]},"Altruist Financial Group Limited":{"Lorraine":["Mathew"]},"Amber Hill Insurance Brokers Limited":{"JP":["Kayley"]},"Ampire Wealth Management Limited":{"Nik":["Kayley"]},"Ample Financial And Insurance Services Limited":{"Lorraine":["Mathew"]},"Apeiron International (HK) Limited":{"Lorraine":["Mathew"]},"Apex Insurance Brokers Limited":{"Kennis":["Mathew"]},"Apex Insurance Management Limited":{"Kennis":["Mathew"]},"AutoMate Wealth Management Limited":{"Danny Wong":["Mathew"]},"Avondale Wealth Management Limited":{"Lorraine":["Mathew"]},"BMI Funds Management Limited":{"JP":["Kayley"]},"BMP Wealth Limited":{"Walter":["Kayley"]},"BS Wealth Management Limited":{"Walter":["Kayley"]},"Bao Sheng International Fortune Advisory Limited":{"JP":["Kayley"]},"Bay Insurance Brokers Limited":{"Danny Wong":["Mathew"]},"Bay Union Insurance Brokers Limited":{"JP":["Kayley"],"Lorraine":["Mathew"]},"Bay Wealth Management Limited":{"Danny Wong":["Mathew"]},"Ben.Excellence Consultancy Limited":{"Lorraine":["Mathew"]},"Best Managed Wealth Limited":{"Nik":["Kayley"]},"Best Managed Wealth Limited (TW)":{"Nik":["Kayley"]},"Better Wealth Management Company Limited":{"Walter":["Kayley"]},"Blue Oak International (HK) Insurance Consultant Limited":{"Rachel Tong":["Roy"]},"Blue Ocean Wealth Management (Hong Kong) Limited":{"JP":["Kayley"]},"Brilliant Asia Asset Management Limited":{"Nik":["Kayley"]},"Brilliant Insurance Broker Limited":{"JP":["Kayley"]},"Bureau of Insurance Services Limited":{"Walter":["Kayley"]},"CCW Global Limited":{"Walter":["Kayley"]},"CECO Wealth Management Limited":{"JP":["Kayley"]},"CES Insurance Consultants (HK) Limited":{"Jessie":["Roy"],"Rachel Tong":["Roy"]},"CES Wealth Management (HK) Limited":{"Jessie":["Roy"],"Rachel Tong":["Roy"]},"CITIC Insurance Brokers Limited":{"Jessie":["Roy"],"Rachel Tong":["Roy"]},"CM Houlder Insurance Brokers Limited":{"Susanna Chan":["Mathew"]},"CMB Wing Lung Insurance Brokers Limited":{"Jessie":["Roy"],"Rachel Tong":["Roy"]},"CSCI Insurance Broker Limited":{"Walter":["Kayley"]},"Cash Wealth Management Limited":{"Lorraine":["Mathew"]},"Centaline Financial Services Ltd.":{"Nik":["Kayley"]},"Charles Monat Associates Limited":{"Wing Qiu Liu":["Roy"]},"Charter Management Group Limited":{"Nik":["Kayley"]},"Chief Champion Financial Services Company Limited":{"Susanna Chan":["Mathew"]},"Chief Financial Services Limited":{"Kennis":["Mathew"]},"Chief Financial Services Limited (New)":{"Kennis":["Mathew"]},"Chifu Wealth Management (Hong Kong) Limited":{"Walter":["Kayley"]},"China Elite Risk Management and Actuarial Consulting Company Limited":{"Walter":["Kayley"]},"China Hong Kong Wealth Management Limited":{"Danny Wong":["Mathew"]},"Chong Hing Insurance Brokers Limited":{"Rachel Tong":["Roy"]},"Clearwater Valley Hong Kong Limited":{"Rachel Tong":["Roy"]},"Colman Li Consulting Limited":{"Jessie":["Roy"]},"Commonwealth Broker Limited":{"Danny Wong":["Mathew"]},"Connect Global Insurance Consultants Limited":{"Rachel Tong":["Roy"]},"Consolidated Marketing Group Int'l Wealth Management Ltd.":{"Jessie":["Roy"]},"Core Pacific - Yamaichi Wealth Management Ltd.":{"JP":["Kayley"]},"DC Insurance Consulting Limited":{"Danny Wong":["Mathew"]},"DL Emerald Wealth Management Limited":{"Susanna Chan":["Mathew"]},"Dah Sing Insurance Brokers Limited":{"Jessie":["Roy"]},"Daybetter Insurance Broker Limited":{"JP":["Kayley"]},"Delta Asia Wealth Management Limited":{"Lorraine":["Mathew"]},"Doo Insurance Broker HK Limited":{"JP":["Kayley"]},"Doxa Wealth Planning Limited":{"Kennis":["Mathew"]},"Dragon Wealth Management Limited":{"Danny Wong":["Mathew"]},"Dynasty Financial Group Limited":{"Nik":["Kayley"]},"Eastern Glorith Wealth Management Ltd.":{"JP":["Kayley"]},"Elitrix Wealth Management Limited":{"JP":["Kayley"]},"Empire Financial Services Centre Limited":{"JP":["Kayley"]},"Equator Asset Protection Limited":{"Nik":["Kayley"]},"Everbest Insurance and Financial Services Ltd.":{"Rachel Tong":["Roy"]},"Everest Global Wealth Management Limited":{"Lorraine":["Mathew"]},"Everlife Asset Enterprise Ltd.":{"Nik":["Kayley"]},"Everon Insurance Services Limited":{"Danny Wong":["Mathew"]},"Everwise Asset Enterprise Limited":{"Nik":["Kayley"]},"Excellent Wealth Management Limited":{"Lorraine":["Mathew"]},"FQ Life Wealth Management Limited":{"Nik":["Kayley"]},"FWD Financial Planning Limited":{"Walter":["Kayley"]},"Father Financial Planning Services Limited":{"Susanna Chan":["Mathew"]},"Financial One Platform Services Limited":{"Nik":["Kayley"]},"Finexis Advisory (HK) Limited":{"Walter":["Kayley"]},"First Shanghai Wealth Management Limited":{"Nik":["Kayley"]},"Forthright Wealth Management Limited":{"Danny Wong":["Mathew"]},"Fortunaire Financial Planning Limited":{"Jessie":["Roy"]},"Fortune Asset Management (HK) Ltd":{"Walter":["Kayley"]},"Fortune Financial Services Company Limited":{"Walter":["Kayley"]},"Fortune Freedoness Wealth Management Ltd.":{"Lorraine":["Mathew"]},"Fortune Insurance Broker Company Limited":{"Kennis":["Mathew"]},"Fortune Union Capital Management Limited":{"Lorraine":["Mathew"]},"Frontier Financial Advisory Services Limited":{"Kennis":["Mathew"]},"Fu Ren Financial Services Limited":{"JP":["Kayley"]},"Fubon Insurance Brokers Limited":{"Rachel Tong":["Roy"]},"Fulbright Wealth Management Limited":{"Lorraine":["Mathew"]},"GF Wealth Management (Hong Kong) Limited":{"Kennis":["Mathew"]},"GLF Wealth Management Ltd.":{"Lorraine":["Mathew"]},"GT Insurance Brokers Limited":{"Kennis":["Mathew"]},"Genuine Oriental Wealth Management Limited":{"Kennis":["Mathew"]},"Global Investment Advisors Limited":{"Lorraine":["Mathew"]},"Global Wealth Services Limited":{"Lorraine":["Mathew"]},"Globe Win Wealth Management Ltd.":{"Walter":["Kayley"]},"Glore Financial Services Limited":{"Kennis":["Mathew"]},"Glory Insurance (HONG KONG) Limited":{"JP":["Kayley"]},"Good Excel International Investment Ltd.":{"Nik":["Kayley"]},"Grandtag Financial Consultancy & Insurance Brokers Limited":{"Jessie":["Roy"]},"Great Value Wealth Management Limited":{"Walter":["Kayley"]},"HCYC Wealth Management (Asia) Co. Limited":{"Kennis":["Mathew"]},"HF Partners Limited":{"Walter":["Kayley"]},"Hanligent Wealth Management Company Limited":{"Lorraine":["Mathew"]},"Hanson Insurance Brokers Limited":{"Lorraine":["Mathew"]},"Hantec Insurance Broker Company Limited":{"Kennis":["Mathew"]},"Harvest Wealth Management Limited":{"JP":["Kayley"]},"Heng Yep International Wealth Management Limited":{"JP":["Kayley"]},"Himark Insurance Group Limited":{"Lorraine":["Mathew"]},"Hong Kong Ai Jia Wealth Management Limited":{"Kennis":["Mathew"]},"Hong Kong Baiji Financial Advisory Co Limited":{"Susanna Chan":["Mathew"]},"Hong Kong Friendly Consulting Limited":{"Kennis":["Mathew"]},"Hong Kong Noble Wealth Management Limited":{"Walter":["Kayley"]},"IAM Wealth Limited":{"Nik":["Kayley"]},"IPG Wealth Management Ltd.":{"Nik":["Kayley"]},"IPP Wealth Advisers Limited":{"Lorraine":["Mathew"]},"ISA Insurance Brokers Limited":{"Nik":["Kayley"]},"Infinity Financial Management Limited":{"JP":["Kayley"]},"Insu-value Insurance Consultants Limited":{"Lorraine":["Mathew"]},"Insurance 110 Company Limited":{"Walter":["Kayley"]},"International Planning Group Insurance Brokers, Limited":{"Wing Qiu Liu":["Roy"]},"JMC Professional Insurance Brokers HK Ltd":{"Walter":["Kayley"]},"JSS Insurance Brokerage (Asia) Limited":{"Wing Qiu Liu":["Roy"]},"Jiayu Insurance Finance Ltd":{"Walter":["Kayley"]},"Jucheng Insurance Broker Limited":{"JP":["Kayley"]},"Jumbo Alliance Funds Limited":{"Nik":["Kayley"]},"Jumbolife Limited":{"Jessie":["Roy"]},"Juvo Wealth Limited":{"Walter":["Kayley"]},"K U M Insurance Brokers Ltd.":{"Rachel Tong":["Roy"]},"KEEN EAGLE INSURANCE BROKERS LIMITED":{"Walter":["Kayley"]},"KGI Investments Management Limited":{"Nik":["Kayley"]},"KSY Speciality limited":{"Nik":["Kayley"]},"Kai Fung Insurance Brokers Limited":{"JP":["Kayley"]},"Kaiser Wealth Management Limited":{"Kennis":["Mathew"]},"Kingkey Privilege Wealth Management":{"Lorraine":["Mathew"]},"Kingstone International Wealth Management Limited":{"Susanna Chan":["Mathew"]},"Kinlou Insurance Broker (HK) Limited":{"Susanna Chan":["Mathew"]},"Kong Seng Asset Management Limited":{"JP":["Kayley"]},"L & P International Wealth Management Limited":{"JP":["Kayley"]},"L Green Specialty Company Limited":{"Lorraine":["Mathew"]},"L.M.W. Fortune Consultant Company Limited":{"Walter":["Kayley"]},"LCF Group HK Limited":{"Nik":["Kayley"]},"LMW MGT Limited":{"Walter":["Kayley"]},"Lal's Insurance Brokers Limited":{"Lorraine":["Mathew"]},"Linden Group Limited":{"Wing Qiu Liu":["Roy"]},"Links Wealth Management Limited":{"Kennis":["Mathew"]},"Lioner International Consultancy Limited":{"Wing Qiu Liu":["Roy"]},"Loksoo Consultants Limited":{"Kennis":["Mathew"]},"Longrun Wealth Management Limited":{"Kennis":["Mathew"]},"Loyal Insurance Advisers Limited":{"JP":["Kayley"]},"Luk Fook Wealth Management (HK) Limited":{"Kennis":["Mathew"]},"Lynco International Wealth Management Limited":{"Kennis":["Mathew"]},"MG Insurance & Financial Management Limited":{"JP":["Kayley"]},"MHK Insurance Services Limited":{"Nik":["Kayley"]},"MacKenzie Wealth Management Limited":{"Walter":["Kayley"]},"Macroscopica International Wealth Management Limited":{"Kennis":["Mathew"]},"Magic Compass Wealth Management Limited":{"Kennis":["Mathew"]},"Maison Aim Asset Management Limited":{"Walter":["Kayley"]},"Majesty Wealth Management Limited":{"Nik":["Kayley"]},"Manchester Insurance Consultants Limited":{"Lorraine":["Mathew"]},"Mass Fidelity Asset Management Limited":{"Kennis":["Mathew"]},"Midland Financial Planning Limited":{"Nik":["Kayley"]},"Money Concepts (Asia) Holdings Limited":{"JP":["Kayley"]},"More Insurance Broker Company Limited":{"Kennis":["Mathew"]},"NCB Wealth Management Advisor Limited":{"Rachel Tong":["Roy"]},"New Century International Insurance Advisory Ltd":{"Lorraine":["Mathew"]},"New Harvest Wealth Insurance Brokers (HK) Limited":{"Kennis":["Mathew"]},"New Universe Pacific Financial Management Limited":{"JP":["Kayley"]},"Noble Apex Wealth Limited":{"JP":["Kayley"]},"Nut Nut Intelligence Limited":{"JP":["Kayley"]},"One Plus Insurance Service Limited":{"Susanna Chan":["Mathew"]},"Oneplatform Wealth Management Limited":{"Kennis":["Mathew"]},"Oreana Financial Services Limited":{"Lorraine":["Mathew"]},"P.B. Wealth Management Ltd":{"JP":["Kayley"]},"PC International (HK) Limited":{"Kennis":["Mathew"]},"PCL Insurance Services Limited":{"Walter":["Kayley"]},"PLA (Hong Kong) Ltd":{"Lorraine":["Mathew"]},"PT insurance Brokers Company Limited":{"Kennis":["Mathew"]},"Pacific Prime Insurance Brokers Limited":{"Lorraine":["Mathew"]},"Pegasus Fund Managers Limited":{"Lorraine":["Mathew"]},"Penguin Insurance Co., Limited":{"Kennis":["Mathew"]},"Perfect Life Insurance Brokers Limited":{"Walter":["Kayley"]},"Phillip Financial Advisors (HK) Limited":{"Walter":["Kayley"]},"Premier Financial Management Limited":{"Lorraine":["Mathew"]},"Prestige Global Wealth Management Limited":{"Lorraine":["Mathew"]},"Prime Wealth Management Limited":{"Walter":["Kayley"]},"Private Client Services by Mercer Limited":{"Wing Qiu Liu":["Roy"]},"Private Portfolio Services (HK) Ltd.":{"Kennis":["Mathew"]},"Pro Insurance & Financial Management Limited":{"Walter":["Kayley"]},"Pyrmont Wealth Management Limited":{"Walter":["Kayley"]},"Queensway Asset Management Limited":{"JP":["Kayley"]},"R.C.W. Financial Services Limited":{"Nik":["Kayley"]},"R.E. Lee International Limited":{"Wing Qiu Liu":["Roy"]},"Raffles Capital Holings Limited":{"Nik":["Kayley"]},"Realife Insurance Broker Limited":{"JP":["Kayley"]},"Realord Asia Pacific Asset Management Limited":{"JP":["Kayley"]},"Rhoba Financial Services Limited":{"Walter":["Kayley"]},"Riches Credit Insurance Brokerage Limited":{"JP":["Kayley"]},"SESG Insurance Services Limited":{"JP":["Kayley"]},"Sandcastle Management Limited":{"Susanna Chan":["Mathew"]},"Shacom Insurance Brokers Limited":{"Lorraine":["Mathew"]},"Shengyuan Global Wealth Management Company Limited":{"Nik":["Kayley"]},"Shining Solutions Wealth Management Limited":{"Kennis":["Mathew"]},"Shorewell Insurance Brokers Ltd":{"Rachel Tong":["Roy"]},"Sincerity Insurance Brokers Limited":{"Walter":["Kayley"]},"St. James’s Place (Hong Kong) Limited":{"Walter":["Kayley"]},"Star Flame Asset Management Limited":{"Michael":["Mathew"]},"Supreme One Wealth Mangagement Limited":{"Lorraine":["Mathew"]},"Supreme Wealth Management Limited":{"JP":["Kayley"]},"Synergy Wealth Management Limited":{"JP":["Kayley"]},"Taifu Asset Management Limited":{"Kennis":["Mathew"]},"Taiping Reinsurance Brokers Limited":{"Danny Wong":["Mathew"]},"Taishan Insurance Brokers Ltd":{"Lorraine":["Mathew"]},"Taoyuen Insurance Services Limited":{"JP":["Kayley"]},"Target Global Wealth Management Limited":{"Kennis":["Mathew"]},"Taylor Brunswick Group Limited":{"Wing Qiu Liu":["Roy"]},"Tek Fong Group Limited":{"JP":["Kayley"]},"Tengard Financial Services Ltd":{"Kennis":["Mathew"]},"Tenti Wealth Management Company Limited":{"Walter":["Kayley"]},"The LOG International Limited":{"Lorraine":["Mathew"]},"Thornton Global Wealth Management Limited":{"Kennis":["Mathew"]},"Tinco Wealth Management Limited":{"Susanna Chan":["Mathew"]},"Top Integrity Financial Services Limited":{"Lorraine":["Mathew"]},"Top One Global Wealth Management Limited":{"Kennis":["Mathew"]},"Topaz Private Wealth Limited":{"Kennis":["Mathew"]},"Trusted Union Limited":{"Lorraine":["Mathew"]},"Tung Chi Consulting Limited":{"Walter":["Kayley"]},"UHO International Wealth Management Co. Ltd.":{"Walter":["Kayley"]},"Universal Alliance Group Limited":{"Walter":["Kayley"]},"Venhouse Financial Planning Limited":{"JP":["Kayley"]},"Victoria Wealth Management Limited":{"Kennis":["Mathew"]},"Victory Insurance Consultants Limited":{"Lorraine":["Mathew"]},"Village Holdings Limited":{"Jessie":["Roy"]},"WE Financial Planning Limited":{"Kennis":["Mathew"]},"WE Wealth Management Limited":{"JP":["Kayley"]},"Wanson Insurance Brokerage Limited":{"Walter":["Kayley"]},"Waterdrop Financial Services (HK) Limited":{"JP":["Kayley"]},"Well Tunes Financial Group Limited":{"Walter":["Kayley"]},"Wickfield Insurance Brokers Limited":{"JP":["Kayley"]},"Wilson Securities Limited":{"JP":["Kayley"]},"Win Finance Wealth Management Limited":{"Danny Wong":["Mathew"]},"Winroad Asia Limited":{"Walter":["Kayley"]},"Winson Insurance Consultants Limited":{"JP":["Kayley"]},"Wisdom Alliance Wealth Management Ltd.":{"Nik":["Kayley"]},"Wisdom Global Concept Limited":{"JP":["Kayley"]},"Wise Fortune Advisors Limited":{"Nik":["Kayley"]},"Wrise Financial Services Limited":{"Lorraine":["Mathew"],"Walter":["Kayley"]},"Yotei Advisors (HK) Limited":{"Lorraine":["Mathew"]},"Yu Fung Broker Limited":{"Walter":["Kayley"]},"Yuanta Securities (Hong Kong) Company Limited":{"Nik":["Kayley"]},"Yushuan Wealth Management Limited":{"Nik":["Kayley"]},"ZA International Insurance Broker Limited":{"Agent Channel (Windian)": [""]},"ZUU Digital Financial Services Limited":{"Walter":["Kayley"]},"ZUU Insurance Brokerage Limited":{"Walter":["Kayley"]},"iFAST Insurance Brokers (HK) Limited":{"Lorraine":["Mathew"]}};

        /* ========== Country Group Map (Sample) ========== */
        // Country group information is used in the HNW (LionMaster) module. Each country maps to a group label, an issue limit (in USD)
        // and any eligible city restrictions. The below sample covers common jurisdictions. Unknown entries default to group 'N/A' and limit 30M.
        // Updated country group map based on Country Group manual. Each entry includes the group, the USD issue limit and any eligible city restrictions.
        const COUNTRY_GROUP_MAP = {
            "All of British Isles": { group: "A", issueLimit: 30000000, eligibleCities: "" },
            "Andorra": { group: "A", issueLimit: 30000000, eligibleCities: "" },
            "Argentina": { group: "A", issueLimit: 30000000, eligibleCities: "" },
            "Australia": { group: "A", issueLimit: 100000000, eligibleCities: "" },
            "Austria": { group: "A", issueLimit: 100000000, eligibleCities: "" },
            "Bahamas": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Bahrain": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Bangladesh": { group: "C", issueLimit: 5000000, eligibleCities: "Dhaka only" },
            "Brazil": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Belgium": { group: "A", issueLimit: 100000000, eligibleCities: "" },
            "Belize": { group: "C", issueLimit: 30000000, eligibleCities: "" },
            "Bermuda": { group: "A", issueLimit: 30000000, eligibleCities: "" },
            "British Virgin Islands": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Brunei": { group: "A", issueLimit: 35000000, eligibleCities: "" },
            "Bulgaria": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Canary Island": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Cayman Islands": { group: "A", issueLimit: 30000000, eligibleCities: "" },
            "Chile": { group: "A", issueLimit: 30000000, eligibleCities: "" },
            "China": { group: "A", issueLimit: 100000000, eligibleCities: "All except Xinjiang and Tibet" },
            "Cambodia": { group: "C", issueLimit: 10000000, eligibleCities: "" },
            "Canada": { group: "A", issueLimit: 100000000, eligibleCities: "" },
            "Costa Rica": { group: "A", issueLimit: 30000000, eligibleCities: "" },
            "Curacao": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Cyprus (Greek Cyprus)": { group: "A", issueLimit: 30000000, eligibleCities: "" },
            "Czech Republic": { group: "A", issueLimit: 30000000, eligibleCities: "" },
            "Denmark": { group: "A", issueLimit: 100000000, eligibleCities: "" },
            "Dominica": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Egypt": { group: "B", issueLimit: 30000000, eligibleCities: "War exclusion" },
            "Estonia": { group: "B", issueLimit: 15000000, eligibleCities: "" },
            "Fiji": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Finland": { group: "A", issueLimit: 100000000, eligibleCities: "" },
            "France": { group: "A", issueLimit: 100000000, eligibleCities: "" },
            "Germany": { group: "A", issueLimit: 100000000, eligibleCities: "" },
            "Greece": { group: "A", issueLimit: 30000000, eligibleCities: "" },
            "Greenland": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Honduras": { group: "B", issueLimit: 10000000, eligibleCities: "" },
            "Hong Kong": { group: "A", issueLimit: 100000000, eligibleCities: "" },
            "Hungary": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Iceland": { group: "A", issueLimit: 100000000, eligibleCities: "" },
            "India": { group: "B", issueLimit: 30000000, eligibleCities: "Ahmedabad, Bangalore, Chennai, Faridabad, Hyderabad, Jaipur, Kolkata, Lucknow, Mysore, Mumbai, New Delhi and Pune only" },
            "Indonesia": { group: "B", issueLimit: 45000000, eligibleCities: "All except Central Sulawesi, Maluku, Papua and West Papua provinces" },
            "Ireland": { group: "A", issueLimit: 100000000, eligibleCities: "" },
            "Israel": { group: "B", issueLimit: 5000000, eligibleCities: "War exclusion; All except West Bank & Gaza Strip" },
            "Italy": { group: "A", issueLimit: 100000000, eligibleCities: "" },
            "Jamaica": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Japan": { group: "A", issueLimit: 100000000, eligibleCities: "All except Aomori, Iwate, Miyagi, Fukushima" },
            "Jordan": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Kuwait": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Laos": { group: "C", issueLimit: 5000000, eligibleCities: "" },
            "Latvia": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Lebanon": { group: "War exclusion", issueLimit: 30000000, eligibleCities: "" },
            "Liechtenstein": { group: "A", issueLimit: 100000000, eligibleCities: "" },
            "Lithuania": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Luxembourg": { group: "A", issueLimit: 100000000, eligibleCities: "" },
            "Macau": { group: "A", issueLimit: 100000000, eligibleCities: "" },
            "Malaysia": { group: "B", issueLimit: 50000000, eligibleCities: "" },
            "Maldives": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Malta": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Martinique": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Mauritius": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Mexico": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Monaco": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Montserrat": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Morocco": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Myanmar": { group: "C", issueLimit: 5000000, eligibleCities: "Yangon only" },
            "Netherlands": { group: "A", issueLimit: 100000000, eligibleCities: "" },
            "Netherlands Antilles": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "New Caledonia": { group: "B", issueLimit: 10000000, eligibleCities: "" },
            "New Zealand": { group: "A", issueLimit: 100000000, eligibleCities: "" },
            "Northern Mariana Islands": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Norway": { group: "A", issueLimit: 100000000, eligibleCities: "" },
            "Oman": { group: "B", issueLimit: 50000000, eligibleCities: "" },
            "Pakistan": { group: "C", issueLimit: 10000000, eligibleCities: "Karachi only" },
            "Panama": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Paraguay": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Peru": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Philippines": { group: "B", issueLimit: 45000000, eligibleCities: "All except Central & Western Mindanao (including Zamboanga Peninsula and Sulu Archipelago)" },
            "Poland": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Portugal": { group: "A", issueLimit: 100000000, eligibleCities: "" },
            "Puerto Rico": { group: "A", issueLimit: 30000000, eligibleCities: "" },
            "Qatar": { group: "B", issueLimit: 45000000, eligibleCities: "" },
            "Romania": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Russia": { group: "C", issueLimit: 30000000, eligibleCities: "Moscow and St Petersburg only" },
            "San Marino": { group: "A", issueLimit: 30000000, eligibleCities: "" },
            "Saudi Arabia": { group: "B", issueLimit: 45000000, eligibleCities: "" },
            "Singapore": { group: "A", issueLimit: 100000000, eligibleCities: "" },
            "Slovakia": { group: "A", issueLimit: 30000000, eligibleCities: "" },
            "Solomon Island": { group: "C", issueLimit: 10000000, eligibleCities: "" },
            "South Africa": { group: "B", issueLimit: 30000000, eligibleCities: "Pretoria, Johannesburg and Cape Town only" },
            "South Korea": { group: "A", issueLimit: 100000000, eligibleCities: "" },
            "Spain": { group: "A", issueLimit: 100000000, eligibleCities: "" },
            "Sri Lanka": { group: "C", issueLimit: 10000000, eligibleCities: "" },
            "St Kitts & Nevis": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "St Lucia": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "St Vincent/Grenadines": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Sweden": { group: "A", issueLimit: 100000000, eligibleCities: "" },
            "Switzerland": { group: "A", issueLimit: 100000000, eligibleCities: "" },
            "Taiwan": { group: "A", issueLimit: 100000000, eligibleCities: "" },
            "Thailand": { group: "B", issueLimit: 45000000, eligibleCities: "All except Yala, Pattani, Narathiwat & Songkhla" },
            "Tonga": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Trinidad/Tobago": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Turkey": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Turks & Caicos Islands": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "United Arab Emirates": { group: "B", issueLimit: 50000000, eligibleCities: "" },
            "United Kingdom": { group: "A", issueLimit: 100000000, eligibleCities: "" },
            "United States": { group: "A", issueLimit: 100000000, eligibleCities: "" },
            "Uruguay": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Vatican City": { group: "A", issueLimit: 30000000, eligibleCities: "" },
            "Venezuela": { group: "B", issueLimit: 30000000, eligibleCities: "" },
            "Vietnam": { group: "B", issueLimit: 45000000, eligibleCities: "Danang, Hanoi, Ho Chi Minh City, Haiphong only" },
            "Virgin Islands": { group: "B", issueLimit: 30000000, eligibleCities: "" }
        };

        /* ========== HNW Options ========== */
        const HNW_CLASS_OPTIONS = ["Non-Med", "Bravo", "Supremo", "Picco"];
        const HNW_SMOKING_OPTIONS = ["Non-smoker", "Smoker"];
        // ==========================================
        // Jumbo Case (大額保單) Constants
        // ==========================================
        const JUMBO_THRESHOLD_USD = 1000000;
        const JUMBO_CASE_TEXT = "Financial Questionnaire + Insurance advisor's report + Supporting Financial evidence including Liquid Asset Proof (for affordability assessment) AND Sources of Funds/Wealth Proof (FYI: Details please refer to Underwriting Manual Section 10.3)";


        const PRODUCT_DB = [
            // GIO
            { name: "LionTycoon Beyond 2", type: "GIO", q1: "A (Optional), C (Optional), D (Optional), E, E(iii)", q2: "A", q3: "F - G", q6: "A - F (2 Pay / 5 Pay); B - F (8 Pay / 10 Pay)", ruleType: "GIO" },
            { name: "Lion Achiever", type: "GIO", q1: "Must: E === Optional: A, C, D", q2: "F, G", q6: "Must be equal or greater than payment term", ruleType: "GIO" },
            { name: "LionPrima", type: "GIO", q1: "A (Optional), C (Optional), D (Optional), E, E(iii)", q2: "A", q3: "E - G", q6: "A - F (2 Pay / 5 Pay); B - F (8 Pay)", ruleType: "GIO" },
            { name: "Emerald (Launch date TBC)", type: "GIO", q1: "A (Optional), C (Optional), D (Optional), E, E(iii)", q2: "A", q3: "D - G", q6: "G", ruleType: "GIO" },
            { name: "Pearl (Launch date TBC)", type: "GIO", q1: "A (Optional), C (Optional), D (Optional), E, E(iii)", q2: "A", q3: "D - G", q6: "A - F", ruleType: "GIO" },
            { name: "LionTycoon Beyond Savings Insurance Plan 3 (Launch date TBC)", type: "GIO", q1: "A (Optional), C (Optional), D (Optional), E, E(iii)", q2: "A", q3: "F - G", q6: "A - F (3 Pay); B - F (8 Pay); Single payment", ruleType: "GIO" },

            { name: "LionAchiever Elite", type: "GIO", q1: "A (Optional), C (Optional), D (Optional), E, E(iii)", q2: "A", q3: "E - G", q6: "A - F", ruleType: "GIO" },
            // Life
            { name: "Generali Supreme Gold", type: "Life", q1: "A", q2: "C", q3: "B - F", q6: "≥ protection period", ruleType: "LIFE" },
            { name: "LionPainter Flexi", type: "Life", q1: "A, D", q2: "C", q3: "B - C (10 Years PPT); B - D (11 - 15 Years PPT); B - E (16 - 20 Years PPT); B - F (21 - 25 Years PPT)", q6: "≥ protection period", ruleType: "LIFE" },
            { name: "LionPromise Pro", type: "Life", q1: "A(Optional), C and/or D, E(iii)", q2: "A", q3: "F - G", q6: "A - F (2 Pay / 5 Pay)", ruleType: "LIFE" },
            { name: "LionPatron", type: "Life", q1: "A, D (Optional), E(iii)", q2: "A", q3: "B - G", q6: "A - F (5 Pay); B - F (10 Pay); D - F (20 Pay)", ruleType: "LIFE", multiplier: 1.5, fnaBaseMultiplier: 2.3 },
            // CI
            { name: "LionGuardian PlusOne", type: "CI", q1: "A, B (iii)", q2: "C", q3: "B - G", q6: "≥ protection period", ruleType: "CI" },
            { name: "LionGuardian Beyond", type: "CI", q1: "A, B (iii), D (Optional), E (Optional) ** If D is selected, E must also be selected **", q2: "A", q3: "C - G", q6: "B - F (10 Pay); D - F (20 Pay); E - F (25 Pay); B (To age 65: age 55); C (To age 65: age 50 - 55 or To age 22: age 7 - 11); D (To age 65: age 45 - 55 or To age 22: age 2 - 11); E - F (To age 65: age 0 - 55 or To age 22: age 0 - 11)", ruleType: "CI", multiplier: 1.3 },
            { name: "LionAlong", type: "CI", q1: "A, B (iii), D (Optional), E (Optional) ** If D is selected, E must also be selected **", q2: "A", q3: "C - G", q6: "B - F (10 Pay); D - F (20 Pay); E - F (25 Pay)", ruleType: "CI" },
            // Annuity
            { name: "LionHarvest Prime", type: "Annuity", q1: "A(Optional), C and/or D", q2: "A", q3: "E - F", q6: "A - F (5 Pay); B - F (10 Pay)", ruleType: "GIO" }
            ,
            // [NEW] High Net Worth product
            { name: "LionMaster", type: "HNW", q1: "A", q2: "C", q3: "B - G", q6: "≥ protection period", ruleType: "HNW" }
        ];

        const MED_RULE_CI = [
            { maxUSD: 50000, req: ["NM", "NM", "NM", "NM", "NM", "NM"] },
            { maxUSD: 160000, req: ["NM", "NM", "NM", "NM", "NM", "ME"] },
            { maxUSD: 350000, req: ["NM", "NM", "NM", "ME/PEM1", "ME", "ME"] },
            { maxUSD: 550000, req: ["NM", "NM", "NM", "ME, MU, BP0", "ME, MU, BP0", "ME, ECG, MU, BP0"] },
            { maxUSD: 850000, req: ["IC", "NM", "NM", "ME, ECG, MU, BP1, UC", "ME, ECG, MU, BP1, UC", "ME, TMECG, MU, BP1, UC"] },
            { maxUSD: 1000000, req: ["IC", "NM", "ME, MU, BP1, UC", "ME, ECG, MU, BP1, UC", "ME, TMECG, MU, BP1, UC", "ME, TMECG, MU, BP1, UC, APS"] },
            { maxUSD: 1250000, req: ["IC", "ME, MU, BP1, UC", "ME, ECG, MU, BP1, UC", "ME, TMECG, MU, BP1, UC, APS", "ME, TMECG, MU, BP1, UC, APS", "ME, TMECG, MU, BP1, UC, APS"] },
            { maxUSD: Infinity, req: ["IC", "IC", "IC", "IC", "IC", "IC"] }
        ];
        const MED_RULE_LIFE = [
            { maxUSD: 150000, req: ["SHQ / NM", "SHQ / NM", "SHQ / NM", "SHQ / NM", "SHQ / NM", "SHQ / NM"] },
            { maxUSD: 300000, req: ["SHQ / NM", "SHQ / NM", "SHQ / NM", "SHQ / NM", "SHQ / NM", "ME"] },
            { maxUSD: 500000, req: ["SHQ / NM", "SHQ / NM", "SHQ / NM", "SHQ / NM", "ME, MU", "ME, MU, BP0, ECG"] },
            { maxUSD: 750000, req: ["SHQ / NM", "SHQ / NM", "SHQ / NM", "NM", "ME, MU, BP0, UC", "ME, MU, BP0, ECG, UC"] },
            { maxUSD: 1500000, req: ["NM", "NM", "NM", "NM", "ME, MU, BP1, ECG, UC", "ME, MU, BP1, TMECG, UC"] },
            { maxUSD: 3000000, req: ["IC", "ME, APS", "ME, MU, BP0", "ME, MU, BP1", "ME, MU, BP1, ECG, UC", "ME, MU, BP1, TMECG, UC"] },
            { maxUSD: 7000000, req: ["IC", "ME, APS", "ME, MU, BP1, ECG", "ME, MU, BP1, ECG", "ME, MU, BP1, TMECG, UC, APS", "ME, MU, BP1, TMECG, UC, APS"] },
            { maxUSD: Infinity, req: ["IC", "IC", "IC", "IC", "IC", "IC"] }
        ];

        // --- Custom MultiSelect Component ---
        const MultiSelect = ({ options, value, onChange, placeholder }) => {
            const [isOpen, setIsOpen] = useState(false);
            const containerRef = useRef(null);

            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (containerRef.current && !containerRef.current.contains(event.target)) {
                        setIsOpen(false);
                    }
                };
                document.addEventListener("mousedown", handleClickOutside);
                return () => document.removeEventListener("mousedown", handleClickOutside);
            }, []);

            const toggleOption = (option) => {
                const newValue = value.includes(option)
                    ? value.filter(v => v !== option)
                    : [...value, option];
                onChange(newValue);
            };

            return (
                <div className="relative" ref={containerRef}>
                    <div
                        className="w-full border rounded p-1.5 text-sm bg-white cursor-pointer min-h-[34px] flex flex-wrap gap-1 items-center"
                        onClick={() => setIsOpen(!isOpen)}
                    >
                        {value.length > 0 ? (
                            value.map(v => (
                                <span key={v} className="bg-blue-100 text-blue-800 text-[10px] px-1.5 py-0.5 rounded font-medium">
                                    {v}
                                </span>
                            ))
                        ) : (
                            <span className="text-slate-400">{placeholder}</span>
                        )}
                        <div className="ml-auto text-slate-400">
                            <ChevronDown size={14} />
                        </div>
                    </div>
                    {isOpen && (
                        <div className="absolute z-50 top-full left-0 right-0 bg-white border border-slate-200 rounded shadow-lg max-h-60 overflow-y-auto mt-1">
                            {options.map((opt) => (
                                <div
                                    key={opt}
                                    className="px-3 py-2 hover:bg-slate-50 cursor-pointer flex items-center gap-2 text-xs"
                                    onClick={() => toggleOption(opt)}
                                >
                                    <div className={`w-4 h-4 border rounded flex items-center justify-center transition-colors ${value.includes(opt) ? 'bg-blue-600 border-blue-600' : 'border-slate-300'}`}>
                                        {value.includes(opt) && <Check size={10} className="text-white" />}
                                    </div>
                                    <span className="text-slate-700">{opt}</span>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };
        // --- Medical Logic ---
        const getMedicalReq = (planName, age, sa, currency, applyMultiplier = true) => {
            if (!planName || !sa) return null;
            const product = PRODUCT_DB.find(p => p.name === planName);
            if (!product || !product.ruleType) return null;
            
            // [UPDATE Req 2] Use FIN_USD_RATE (8.0) for exchange if HKD
            const rate = product.ruleType === 'CI' ? MED_CHECK_RATE : FIN_USD_RATE;
            let saUSD = currency === 'HKD' ? sa / rate : sa;
            
            if (product.ruleType === 'GIO') {
                if (saUSD > 2500000) {
                    return { req: "Exceeds GIO limit, SUW is required", checkSA_USD: saUSD, ruleType: "GIO" };
                } else {
                    return { req: "NM (GIO)", checkSA_USD: saUSD, ruleType: "GIO" };
                }
            }

            let checkSA = saUSD;
            if (applyMultiplier && product.multiplier) {
                checkSA = saUSD * product.multiplier;
            }

            let result = "Unknown";
            if (product.ruleType === 'CI') {
                let colIdx = -1;
                if (age <= 17) colIdx = 0;
                else if (age <= 45) colIdx = 1;
                else if (age <= 55) colIdx = 2;
                else if (age <= 60) colIdx = 3;
                else if (age <= 65) colIdx = 4;
                else if (age <= 70) colIdx = 5;
                if (colIdx === -1) return { req: "Age > 70: IC", checkSA_USD: checkSA, ruleType: product.ruleType }; 

                for (const tier of MED_RULE_CI) {
                    if (checkSA <= tier.maxUSD) {
                        result = tier.req[colIdx];
                        break;
                    }
                }
            } else if (product.ruleType === 'LIFE') {
                let colIdx = -1;
                if (age <= 4) colIdx = 0;
                else if (age <= 17) colIdx = 1;
                else if (age <= 45) colIdx = 2;
                else if (age <= 55) colIdx = 3;
                else if (age <= 65) colIdx = 4;
                else colIdx = 5;
                for (const tier of MED_RULE_LIFE) {
                    if (checkSA <= tier.maxUSD) {
                        result = tier.req[colIdx];
                        break;
                    }
                }
                // [UPDATE] Custom SHQ logic for specific Life plans
                // For Generali Supreme Gold and LionPainter Flexi, only use SHQ for 18-45 age group with total SA ≤ 750k USD; otherwise, use NM when SHQ is present
                if (product.name === 'Generali Supreme Gold' || product.name === 'LionPainter Flexi') {
                    if (typeof result === 'string' && result.includes('SHQ')) {
                        // Determine if this is one of the 4 highlighted SHQ cases
                        if (age <= 45 && checkSA <= 750000) {
                            result = 'SHQ';
                        } else {
                            // For all other combinations showing SHQ/NM, display NM only
                            result = 'NM';
                        }
                    }
                }
                // For LionPatron, always use NM (never SHQ)
                if (product.name === 'LionPatron') {
                    if (typeof result === 'string' && result.includes('SHQ')) {
                        result = 'NM';
                    }
                }
            }

            return {
                req: result,
                checkSA_USD: checkSA,
                ruleType: product.ruleType
            };
        };

        // --- Financial Logic ---
        const getFinancialReq = (planName, occupationStatus, age, sa, currency, annualIncome) => {
            if (!planName || !sa) return null;
            const product = PRODUCT_DB.find(p => p.name === planName);
            if (!product || (product.ruleType !== 'LIFE' && product.ruleType !== 'CI')) return null;

            // [UPDATE Req 2] Use FIN_USD_RATE (8.0) for exchange if HKD
            let saUSD = currency === 'HKD' ? sa / FIN_USD_RATE : sa;
            
            let reqs = [];
            let maxCapMsg = "";
            if (product.ruleType === 'CI') {
                if (occupationStatus === 'Employed' || occupationStatus === 'SelfEmployed') {
                    let multiple = 0;
                    if (age >= 18 && age <= 40) multiple = 30;
                    else if (age <= 50) multiple = 25;
                    else if (age <= 55) multiple = 20;
                    else if (age <= 60) multiple = 15;
                    else if (age <= 65) multiple = 10;
                    else multiple = 5;
                    if (multiple > 0 && annualIncome > 0) {
                        // [UPDATE Req 2] Use FIN_USD_RATE (8.0) for income conversion
                        let incomeUSD = annualIncome / FIN_USD_RATE;
                        let maxCapUSD = incomeUSD * multiple;
                        maxCapMsg = `Max. Coverage up to USD ${Math.round(maxCapUSD).toLocaleString()}`;
                        if (saUSD > maxCapUSD) reqs.push(`Over Max Cap (${multiple}x). Justification required.`);
                    }
                    if (saUSD > 1000000) {
                        reqs.push("FQ + Personal Tax Demand Note (last 2 years) OR Asset Proof (AUM/Properties)");
                    }
                } else if (occupationStatus === 'Housewife' || occupationStatus === 'Juvenile' || occupationStatus === 'Student') {
                    if (saUSD > 500000) {
                        reqs.push("Supplementary Form + Spouse/Parent's Cover Proof (Similar size)");
                    }
                } else if (occupationStatus === 'Retiree' || occupationStatus === 'Unemployed') {
                    if (saUSD > 500000) {
                        reqs.push("FQ + Insurance Advisor's Report");
                    }
                }
            } else {
                if (occupationStatus === 'Housewife' || occupationStatus === 'Juvenile' || occupationStatus === 'Student') {
                    if (saUSD > 1000000) {
                        reqs.push("IC + FQ on Insured & Spouse/Parent + Asset Proof & Income Proof of Spouse/Parent + Spouse/Parent Cover Proof");
                    } else if (saUSD > 500000) {
                        reqs.push("FQ on Insured & Spouse/Parent + Asset Proof/Income Proof of Spouse/Parent + Spouse/Parent Cover Proof");
                    } else if (saUSD > 350000) {
                        reqs.push("Proof of Spouse/Parent Cover (Similar size)");
                    }
                } else if (occupationStatus === 'Unemployed') {
                    if (saUSD > 100000) reqs.push("FQ + Proof of financial info (Assets/Liabilities/Dependents etc.)");
                } else if (occupationStatus === 'Retiree') {
                    if (saUSD > 200000) reqs.push("FQ + Proof of financial info (Assets/Liabilities/Dependents etc.)");
                } else if (occupationStatus === 'Employed' || occupationStatus === 'SelfEmployed') {
                    let multiple = 0;
                    if (age >= 18 && age <= 35) multiple = 30;
                    else if (age <= 50) multiple = 25;
                    else if (age <= 60) multiple = 15;
                    else if (age <= 70) multiple = 10;
                    if (multiple > 0 && annualIncome > 0) {
                        // [UPDATE Req 2] Use FIN_USD_RATE (8.0) for income conversion
                        let incomeUSD = annualIncome / FIN_USD_RATE;
                        let maxCapUSD = incomeUSD * multiple;
                        maxCapMsg = `Max. Coverage up to USD ${Math.round(maxCapUSD).toLocaleString()}`;
                        if (saUSD > maxCapUSD) reqs.push(`Over Max Cap (${multiple}x). Justification required.`);
                    } else if (age > 70) {
                        reqs.push("Age > 70: Individual Consideration (IC)");
                    }
                }
                if (saUSD > 1500000) {
                    reqs.push("FQ + Last 2 years Income Proof (e.g. Tax Demand Note)");
                } else if (saUSD > 1000000) {
                    reqs.push("FQ");
                }
            }

            const uniqueReqs = [...new Set(reqs)];
            if (uniqueReqs.length === 0 && !maxCapMsg) return null;

            return {
                reqs: uniqueReqs,
                maxCapMsg,
                checkSA_USD: saUSD
            };
        };

        // ==========================================
        // Tab 1: Text Splitter Component
        // ==========================================
        const TextSplitterTab = () => {
            const [lineLength, setLineLength] = useState(40);
            const [rowLimit, setRowLimit] = useState(12);
            const [firstColRowLimit, setFirstColRowLimit] = useState(""); 
            const [removeNumbering, setRemoveNumbering] = useState(true);
            const [bulkTextA, setBulkTextA] = useState('');
            const [rows, setRows] = useState([
                { prefixType: 'pending', customPrefix: '', textA: '', textB: '' },
            ]);
            const [processedData, setProcessedData] = useState([]);

            const sortRowsByPrefix = (arr) => {
                const getRank = (t) => (t === 'pending' ? 0 : (t === 'fyi' ? 1 : 2));
                return (arr || [])
                    .map((r, idx) => ({ ...r, _idx: idx }))
                    .sort((a, b) => {
                        const ra = getRank(a.prefixType);
                        const rb = getRank(b.prefixType);
                        if (ra !== rb) return ra - rb;
                        return (a._idx || 0) - (b._idx || 0);
                    });
            };
            const sortedRows = useMemo(() => sortRowsByPrefix(rows), [rows]);



            useEffect(() => {
                const text = bulkTextA.trim();
                if (!text) return;
                const segments = text.split(/\n(?=\s*\d+[.)\/、-]?\s*)/);
                const parsed = segments.map(seg => seg.replace(/^\s*\d+[.)\/、-]?\s*/, '').trim());
                const newRows = parsed.map(seg => {
                    let prefixType = 'none';
                    let textA = seg;
                    const pendingMatch = /^\(Pending\)\s*/i;
                    const fyiMatch = /^\(FYI\)\s*/i;
                    if (pendingMatch.test(textA)) {
                        prefixType = 'pending';
                        textA = textA.replace(pendingMatch, '').trim();
                    } else if (fyiMatch.test(textA)) {
                        prefixType = 'fyi';
                        textA = textA.replace(fyiMatch, '').trim();
                    }
                    return { prefixType, customPrefix: '', textA, textB: '' };
                });
                setRows(newRows.length ? newRows : [{ prefixType: 'pending', customPrefix: '', textA: '', textB: '' }]);
            }, [bulkTextA]);

            const handleRowCountChange = (newCount) => {
                const count = Math.max(1, Math.min(100, Number(newCount)));
                const newRows = [...rows];
                if (count > rows.length) {
                    for (let i = rows.length; i < count; i++) newRows.push({ prefixType: 'none', customPrefix: '', textA: '', textB: '' });
                } else {
                    newRows.length = count;
                }
                setRows(newRows);
            };

            const updateRow = (index, field, value) => {
                const newRows = [...rows];
                newRows[index] = { ...newRows[index], [field]: value };
                setRows(newRows);
            };

            const handleClearAll = () => {
                setRows([{ prefixType: 'pending', customPrefix: '', textA: '', textB: '' }]);
                setFirstColRowLimit("");
                setBulkTextA("");
            };

            useEffect(() => {
                const gridData = [];
                let currentRow = 1;
                let currentColumnBlock = 1;

                sortRowsByPrefix(rows).forEach((row) => {
                    let content = row.textA || "";
                    let refText = row.textB || "";
                    if (!content.trim() && !refText.trim()) return;

                    if (removeNumbering) {
                        content = content.replace(/^\s*\d+[.)\/-]?\s*/, '');
                    }

                    let prefixStr = "";
                    if (row.prefixType === 'pending') prefixStr = "(Pending) ";
                    else if (row.prefixType === 'fyi') prefixStr = "(FYI) ";
                    else if (row.prefixType === 'custom') prefixStr = row.customPrefix + " ";

                    if (prefixStr && !/^\s*\([A-Za-z0-9\s]+\)/.test(content)) content = prefixStr + content;
                    content = content.replace(/(\s+|^)(\([A-Za-z0-9]+\))/g, "\n$2").trim();

                    const paragraphs = content.split('\n');
                    paragraphs.forEach(paragraph => {
                        const words = paragraph.split(' ');
                        let lines = [];
                        let tempLine = "";

                        for (let j = 0; j < words.length; j++) {
                            const currentWord = words[j];
                            if ((tempLine + currentWord).length <= lineLength) {
                                tempLine += currentWord + " ";
                            } else {
                                if (tempLine.trim()) lines.push(tempLine.trim());
                                tempLine = currentWord + " ";
                            }
                        }
                        if (tempLine.trim()) lines.push(tempLine.trim());

                        lines.forEach((line) => {
                            let currentLimit = rowLimit;
                            if (currentColumnBlock === 1 && firstColRowLimit && Number(firstColRowLimit) > 0) {
                                currentLimit = Number(firstColRowLimit);
                            }

                            if (currentRow > currentLimit) {
                                currentColumnBlock++;
                                currentRow = 1;
                            }
                            gridData.push({ textA: line, textB: refText, row: currentRow, block: currentColumnBlock });
                            currentRow++;
                        });
                    });
                    
                    if (paragraphs.length === 0 && refText.trim()) {
                         let currentLimit = rowLimit;
                         if (currentColumnBlock === 1 && firstColRowLimit && Number(firstColRowLimit) > 0) {
                             currentLimit = Number(firstColRowLimit);
                         }
                         if (currentRow > currentLimit) {
                            currentColumnBlock++;
                            currentRow = 1;
                        }
                        gridData.push({ textA: "", textB: refText, row: currentRow, block: currentColumnBlock });
                        currentRow++;
                    }
                });
                setProcessedData(gridData);
            }, [rows, lineLength, rowLimit, firstColRowLimit, removeNumbering]);

            useEffect(() => {
                const handler = () => {
                    try {
                        const text = localStorage.getItem('bulkTextA') || '';
                        if (text) {
                            setBulkTextA(text);
                        }
                    } catch (e) {}
                };
                window.addEventListener('autoPasteIssueUN', handler);
                return () => window.removeEventListener('autoPasteIssueUN', handler);
            }, []);

            const groupedBlocks = useMemo(() => {
                const groups = {};
                processedData.forEach(d => {
                    if (!groups[d.block]) groups[d.block] = [];
                    groups[d.block].push(d);
                });
                return groups;
            }, [processedData]);

            const handleCopy = (type, blockData = null) => {
                let text = "";
                const source = blockData || processedData;
                if (type === 'A') {
                    text = source.map(d => d.textA).join('\n');
                } else if (type === 'B') {
                    text = source.map(d => d.textB).join('\n');
                } else if (type === 'followup') {
                    // Follow-up format: Text B 1 00 L Text A
                    text = source.map(d => `${(d.textB || '')} 1 00 L ${(d.textA || '')}`).join('\n');
                } else {
                    // Excel format (aligned): TextB 1 00 L .......... TextA
                    text = source.map(d => `${d.textB} 1 00 L .......... ${d.textA}`).join('\n');
                }
                copyToClipboard(text, 'Copied (UN Screen)');
            };

            return (
                <div className="flex flex-col md:flex-row flex-1 overflow-hidden h-full">
                    <div className="w-full md:w-1/2 flex flex-col border-r border-slate-200 bg-slate-50 h-1/2 md:h-full">
                        <div className="p-4 bg-white border-b border-slate-200 shadow-sm z-10">
                            <div className="flex justify-between items-center mb-3">
                                <div className="flex items-center gap-2">
                                    <label className="text-sm font-bold text-slate-700">筆數:</label>
                                    <input type="number" min="1" value={rows.length} onChange={(e) => handleRowCountChange(e.target.value)} className="w-16 px-2 py-1 border border-slate-300 rounded focus:ring-2 focus:ring-blue-500 font-bold text-center" />
                                </div>
                                <button onClick={handleClearAll} className="text-xs text-red-500 hover:text-red-700 flex items-center gap-1 px-2 py-1 rounded hover:bg-red-50 transition-colors">
                                    <Trash2 size={14} /> 清除全部
                                </button>
                            </div>
                            <div className="flex flex-wrap gap-3 text-xs text-slate-600 bg-slate-50 p-2 rounded border border-slate-100 items-center">
                                <div className="flex items-center gap-1">
                                    <span>單行字數:</span> <input type="number" value={lineLength} onChange={(e)=>setLineLength(Number(e.target.value))} className="w-12 px-1 border rounded text-center"/>
                                </div>
                                <div className="flex items-center gap-1">
                                    <span>每欄行數:</span> <input type="number" value={rowLimit} onChange={(e)=>setRowLimit(Number(e.target.value))} className="w-12 px-1 border rounded text-center"/>
                                </div>
                                <div className="flex items-center gap-1">
                                    <span>第一欄行數:</span> <input type="number" value={firstColRowLimit} onChange={(e)=>setFirstColRowLimit(e.target.value)} placeholder="-" className="w-12 px-1 border rounded text-center bg-yellow-50 border-yellow-200" title="留空則使用預設每欄行數"/>
                                </div>
                                <label className="flex items-center gap-1 cursor-pointer select-none">
                                    <input type="checkbox" checked={removeNumbering} onChange={(e)=>setRemoveNumbering(e.target.checked)} className="rounded text-blue-600"/> <span>移除編號</span>
                                </label>
                            </div>
                            <div className="mt-4">
                                <label className="text-xs font-bold text-slate-700 block mb-1">批量輸入 Text A (按編號自動分段)</label>
                                <textarea value={bulkTextA} onChange={(e) => setBulkTextA(e.target.value)} className="w-full text-sm border border-slate-300 rounded p-2 focus:ring-1 focus:ring-blue-500 outline-none resize-y" rows={4} placeholder="將所有 Text A 貼上此處，系統會根據數字編號（例如 1., 2., 3.）自動分段"></textarea>
                            </div>
                        </div>
                        <div className="flex-1 overflow-y-auto p-4 custom-scrollbar">
                            {sortedRows.map((row, i) => (
                                <div key={row._idx} className="bg-white p-3 rounded shadow-sm border border-slate-200 mb-3 hover:shadow-md transition-shadow">
                                    <div className="flex justify-between items-center mb-2 pb-2 border-b border-slate-50">
                                        <span className="text-xs font-bold text-slate-400">項目 #{i+1}</span>
                                        <select value={row.prefixType} onChange={(e)=>updateRow(row._idx, 'prefixType', e.target.value)} className={`text-xs border rounded p-1 font-medium ${row.prefixType === 'pending' ? 'text-orange-600 bg-orange-50' : row.prefixType === 'fyi' ? 'text-blue-600 bg-blue-50' : 'text-slate-600'}`}>
                                            <option value="none">無前綴</option>
                                            <option value="pending">(Pending)</option>
                                            <option value="fyi">(FYI)</option>
                                            <option value="custom">自訂...</option>
                                        </select>
                                    </div>
                                    <div className="space-y-2">
                                        {row.prefixType === 'custom' && (<input value={row.customPrefix} onChange={(e)=>updateRow(row._idx,'customPrefix',e.target.value)} className="w-full text-xs border rounded p-1.5 bg-slate-50" placeholder="輸入自訂前綴"/>)}
                                        <textarea value={row.textA} onChange={(e)=>updateRow(row._idx,'textA',e.target.value)} className="w-full text-sm border border-slate-300 rounded p-2 focus:ring-1 focus:ring-blue-500 outline-none resize-none" placeholder="Text A (主要內容)" rows={2}/>
                                        <input value={row.textB} onChange={(e)=>updateRow(row._idx,'textB',e.target.value)} className="w-full text-sm border border-slate-300 rounded p-2 focus:ring-1 focus:ring-blue-500 outline-none" placeholder="Text B (參照內容)"/>
                                    </div>
                                </div>
                            ))}
                            <button onClick={() => handleRowCountChange(rows.length + 1)} className="w-full py-3 border-2 border-dashed border-slate-300 rounded-lg text-slate-400 hover:border-blue-400 hover:text-blue-500 hover:bg-blue-50 transition-all flex items-center justify-center gap-2 font-medium text-sm">
                                <Plus size={16} /> 新增一筆
                            </button>
                        </div>
                    </div>
                    {/* Right Panel - Text Splitter */}
                    <div className="w-full md:w-1/2 flex flex-col bg-slate-100 h-1/2 md:h-full">
                         <div className="p-3 bg-slate-200 border-b border-slate-300 flex justify-between items-center shadow-sm z-10">
                            <span className="text-xs font-bold text-slate-600 uppercase">結果預覽 (共 {Object.keys(groupedBlocks).length} 欄)</span>
                            <div className="flex gap-2">
                                <button onClick={()=>handleCopy('A')} className="text-[10px] bg-white border border-slate-300 text-slate-700 px-2 py-1 rounded hover:bg-slate-50 transition-colors">全複製 Col A</button>
                                <button onClick={()=>handleCopy('B')} className="text-[10px] bg-white border border-slate-300 text-slate-700 px-2 py-1 rounded hover:bg-slate-50 transition-colors">全複製 Col B</button>
                                <button onClick={()=>handleCopy('all')} className="text-[10px] bg-green-600 text-white px-2 py-1 rounded hover:bg-green-700 font-bold shadow-sm transition-colors flex items-center gap-1"><Copy size={12}/> 全複製 Excel</button>
                                <button onClick={()=>handleCopy('followup')} className="text-[10px] bg-purple-600 text-white px-2 py-1 rounded hover:bg-purple-700 flex items-center gap-1"><Copy size={12}/> Copy all for Follow Up</button>
                            </div>
                         </div>
                         <div className="flex-1 overflow-y-auto p-4 custom-scrollbar">
                             {processedData.length === 0 ? (
                                <div className="flex flex-col items-center justify-center h-full text-slate-400"><Split size={48} /><p className="mt-2 text-sm">請在左側輸入資料</p></div>
                            ) : Object.entries(groupedBlocks).map(([blockNum, blockRows]) => (
                                <div key={blockNum} className="mb-6 bg-white border border-slate-200 rounded-lg shadow-sm overflow-hidden">
                                    <div className="bg-slate-100 px-3 py-2 border-b border-slate-200 flex justify-between items-center">
                                        <span className="text-xs font-bold text-slate-600 bg-white px-2 py-0.5 rounded border">Block {blockNum}</span>
                                        <div className="flex gap-1">
                                            <button onClick={()=>handleCopy('A', blockRows)} className="text-[10px] bg-white hover:bg-blue-50 text-blue-600 border border-blue-200 px-2 py-0.5 rounded transition-colors flex items-center gap-1">Copy A</button>
                                            <button onClick={()=>handleCopy('B', blockRows)} className="text-[10px] bg-white hover:bg-blue-50 text-blue-600 border border-blue-200 px-2 py-0.5 rounded transition-colors flex items-center gap-1">Copy B</button>
                                            <button onClick={()=>handleCopy('all', blockRows)} className="text-[10px] bg-blue-600 hover:bg-blue-700 text-white border border-blue-600 px-2 py-0.5 rounded transition-colors flex items-center gap-1">Copy Both <Copy size={10}/></button>
                                            <button onClick={()=>handleCopy('followup', blockRows)} className="text-[10px] bg-purple-600 text-white px-2 py-1 rounded hover:bg-purple-700 flex items-center gap-1"><Copy size={12}/> Copy all for Follow Up</button>
                                        </div>
                                    </div>
                                    <div>
                                        {blockRows.map((d, i) => (
                                            <div key={i} className="flex text-sm border-b border-slate-50 last:border-0 hover:bg-blue-50/50 transition-colors">
                                                <span className="w-8 text-[10px] text-slate-400 flex items-center justify-center border-r border-slate-100 bg-slate-50/50">{d.row}</span>
                                                <span className="w-2/3 border-r border-slate-100 px-3 py-1.5 break-all text-slate-700">{d.textA}</span>
                                                <span className="w-1/3 px-3 py-1.5 text-slate-500 bg-slate-50/30 break-all text-xs">{d.textB}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            ))}
                         </div>
                    </div>
                </div>
            );
        };

        // ==========================================
        // [UPDATE Req 9] New Occupation Tab Component
        // ==========================================
        const OccupationTab = () => {
            const [searchTerm, setSearchTerm] = useState('');
            
            const filteredData = useMemo(() => {
                if (!searchTerm.trim()) return OCCUPATION_DB;
                const lower = searchTerm.toLowerCase();
                return OCCUPATION_DB.filter(item => 
                    (item.title && item.title.toLowerCase().includes(lower)) ||
                    (item.titleEn && item.titleEn.toLowerCase().includes(lower)) ||
                    (item.industry && item.industry.toLowerCase().includes(lower))
                );
            }, [searchTerm]);

            return (
                <div className="h-full flex flex-col bg-slate-50 overflow-hidden tab-content">
                    <div className="p-4 bg-white border-b border-slate-200 shadow-sm z-10 flex justify-between items-center">
                        <div className="flex items-center gap-2">
                            <Briefcase className="text-slate-600" size={20} />
                            <h2 className="text-lg font-bold text-slate-800">Occupation Rating Manual</h2>
                        </div>
                        <div className="relative w-64">
                            <input 
                                type="text" 
                                placeholder="Search Job Title / Industry..." 
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                                className="w-full pl-9 pr-3 py-1.5 border border-slate-300 rounded text-sm focus:ring-2 focus:ring-blue-500 outline-none"
                            />
                            <Search className="absolute left-2.5 top-2 text-slate-400" size={16} />
                        </div>
                    </div>
                    
                    <div className="flex-1 overflow-auto p-6 custom-scrollbar">
                        <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-hidden">
                            <table className="w-full text-sm text-left">
                            {/* Make the table header sticky so it remains visible when scrolling */}
                            <thead className="bg-slate-100 text-slate-700 font-bold border-b border-slate-200 sticky top-0">
                                    <tr>
                                        <th className="px-4 py-3 border-r border-slate-200 w-32">Industry</th>
                                        <th className="px-4 py-3 border-r border-slate-200">Job Title (Chi)</th>
                                        <th className="px-4 py-3 border-r border-slate-200">Job Title (Eng)</th>
                                        <th className="px-4 py-3 border-r border-slate-200 text-center w-24">Life</th>
                                        <th className="px-4 py-3 border-r border-slate-200 text-center w-24">CI</th>
                                        <th className="px-4 py-3 text-center w-24">WP</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-slate-100">
                                    {filteredData.length > 0 ? (
                                        filteredData.map((item, index) => (
                                            <tr key={index} className="hover:bg-slate-50 transition-colors">
                                                <td className="px-4 py-2.5 border-r border-slate-100 text-slate-500 text-xs font-bold">{item.industry}</td>
                                                <td className="px-4 py-2.5 border-r border-slate-100 font-medium text-slate-800">{item.title}</td>
                                                <td className="px-4 py-2.5 border-r border-slate-100 text-slate-600">{item.titleEn}</td>
                                                <td className={`px-4 py-2.5 border-r border-slate-100 text-center font-bold ${item.life !== 'STD' ? 'text-red-600 bg-red-50' : 'text-green-600'}`}>{item.life}</td>
                                                <td className={`px-4 py-2.5 border-r border-slate-100 text-center font-bold ${item.ci !== 'STD' ? 'text-red-600 bg-red-50' : 'text-green-600'}`}>{item.ci}</td>
                                                <td className={`px-4 py-2.5 text-center font-bold ${item.wp !== 'STD' ? 'text-red-600 bg-red-50' : 'text-green-600'}`}>{item.wp}</td>
                                            </tr>
                                        ))
                                    ) : (
                                        <tr>
                                            <td colSpan="6" className="p-8 text-center text-slate-400">No matching occupations found.</td>
                                        </tr>
                                    )}
                                </tbody>
                            </table>
                        </div>
                        <div className="mt-4 text-xs text-slate-400 text-right">
                            Showing {filteredData.length} entries based on Occupation Manual Master List
                        </div>
                    </div>
                </div>
            );
        };

        // ==========================================
        // Tab 2: Affordability Calculator Component
        // ==========================================
        const AffordabilityTab = () => {
            const [age, setAge] = useState(18);
            const [retireAge, setRetireAge] = useState(70);
            const [calcMode, setCalcMode] = useState('both'); 
            const [monthlyIncome, setMonthlyIncome] = useState(4166); 
            const [incomePercent, setIncomePercent] = useState(100);
            const [liquidAsset, setLiquidAsset] = useState(860000);
            const [assetPercent, setAssetPercent] = useState(100);
            const [policies, setPolicies] = useState([
                 // [UPDATE v2.8] add payType property to identify Single vs Regular pay
                 { id: 1, name: '', status: 'Applying', premium: 0, currency: 'HKD', term: 5, payType: 'Regular' },
             ]);

            // Premium Financing (PF) fields copied from Policy Info for affordability calculation
            const [isPremiumFinancing, setIsPremiumFinancing] = useState(false);
            const [pfLoanAmount, setPfLoanAmount] = useState(0);
            const [pfLoanRate, setPfLoanRate] = useState(0);
            const [pfLoanTenor, setPfLoanTenor] = useState(0);
            // [UPDATE v2.8] Capture repayment amount per period for PF (for display only)
            const [pfRepaymentAmount, setPfRepaymentAmount] = useState(0);


            // ===== v2.0 Export/Import Hydration (Affordability) =====
            const [affHydrated, setAffHydrated] = useState(false);

            useEffect(() => {
                try {
                    const savedStr = localStorage.getItem('affordabilityFullState');
                    if (savedStr) {
                        const s = JSON.parse(savedStr) || {};
                        if (s.age !== undefined && s.age !== null) setAge(Number(s.age));
                        if (s.retireAge !== undefined && s.retireAge !== null) setRetireAge(Number(s.retireAge));
                        if (s.calcMode) setCalcMode(s.calcMode);
                        if (s.monthlyIncome !== undefined && s.monthlyIncome !== null) setMonthlyIncome(Number(s.monthlyIncome));
                        if (s.incomePercent !== undefined && s.incomePercent !== null) setIncomePercent(Number(s.incomePercent));
                        if (s.liquidAsset !== undefined && s.liquidAsset !== null) setLiquidAsset(Number(s.liquidAsset));
                        if (s.assetPercent !== undefined && s.assetPercent !== null) setAssetPercent(Number(s.assetPercent));
                        // Hydrate Premium Financing fields
                        if (s.isPremiumFinancing !== undefined) setIsPremiumFinancing(!!s.isPremiumFinancing);
                        if (s.pfLoanAmount !== undefined) setPfLoanAmount(Number(s.pfLoanAmount));
                        if (s.pfLoanRate !== undefined) setPfLoanRate(Number(s.pfLoanRate));
                        if (s.pfLoanTenor !== undefined) setPfLoanTenor(Number(s.pfLoanTenor));
                        // [UPDATE v2.8] hydrate PF repayment amount
                        if (s.pfRepaymentAmount !== undefined) setPfRepaymentAmount(Number(s.pfRepaymentAmount));
                        if (Array.isArray(s.policies) && s.policies.length) {
                            // Ensure at least one policy marked as Applying
                            const hasApplying = s.policies.some(p => (p.status || '') === 'Applying');
                            let safePolicies = hasApplying ? s.policies : [{ ...(s.policies[0] || {}), status: 'Applying' }, ...s.policies.slice(1)];
                            // [UPDATE v2.8] Ensure each policy has a payType property (default Regular)
                            safePolicies = safePolicies.map(p => ({ ...p, payType: p.payType || 'Regular' }));
                            setPolicies(safePolicies);
                        }
                    }
                } catch (err) {
                    console.error('Failed to hydrate Affordability from import', err);
                } finally {
                    setAffHydrated(true);
                }
            }, []);

            // Save full Affordability state for Export
            useEffect(() => {
                if (!affHydrated) return;
                try {
                    const full = {
                        age,
                        retireAge,
                        calcMode,
                        monthlyIncome,
                        incomePercent,
                        liquidAsset,
                        assetPercent,
                        // [UPDATE v2.8] persist policies including payType
                        policies,
                        // persist PF fields for hydration/export
                        isPremiumFinancing,
                        pfLoanAmount,
                        pfLoanRate,
                        pfLoanTenor,
                        // [UPDATE v2.8] persist PF repayment amount
                        pfRepaymentAmount,
                    };
                    localStorage.setItem('affordabilityFullState', JSON.stringify(full));
                } catch (err) {
                    console.error('Failed to persist Affordability full state', err);
                }
            }, [age, retireAge, calcMode, monthlyIncome, incomePercent, liquidAsset, assetPercent, policies, affHydrated,
                // dependencies for PF states
                isPremiumFinancing, pfLoanAmount, pfLoanRate, pfLoanTenor, pfRepaymentAmount]);

            // [UPDATE v2.8] When premium financing is toggled, automatically treat the applying policy as Single Pay
            useEffect(() => {
                // Do not run until hydration complete
                if (!affHydrated) return;
                setPolicies(prevPolicies => {
                    return prevPolicies.map(p => {
                        if (p.status === 'Applying') {
                            // When PF is on, force payType to Single; when off, default to Regular if previously forced
                            const forcedType = isPremiumFinancing ? 'Single' : (p.payType === 'Single' && p.status === 'Applying' ? 'Regular' : p.payType);
                            return { ...p, payType: forcedType };
                        }
                        return p;
                    });
                });
            }, [isPremiumFinancing, affHydrated]);
            // =========================================================

            const yearsToRetire = Math.max(0, retireAge - age);

            const calculationResult = useMemo(() => {
                const annualNetIncomeRaw = monthlyIncome * 12;
                let effectiveIncome = annualNetIncomeRaw * (incomePercent / 100);
                let effectiveAssets = liquidAsset * (assetPercent / 100);

                // In asset-only mode, income is not considered
                if (calcMode === 'asset') effectiveIncome = 0;

                // Sort policies by term descending (longer first)
                const sortedPolicies = [...policies].sort((a, b) => b.term - a.term);

                let currentRemainingIncome = effectiveIncome;
                let totalRequiredHKD = 0; // total assets needed without interest
                let grossTotalDisplay = 0;
                let preRetireShortfallSum = 0;

                const detailedResults = sortedPolicies.map((p, index) => {
                    const annualPremiumRaw = Number(p.premium);
                    const term = Number(p.term);
                    let premiumInHKD = p.currency === 'USD' ? annualPremiumRaw * USD_RATE : annualPremiumRaw;
                    // Determine if this policy is treated as single pay: either user-selected or PF applying policy
                    const isSinglePolicy = (p.payType === 'Single') || (isPremiumFinancing && p.status === 'Applying');

                    if (isSinglePolicy) {
                        // For single pay, premium is paid once from assets; income is not used
                        grossTotalDisplay += premiumInHKD;
                        const shortfallAnnual = 0;
                        const preRetireYears = 0;
                        const overhangYears = 0;
                        const totalAssetCover = premiumInHKD;
                        totalRequiredHKD += totalAssetCover;
                        // Do not reduce currentRemainingIncome
                        return {
                            ...p,
                            calculatedSequence: index + 1,
                            premiumInHKD,
                            shortfallAnnual,
                            overhangYears,
                            totalAssetCover,
                            preRetireYears
                        };
                    }

                    // Regular pay logic
                    if (calcMode === 'income') {
                        grossTotalDisplay += premiumInHKD;
                    } else {
                        grossTotalDisplay += premiumInHKD * term;
                    }
                    // Determine annual shortfall when income cannot cover premium
                    const shortfallAnnual = Math.max(0, premiumInHKD - currentRemainingIncome);
                    currentRemainingIncome = Math.max(0, currentRemainingIncome - premiumInHKD);
                    // Years beyond retirement; cannot use income
                    const overhangYears = Math.max(0, term - yearsToRetire);
                    // Years before retirement
                    const preRetireYears = Math.max(0, term - overhangYears);
                    // Shortfall across pre-retire years contributes to asset requirement
                    preRetireShortfallSum += shortfallAnnual * preRetireYears;
                    // Asset cover includes premiums due after retirement plus shortfall before retirement
                    const totalAssetCover = (premiumInHKD * overhangYears) + (shortfallAnnual * preRetireYears);
                    totalRequiredHKD += totalAssetCover;
                    return {
                        ...p,
                        calculatedSequence: index + 1,
                        premiumInHKD,
                        shortfallAnnual,
                        overhangYears,
                        totalAssetCover,
                        preRetireYears
                    };
                });

                // Calculate projected interest for premium financing
                let projectedInterest = 0;
                if (isPremiumFinancing) {
                    const loan = Number(pfLoanAmount) || 0;
                    const rate = Number(pfLoanRate) || 0;
                    const tenor = Number(pfLoanTenor) || 0;
                    projectedInterest = loan * (rate / 100) * tenor;
                }
                // Test A: asset requirement without interest
                const assetRequirement = totalRequiredHKD;
                // Test B: include projected interest when PF is on
                const assetRequirementWithInterest = totalRequiredHKD + projectedInterest;

                // Determine pass/fail for Premium Affordability (Test A) and Over‑leveraging (Test B)
                let isPassA;
                let isPassB;
                let diffA;
                let diffB;
                // Remaining net assets (100% of liquidAsset) after paying all premium requirements (Test A requirement)
                const remainingRawAssetsAfterPremiums = (Number(liquidAsset) || 0) - assetRequirement;
                if (calcMode === 'income') {
                    if (preRetireShortfallSum > 0) {
                        // Income cannot cover pre‑retire premiums; fail both tests regardless of assets
                        isPassA = false;
                        isPassB = false;
                        diffA = effectiveAssets - assetRequirement;
                        diffB = remainingRawAssetsAfterPremiums - projectedInterest;
                    } else {
                        isPassA = effectiveAssets >= assetRequirement;
                        // Test B uses raw net assets (not capped by assetPercent)
                        isPassB = remainingRawAssetsAfterPremiums >= projectedInterest;
                        diffA = effectiveAssets - assetRequirement;
                        diffB = remainingRawAssetsAfterPremiums - projectedInterest;
                    }
                } else {
                    // For combined or asset-only modes, compare assets directly
                    isPassA = effectiveAssets >= assetRequirement;
                    isPassB = remainingRawAssetsAfterPremiums >= projectedInterest;
                    diffA = effectiveAssets - assetRequirement;
                    diffB = remainingRawAssetsAfterPremiums - projectedInterest;
                }

                // For backward compatibility: use Test A result for existing pass/diff properties
                const isPass = isPassA;
                const diff = diffA;
                // Provide totalRequiredHKD as A requirement (without interest)
                return {
                    detailedResults,
                    effectiveIncome,
                    effectiveAssets,
                    totalRequiredHKD: assetRequirement,
                    grossTotalDisplay,
                    isPass,
                    diff,
                    calcMode,
                    projectedInterest,
                    isPremiumFinancing,
                    // Provide separate results for Test A and Test B
                    isPassA,
                    diffA,
                    isPassB,
                    diffB
                };
            }, [policies, monthlyIncome, incomePercent, liquidAsset, assetPercent, yearsToRetire, calcMode, isPremiumFinancing, pfLoanAmount, pfLoanRate, pfLoanTenor]);

            const addPolicy = () => {
                const newId = Math.max(...policies.map(p=>p.id), 0) + 1;
                // [UPDATE v2.8] New policies default to Regular pay type
                setPolicies([...policies, { id: newId, name: 'New Policy', status: 'Existing', premium: 0, currency: 'HKD', term: 1, payType: 'Regular' }]);
            };
            const removePolicy = (id) => {
                setPolicies(policies.filter(p => p.id !== id));
            };
            const updatePolicy = (id, field, value) => {
                setPolicies(policies.map(p => p.id === id ? { ...p, [field]: value } : p));
            };

            const handleCopyFromPolicy = () => {
                try {
                    const dataStr = localStorage.getItem('policyInfoForAffordability');
                    if (!dataStr) return;
                    const data = JSON.parse(dataStr);
                    if (data.age !== undefined && data.age !== null) setAge(Number(data.age));
                    if (data.retireAge) setRetireAge(Number(data.retireAge));
                    if (data.monthlyIncome) setMonthlyIncome(Number(data.monthlyIncome));
                    if (data.incomePercent) setIncomePercent(Number(data.incomePercent));
                    if (data.liquidAsset) setLiquidAsset(Number(data.liquidAsset));
                    if (data.assetPercent) setAssetPercent(Number(data.assetPercent));

                    // Copy Premium Financing values from policy info
                    if (data.isPremiumFinancing !== undefined) setIsPremiumFinancing(!!data.isPremiumFinancing);
                    if (data.pfLoanAmount) setPfLoanAmount(Number(data.pfLoanAmount));
                    if (data.pfLoanRate) setPfLoanRate(Number(data.pfLoanRate));
                    if (data.pfLoanTenor) setPfLoanTenor(Number(data.pfLoanTenor));
                    // [UPDATE v2.8] Copy PF repayment amount
                    if (data.pfRepaymentAmount !== undefined) setPfRepaymentAmount(Number(data.pfRepaymentAmount));
                    
                    const applyingPolicyIndex = policies.findIndex(p => p.status === 'Applying');
                    if (applyingPolicyIndex >= 0) {
                        const newPolicies = [...policies];
                        let copiedPremium = data.premium ? Number(data.premium) : newPolicies[applyingPolicyIndex].premium;
                        let factor = 1;
                        if (data.payMode) {
                            if (data.payMode === 'Monthly') factor = 12;
                            else if (data.payMode === 'Quarterly') factor = 4;
                            else if (data.payMode === 'Semi') factor = 2;
                            // Treat both Prepay and Single as one-time, same factor 1
                            else if (data.payMode === 'Annual' || data.payMode === 'Prepay' || data.payMode === 'Single') factor = 1;
                        }
                        copiedPremium = copiedPremium * factor;
                        // Determine payType based on payMode; Prepay is treated as Regular Pay (not Single)
                        const copiedPayType = (data.payMode === 'Single') ? 'Single' : 'Regular';
                        newPolicies[applyingPolicyIndex] = {
                            ...newPolicies[applyingPolicyIndex],
                            premium: copiedPremium,
                            term: data.term ? Number(data.term) : newPolicies[applyingPolicyIndex].term,
                            currency: data.currency ? data.currency : newPolicies[applyingPolicyIndex].currency,
                            // [UPDATE v2.8] set payType when copying from policy info
                            payType: copiedPayType
                        };
                        setPolicies(newPolicies);
                    } else if (data.premium || data.term) {
                        const newId = Math.max(...policies.map(p=>p.id), 0) + 1;
                        let annPrem = data.premium ? Number(data.premium) : 0;
                        let factor2 = 1;
                        if (data.payMode) {
                            if (data.payMode === 'Monthly') factor2 = 12;
                            else if (data.payMode === 'Quarterly') factor2 = 4;
                            else if (data.payMode === 'Semi') factor2 = 2;
                            else if (data.payMode === 'Annual' || data.payMode === 'Prepay' || data.payMode === 'Single') factor2 = 1;
                        }
                        annPrem = annPrem * factor2;
                        // Determine payType for the new policy; Prepay maps to Regular Pay
                        const newPayType = (data.payMode === 'Single') ? 'Single' : 'Regular';
                        setPolicies([...policies, { 
                            id: newId, 
                            name: 'Current Application', 
                            status: 'Applying', 
                            premium: annPrem, 
                            currency: data.currency ? data.currency : 'USD',
                            term: data.term ? Number(data.term) : 1,
                            payType: newPayType
                        }]);
                    }
                } catch (err) {
                    console.error('Error parsing copied data', err);
                }
            };
            
            const handleResetAffordability = () => {
                setAge(18);
                setRetireAge(70);
                setCalcMode('both');
                setMonthlyIncome(4166);
                setIncomePercent(100);
                setLiquidAsset(860000);
                setAssetPercent(100);
                setPolicies([
                    { id: 1, name: '', status: 'Applying', premium: 0, currency: 'HKD', term: 5, payType: 'Regular' },
                ]);

                // Reset Premium Financing states
                setIsPremiumFinancing(false);
                setPfLoanAmount(0);
                setPfLoanRate(0);
                setPfLoanTenor(0);
                setPfRepaymentAmount(0);
            };

            useEffect(() => {
                if (!affHydrated) return;
                try {
                        const data = {
                            policies,
                            calculationResult,
                            calcMode,
                            monthlyIncome,
                            incomePercent,
                            liquidAsset,
                            assetPercent,
                            // Include premium financing information for case summary
                            isPremiumFinancing,
                            projectedInterest: calculationResult.projectedInterest || 0,
                            // Save Test B result status using calculationResult.isPassB
                            testBPass: isPremiumFinancing ? (calculationResult.isPassB) : null,
                            // Persist PF fields for summary output
                            pfLoanAmount,
                            pfLoanRate,
                            pfLoanTenor,
                            pfRepaymentAmount,
                            // Persist diffB for net asset vs interest calculation
                            diffB: calculationResult.diffB
                        };
                    localStorage.setItem('caseSummaryAffordability', JSON.stringify(data));
                    window.dispatchEvent(new CustomEvent('caseSummaryUpdate'));
                } catch (err) {
                    console.error('Failed to save case summary affordability data', err);
                }
            }, [policies, calculationResult, calcMode, monthlyIncome, incomePercent, liquidAsset, assetPercent, affHydrated,
                // premium financing
                isPremiumFinancing]);

            return (
                <div className="flex flex-col h-full bg-slate-50 overflow-hidden">
                    {/* Top Inputs */}
                    <div className="p-4 bg-white border-b border-slate-200 shadow-sm">
                        <div className="mb-4 flex justify-between items-center">
                            <div className="flex-1 flex justify-center">
                                <div className="inline-flex bg-slate-100 p-1 rounded-lg border border-slate-200">
                                    <button onClick={() => setCalcMode('both')} className={`px-4 py-1.5 text-xs font-bold rounded-md transition-all ${calcMode === 'both' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}>綜合計算 (Both)</button>
                                    <button onClick={() => setCalcMode('income')} className={`px-4 py-1.5 text-xs font-bold rounded-md transition-all ${calcMode === 'income' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}>僅計算收入 (Income)</button>
                                    <button onClick={() => setCalcMode('asset')} className={`px-4 py-1.5 text-xs font-bold rounded-md transition-all ${calcMode === 'asset' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}>僅計算資產 (Asset)</button>
                                </div>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={handleCopyFromPolicy} className="text-xs bg-blue-600 text-white px-3 py-1.5 rounded hover:bg-blue-700 transition-colors flex items-center gap-1 shadow-sm">
                                    <Copy size={12}/> 複製保單資料
                                </button>
                                <button onClick={handleResetAffordability} className="text-xs bg-white border border-slate-300 text-red-500 px-3 py-1.5 rounded hover:bg-red-50 transition-colors flex items-center gap-1">
                                    <RotateCw size={12}/> 重設
                                </button>
                            </div>
                        </div>

                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-2">
                            <div>
                                <label className="block text-xs font-bold text-slate-500 uppercase">現有年齡</label>
                                <input type="number" value={age} onChange={(e) =>setAge(Number(e.target.value))} className="w-full border rounded p-1 font-bold text-sm"/>
                            </div>
                            <div>
                                <label className="block text-xs font-bold text-slate-500 uppercase">預期退休年齡</label>
                                <input type="number" value={retireAge} onChange={(e) =>setRetireAge(Number(e.target.value))} className="w-full border rounded p-1 font-bold text-sm"/>
                                <div className="text-[10px] text-blue-600 mt-1">距離退休: {yearsToRetire} 年</div>
                            </div>
                            
                            <div className={`col-span-1 border-l pl-4 border-slate-100 transition-opacity ${calcMode === 'asset' ? 'disabled-input opacity-50' : ''}`}>
                                <label className="block text-xs font-bold text-slate-500 uppercase flex justify-between">
                                    <span>可支配月收入</span>
                                    <span className="text-blue-500">x 12 = Annual</span>
                                </label>
                                <div className="flex gap-2 mb-1">
                                    <input type="number" value={monthlyIncome} onChange={(e) =>setMonthlyIncome(Number(e.target.value))} disabled={calcMode === 'asset'} className="w-full border rounded p-1 font-bold text-sm disabled:bg-transparent"/>
                                </div>
                                <div className="flex items-center gap-2">
                                    <label className="text-[10px] text-slate-400">計算佔比%</label>
                                    <input type="number" value={incomePercent} onChange={(e) =>setIncomePercent(Number(e.target.value))} disabled={calcMode === 'asset'} className="w-12 border rounded p-0.5 text-center text-xs font-bold bg-slate-50 disabled:text-slate-400"/>
                                </div>
                                {calcMode !== 'asset' && (<div className="text-[10px] text-slate-400 mt-1">有效年薪: <span className="font-bold text-slate-700">{formatMoney(calculationResult.effectiveIncome)}</span></div>)}
                            </div>

                            <div className={`col-span-1 border-l pl-4 border-slate-100 transition-opacity ${calcMode === 'income' ? 'opacity-50' : ''}`}>
                                <label className="block text-xs font-bold text-slate-500 uppercase">淨流動資產 (Net Assets)</label>
                                <div className="flex gap-2 mb-1">
                                    <input type="number" value={liquidAsset} onChange={(e) =>setLiquidAsset(Number(e.target.value))} className="w-full border rounded p-1 font-bold text-sm text-green-700 disabled:text-slate-400 disabled:bg-transparent"/>
                                </div>
                                <div className="flex items-center gap-2">
                                    <label className="text-[10px] text-slate-400">計算佔比%</label>
                                    <input type="number" value={assetPercent} onChange={(e) =>setAssetPercent(Number(e.target.value))} className="w-12 border rounded p-0.5 text-center text-xs font-bold bg-slate-50 disabled:text-slate-400"/>
                                </div>
                                <div className="text-[10px] text-slate-400 mt-1">有效資產: <span className="font-bold text-green-700">{formatMoney(calculationResult.effectiveAssets)}</span></div>
                                {calcMode === 'income' && <div className="text-[9px] text-blue-500 mt-1 font-bold">* 僅用於退休後年期支付</div>}
                            </div>
                        </div>
                        {/* Premium Financing toggle and input fields in Affordability tab */}
                        <div className="mt-2">
                            <div className="flex items-center gap-2">
                                <input type="checkbox" checked={isPremiumFinancing} onChange={(e) => setIsPremiumFinancing(e.target.checked)} />
                                <label className="text-xs font-bold text-slate-500">保費融資 Premium Financing</label>
                            </div>
                            {isPremiumFinancing && (
                                <div className="grid grid-cols-2 gap-3 mt-2 p-2 rounded">
                                    <div>
                                        <label className="text-xs font-bold text-slate-500">貸款額</label>
                                        <input type="number" value={pfLoanAmount} onChange={(e) => setPfLoanAmount(Number(e.target.value))} className="w-full border rounded p-1.5 text-sm bg-yellow-50" />
                                    </div>
                                    <div>
                                        <label className="text-xs font-bold text-slate-500">貸款利率 %</label>
                                        <input type="number" value={pfLoanRate} onChange={(e) => setPfLoanRate(Number(e.target.value))} className="w-full border rounded p-1.5 text-sm bg-yellow-50" />
                                    </div>
                                    <div>
                                        <label className="text-xs font-bold text-slate-500">貸款年期 Years</label>
                                        <input type="number" value={pfLoanTenor} onChange={(e) => setPfLoanTenor(Number(e.target.value))} className="w-full border rounded p-1.5 text-sm bg-yellow-50" />
                                    </div>
                                    <div>
                                        <label className="text-xs font-bold text-slate-500">每期還款額</label>
                                        <input type="text" value={pfRepaymentAmount} onChange={(e) => setPfRepaymentAmount(e.target.value)} className="w-full border rounded p-1.5 text-sm bg-yellow-50" />
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Content */}
                    <div className="flex-1 flex flex-col md:flex-row overflow-hidden">
                        <div className="w-full md:w-1/3 border-r border-slate-200 bg-white flex flex-col h-1/2 md:h-full">
                            <div className="p-3 bg-slate-100 border-b flex justify-between items-center">
                                <span className="font-bold text-sm">保單列表</span>
                                <button onClick={addPolicy} className="text-xs bg-blue-600 text-white px-2 py-1 rounded flex items-center gap-1 hover:bg-blue-700"><Plus size={12}/> 新增</button>
                            </div>
                            <div className="p-2 bg-blue-50 text-[10px] text-blue-800 text-center border-b border-blue-100 flex items-center justify-center gap-2">
                                <ArrowDownWideNarrow size={12}/> 系統自動按年期(長→短)排序 • USD以7.8計算
                            </div>
                            <div className="flex-1 overflow-y-auto p-4 custom-scrollbar">
                                {policies.map((p) => (
                                    <div key={p.id} className="border rounded-lg p-3 mb-3 bg-slate-50 hover:shadow-md transition-shadow relative group">
                                        <button onClick={() => removePolicy(p.id)} className="absolute top-2 right-2 text-slate-300 hover:text-red-500"><Trash2 size={14}/></button>
                                        <div className="grid grid-cols-2 gap-2 mb-2">
                                            <div>
                                                <label className="text-[10px] text-slate-500 font-bold">名稱</label>
                                                <input type="text" value={p.name} onChange={(e) =>updatePolicy(p.id, 'name', e.target.value)} className="w-full text-xs border rounded p-1"/>
                                            </div>
                                            <div>
                                                <label className="text-[10px] text-slate-500 font-bold">狀態</label>
                                                <select value={p.status} onChange={(e) =>updatePolicy(p.id, 'status', e.target.value)} className="w-full text-xs border rounded p-1">
                                                    <option value="Existing">Existing</option>
                                                    <option value="Applying">Applying</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div className="grid grid-cols-6 gap-2">
                                            <div className="col-span-3">
                                                <label className="text-[10px] text-slate-500 font-bold">年繳保費</label>
                                                <input type="number" value={p.premium} onChange={(e) =>updatePolicy(p.id, 'premium', Number(e.target.value))} className="w-full text-xs border rounded p-1 font-mono"/>
                                            </div>
                                            <div className="col-span-1">
                                                <label className="text-[10px] text-slate-500 font-bold">幣值</label>
                                                <select value={p.currency} onChange={(e) =>updatePolicy(p.id, 'currency', e.target.value)} className="w-full text-xs border rounded p-1 font-bold text-center">
                                                    <option value="HKD">HKD</option>
                                                    <option value="USD">USD</option>
                                                </select>
                                            </div>
                                            <div className="col-span-2">
                                                <label className="text-[10px] text-slate-500 font-bold">年期</label>
                                                <input type="number" value={p.term} onChange={(e) =>updatePolicy(p.id, 'term', Number(e.target.value))} className="w-full text-xs border rounded p-1 font-mono"/>
                                            </div>
                                        </div>
                                        {/* pay type selector */}
                                        <div className="mt-2 grid grid-cols-2 gap-2">
                                            <div className="col-span-2">
                                                <label className="text-[10px] text-slate-500 font-bold">繳費類型</label>
                                                <select value={p.payType || 'Regular'} onChange={(e) => updatePolicy(p.id, 'payType', e.target.value)} className="w-full text-xs border rounded p-1">
                                                    <option value="Regular">Regular Pay</option>
                                                    <option value="Single">Single Pay</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div className="w-full md:w-2/3 flex flex-col bg-slate-50 h-1/2 md:h-full">
                            <div className="flex-1 overflow-auto p-4 custom-scrollbar">
                                <div className="bg-white rounded shadow-sm border overflow-hidden">
                                    <table className="w-full text-xs text-left">
                                        <thead className="bg-slate-100 text-slate-600 font-bold border-b">
                                            <tr>
                                                <th className="p-2 border-r text-center w-10 bg-slate-200 text-slate-700">Seq</th>
                                                <th className="p-2 border-r">Policy</th>
                                                <th className="p-2 border-r text-right">原幣保費</th>
                                                <th className="p-2 border-r text-center">年期</th>
                                                <th className="p-2 border-r text-right bg-orange-50 text-orange-800">收入不足額 (HKD)</th>
                                                <th className="p-2 border-r text-center bg-blue-50 text-blue-800">退休後年期</th>
                                                <th className="p-2 text-right font-bold">資產需支付 (HKD)</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y">
                                            {calculationResult.detailedResults.map((res) => (
                                                <tr key={res.id} className="hover:bg-slate-50">
                                                    <td className="p-2 text-center border-r font-bold text-white bg-slate-400">{res.calculatedSequence}</td>
                                                    <td className="p-2 border-r">
                                                        <div className="font-bold">{res.name}</div>
                                                        <div className="text-[10px] text-slate-400">{res.status}</div>
                                                    </td>
                                                    <td className="p-2 text-right border-r font-mono">
                                                        {formatMoney(res.premium, res.currency)}
                                                        {res.currency === 'USD' && <div className="text-[9px] text-slate-400">≈ {formatMoney(res.premiumInHKD)}</div>}
                                                    </td>
                                                    <td className="p-2 text-center border-r font-mono font-bold text-slate-700">{res.term}</td>
                                                    <td className="p-2 text-right border-r font-mono bg-orange-50/50 text-orange-700">
                                                        {formatMoney(res.shortfallAnnual)}
                                                    </td>
                                                    <td className="p-2 text-center border-r font-mono bg-blue-50/50 text-blue-700">
                                                        {res.overhangYears}
                                                    </td>
                                                    <td className="p-2 text-right font-mono font-bold">
                                                        {formatMoney(res.totalAssetCover)}
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div className="bg-white border-t border-slate-200 p-6 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                                    <div className="space-y-3">
                                        <div className="flex justify-between items-center text-sm p-2 bg-slate-50 rounded border border-slate-200">
                                            <span className="text-slate-600 font-medium">
                                                {calcMode === 'income' ? '首年總年繳保費 (Total Annual Premium):' : '保單合約總保費 (Gross Total Premium):'}
                                            </span>
                                            <span className="font-bold text-lg text-slate-800">{formatMoney(calculationResult.grossTotalDisplay)}</span>
                                        </div>
                                        
                                        <div className="h-px bg-slate-100 my-1"></div>
                                        
                                        <div className="flex justify-between items-center text-sm">
                                            <span className="text-slate-500">
                                                {calcMode === 'income' ? '收入/資產不足總額 (Total Shortfall):' : '資產負擔總需求 (Asset Required):'}
                                            </span>
                                            <span className="font-bold text-lg">{formatMoney(calculationResult.totalRequiredHKD)}</span>
                                        </div>
                                        {/* When premium financing is used, display the projected interest separately */}
                                        {calcMode !== 'income' && calculationResult.projectedInterest > 0 && (
                                            <div className="flex justify-between items-center text-sm">
                                                <span className="text-slate-500">預計總利息 (Projected Interest):</span>
                                                <span className="font-bold text-lg">{formatMoney(calculationResult.projectedInterest)}</span>
                                            </div>
                                        )}

                                        <div className="flex justify-between items-center text-sm">
                                            <span className="text-slate-500">有效淨流動資產 (Effective Net Assets):</span>
                                            <span className="font-bold text-lg text-green-600">{formatMoney(calculationResult.effectiveAssets)}</span>
                                        </div>
                                        
                                        <div className="h-px bg-slate-200 my-2"></div>
                                        {!isPremiumFinancing && (
                                            <div className="flex justify-between items-center">
                                                <span className="font-bold text-slate-700">差額 (Difference):</span>
                                                <span className={`font-mono font-bold text-xl ${calculationResult.diff >= 0 ? 'text-green-600' : 'text-red-600'}`}>{calculationResult.diff >= 0 ? '+' : ''}{formatMoney(calculationResult.diff)}</span>
                                            </div>
                                        )}
                                    </div>

                                    {isPremiumFinancing ? (
                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                            {/* Test A Card */}
                                            <div className={`flex flex-col items-center justify-center p-4 rounded-xl border-4 ${calculationResult.isPassA ? 'border-green-100 bg-green-50' : 'border-red-100 bg-red-50'}`}>
                                                <div className={`text-2xl font-black mb-1 flex items-center gap-2 ${calculationResult.isPassA ? 'text-green-600' : 'text-red-600'}`}>
                                                    {calculationResult.isPassA ? <Check size={24}/> : <AlertTriangle size={24}/>}
                                                    {calculationResult.isPassA ? 'PASS' : 'FAIL'}
                                                </div>
                                                <div className={`text-xs font-bold ${calculationResult.isPassA ? 'text-green-500' : 'text-red-500'}`}>Premium Affordability Checking</div>
                                                <div className="text-[10px] text-slate-400 mt-2 text-center">
                                                    {calculationResult.isPassA ? '資產足以支付保費' : '資產不足以支付保費'}
                                                </div>
                                                <div className="mt-2 text-[10px] font-mono font-bold">差額: <span className={`${calculationResult.diffA >= 0 ? 'text-green-600' : 'text-red-600'}`}>{calculationResult.diffA >= 0 ? '+' : ''}{formatMoney(calculationResult.diffA)}</span></div>
                                            </div>
                                            {/* Test B Card */}
                                            <div className={`flex flex-col items-center justify-center p-4 rounded-xl border-4 ${calculationResult.isPassB ? 'border-green-100 bg-green-50' : 'border-red-100 bg-red-50'}`}>
                                                <div className={`text-2xl font-black mb-1 flex items-center gap-2 ${calculationResult.isPassB ? 'text-green-600' : 'text-red-600'}`}>
                                                    {calculationResult.isPassB ? <Check size={24}/> : <AlertTriangle size={24}/>}
                                                    {calculationResult.isPassB ? 'PASS' : 'FAIL'}
                                                </div>
                                                <div className={`text-xs font-bold ${calculationResult.isPassB ? 'text-green-500' : 'text-red-500'}`}>Over‑leveraging checking for Premium Financing Policy</div>
                                                <div className="text-[10px] text-slate-400 mt-2 text-center">
                                                    {calculationResult.isPassB ? '資產足以承擔保費及利息' : '資產不足以承擔保費及利息'}
                                                </div>
                                                <div className="mt-2 text-[10px] font-mono font-bold">差額: <span className={`${calculationResult.diffB >= 0 ? 'text-green-600' : 'text-red-600'}`}>{calculationResult.diffB >= 0 ? '+' : ''}{formatMoney(calculationResult.diffB)}</span></div>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className={`flex flex-col items-center justify-center p-4 rounded-xl border-4 ${calculationResult.isPass ? 'border-green-100 bg-green-50' : 'border-red-100 bg-red-50'}`}>
                                            <div className={`text-3xl font-black mb-1 flex items-center gap-2 ${calculationResult.isPass ? 'text-green-600' : 'text-red-600'}`}>
                                                {calculationResult.isPass ? <Check size={32}/> : <AlertTriangle size={32}/>}
                                                {calculationResult.isPass ? 'PASS' : 'FAIL'}
                                            </div>
                                            <div className={`text-sm font-bold ${calculationResult.isPass ? 'text-green-500' : 'text-red-500'}`}>
                                                Premium Affordability Checking
                                            </div>
                                            <div className="text-xs text-slate-400 mt-2 text-center">
                                                {calcMode === 'income' 
                                                    ? (calculationResult.isPass ? '收入及退休資產足以支付保費' : '收入或退休資產不足以支付')
                                                    : (calculationResult.isPass ? '有效資產足以支付預期保費總額' : '有效資產不足以支付，請調整保費')
                                                }
                                            </div>
                                            <div className="mt-2 text-[10px] font-mono font-bold">差額: <span className={`${calculationResult.diff >= 0 ? 'text-green-600' : 'text-red-600'}`}>{calculationResult.diff >= 0 ? '+' : ''}{formatMoney(calculationResult.diff)}</span></div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        // ==========================================
        // Tab 3: Policy Info Component
        // ==========================================
        const PolicyInfoTab = ({ onNavigate }) => {
            // Application-level states
            const [appType, setAppType] = useState('Individual');
            const [isEverestBroker, setIsEverestBroker] = useState(false);
                        const [trustReasonCompany, setTrustReasonCompany] = useState('Pacific');
                        const [trustDeclaration, setTrustDeclaration] = useState('No');
            const [niceActimize, setNiceActimize] = useState('');
const [addressProofType, setAddressProofType] = useState('');
            const [height, setHeight] = useState('');
            const [weight, setWeight] = useState('');
            const [isDateBack, setIsDateBack] = useState(false);
            const [isSamePerson, setIsSamePerson] = useState(true);
            const [proposalDate, setProposalDate] = useState("");
            const [signingDate, setSigningDate] = useState(""); // Kept for legacy compatibility if needed
            const [applicationSigningDate, setApplicationSigningDate] = useState("");
            const [fnaSigningDate, setFnaSigningDate] = useState("");
            const [phDob, setPhDob] = useState("");
            const [phGender, setPhGender] = useState("M");
            const [phSmoker, setPhSmoker] = useState("N");
            const [phResidency, setPhResidency] = useState("HK");
            const [phOtherCountry, setPhOtherCountry] = useState("");
            const [phArrivalDate, setPhArrivalDate] = useState("");
            const [phExpiryDate, setPhExpiryDate] = useState("");
            const [phIfsDate, setPhIfsDate] = useState("");
            const [insDob, setInsDob] = useState("");
            const [insGender, setInsGender] = useState("M");
            const [insSmoker, setInsSmoker] = useState("N");
            const [insResidency, setInsResidency] = useState("HK");
            const [planName, setPlanName] = useState("");
            const [prodType, setProdType] = useState(""); 
            const [sumAssured, setSumAssured] = useState("");
            const [curr, setCurr] = useState("USD");
            const [payMode, setPayMode] = useState("Annual");
            const [premAmount, setPremAmount] = useState("");
            const [occupationStatus, setOccupationStatus] = useState("Employed"); 
            const [employer, setEmployer] = useState("");
            const [location, setLocation] = useState("");
            const [lifeCiEmployerToggle, setLifeCiEmployerToggle] = useState(false); // v2.2 optional employer/work fields for Life/CI
            const [bizNature, setBizNature] = useState("");
            const [position, setPosition] = useState("");
            const [monthlyIncome, setMonthlyIncome] = useState("");
            const [sofWealthSupplementType, setSofWealthSupplementType] = useState(""); // v1.9 Non-employed supplementary context
            const [targetSavingHKD, setTargetSavingHKD] = useState("");
            const [targetYear, setTargetYear] = useState("");
            const [surrenderValueUSD, setSurrenderValueUSD] = useState("");
            const [yearTerm, setYearTerm] = useState("");

// ====== FNA Suitability Mapping Inputs (Part 2 / Part 3) ======
const [fnaP2Q1, setFnaP2Q1] = useState([]);   // multi-select (e.g., A, C, D, E(iii))
const [fnaP2Q2, setFnaP2Q2] = useState("");   // single-select (A / C etc.)
const [fnaP2Q3, setFnaP2Q3] = useState("");   // single-select (A - G)
const [fnaP3Q6, setFnaP3Q6] = useState("");   // single-select (A - G)
    // --- Premium Financing (PF) fields ---
    // Flag to indicate whether the current case uses premium financing. When checked, the
    // additional loan details will be collected and persisted along with other policy data.
    const [isPremiumFinancing, setIsPremiumFinancing] = useState(false);
    // Loan amount for premium financing. Should be entered in the same currency as the policy.
    const [pfLoanAmount, setPfLoanAmount] = useState("");
    // Annualized interest rate (percentage) for the premium financing loan.
    const [pfLoanRate, setPfLoanRate] = useState("");
    // Loan tenor expressed in years. Used together with loan amount and rate to compute projected interest.
    const [pfLoanTenor, setPfLoanTenor] = useState("");
    // Optional repayment amount per period. Captured for reference only and not used in calculations.
    const [pfRepaymentAmount, setPfRepaymentAmount] = useState("");
            // FNA related
            const [fnaRetireAge, setFnaRetireAge] = useState("");
            const [fnaDisposableIncome, setFnaDisposableIncome] = useState("");
            const [fnaIncomePercent, setFnaIncomePercent] = useState(100);
            const [fnaLiquidAssets, setFnaLiquidAssets] = useState("");
            const [fnaAssetPercent, setFnaAssetPercent] = useState(100);
            const [fnaSof, setFnaSof] = useState([]);
            const [fnaSow, setFnaSow] = useState([]);
            // [UPDATE Req 8] Allow skipping FNA for specific products
            const [noFna, setNoFna] = useState(false);

            // Payment related
            const [paymentDate, setPaymentDate] = useState("");
            const [paymentCurrency, setPaymentCurrency] = useState("HKD");
            const [paymentAmount, setPaymentAmount] = useState("");
            const [paymentPayor, setPaymentPayor] = useState("Policyholder");
            const [paymentMethod, setPaymentMethod] = useState("Bank Transfer");
            const [pdfAmount, setPdfAmount] = useState('');
            const [trustBeneficiaries, setTrustBeneficiaries] = useState([{ name: '', relationType: 'Self', relationDetail: '', percent: '' }]);
            const [unpaidPremium, setUnpaidPremium] = useState(false);

            // Commission Spreading (Professional Investor - PI)
            const [commissionSpreading, setCommissionSpreading] = useState(false);
            const [piInvestorType, setPiInvestorType] = useState("");
            const [piScenarioKey, setPiScenarioKey] = useState("");

            const [reasonPurchaseHK, setReasonPurchaseHK] = useState('');
            const [showBizNatureHint, setShowBizNatureHint] = useState(false);
            const normalizeOtherInsuranceList = (list, fallbackCurrency) => {
                if (!Array.isArray(list) || !list.length) {
                    return [{ name: '', currency: fallbackCurrency, amount: '', status: 'Existing', pfInGenerali: false }];
                }
                return list.map(item => ({
                    name: item?.name || '',
                    currency: item?.currency || fallbackCurrency,
                    amount: item?.amount ?? '',
                    status: item?.status || 'Existing',
                    pfInGenerali: !!item?.pfInGenerali
                }));
            };

            const [otherInsurances, setOtherInsurances] = useState(() => normalizeOtherInsuranceList([], curr));

            const [showSuggestions, setShowSuggestions] = useState(false);

            // ====== HNW (LionMaster) fields ======
            // When the plan is LionMaster, these fields capture the high-net-worth inputs. They are kept separate
            // from the generic policy fields to avoid interference with normal plans.
            const [hnwAppSignDate, setHnwAppSignDate] = useState("");
            const [hnwDOB, setHnwDOB] = useState("");
            const [hnwGender, setHnwGender] = useState("M");
            const [hnwSmoking, setHnwSmoking] = useState("Non-smoker");
            const [hnwClass, setHnwClass] = useState("Non-Med");
            const [hnwNationality, setHnwNationality] = useState("");
            const [hnwResidency, setHnwResidency] = useState("");
            const [hnwSumAssured, setHnwSumAssured] = useState("");
            const [hnwTerms, setHnwTerms] = useState("");
            const [hnwAnnualPremium, setHnwAnnualPremium] = useState("");
            const [hnwExistingSA, setHnwExistingSA] = useState("");
            const [hnwOccupation, setHnwOccupation] = useState("");
            const [hnwMedically, setHnwMedically] = useState("");
            const [hnwFinancially, setHnwFinancially] = useState("");
            const [hnwSummaryText, setHnwSummaryText] = useState("");
            const [hnwWarnings, setHnwWarnings] = useState([]);

            // [v2.8.3 Enhancement] Capture annual income for HNW income requirement calculation
            const [hnwAnnualIncome, setHnwAnnualIncome] = useState("");

            // ===== v2.0 Export/Import Hydration (Policy Input) =====
            const [policyHydrated, setPolicyHydrated] = useState(false);

            useEffect(() => {
                try {
                    const savedStr = localStorage.getItem('policyInputFullState');
                    if (savedStr) {
                        const s = JSON.parse(savedStr) || {};
                        // Application / identity
                        if (s.appType !== undefined) setAppType(s.appType);
                        if (s.trustReasonCompany !== undefined) setTrustReasonCompany(s.trustReasonCompany);
                        if (s.trustDeclaration !== undefined) setTrustDeclaration(s.trustDeclaration);
                        if (s.niceActimize !== undefined) setNiceActimize(s.niceActimize);
                        if (s.addressProofType !== undefined) setAddressProofType(s.addressProofType);
                        if (s.height !== undefined) setHeight(s.height);
                        if (s.weight !== undefined) setWeight(s.weight);
                        if (s.isDateBack !== undefined) setIsDateBack(!!s.isDateBack);
                        if (s.isSamePerson !== undefined) setIsSamePerson(!!s.isSamePerson);

                        // Dates
                        if (s.proposalDate !== undefined) setProposalDate(s.proposalDate);
                        if (s.signingDate !== undefined) setSigningDate(s.signingDate);
                        if (s.applicationSigningDate !== undefined) setApplicationSigningDate(s.applicationSigningDate);
                        if (s.fnaSigningDate !== undefined) setFnaSigningDate(s.fnaSigningDate);

                        // Policyholder
                        if (s.phDob !== undefined) setPhDob(s.phDob);
                        if (s.phGender !== undefined) setPhGender(s.phGender);
                        if (s.phSmoker !== undefined) setPhSmoker(s.phSmoker);
                        if (s.phResidency !== undefined) setPhResidency(s.phResidency);
                        if (s.phOtherCountry !== undefined) setPhOtherCountry(s.phOtherCountry);
                        if (s.phArrivalDate !== undefined) setPhArrivalDate(s.phArrivalDate);
                        if (s.phExpiryDate !== undefined) setPhExpiryDate(s.phExpiryDate);
                        if (s.phIfsDate !== undefined) setPhIfsDate(s.phIfsDate);

                        // Insured
                        if (s.insDob !== undefined) setInsDob(s.insDob);
                        if (s.insGender !== undefined) setInsGender(s.insGender);
                        if (s.insSmoker !== undefined) setInsSmoker(s.insSmoker);
                        if (s.insResidency !== undefined) setInsResidency(s.insResidency);

                    // === HNW (LionMaster) persisted fields ===
                    // When hydrating from localStorage, restore the values for the HNW module if they exist in saved state.
                    if (s.hnwAppSignDate !== undefined) setHnwAppSignDate(s.hnwAppSignDate);
                    if (s.hnwDOB !== undefined) setHnwDOB(s.hnwDOB);
                    if (s.hnwGender !== undefined) setHnwGender(s.hnwGender);
                    if (s.hnwSmoking !== undefined) setHnwSmoking(s.hnwSmoking);
                    if (s.hnwClass !== undefined) setHnwClass(s.hnwClass);
                    if (s.hnwNationality !== undefined) setHnwNationality(s.hnwNationality);
                    if (s.hnwResidency !== undefined) setHnwResidency(s.hnwResidency);
                    if (s.hnwSumAssured !== undefined) setHnwSumAssured(s.hnwSumAssured);
                    if (s.hnwTerms !== undefined) setHnwTerms(s.hnwTerms);
                    if (s.hnwAnnualPremium !== undefined) setHnwAnnualPremium(s.hnwAnnualPremium);
                    if (s.hnwExistingSA !== undefined) setHnwExistingSA(s.hnwExistingSA);
                    if (s.hnwOccupation !== undefined) setHnwOccupation(s.hnwOccupation);
                    if (s.hnwMedically !== undefined) setHnwMedically(s.hnwMedically);
                    if (s.hnwFinancially !== undefined) setHnwFinancially(s.hnwFinancially);
                    if (s.hnwAnnualIncome !== undefined) setHnwAnnualIncome(s.hnwAnnualIncome);

                        // Plan / premium
                        if (s.planName !== undefined) setPlanName(s.planName);
                        if (s.prodType !== undefined) setProdType(s.prodType);
                        if (s.sumAssured !== undefined) setSumAssured(s.sumAssured);
                        if (s.curr !== undefined) setCurr(s.curr);
                        if (s.payMode !== undefined) setPayMode(s.payMode);
                        if (s.premAmount !== undefined) setPremAmount(s.premAmount);

                        // Occupation / income
                        if (s.occupationStatus !== undefined) setOccupationStatus(s.occupationStatus);
                        if (s.employer !== undefined) setEmployer(s.employer);
                        if (s.location !== undefined) setLocation(s.location);
                        if (s.lifeCiEmployerToggle !== undefined) setLifeCiEmployerToggle(!!s.lifeCiEmployerToggle);
                        if (s.bizNature !== undefined) setBizNature(s.bizNature);
                        if (s.position !== undefined) setPosition(s.position);
                        if (s.monthlyIncome !== undefined) setMonthlyIncome(s.monthlyIncome);
                        if (s.sofWealthSupplementType !== undefined) setSofWealthSupplementType(s.sofWealthSupplementType);

                        // Targets
                        if (s.targetSavingHKD !== undefined) setTargetSavingHKD(s.targetSavingHKD);
                        if (s.targetYear !== undefined) setTargetYear(s.targetYear);
                        if (s.surrenderValueUSD !== undefined) setSurrenderValueUSD(s.surrenderValueUSD);
                        if (s.yearTerm !== undefined) setYearTerm(s.yearTerm);

                        // Hydrate Premium Financing (PF) fields from stored state
                        if (s.isPremiumFinancing !== undefined) setIsPremiumFinancing(!!s.isPremiumFinancing);
                        if (s.pfLoanAmount !== undefined) setPfLoanAmount(s.pfLoanAmount);
                        if (s.pfLoanRate !== undefined) setPfLoanRate(s.pfLoanRate);
                        if (s.pfLoanTenor !== undefined) setPfLoanTenor(s.pfLoanTenor);
                        if (s.pfRepaymentAmount !== undefined) setPfRepaymentAmount(s.pfRepaymentAmount);

                        // FNA inputs
                        if (s.fnaRetireAge !== undefined) setFnaRetireAge(s.fnaRetireAge);
                        if (s.fnaDisposableIncome !== undefined) setFnaDisposableIncome(s.fnaDisposableIncome);
                        if (s.fnaIncomePercent !== undefined && s.fnaIncomePercent !== null) setFnaIncomePercent(Number(s.fnaIncomePercent));
                        if (s.fnaLiquidAssets !== undefined) setFnaLiquidAssets(s.fnaLiquidAssets);
                        if (s.fnaAssetPercent !== undefined && s.fnaAssetPercent !== null) setFnaAssetPercent(Number(s.fnaAssetPercent));
                        if (Array.isArray(s.fnaSof)) setFnaSof(s.fnaSof);
                        if (Array.isArray(s.fnaSow)) setFnaSow(s.fnaSow);
                        if (s.noFna !== undefined) setNoFna(!!s.noFna);

                        // Payment
                        if (s.paymentDate !== undefined) setPaymentDate(s.paymentDate);
                        if (s.paymentCurrency !== undefined) setPaymentCurrency(s.paymentCurrency);
                        if (s.paymentAmount !== undefined) setPaymentAmount(s.paymentAmount);
                        if (s.paymentPayor !== undefined) setPaymentPayor(s.paymentPayor);
                        if (s.paymentMethod !== undefined) setPaymentMethod(s.paymentMethod);
                        if (s.pdfAmount !== undefined) setPdfAmount(s.pdfAmount);

                        // Commission Spreading (Professional Investor - PI)
                        if (s.commissionSpreading !== undefined) setCommissionSpreading(!!s.commissionSpreading);
                        if (s.piInvestorType !== undefined) setPiInvestorType(s.piInvestorType);
                        if (s.piScenarioKey !== undefined) setPiScenarioKey(s.piScenarioKey);

                        // Others
                        if (Array.isArray(s.trustBeneficiaries)) setTrustBeneficiaries(s.trustBeneficiaries);
                        if (s.unpaidPremium !== undefined) setUnpaidPremium(!!s.unpaidPremium);
                        if (s.reasonPurchaseHK !== undefined) setReasonPurchaseHK(s.reasonPurchaseHK);
                        if (Array.isArray(s.otherInsurances)) setOtherInsurances(normalizeOtherInsuranceList(s.otherInsurances, s.curr || curr));
                    }
                } catch (err) {
                    console.error('Failed to hydrate Policy Input from import', err);
                } finally {
                    setPolicyHydrated(true);
                }
            }, []);

            // Save full Policy Input state for Export
            useEffect(() => {
                if (!policyHydrated) return;
                try {
                    const full = {
                        appType,
                        trustReasonCompany,
                        trustDeclaration,
                        addressProofType,
                        height,
                        weight,
                        isDateBack,
                        isSamePerson,
                        proposalDate,
                        signingDate,
                        applicationSigningDate,
                        fnaSigningDate,

                        phDob,
                        phGender,
                        phSmoker,
                        phResidency,
                        phOtherCountry,
                        phArrivalDate,
                        phExpiryDate,
                        phIfsDate,

                        insDob,
                        insGender,
                        insSmoker,
                        insResidency,

                        planName,
                        prodType,
                        sumAssured,
                        curr,
                        payMode,
                        premAmount,

                        occupationStatus,
                        employer,
                        location,
                        lifeCiEmployerToggle,
                        bizNature,
                        position,
                        monthlyIncome,
                        sofWealthSupplementType,

                        targetSavingHKD,
                        targetYear,
                        surrenderValueUSD,
                        yearTerm,

                        fnaRetireAge,
                        fnaDisposableIncome,
                        fnaIncomePercent,
                        fnaLiquidAssets,
                        fnaAssetPercent,
                        fnaSof,
                        fnaSow,
                        noFna,

                        paymentDate,
                        paymentCurrency,
                        paymentAmount,
                        paymentPayor,
                        paymentMethod,
                        pdfAmount,

                        // Commission Spreading (Professional Investor - PI)
                        commissionSpreading,
                        piInvestorType,
                        piScenarioKey,

                        trustBeneficiaries,
                        unpaidPremium,
                        reasonPurchaseHK,
                        otherInsurances,
                        niceActimize,
                        // Premium Financing (PF) fields - persisted for export/import
                        isPremiumFinancing,
                        pfLoanAmount,
                        pfLoanRate,
                        pfLoanTenor,
                        pfRepaymentAmount,

                    // Persist HNW (LionMaster) fields so that they are restored upon reload
                    hnwAppSignDate,
                    hnwDOB,
                    hnwGender,
                    hnwSmoking,
                    hnwClass,
                    hnwNationality,
                    hnwResidency,
                    hnwSumAssured,
                    hnwTerms,
                    hnwAnnualPremium,
                    hnwExistingSA,
                    hnwOccupation,
                    hnwMedically,
                    hnwFinancially,
                    hnwAnnualIncome
                    };
                    localStorage.setItem('policyInputFullState', JSON.stringify(full));
                } catch (err) {
                    console.error('Failed to persist Policy Input full state', err);
                }
            }, [
                appType, trustReasonCompany, trustDeclaration, niceActimize, addressProofType, height, weight, isDateBack, isSamePerson,
                proposalDate, signingDate, applicationSigningDate, fnaSigningDate,
                phDob, phGender, phSmoker, phResidency, phOtherCountry, phArrivalDate, phExpiryDate, phIfsDate,
                insDob, insGender, insSmoker, insResidency,
                planName, prodType, sumAssured, curr, payMode, premAmount,
                occupationStatus, employer, location, lifeCiEmployerToggle, bizNature, position, monthlyIncome, sofWealthSupplementType,
                targetSavingHKD, targetYear, surrenderValueUSD, yearTerm,
                fnaRetireAge, fnaDisposableIncome, fnaIncomePercent, fnaLiquidAssets, fnaAssetPercent, fnaSof, fnaSow, noFna,
                paymentDate, paymentCurrency, paymentAmount, paymentPayor, paymentMethod, pdfAmount,
                commissionSpreading, piInvestorType, piScenarioKey,
                trustBeneficiaries, unpaidPremium, reasonPurchaseHK, otherInsurances, niceActimize,
                // dependencies for PF fields
                isPremiumFinancing, pfLoanAmount, pfLoanRate, pfLoanTenor, pfRepaymentAmount,
                // HNW fields dependencies
                hnwAppSignDate, hnwDOB, hnwGender, hnwSmoking, hnwClass, hnwNationality, hnwResidency,
                hnwSumAssured, hnwTerms, hnwAnnualPremium, hnwExistingSA, hnwOccupation, hnwMedically, hnwFinancially, hnwAnnualIncome,
                policyHydrated
            ]);
            // =========================================================

            const wrapperRef = useRef(null);

            // -- Computed Values --
            const phAge = useMemo(() => {
                const refDateStr = proposalDate || new Date().toISOString().split('T')[0];
                const baseAge = calculateAge(phDob, refDateStr);
                if (baseAge === "") return "";
                if (isDateBack && (prodType === 'Life' || prodType === 'CI')) {
                    return Math.max(0, baseAge - 1);
                }
                return baseAge;
            }, [phDob, proposalDate, isDateBack, prodType]);

            const insAge = useMemo(() => {
                const refDateStr = proposalDate || new Date().toISOString().split('T')[0];
                const baseAge = calculateAge(insDob, refDateStr);
                if (baseAge === "") return "";
                if (isDateBack && (prodType === 'Life' || prodType === 'CI')) {
                    return Math.max(0, baseAge - 1);
                }
                return baseAge;
            }, [insDob, proposalDate, isDateBack, prodType]);

            // [CRITICAL FIX] Always keep Insured Age available for TSA(Med) & Medical Requirements calculations
            // - If Policyholder = Insured: insuredAgeForCalc == phAge
            // - If Policyholder != Insured: insuredAgeForCalc == insAge (derived from Insured DOB)
            const insuredAgeForCalc = isSamePerson ? phAge : insAge;

            // Compute HNW age based on DOB and application sign date
            const hnwAge = useMemo(() => {
                if (!hnwDOB || !hnwAppSignDate) return "";
                return calculateAge(hnwDOB, hnwAppSignDate);
            }, [hnwDOB, hnwAppSignDate]);

            // Update HNW warnings whenever relevant fields change
            useEffect(() => {
                const warnings = [];
                const sa = parseFloat(hnwSumAssured || 0);
                const age = hnwAge;
                // Issue limit check based on residency
                const limit = (hnwResidency && COUNTRY_GROUP_MAP[hnwResidency]) ? COUNTRY_GROUP_MAP[hnwResidency].issueLimit : 30000000;
                if (sa > 0 && sa > limit) {
                    warnings.push(`Sum Assured exceeds issue limit (${formatMoney(limit, 'USD')}) for ${hnwResidency}`);
                }
                // Income requirement check based on annual income and age
                const annualIncome = parseFloat(hnwAnnualIncome || 0);
                if (!isNaN(annualIncome) && annualIncome > 0 && age !== "") {
                    const multiplier = Math.min(Math.max(75 - age, 0), 35); // capped at 35
                    const maxSaByIncome = annualIncome * multiplier;
                    if (maxSaByIncome > 0 && sa > maxSaByIncome) {
                        warnings.push(`Sum Assured exceeds income requirement maximum (${formatMoney(maxSaByIncome, 'USD')})`);
                    }
                }
                // Financial requirements based on detailed thresholds (non private bank clients)
                if (sa > 0) {
                    if (sa <= 1500000) {
                        warnings.push('Financial requirement: Financial questionnaire required.');
                    } else if (sa <= 3000000) {
                        warnings.push("Financial requirement: Financial questionnaire + broker's report required.");
                    } else if (sa <= 7500000) {
                        warnings.push("Financial requirement: Financial questionnaire + broker's report required.");
                    } else if (sa <= 45000000) {
                        warnings.push("Financial requirement: Financial questionnaire + broker's report + supporting financial evidence required.");
                    } else {
                        warnings.push("Financial requirement: Financial questionnaire + broker's report + supporting financial evidence required.");
                    }
                }
                // Medical requirements based on age and sum assured thresholds from Routine Medical Requirements Table
                if (sa > 0) {
                    // Only calculate if age is available
                    if (age !== "") {
                        const ageNum = age;
                        // Age 18-45 inclusive
                        if (ageNum <= 45) {
                            if (sa <= 1500000) {
                                warnings.push('Medical requirement: ME, MU, FBP required.');
                            } else if (sa <= 5000000) {
                                warnings.push('Medical requirement: ME, MU, FBP, ECG required.');
                            } else if (sa <= 10000000) {
                                warnings.push('Medical requirement: ME, MU, FBP, ECG required.');
                            } else if (sa <= 30000000) {
                                warnings.push('Medical requirement: ME, MU, FBP, TMX required.');
                            } else {
                                warnings.push('Medical requirement: ME, MU, FBP, TMX, APS required.');
                            }
                        // Age 46-55 inclusive
                        } else if (ageNum <= 55) {
                            if (sa <= 2000000) {
                                warnings.push('Medical requirement: ME, MU, FBP required.');
                            } else if (sa <= 5000000) {
                                warnings.push('Medical requirement: ME, MU, FBP, ECG required.');
                            } else if (sa <= 10000000) {
                                warnings.push('Medical requirement: ME, MU, FBP, ECG required.');
                            } else if (sa <= 30000000) {
                                warnings.push('Medical requirement: ME, MU, FBP, TMX required.');
                            } else {
                                warnings.push('Medical requirement: ME, MU, FBP, TMX, APS required.');
                            }
                        // Age over 55
                        } else {
                            if (sa <= 2000000) {
                                warnings.push('Medical requirement: ME, MU, FBP, ECG required.');
                            } else if (sa <= 5000000) {
                                warnings.push('Medical requirement: ME, MU, FBP, ECG required.');
                            } else if (sa <= 10000000) {
                                warnings.push('Medical requirement: ME, MU, FBP, TMX required.');
                            } else if (sa <= 30000000) {
                                warnings.push('Medical requirement: ME, MU, FBP, TMX, APS required.');
                            } else {
                                warnings.push('Medical requirement: ME, MU, FBP, TMX, APS required.');
                            }
                        }
                    } else {
                        // Age unavailable: default minimal medical requirement
                        warnings.push('Medical requirement: ME, MU, FBP required.');
                    }
                }
                setHnwWarnings(warnings);
            }, [hnwSumAssured, hnwAge, hnwClass, hnwSmoking, hnwResidency, hnwAnnualIncome]);

            // Handler to generate HNW case summary for LionMaster. It composes the output according to the
            // specified format and stores it in hnwSummaryText so that the UI can display and copy it.
            const handleRunHnwSummary = () => {
                const sa = Number(hnwSumAssured || 0);
                const existing = Number(hnwExistingSA || 0);
                const group = (hnwResidency && COUNTRY_GROUP_MAP[hnwResidency]) ? COUNTRY_GROUP_MAP[hnwResidency].group : '';
                const total = sa + existing;
                const annualIncome = Number(hnwAnnualIncome || 0);
                const ageNum = (hnwAge === '' || hnwAge === null || hnwAge === undefined) ? NaN : Number(hnwAge);
                const multiple = (Number.isFinite(ageNum)) ? Math.max(0, Math.min(75 - ageNum, 35)) : 0;
                const maxSaByIncome = annualIncome * multiple;
                const smokingVal = String(hnwSmoking || '').trim();
                const smokerShort = smokingVal
                    ? (smokingVal.toUpperCase().includes('NS') ? 'NS' : (smokingVal.toUpperCase().includes('S') ? 'S' : smokingVal))
                    : '';
                const premiumNum = Number(hnwAnnualPremium || 0);
                const summary =
`Applying LionMaster USD ${sa.toLocaleString()} ${hnwClass} - ${hnwTerms} years
Annual premium: USD ${Number.isFinite(premiumNum) && premiumNum > 0 ? premiumNum.toLocaleString() : (hnwAnnualPremium || '')}

${hnwGender}/${hnwAge}/${smokerShort || hnwSmoking}
Occupation: ${hnwOccupation || ''}
Nationality: ${hnwNationality || ''}
${hnwResidency || ''} Resident
Country Rate - Group ${group}

Medically,
${hnwMedically || ''}

Financially,
Annual income USD ${Number.isFinite(annualIncome) && annualIncome > 0 ? annualIncome.toLocaleString() : (hnwAnnualIncome || '')}
=> Max. SA up to [(${Number.isFinite(ageNum) ? (75 - ageNum) : '75 - Age'}, max cap 35) x annual income] = USD ${maxSaByIncome.toLocaleString()}

TSA (All): USD ${total.toLocaleString()}
${hnwFinancially || ''}`;
                setHnwSummaryText(summary);
            };


            const filteredCountries = useMemo(() => {
                if (!phOtherCountry) return [];
                return COUNTRY_LIST.filter(c => c.name.toLowerCase().includes(phOtherCountry.toLowerCase()));
            }, [phOtherCountry]);

            useEffect(() => {
                function handleClickOutside(event) {
                    if (wrapperRef.current && !wrapperRef.current.contains(event.target)) setShowSuggestions(false);
                }
                document.addEventListener("mousedown", handleClickOutside);
                return () => document.removeEventListener("mousedown", handleClickOutside);
            }, [wrapperRef]);

            const productGroups = useMemo(() => {
                // Include new HNW category for high-net-worth products
                const groups = { 'GIO': [], 'Life': [], 'CI': [], 'Annuity': [], 'HNW': [] };
                PRODUCT_DB.forEach(p => { if(groups[p.type]) groups[p.type].push(p); });
                return groups;
            }, []);

            const handlePlanChange = (name) => {
                setPlanName(name);
                const product = PRODUCT_DB.find(p => p.name === name);
                setProdType(product ? product.type : "");
                // Reset noFna when plan changes
                setNoFna(false);
            };

            const selectedProductData = useMemo(() => PRODUCT_DB.find(p => p.name === planName), [planName]);

            const residencyOptions = useMemo(() => {
                const all = [
                    { val: 'HK', label: '香港 (Hong Kong)' },
                    { val: 'CN', label: '中國 (China)' },
                    { val: 'TW', label: '台灣 (Taiwan)' },
                    { val: 'MO', label: '澳門 (Macau)' },
                    { val: 'KR', label: '南韓 (South Korea)' },
                    { val: 'Other', label: '其他 (Other)' }
                ];
                if (appType === 'Trust') {
                    return all.filter(o => !['HK', 'CN', 'MO'].includes(o.val));
                }
                return all;
            }, [appType]);

            const riskLevel = useMemo(() => {
                const lookupRisk = (countryName) => {
                    if (!countryName) return null;
                    const key = String(countryName).trim().toLowerCase();
                    if (!key) return null;
                    const exact = COUNTRY_LIST.find(c => c.name.toLowerCase() === key);
                    if (exact) return exact.risk;
                    const partial = COUNTRY_LIST.find(c => c.name.toLowerCase().includes(key));
                    return partial ? partial.risk : 'Unknown';
                };

                if (phResidency === 'Other') {
                    return lookupRisk(phOtherCountry);
                }

                const codeToCountryName = {
                    HK: 'Hong Kong',
                    CN: 'China',
                    TW: 'Taiwan (Province of China)',
                    MO: 'Macao',
                    KR: 'Korea (the Republic of)'
                };

                return codeToCountryName[phResidency] ? lookupRisk(codeToCountryName[phResidency]) : null;
            }, [phResidency, phOtherCountry]);

            // [UPDATE] Resident Loading display text (only for Life / CI / Annuity)
            const residentLoadingText = useMemo(() => {
                if (!['Life','CI','Annuity'].includes(prodType)) return null;

                const codeMap = { HK: 'Hong Kong', CN: 'China', MO: 'Macau', KR: 'Korea', TW: 'Taiwan', JP: 'Japan', US: 'USA', GB: 'United Kingdom' };
                let key = null;

                if (phResidency === 'Other') {
                    key = phOtherCountry ? String(phOtherCountry).trim() : null;
                } else if (phResidency) {
                    key = codeMap[phResidency] || null;
                }
                if (!key) return null;

                let row = getResidentLoading(key);
                if (!row) {
                    const lower = key.toLowerCase();
                    const foundKey = Object.keys(RESIDENT_LOADING).find(k => k.toLowerCase() === lower);
                    if (foundKey) row = RESIDENT_LOADING[foundKey];
                }
                if (!row) row = RESIDENT_LOADING["Others"] || null;
                if (!row) return null;

                const rule = (prodType === 'CI') ? row.ci : row.life; // Annuity uses life rule
                return formatResidentLoadingRule(rule);
            }, [prodType, phResidency, phOtherCountry]);


            const isHighRisk = useMemo(() => riskLevel === 'High' || riskLevel === 'Sanctioned', [riskLevel]);
            const needsAddressProof = useMemo(() => isHighRisk || appType === 'Trust' || isEverestBroker, [isHighRisk, appType, isEverestBroker]);

            // [UPDATE Req 1] Logic to hide employer info
            const isEmployerInfoRequired = useMemo(() => {
                // If Life or CI, normally NOT required.
                // UNLESS it is Trust OR High Risk.
                if (prodType === 'Life' || prodType === 'CI') {
                    if (appType === 'Trust' || isHighRisk || isEverestBroker || lifeCiEmployerToggle) return true;
                    return false; 
                }
                // For other products (GIO/Annuity), assume required/standard behavior (kept visible)
                return true;
            }, [prodType, appType, isHighRisk, isEverestBroker, lifeCiEmployerToggle]);

            // v1.9 / v1.12 Non-employed supplementary triggers
            const isNonEmployedElitePrimaCase = useMemo(() => {
                const isTargetPlan = (planName === 'LionAchiever Elite' || planName === 'LionPrima');
                const nonEmployed = (occupationStatus !== 'Employed' && occupationStatus !== 'SelfEmployed');
                return isTargetPlan && nonEmployed;
            }, [planName, occupationStatus]);

            // v1.12 General non-employed case (ALL plans except LionAchiever Elite / LionPrima)
            const isNonEmployedOtherPlanCase = useMemo(() => {
                const hasPlan = !!planName;
                const isExcluded = (planName === 'LionAchiever Elite' || planName === 'LionPrima');
                const nonEmployed = (occupationStatus !== 'Employed' && occupationStatus !== 'SelfEmployed');
                return hasPlan && !isExcluded && nonEmployed;
            }, [planName, occupationStatus]);

            const requiresNonEmpSelection = isNonEmployedElitePrimaCase || isNonEmployedOtherPlanCase;

            // Reveal Nature of Business + Job Title only after user selects context for non-employed cases
            const showBizJobFields = useMemo(() => {
                if (!requiresNonEmpSelection) return true;
                return !!sofWealthSupplementType;
            }, [requiresNonEmpSelection, sofWealthSupplementType]);

            // Employer Name + Work Address:
            // - Elite/Prima non-employed: hidden until selection (existing v1.9 behavior)
            // - Other plans non-employed: ALWAYS hidden (v1.12)
            const showEmployerWorkFields = useMemo(() => {
                if (!isEmployerInfoRequired) return false;
                if (isNonEmployedOtherPlanCase) return false;
                if (requiresNonEmpSelection) return !!sofWealthSupplementType;
                return true;
            }, [isEmployerInfoRequired, isNonEmployedOtherPlanCase, requiresNonEmpSelection, sofWealthSupplementType]);

            // Reset selection if trigger no longer matches
            useEffect(() => {
                if (!requiresNonEmpSelection) {
                    if (sofWealthSupplementType) setSofWealthSupplementType("");
                }
            }, [requiresNonEmpSelection]);

            // [UPDATE Req 8] Logic to allow No FNA
            const canSkipFna = useMemo(() => {
                if (!planName) return false;
                const lower = planName.toLowerCase();
                return lower.includes('supreme gold') || lower.includes('painter flexi');
            }, [planName]);

            const bmiResult = useMemo(() => {
                if (!height || !weight) return null;
                const hM = Number(height) / 100;
                const wKg = Number(weight);
                if (hM <= 0) return null;
                return wKg / (hM * hM);
            }, [height, weight]);

            const bmiWarning = useMemo(() => {
                if (!bmiResult) return null;
                if (bmiResult < 16 || bmiResult > 28) return 'Body build beyond normal range';
                return null;
            }, [bmiResult]);

            const flyToBuyAmlRequired = useMemo(() => {
                if (!phResidency) return false;
                const allowedCodes = new Set(['HK', 'CN', 'TW', 'MO']);
                if (phResidency !== 'Other') {
                    return !allowedCodes.has(phResidency);
                }
                const normalizedCountry = String(phOtherCountry || '').trim().toLowerCase();
                if (!normalizedCountry) return true;
                const allowedNames = [
                    'hong kong',
                    'hong kong, china',
                    'hong kong china',
                    'china',
                    'taiwan',
                    'taiwan (province of china)',
                    'macau',
                    'macao'
                ];
                return !allowedNames.includes(normalizedCountry);
            }, [phResidency, phOtherCountry]);

            const birthdayAlert = useMemo(() => {
                if (prodType !== 'GIO' && prodType !== 'Annuity') return null;
                const refDateStr = proposalDate || new Date().toISOString().split('T')[0];
                const dobStr = isSamePerson ? phDob : insDob;
                if (!dobStr) return null;
                const refDate = new Date(refDateStr);
                const dob = new Date(dobStr);
                let nextBirthday = new Date(refDate.getFullYear(), dob.getMonth(), dob.getDate());
                if (nextBirthday < refDate) {
                    nextBirthday.setFullYear(refDate.getFullYear() + 1);
                }
                const diffTime = nextBirthday - refDate;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                if (diffDays <= 93) {
                    return {
                        type: 'warning',
                        text: `提示：受保人將於 3 個月內 (${formatDate(nextBirthday)}) 生日，屆時年齡將增加一歲。`
                    };
                }
                return null;
            }, [prodType, proposalDate, isSamePerson, phDob, insDob]);

            const fnaRangeInfo = useMemo(() => {
                if (!sumAssured || !prodType) return null;
                if (prodType !== 'Life' && prodType !== 'CI') return null; 
                
                let saHKD = Number(sumAssured);
                if (curr === 'USD') saHKD = saHKD * USD_RATE; 

                let baseSA = saHKD;
                if (planName === "LionPatron") {
                    baseSA = saHKD * 2.3;
                }

                const minTarget = baseSA / 1.2; 
                const maxTarget = baseSA * 2.0; 
                const rangeMsg = `💡 參考資訊：合理目標保障範圍應為 ${formatMoney(minTarget)} - ${formatMoney(maxTarget)}`;
                
                let status = null;
                let msg = "";
                if (targetSavingHKD) {
                    const target = Number(targetSavingHKD);
                    if (target < minTarget) {
                        status = "WARN";
                        msg = `(目標保障額度低於建議範圍)`;
                    } else if (target > maxTarget) {
                        status = "WARN";
                        msg = `(目標保障額度高於建議範圍)`;
                    } else {
                        status = "PASS";
                        msg = `(目標符合建議範圍)`;
                    }
                }
                return { rangeMsg, status, msg };
            }, [sumAssured, curr, planName, targetSavingHKD, prodType]);

            const returnCheck = useMemo(() => {
    // ===== Suitability Check (Reference Only for FNA Mapping) =====
    const issues = [];

    // --- A) 95% Rule (Target Saving vs Surrender Value) ---
    let targetStatus = null;
    if (targetSavingHKD && surrenderValueUSD) {
        const target = Number(targetSavingHKD);
        const svHKD = Number(surrenderValueUSD) * 7.8;
        targetStatus = (svHKD < target * 0.95) ? "FAIL" : "PASS";
        if (targetStatus === "FAIL") issues.push("退保價值低於目標儲蓄 95% (95% Rule FAIL)");
    }

    // --- B) FNA Mapping: Reference display only (no user selection / no pass-fail) ---
    let fnaStatus = null;
    const prod = selectedProductData;
    const hasMapping = !!(prod && (prod.q1 || prod.q2 || prod.q3 || prod.q6));
    if (!noFna && hasMapping) {
        fnaStatus = "REFERENCE";
    }

    let status = "PASS";
    if (targetStatus === "FAIL") status = "FAIL";
    return { status, targetStatus, fnaStatus, issues };
}, [targetSavingHKD, surrenderValueUSD, selectedProductData, noFna, fnaP2Q1, fnaP2Q2, fnaP2Q3, fnaP3Q6]);


            const medicalReq = useMemo(() => {
                const checkAge = insuredAgeForCalc;
                const isValidAge = !(checkAge === '' || checkAge === null || checkAge === undefined || Number.isNaN(Number(checkAge)));
                if (!isValidAge || !sumAssured) return null;
                let baseSA = Number(sumAssured) || 0;
                let otherApplying = 0;
                if ((prodType === 'Life' || prodType === 'CI') && otherInsurances && otherInsurances.length) {
                    otherInsurances.forEach(item => {
                        if (item.status !== 'Applying' && !item.pfInGenerali) return;
                        const val = Number(item.amount);
                        if (!val || isNaN(val)) return;
                        if (item.currency === curr) {
                            otherApplying += val;
                        } else if (item.currency === 'USD' && curr === 'HKD') {
                            otherApplying += val * FIN_USD_RATE;
                        } else if (item.currency === 'HKD' && curr === 'USD') {
                            otherApplying += val / FIN_USD_RATE;
                        } else {
                            otherApplying += val;
                        }
                    });
                }
                const product = PRODUCT_DB.find(p => p.name === planName);
                const multiplier = product?.multiplier ? Number(product.multiplier) : 1;
                const adjustedBaseSA = baseSA * multiplier;
                const totalSA = adjustedBaseSA + otherApplying;
                return getMedicalReq(planName, checkAge, totalSA, curr, false);
            }, [planName, phAge, insAge, isSamePerson, sumAssured, curr, prodType, otherInsurances]);

            const financialReq = useMemo(() => {
                const checkAge = insuredAgeForCalc;
                const annualIncome = monthlyIncome ? Number(monthlyIncome) * 12 : 0;
                const isValidAge = !(checkAge === '' || checkAge === null || checkAge === undefined || Number.isNaN(Number(checkAge)));
                if (!isValidAge || !sumAssured) return null;
                
                const baseSA = Number(sumAssured) || 0;
                let otherSum = 0;
                if ((prodType === 'Life' || prodType === 'CI') && otherInsurances && otherInsurances.length) {
                    otherInsurances.forEach(item => {
                        const val = Number(item.amount);
                        if (!val || isNaN(val)) return;
                        if (item.currency === curr) {
                            otherSum += val;
                        } else if (item.currency === 'USD' && curr === 'HKD') {
                            otherSum += val * FIN_USD_RATE;
                        } else if (item.currency === 'HKD' && curr === 'USD') {
                            otherSum += val / FIN_USD_RATE;
                        } else {
                            otherSum += val;
                        }
                    });
                }
                let saForReq;
                if (planName === 'LionPatron') {
                    saForReq = baseSA * 1.5 + otherSum;
                } else {
                    saForReq = baseSA + otherSum;
                }
                return getFinancialReq(planName, occupationStatus, checkAge, saForReq, curr, annualIncome);
            }, [planName, occupationStatus, phAge, insAge, isSamePerson, sumAssured, curr, monthlyIncome, prodType, otherInsurances]);

            const checkCompliance = useMemo(() => {
                let msgs = [];
                if (birthdayAlert) {
                    msgs.push({ type: 'warning', text: birthdayAlert.text, icon: <CalendarClock size={16}/> });
                }
                if (flyToBuyAmlRequired) {
                    msgs.push({ type: 'warning', text: 'please complete AML checklist for fly to buy client' });
                }
                const datesToCheck = [];
                if (proposalDate) datesToCheck.push({ label: '印刷日期', date: new Date(proposalDate) });
                if (signingDate) datesToCheck.push({ label: '簽署日期', date: new Date(signingDate) });
                if (applicationSigningDate) datesToCheck.push({ label: '申請書簽署日期', date: new Date(applicationSigningDate) });
                if (fnaSigningDate) datesToCheck.push({ label: '財務需求分析簽署日期', date: new Date(fnaSigningDate) });
                
                if (appType !== 'Trust' && phResidency !== 'HK' && phArrivalDate && phExpiryDate) {
                    const arr = new Date(phArrivalDate);
                    const exp = new Date(phExpiryDate);
                    datesToCheck.forEach(item => {
                        if (item.date < arr || item.date > exp) {
                            msgs.push({ type: 'error', text: `${item.label} 不在入境/逗留期限內` });
                        }
                    });
                }
                if (applicationSigningDate && phResidency === 'CN' && phIfsDate) {
                    const sign = new Date(applicationSigningDate);
                    const ifsDeadline = addWorkingDaysExclHolidays(sign, 7, HK_HOLIDAYS_2025_2026);
                    const ifs = new Date(phIfsDate);
                    if (ifsDeadline && ifs > ifsDeadline) {
                        msgs.push({ type: 'error', text: `IFS-MP 逾期提交 (限期: ${formatDate(ifsDeadline)})` });
                    }
                }
                // [v2.7] Warning: FNA sign date should not be later than Proposal print date / Application signing date
                if (fnaSigningDate) {
                    const fnaD = new Date(fnaSigningDate);
                    if (!Number.isNaN(fnaD.getTime())) {
                        if (proposalDate) {
                            const pD = new Date(proposalDate);
                            if (!Number.isNaN(pD.getTime()) && fnaD > pD) {
                                msgs.push({ type: 'warning', text: '財務需求分析簽署日期在建議書印刷日期之後' });
                            }
                        }
                        if (applicationSigningDate) {
                            const aD = new Date(applicationSigningDate);
                            if (!Number.isNaN(aD.getTime()) && fnaD > aD) {
                                msgs.push({ type: 'warning', text: '財務需求分析簽署日期在申請書簽署日期之後' });
                            }
                        }
                    }
                }
                if (appType === 'Trust') {
                    msgs.push({ type: 'warning', text: '需提交 Address Proof (地址證明)' });
                    msgs.push({ type: 'warning', text: '需提交 Trust Declaration Form' });
                    let paUSD = 0;
                    if (premAmount) {
                        paUSD = curr === 'HKD' ? (Number(premAmount) / USD_RATE) : Number(premAmount);
                    }
                    let pdfUSD = 0;
                    if (pdfAmount) {
                        pdfUSD = curr === 'HKD' ? (Number(pdfAmount) / USD_RATE) : Number(pdfAmount);
                    }
                    if (paUSD > 50000 || pdfUSD > 50000 || (paUSD + pdfUSD) > 50000) {
                        let warnMsg = 'Premium > USD 50,000: Check Employment Background';
                        if (pdfAmount) warnMsg += ` (include PDF amount: ${curr || ''} ${pdfAmount})`;
                        msgs.push({ type: 'warning', text: warnMsg });
                    }
                }
                return msgs;
            }, [proposalDate, signingDate, applicationSigningDate, fnaSigningDate, phResidency, phArrivalDate, phExpiryDate, phIfsDate, appType, premAmount, curr, pdfAmount, paymentCurrency, birthdayAlert, flyToBuyAmlRequired]);

            // ==========================================
            // Jumbo Case (大額保單) Logic
            // Trigger if Premium or PDF Amount > USD 1,000,000
            // ==========================================
            const jumboPremiumUSD = useMemo(() => {
                const raw = Number(String(premAmount || '').replace(/,/g, ''));
                if (!raw) return 0;
                return curr === 'HKD' ? (raw / USD_RATE) : raw;
            }, [premAmount, curr]);

            const jumboPDFUSD = useMemo(() => {
                if (payMode !== 'Prepay') return 0;
                const raw = Number(String(pdfAmount || '').replace(/,/g, ''));
                if (!raw) return 0;
                return curr === 'HKD' ? (raw / USD_RATE) : raw;
            }, [pdfAmount, curr, payMode]);

            const isJumboPremium = jumboPremiumUSD > JUMBO_THRESHOLD_USD;
            const isJumboPDF = jumboPDFUSD > JUMBO_THRESHOLD_USD;
            const isJumboCase = isJumboPremium || isJumboPDF;


            const updateOtherInsurance = (idx, field, value) => {
                setOtherInsurances(prev => {
                    const list = [...prev];
                    list[idx] = { ...list[idx], [field]: value };
                    return list;
                });
            };
            const addOtherInsurance = () => setOtherInsurances(prev => [...prev, { name: '', currency: curr, amount: '', status: 'Existing', pfInGenerali: false }]);
            const removeOtherInsurance = (idx) => setOtherInsurances(prev => {
                const list = [...prev];
                list.splice(idx, 1);
                return list.length ? list : [{ name: '', currency: curr, amount: '', status: 'Existing', pfInGenerali: false }];
            });

            const updateTrustBeneficiary = (idx, field, value) => {
                setTrustBeneficiaries(prev => {
                    const list = [...prev];
                    list[idx] = { ...list[idx], [field]: value };
                    return list;
                });
            };
            const addTrustBeneficiary = () => setTrustBeneficiaries(prev => [...prev, { name: '', relationType: 'Self', relationDetail: '', percent: '' }]);
            const removeTrustBeneficiary = (idx) => setTrustBeneficiaries(prev => {
                const list = [...prev];
                list.splice(idx, 1);
                return list.length ? list : [{ name: '', relationType: 'Self', relationDetail: '', percent: '' }];
            });

            const handleSelectCountry = (name) => { setPhOtherCountry(name); setShowSuggestions(false); };

            useEffect(() => {
                if (!policyHydrated) return;
                try {
                    const data = {
                        age: (phAge === "" ? null : phAge), // v2.0 fix: use Policyholder/Settlor age (skip if blank)
                        retireAge: fnaRetireAge,
                        monthlyIncome: fnaDisposableIncome,
                        liquidAsset: fnaLiquidAssets,
                        incomePercent: fnaIncomePercent,
                        assetPercent: fnaAssetPercent,
                        premium: premAmount,
                        term: yearTerm,
                        payMode: payMode,
                        currency: curr,
                        // Premium Financing (PF) values used by the Affordability calculator
                        isPremiumFinancing,
                        pfLoanAmount,
                        pfLoanRate,
                        pfLoanTenor,
                        pfRepaymentAmount,
                    };
                    localStorage.setItem('policyInfoForAffordability', JSON.stringify(data));
                } catch (err) {
                    console.error('Failed to save policy info for affordability', err);
                }
            }, [policyHydrated, isSamePerson, phAge, insAge, fnaRetireAge, fnaDisposableIncome, fnaLiquidAssets, fnaIncomePercent, fnaAssetPercent, premAmount, yearTerm, payMode, curr,
                // watch PF states to update affordability data when they change
                isPremiumFinancing, pfLoanAmount, pfLoanRate, pfLoanTenor, pfRepaymentAmount]);

            useEffect(() => {
                if (!policyHydrated) return;
                try {
                    const summary = {
                        entryProofDate: phArrivalDate || null,
                        fnaSignDate: fnaSigningDate || null,
                        proposalDate: proposalDate || null,
                        applicationSignDate: applicationSigningDate || null,
                        signingDate: signingDate || null,
                        addressProofType: addressProofType || null,
                        isSamePerson,
                        phAge, phGender, phSmoker, phDob,
                        insAge, insGender, insSmoker, insDob,
                        planName, sumAssured, curr, prodType, otherInsurances,
                        height, weight, medicalReq, financialReq, returnCheck,
                        monthlyIncome, occupationStatus, position, employer, location, lifeCiEmployerToggle, bizNature,
                        sofWealthSupplementType, // v1.9
                        annualIncome: monthlyIncome ? Number(monthlyIncome) * 12 : 0,
                        premAmount, payMode, yearTerm,
                        paymentDate, paymentCurrency, paymentAmount, paymentPayor, paymentMethod,
                        // Commission Spreading (Professional Investor - PI)
                        commissionSpreading,
                        piInvestorType,
                        piScenarioKey,
                        isDateBack, birthdayAlert, appType,
                        fnaDisposableIncome: fnaDisposableIncome || null,
                        fnaIncomePercent: fnaIncomePercent || null,
                        fnaLiquidAssets: fnaLiquidAssets || null,
                        fnaAssetPercent: fnaAssetPercent || null,
                        fnaSof: fnaSof || [],
                        fnaSow: fnaSow || [],
                        fnaRetireAge: fnaRetireAge || null,
                        pdfAmount: pdfAmount || '',
                        phResidency, phOtherCountry, reasonPurchaseHK,
                        unpaidPremium, trustBeneficiaries,
                        trustDeclaration,
                        niceActimize,
                        noFna, // [UPDATE Req 8] Save noFna state
                        // Premium Financing details for case summary display
                        isPremiumFinancing,
                        pfLoanAmount,
                        pfLoanRate,
                        pfLoanTenor,
                        pfRepaymentAmount
                    };
                    localStorage.setItem('caseSummaryPolicyInfo', JSON.stringify(summary));
                    window.dispatchEvent(new CustomEvent('caseSummaryUpdate'));
                } catch (err) {
                    console.error('Failed to save case summary policy info', err);
                }
            }, [policyHydrated, phArrivalDate, fnaSigningDate, proposalDate, applicationSigningDate, signingDate, addressProofType, isSamePerson, phAge, phGender, phSmoker, phDob, insAge, insGender, insSmoker, insDob, planName, sumAssured, curr, prodType, otherInsurances, height, weight, medicalReq, financialReq, returnCheck, monthlyIncome, occupationStatus, position, employer, location, lifeCiEmployerToggle, bizNature, sofWealthSupplementType, premAmount, payMode, yearTerm, paymentDate, paymentCurrency, paymentAmount, paymentPayor, paymentMethod,
                // Commission Spreading (Professional Investor - PI)
                commissionSpreading, piInvestorType, piScenarioKey,
                isDateBack, birthdayAlert, appType, trustDeclaration, niceActimize, pdfAmount, phResidency, phOtherCountry, reasonPurchaseHK, unpaidPremium, trustBeneficiaries, noFna,
                // Premium Financing dependencies
                isPremiumFinancing, pfLoanAmount, pfLoanRate, pfLoanTenor, pfRepaymentAmount]);

            const handleResetPolicyInfo = () => {
                setAppType('Individual'); setIsEverestBroker(false); setTrustDeclaration('No'); setNiceActimize(''); setAddressProofType(''); setHeight(''); setWeight(''); setIsSamePerson(true); setIsDateBack(false);
                setProposalDate(""); setSigningDate(""); setApplicationSigningDate(""); setFnaSigningDate("");
                setPhDob(""); setPhGender("M"); setPhSmoker("N"); setPhResidency("HK"); setPhOtherCountry(""); setPhArrivalDate(""); setPhExpiryDate(""); setPhIfsDate("");
                setInsDob(""); setInsGender("M"); setInsSmoker("N"); setInsResidency("HK");
                setPlanName(""); setProdType(""); setSumAssured(""); setCurr("USD"); setPayMode("Annual"); setPremAmount("");
                setOccupationStatus("Employed"); setEmployer(""); setLocation(""); setLifeCiEmployerToggle(false); setBizNature(""); setPosition(""); setMonthlyIncome(""); setSofWealthSupplementType("");
                setTargetSavingHKD(""); setTargetYear(""); setSurrenderValueUSD(""); setYearTerm("");
                setFnaRetireAge(""); setFnaDisposableIncome(""); setFnaIncomePercent(100); setFnaLiquidAssets(""); setFnaAssetPercent(100); setFnaSof([]); setFnaSow([]);
                setPaymentDate(""); setPaymentCurrency("HKD"); setPaymentAmount(""); setPaymentPayor("Policyholder"); setPaymentMethod("Bank Transfer");
                setTrustBeneficiaries([{ name: '', relationType: 'Self', relationDetail: '', percent: '' }]);
                setUnpaidPremium(false); setReasonPurchaseHK('');
                // Reset Commission Spreading (PI)
                setCommissionSpreading(false);
                setPiInvestorType('');
                setPiScenarioKey('');
                setOtherInsurances([{ name: '', currency: 'USD', amount: '' }]);
                setNoFna(false);

                // Reset Premium Financing fields
                setIsPremiumFinancing(false);
                setPfLoanAmount('');
                setPfLoanRate('');
                setPfLoanTenor('');
                setPfRepaymentAmount('');
            };

            return (
                <div id="policy-info" className="h-full">
                    <style>{`#policy-info input:not([type="checkbox"]):not([type="radio"]):not(:disabled), #policy-info textarea:not(:disabled) { background-color: #FEF9C3; }`}</style>
                    <div className="h-full flex flex-col bg-slate-50 overflow-y-auto custom-scrollbar p-6 tab-content">
                        <div className="flex justify-between mb-4 items-center">
                            <div className="flex items-center gap-2">
                                <label className="text-sm font-bold text-slate-700">申請類別 (Application Type):</label>
                                <select value={appType} onChange={(e) =>setAppType(e.target.value)} className="border-2 border-blue-200 rounded-lg p-1.5 text-sm font-bold text-blue-800 bg-white focus:border-blue-500 outline-none">
                                    <option value="Individual">Individual (個人)</option>
                                    <option value="Trust">Trust (信託)</option>
                                </select>
                                <div className="flex items-center gap-2 ml-4">
                                    <label className="text-xs font-bold text-slate-700">NiceActimize:</label>
                                    <select
                                        value={niceActimize}
                                        onChange={(e) => setNiceActimize(e.target.value)}
                                        className="border border-slate-300 rounded-md p-1.5 text-xs bg-white focus:border-blue-500 outline-none"
                                    >
                                        <option value="">Blank</option>
                                        <option value="No">No</option>
                                        <option value="false">false</option>
                                        <option value="with possible">with possible</option>
                                    </select>
                                </div>
                                {appType === 'Trust' && (
                                    <div className="flex items-center gap-2 ml-4">
                                        <select
                                            value={trustReasonCompany}
                                            onChange={(e) => setTrustReasonCompany(e.target.value)}
                                            className="text-sm px-2 py-1 rounded-md border border-slate-300 text-slate-800 bg-white focus:border-blue-500 outline-none"
                                        >
                                            <option value="Pacific">Pacific</option>
                                            <option value="Relyon">Relyon</option>
                                            <option value="Probiz">Probiz</option>
                                                                                    <option value="METIS">METIS</option>
</select>
                                        <button
                                            type="button"
                                            onClick={() => copyToClipboard(TRUST_REASON_TEXTS[trustReasonCompany] || '', 'Copied (Trust Reason)')}
                                            className="text-sm px-3 py-1 rounded-md bg-slate-800 text-white hover:bg-slate-900 active:scale-[0.99]"
                                        >
                                            Copy Trust Reason
                                        </button>
                                        <div className="flex items-center gap-2">
                                            <label className="text-xs font-bold text-slate-700">Declaration for Trust:</label>
                                            <select
                                                value={trustDeclaration}
                                                onChange={(e) => setTrustDeclaration(e.target.value)}
                                                className="text-sm px-2 py-1 rounded-md border border-slate-300 text-slate-800 bg-white focus:border-blue-500 outline-none"
                                            >
                                                <option value="Yes">Yes</option>
                                                <option value="No">No</option>
                                            </select>
                                        </div>
                                    </div>
                                )}

                            </div>
                            <button onClick={handleResetPolicyInfo} className="text-xs bg-white border border-slate-300 text-red-500 px-3 py-1.5 rounded hover:bg-red-50 transition-colors flex items-center gap-1"><RotateCw size={12}/> 重設資料</button>
                        </div>
                        <div className="mt-1 mb-3 flex items-center gap-2">
                            <label className="text-xs font-bold text-slate-700">Broker = Everest Global:</label>
                            <input type="checkbox" checked={isEverestBroker} onChange={(e) => setIsEverestBroker(e.target.checked)} className="h-4 w-4" />
                            <span className="text-[11px] text-slate-600">如勾選，將需要提交地址證明（同高風險地區 / Trust 相同）</span>
                        </div>
                        <div className="space-y-2 mb-6">
                            {isHighRisk && <div className="p-3 rounded border flex items-center gap-2 text-sm font-bold bg-red-100 border-red-300 text-red-800"><AlertTriangle size={16}/>⚠️ 高風險地區：請提交地址證明 (Address Proof Required)</div>}
                            {isEverestBroker && <div className="p-3 rounded border flex items-center gap-2 text-sm font-bold bg-red-50 border-red-200 text-red-700"><AlertTriangle size={16}/>⚠️ Broker = Everest Global：請提交地址證明 (Address Proof Required)</div>}
                            {checkCompliance.map((msg, idx) => (
                                <div key={idx} className={`p-3 rounded border flex items-center gap-2 text-sm font-bold ${msg.type === 'error' ? 'bg-red-50 border-red-200 text-red-600' : (msg.type === 'warning' ? 'bg-orange-50 border-orange-200 text-orange-700' : 'bg-green-50 border-green-200 text-green-600')}`}>
                                    {msg.icon ? msg.icon : (msg.type === 'error' ? <AlertTriangle size={16}/> : (msg.type === 'warning' ? <Info size={16}/> : <Check size={16}/>))}
                                    {msg.text}
                                </div>
                            ))}
                        </div>
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div className="space-y-6">
                                {/* Trust Beneficiary card will be rendered below Basic Information when appType==='Trust' */}

                                {/* Render Trust Beneficiary card below Basic Information */}
                                <div className="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
                                    <div className="text-sm font-bold text-slate-700 uppercase tracking-wide border-l-4 border-blue-500 pl-2 mb-2">基本資料</div>
                                    <div className="flex items-center gap-2 mb-4 p-2 bg-blue-50 rounded border border-blue-100">
                                        <input type="checkbox" checked={isSamePerson} onChange={(e) =>setIsSamePerson(e.target.checked)} className="rounded text-blue-600"/>
                                        <span className="text-sm font-bold text-blue-800">受保人與持有人為同一人</span>
                                    </div>
                                    <div className="space-y-3 border-t pt-3">
                                        <div className="text-sm font-bold text-slate-700">{appType === 'Trust' ? 'Settlor (成立人 - formerly Policyholder)' : '持有人 (Policyholder)'}</div>
                                        <div className="grid grid-cols-3 gap-3">
                                            <div><label className="text-[10px] text-slate-500 font-bold">出生日期</label><input type="date" value={phDob} onChange={(e) =>setPhDob(e.target.value)} className="w-full border rounded p-1 text-sm"/></div>
                                            <div><label className="text-[10px] text-slate-500 font-bold">性別</label><select value={phGender} onChange={(e) =>setPhGender(e.target.value)} className="w-full border rounded p-1 text-sm"><option value="M">男</option><option value="F">女</option></select></div>
                                            <div><label className="text-[10px] text-slate-500 font-bold">吸煙</label><select value={phSmoker} onChange={(e) =>setPhSmoker(e.target.value)} className="w-full border rounded p-1 text-sm"><option value="N">否</option><option value="Y">是</option></select></div>
                                        </div>
                                        <div className="text-xs text-blue-600 font-bold">計算年齡: {phAge} 歲</div>
                                        <div>
                                            <label className="text-[10px] text-slate-500 font-bold">居住地 {appType==='Trust' && <span className="text-red-500">(Trust: Cannot select HK/CN/MO)</span>}</label>
                                            <select value={phResidency} onChange={(e) =>setPhResidency(e.target.value)} className="w-full border rounded p-1 text-sm mb-2">
                                                <option value="">請選擇</option>
                                                {residencyOptions.map(opt => <option key={opt.val} value={opt.val}>{opt.label}</option>)}
                                            </select>
                                            {phResidency === 'Other' && (
                                                <div className="flex gap-2 items-center" ref={wrapperRef}>
                                                    <div className="relative w-full">
                                                        <div className="relative">
                                                            <input type="text" placeholder="輸入國家" value={phOtherCountry} onChange={(e) => {setPhOtherCountry(e.target.value); setShowSuggestions(true);}} onFocus={() => setShowSuggestions(true)} className="w-full border rounded p-1 text-sm pl-7"/>
                                                            <span className="absolute left-2 top-1.5 text-slate-400"><Search size={14}/></span>
                                                        </div>
                                                        {showSuggestions && phOtherCountry && filteredCountries.length > 0 && (
                                                            <ul className="absolute z-50 top-full left-0 right-0 bg-white border border-slate-200 rounded max-h-48 overflow-y-auto shadow-lg">
                                                                {filteredCountries.map((c, idx) => <li key={idx} onClick={() => handleSelectCountry(c.name)} className="px-3 py-2 cursor-pointer hover:bg-slate-50 text-sm flex justify-between items-center"><span>{c.name}</span><span className={`text-[10px] px-1.5 py-0.5 rounded ${c.risk==='High'?'bg-red-100 text-red-700':c.risk==='Medium'?'bg-blue-100 text-blue-700':'bg-green-100 text-green-700'}`}>{c.risk}</span></li>)}
                                                            </ul>
                                                        )}
                                                    </div>
                                                    }
                                                </div>
                                            )}
                                            
                                            {(['Life','CI','Annuity'].includes(prodType)) && (riskLevel || residentLoadingText) && (
                                                <div className="flex flex-wrap gap-2 items-center mt-2">
                                                    {riskLevel && <span className={`text-xs font-bold px-2 py-1 rounded whitespace-nowrap ${riskLevel==='High'||riskLevel==='Sanctioned'?'bg-red-100 text-red-700':riskLevel==='Medium'?'bg-blue-100 text-blue-700':'bg-green-100 text-green-700'}`}>{riskLevel} Risk</span>}
                                                    {residentLoadingText && <span className="text-xs font-bold px-2 py-1 rounded whitespace-nowrap bg-purple-100 text-purple-700">Resident Loading: {residentLoadingText}</span>}
                                                </div>
                                            )}
{needsAddressProof && (
                                                <div className="bg-red-50 p-2 rounded border border-red-200 animate-pulse mt-2">
                                                    <label className="text-[10px] text-red-700 font-bold block mb-1">地址證明類型 (Address Proof Type) *</label>
                                                    <select value={addressProofType} onChange={(e) =>setAddressProofType(e.target.value)} className="w-full border border-red-300 rounded p-1 text-sm bg-white text-red-800">
                                                        <option value="">請選擇...</option>
                                                        <option value="Refer ID">Refer ID (身份證地址)</option>
                                                        <option value="Refer Household">Refer Household (同住家人證明)</option>
                                                        <option value="Refer Bank statement">Refer Bank statement (銀行月結單)</option>
                                                        <option value="Others">Others (其他)</option>
                                                    </select>
                                                </div>
                                            )}
                                            {phResidency !== 'HK' && (
                                                <div className="bg-yellow-50 p-2 rounded border border-yellow-200 mt-2">
                                                    <label className="text-[10px] text-yellow-700 font-bold block mb-1">Reason of purchase insurance in HK</label>
                                                    <select value={reasonPurchaseHK} onChange={(e) => setReasonPurchaseHK(e.target.value)} className="w-full border rounded p-1 text-sm bg-white">
                                                        <option value="">請選擇</option>
                                                        <option value="Provided">Provided</option>
                                                        <option value="NOT provided">NOT provided</option>
                                                    </select>
                                                </div>
                                            )}
                                        </div>
                                        {phResidency === 'CN' && (
                                            <div className="bg-orange-50 p-2 rounded border border-orange-200">
                                                <label className="text-[10px] text-orange-700 font-bold">IFS-MP submission date</label>
                                                <input type="date" value={phIfsDate} onChange={(e) =>setPhIfsDate(e.target.value)} className="w-full border rounded p-1 text-sm" />
                                            </div>
                                        )}
                                        {appType !== 'Trust' && phResidency !== 'HK' && <div className="grid grid-cols-2 gap-2 bg-yellow-50 p-2 rounded border border-yellow-200"><div><label className="text-[10px] text-yellow-700 font-bold">入境日期</label><input type="date" value={phArrivalDate} onChange={(e) =>setPhArrivalDate(e.target.value)} className="w-full border rounded p-1 text-sm"/></div><div><label className="text-[10px] text-yellow-700 font-bold">逗留期限</label><input type="date" value={phExpiryDate} onChange={(e) =>setPhExpiryDate(e.target.value)} className="w-full border rounded p-1 text-sm"/></div></div>}
                                    </div>
                                    {!isSamePerson && (
                                        <div className="space-y-3 border-t pt-3 mt-3 bg-slate-50 p-2 rounded border border-slate-200">
                                            <div className="text-sm font-bold text-slate-700">受保人 (Insured)</div>
                                            <div className="grid grid-cols-3 gap-3">
                                                <div><label className="text-[10px] text-slate-500 font-bold">出生日期</label><input type="date" value={insDob} onChange={(e) =>setInsDob(e.target.value)} className="w-full border rounded p-1 text-sm"/></div>
                                                <div><label className="text-[10px] text-slate-500 font-bold">性別</label><select value={insGender} onChange={(e) =>setInsGender(e.target.value)} className="w-full border rounded p-1 text-sm"><option value="M">男</option><option value="F">女</option></select></div>
                                                <div><label className="text-[10px] text-slate-500 font-bold">吸煙</label><select value={insSmoker} onChange={(e) =>setInsSmoker(e.target.value)} className="w-full border rounded p-1 text-sm"><option value="N">否</option><option value="Y">是</option></select></div>
                                            </div>
                                            <div className="text-xs text-blue-600 font-bold">計算年齡: {insAge} 歲</div>
                                        </div>
                                    )}
                                </div>
                                
                                
                                {appType === 'Trust' && (
                                    <div className="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
                                        <div className="text-sm font-bold text-slate-700 uppercase tracking-wide border-l-4 border-blue-500 pl-2 mb-2">Trust Beneficiary</div>
                                        <div className="space-y-2">
                                            {trustBeneficiaries.map((ben, idx) => (
                                                <div className="grid grid-cols-6 gap-2 items-end" key={idx}>
                                                    <div className="col-span-2"><label className="text-[10px] text-slate-500 font-bold">Name</label><input type="text" value={ben.name} onChange={(e) => updateTrustBeneficiary(idx, 'name', e.target.value)} className="w-full border rounded p-1 text-sm" /></div>
                                                    <div>
                                                        <label className="text-[10px] text-slate-500 font-bold">Relation</label>
                                                        <select value={ben.relationType} onChange={(e) => updateTrustBeneficiary(idx, 'relationType', e.target.value)} className="w-full border rounded p-1 text-sm"><option value="Self">Self</option><option value="Others">Others</option></select>
                                                        {ben.relationType === 'Others' && (<input type="text" value={ben.relationDetail} onChange={(e) => updateTrustBeneficiary(idx, 'relationDetail', e.target.value)} className="w-full border rounded p-1 text-sm mt-1" placeholder="Relation Detail" />)}
                                                    </div>
                                                    <div><label className="text-[10px] text-slate-500 font-bold">Percentage (%)</label><input type="number" value={ben.percent} onChange={(e) => updateTrustBeneficiary(idx, 'percent', e.target.value)} className="w-full border rounded p-1 text-sm" /></div>
                                                    <div className="flex gap-1 justify-end col-span-1 pb-1">
                                                        {trustBeneficiaries.length > 1 && (<button type="button" onClick={() => removeTrustBeneficiary(idx)} className="text-red-500 text-xs border border-red-200 px-2 py-1 rounded hover:bg-red-50 flex items-center gap-1"><Trash2 size={12} /> 刪除</button>)}
                                                        {idx === trustBeneficiaries.length - 1 && (<button type="button" onClick={addTrustBeneficiary} className="text-blue-500 text-xs border border-blue-200 px-2 py-1 rounded hover:bg-blue-50 flex items-center gap-1"><Plus size={12} /> 新增</button>)}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

<div className="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
                                    <div className="text-sm font-bold text-slate-700 uppercase tracking-wide border-l-4 border-blue-500 pl-2 mb-2">建議書資料</div>
                                    <div className="grid grid-cols-1 gap-3">
                                        <div>
                                            <label className="text-xs font-bold text-slate-500">計劃名稱</label>
                                            <select value={planName} onChange={(e) =>handlePlanChange(e.target.value)} className="w-full border rounded p-1.5 text-sm">
                                                <option value="">請選擇...</option>
                                                {['GIO', 'Life', 'CI', 'Annuity', 'HNW'].map(type => (
                                                    <optgroup key={type} label={type}>{productGroups[type]?.map(p => <option key={p.name} value={p.name}>{p.name}</option>)}</optgroup>
                                                ))}
                                            </select>
                                        </div>
                                        <div className="grid grid-cols-2 gap-3">
                                            <div><label className="text-xs font-bold text-slate-500">印刷日期</label><input type="date" value={proposalDate} onChange={(e) =>setProposalDate(e.target.value)} className="w-full border rounded p-1.5 text-sm"/></div>
                                            <div><label className="text-xs font-bold text-slate-500">年期</label><input type="number" value={yearTerm} onChange={(e) =>setYearTerm(e.target.value)} className="w-full border rounded p-1.5 text-sm"/></div>
                                        </div>
                                        {prodType && <div className="bg-blue-50 px-3 py-2 rounded text-xs font-bold text-blue-700 flex justify-between"><span>產品類型: {prodType}</span>{selectedProductData?.multiplier && <span>(規則: 保額 x {selectedProductData.multiplier})</span>}</div>}
                                        <div className="grid grid-cols-2 gap-3">
                                            <div><label className="text-xs font-bold text-slate-500">保額</label><input type="number" value={sumAssured} onChange={(e) =>setSumAssured(e.target.value)} className="w-full border rounded p-1.5 text-sm"/></div>
                                            <div><label className="text-xs font-bold text-slate-500">貨幣</label><select value={curr} onChange={(e) =>setCurr(e.target.value)} className="w-full border rounded p-1.5 text-sm"><option value="USD">USD</option><option value="HKD">HKD</option></select></div>
                                        </div>
                                        <div className="grid grid-cols-2 gap-3">
                                            <div>
                                                <label className="text-xs font-bold text-slate-500">繳費模式</label>
                                                <select value={payMode} onChange={(e) =>setPayMode(e.target.value)} className="w-full border rounded p-1.5 text-sm">
                                                    <option value="Annual">年繳</option>
                                                    <option value="Semi">半年繳</option>
                                                    <option value="Quarterly">季繳</option>
                                                    <option value="Monthly">月繳</option>
                                                    <option value="Prepay">預繳</option>
                                                    {/* [UPDATE v2.8] Add Single Pay option */}
                                                    <option value="Single">單繳</option>
                                                </select>
                                            </div>
                                            <div><label className="text-xs font-bold text-slate-500">保費</label><input type="number" value={premAmount} onChange={(e) =>setPremAmount(e.target.value)} className="w-full border rounded p-1.5 text-sm"/></div>
                                        </div>
                                        {/* Premium Financing (PF) toggle and input fields */}
                                        <div className="flex items-center mt-2">
                                            <input type="checkbox" checked={isPremiumFinancing} onChange={(e) => setIsPremiumFinancing(e.target.checked)} className="mr-2" />
                                            <label className="text-xs font-bold text-slate-500">保費融資 Premium Financing</label>
                                        </div>
                                        {isPremiumFinancing && (
                                            <div className="grid grid-cols-2 gap-3 mt-2 p-2 rounded">
                                                <div>
                                                    <label className="text-xs font-bold text-slate-500">貸款額</label>
                                                    <input type="number" value={pfLoanAmount} onChange={(e) => setPfLoanAmount(e.target.value)} className="w-full border rounded p-1.5 text-sm bg-yellow-50" />
                                                </div>
                                                <div>
                                                    <label className="text-xs font-bold text-slate-500">貸款利率 %</label>
                                                    <input type="number" value={pfLoanRate} onChange={(e) => setPfLoanRate(e.target.value)} className="w-full border rounded p-1.5 text-sm bg-yellow-50" />
                                                </div>
                                                <div>
                                                    <label className="text-xs font-bold text-slate-500">貸款年期 Years</label>
                                                    <input type="number" value={pfLoanTenor} onChange={(e) => setPfLoanTenor(e.target.value)} className="w-full border rounded p-1.5 text-sm bg-yellow-50" />
                                                </div>
                                                <div>
                                                    <label className="text-xs font-bold text-slate-500">每期還款額</label>
                                                    <input type="text" value={pfRepaymentAmount} onChange={(e) => setPfRepaymentAmount(e.target.value)} className="w-full border rounded p-1.5 text-sm bg-yellow-50" />
                                                </div>
                                            </div>
                                        )}
                                        {isJumboPremium && (
                                            <div className="mt-2 bg-blue-50 border border-blue-200 rounded p-2 text-[11px]">
                                                <div className="font-bold text-blue-800 mb-1">Jumbo case requirements</div>
                                                <div className="text-blue-800 whitespace-pre-line">{JUMBO_CASE_TEXT}</div>
                                            </div>
                                        )}

                                        {payMode === 'Prepay' && (
                                            <>
                                            <div className="grid grid-cols-2 gap-3">
                                                <div><label className="text-xs font-bold text-slate-500">PDF Amount</label><input type="number" value={pdfAmount} onChange={(e) => setPdfAmount(e.target.value)} className="w-full border rounded p-1.5 text-sm" /></div>
                                            </div>
                                            {isJumboPDF && (
                                                <div className="mt-2 bg-blue-50 border border-blue-200 rounded p-2 text-[11px]">
                                                    <div className="font-bold text-blue-800 mb-1">Jumbo case requirements</div>
                                                    <div className="text-blue-800 whitespace-pre-line">{JUMBO_CASE_TEXT}</div>
                                                </div>
                                            )}
                                            </>
                                        )}
                                        {(prodType === 'Life' || prodType === 'CI') && (
                                            <div className="space-y-2 border border-slate-200 rounded p-2 bg-slate-50">
                                                <div className="text-xs font-bold text-slate-500">其他保險保額 (Other Insurance Coverage)</div>
                                                {otherInsurances.map((item, idx) => (
                                                    <div key={idx} className="grid grid-cols-8 gap-2 items-end">
                                                        <div className="col-span-2"><label className="text-[10px] text-slate-500 font-bold">名稱</label><input type="text" value={item.name} onChange={(e) => updateOtherInsurance(idx, 'name', e.target.value)} className="w-full border rounded p-1 text-sm" /></div>
                                                        <div><label className="text-[10px] text-slate-500 font-bold">類型</label><select value={item.status || 'Existing'} onChange={(e) => updateOtherInsurance(idx, 'status', e.target.value)} className="w-full border rounded p-1 text-sm"><option value="Applying">Applying</option><option value="Existing">Existing</option></select></div>
                                                        <div><label className="text-[10px] text-slate-500 font-bold">貨幣</label><select value={item.currency} onChange={(e) => updateOtherInsurance(idx, 'currency', e.target.value)} className="w-full border rounded p-1 text-sm"><option value="USD">USD</option><option value="HKD">HKD</option></select></div>
                                                        <div><label className="text-[10px] text-slate-500 font-bold">保額</label><input type="number" value={item.amount} onChange={(e) => updateOtherInsurance(idx, 'amount', e.target.value)} className="w-full border rounded p-1 text-sm" /></div>
                                                        <div className="flex gap-1 justify-end pb-1 col-span-1">
                                                            {otherInsurances.length > 1 && (<button type="button" onClick={() => removeOtherInsurance(idx)} className="text-red-500 text-xs border border-red-200 px-2 py-1 rounded hover:bg-red-50 flex items-center gap-1"><Trash2 size={12} /> 刪除</button>)}
                                                            {idx === otherInsurances.length - 1 && (<button type="button" onClick={addOtherInsurance} className="text-blue-500 text-xs border border-blue-200 px-2 py-1 rounded hover:bg-blue-50 flex items-center gap-1"><Plus size={12} /> 新增</button>)}
                                                        </div>
                                                        <div className="col-span-2">
                                                            <label className="inline-flex items-center gap-2 text-[10px] text-slate-600 font-bold">
                                                                <input
                                                                    type="checkbox"
                                                                    checked={!!item.pfInGenerali}
                                                                    onChange={(e) => updateOtherInsurance(idx, 'pfInGenerali', e.target.checked)}
                                                                />
                                                                PF in Generali
                                                            </label>
                                                            <div className="text-[10px] text-amber-600 mt-1">如該保單是 LionPatron，請自行 x1.5；LionGuardian Beyond 請自行 x1.3。</div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                    {medicalReq && (
                                        <div className="mt-4 border-t pt-4">
                                            <div className="flex items-center gap-2 mb-2"><Stethoscope size={16}/><span className="text-sm font-bold text-slate-700">體檢要求</span></div>
                                            <div className="bg-slate-50 p-3 rounded border border-slate-200 text-sm">
                                                <div className="grid grid-cols-2 gap-2 mb-1 text-xs text-slate-500"><span>年齡: {isSamePerson?phAge:insAge}</span><span>總保額 (USD): {Math.round(medicalReq.checkSA_USD).toLocaleString()}</span></div>
                                                <div className={`font-bold text-lg ${String(medicalReq.req || '').includes('Exceeds') ? 'text-red-600' : 'text-blue-700'}`}>{medicalReq.req}</div>
                                            </div>
                                        </div>
                                    )}
                                    {financialReq && (
                                        <div className="mt-4 border-t pt-4">
                                            <div className="flex items-center gap-2 mb-2"><DollarSign size={16}/><span className="text-sm font-bold text-slate-700">財務核保要求</span></div>
                                            <div className="bg-yellow-50 p-3 rounded border border-yellow-200 text-sm">
                                                {financialReq.maxCapMsg && <div className="text-xs text-yellow-700 mb-2 font-bold">{financialReq.maxCapMsg}</div>}
                                                <ul className="list-disc pl-4 space-y-1">
                                                    {financialReq.reqs.map((req, i) => <li key={i} className="text-slate-700 font-bold">{req}</li>)}
                                                </ul>
                                            </div>
                                        </div>
                                    )}
                                    {/* HNW LionMaster module appears after financial requirements */}
                                    {planName === 'LionMaster' && (
                                        <div className="bg-white p-5 rounded-xl border border-slate-200 shadow-sm mt-6">
                                            <div className="text-sm font-bold text-slate-700 uppercase tracking-wide border-l-4 border-red-500 pl-2 mb-2">LionMaster HNW</div>
                                            <div className="grid grid-cols-1 gap-3">
                                                <div className="grid grid-cols-2 gap-3">
                                                    <div>
                                                        <label className="text-xs font-bold text-slate-500">App Sign Date</label>
                                                        <input type="date" value={hnwAppSignDate} onChange={(e) => setHnwAppSignDate(e.target.value)} className="w-full border rounded p-1.5 text-sm" />
                                                    </div>
                                                    <div>
                                                        <label className="text-xs font-bold text-slate-500">Date of Birth (DOB)</label>
                                                        <input type="date" value={hnwDOB} onChange={(e) => setHnwDOB(e.target.value)} className="w-full border rounded p-1.5 text-sm" />
                                                    </div>
                                                </div>
                                                <div className="grid grid-cols-3 gap-3">
                                                    <div>
                                                        <label className="text-xs font-bold text-slate-500">Age</label>
                                                        <div className="w-full border rounded p-1.5 text-sm bg-gray-100">{hnwAge || '-'}</div>
                                                    </div>
                                                    <div>
                                                        <label className="text-xs font-bold text-slate-500">Gender</label>
                                                        <select value={hnwGender} onChange={(e) => setHnwGender(e.target.value)} className="w-full border rounded p-1.5 text-sm">
                                                            <option value="M">M</option>
                                                            <option value="F">F</option>
                                                        </select>
                                                    </div>
                                                    <div>
                                                        <label className="text-xs font-bold text-slate-500">Smoking Status</label>
                                                        <select value={hnwSmoking} onChange={(e) => setHnwSmoking(e.target.value)} className="w-full border rounded p-1.5 text-sm">
                                                            {HNW_SMOKING_OPTIONS.map((opt) => <option key={opt} value={opt}>{opt}</option>)}
                                                        </select>
                                                    </div>
                                                </div>
                                                <div className="grid grid-cols-3 gap-3">
                                                    <div>
                                                        <label className="text-xs font-bold text-slate-500">Class</label>
                                                        <select value={hnwClass} onChange={(e) => setHnwClass(e.target.value)} className="w-full border rounded p-1.5 text-sm">
                                                            {HNW_CLASS_OPTIONS.map((opt) => <option key={opt} value={opt}>{opt}</option>)}
                                                        </select>
                                                    </div>
                                                    <div>
                                                        <label className="text-xs font-bold text-slate-500">Nationality</label>
                                                        <select value={hnwNationality} onChange={(e) => setHnwNationality(e.target.value)} className="w-full border rounded p-1.5 text-sm">
                                                            <option value="">Select...</option>
                                                            {COUNTRY_LIST.map((c) => <option key={c.name} value={c.name}>{c.name}</option>)}
                                                        </select>
                                                    </div>
                                                    <div>
                                                        <label className="text-xs font-bold text-slate-500">Residency</label>
                                                        <select value={hnwResidency} onChange={(e) => setHnwResidency(e.target.value)} className="w-full border rounded p-1.5 text-sm">
                                                            <option value="">Select...</option>
                                                            {Object.keys(COUNTRY_GROUP_MAP).map((k) => <option key={k} value={k}>{k}</option>)}
                                                        </select>
                                                    </div>
                                                </div>
                                                {hnwResidency && COUNTRY_GROUP_MAP[hnwResidency] && (
                                                    <div className="mt-1 p-2 border border-slate-200 rounded bg-slate-50 text-[10px] text-slate-600">
                                                        <div><span className="font-bold">Group:</span> {COUNTRY_GROUP_MAP[hnwResidency].group}</div>
                                                        <div><span className="font-bold">Issue Limit:</span> {formatMoney(COUNTRY_GROUP_MAP[hnwResidency].issueLimit, 'USD')}</div>
                                                        <div><span className="font-bold">Eligible Cities:</span> {COUNTRY_GROUP_MAP[hnwResidency].eligibleCities}</div>
                                                    </div>
                                                )}
                                                <div className="grid grid-cols-2 gap-3">
                                                    <div>
                                                        <label className="text-xs font-bold text-slate-500">Sum Assured (USD)</label>
                                                        <input type="number" value={hnwSumAssured} onChange={(e) => setHnwSumAssured(e.target.value)} className="w-full border rounded p-1.5 text-sm" />
                                                    </div>
                                                    <div>
                                                        <label className="text-xs font-bold text-slate-500">Terms (Years)</label>
                                                        <input type="number" value={hnwTerms} onChange={(e) => setHnwTerms(e.target.value)} className="w-full border rounded p-1.5 text-sm" />
                                                    </div>
                                                </div>
                                                {/* Annual premium, existing coverage and annual income fields */}
                                                <div className="grid grid-cols-3 gap-3">
                                                    <div>
                                                        <label className="text-xs font-bold text-slate-500">Annual Premium (USD)</label>
                                                        <input type="number" value={hnwAnnualPremium} onChange={(e) => setHnwAnnualPremium(e.target.value)} className="w-full border rounded p-1.5 text-sm" />
                                                    </div>
                                                    <div>
                                                        <label className="text-xs font-bold text-slate-500">Existing Coverage SA (USD)</label>
                                                        <input type="number" value={hnwExistingSA} onChange={(e) => setHnwExistingSA(e.target.value)} className="w-full border rounded p-1.5 text-sm" />
                                                    </div>
                                                    <div>
                                                        <label className="text-xs font-bold text-slate-500">Annual Income (USD)</label>
                                                        <input type="number" value={hnwAnnualIncome} onChange={(e) => setHnwAnnualIncome(e.target.value)} className="w-full border rounded p-1.5 text-sm" />
                                                    </div>
                                                </div>
                                                <div>
                                                    <label className="text-xs font-bold text-slate-500">Occupation</label>
                                                    <input type="text" value={hnwOccupation} onChange={(e) => setHnwOccupation(e.target.value)} className="w-full border rounded p-1.5 text-sm" />
                                                </div>
                                                <div>
                                                    <label className="text-xs font-bold text-slate-500">Medically</label>
                                                    <textarea value={hnwMedically} onChange={(e) => setHnwMedically(e.target.value)} className="w-full border rounded p-1.5 text-xs" rows="2"></textarea>
                                                </div>
                                                <div>
                                                    <label className="text-xs font-bold text-slate-500">Financially</label>
                                                    <textarea value={hnwFinancially} onChange={(e) => setHnwFinancially(e.target.value)} className="w-full border rounded p-1.5 text-xs" rows="2"></textarea>
                                                </div>
                                                {hnwWarnings && hnwWarnings.length > 0 && (
                                                    <div className="mt-2 bg-red-50 border border-red-200 p-2 rounded text-[10px] text-red-700 space-y-1">
                                                        {hnwWarnings.map((w, i) => <div key={i}>⚠️ {w}</div>)}
                                                    </div>
                                                )}
                                                <div className="flex items-center gap-2 mt-2">
                                                    <button type="button" onClick={handleRunHnwSummary} className="px-3 py-1 rounded text-xs font-bold text-white bg-blue-600 hover:bg-blue-700">Run Case Summary</button>
                                                    {hnwSummaryText && (
                                                        <button type="button" onClick={() => { navigator.clipboard.writeText(hnwSummaryText); }} className="px-3 py-1 rounded text-xs font-bold text-white bg-green-600 hover:bg-green-700">Copy</button>
                                                    )}
                                                </div>
                                                {hnwSummaryText && (
                                                    <textarea className="w-full mt-2 p-2 border rounded text-xs" rows="6" value={hnwSummaryText} readOnly></textarea>
                                                )}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                            
                            <div className="space-y-6">
                                <div className="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
                                    <div className="text-sm font-bold text-slate-700 uppercase tracking-wide border-l-4 border-blue-500 pl-2 mb-2">申請書資料</div>
                                    <div className="space-y-3">
                                        <div><label className="text-xs font-bold text-slate-500">簽署日期</label><input type="date" value={applicationSigningDate} onChange={(e) =>setApplicationSigningDate(e.target.value)} className="w-full border rounded p-1.5 text-sm"/></div>
                                        {(prodType === 'Life' || prodType === 'CI') && (
                                            <div className="flex items-center gap-2 mb-2 p-2 bg-purple-50 rounded border border-purple-100">
                                                 <input type="checkbox" checked={isDateBack} onChange={(e) =>setIsDateBack(e.target.checked)} className="rounded text-purple-600"/>
                                                 <span className="text-sm font-bold text-purple-800">Date Back (追溯保單生效日 - 調整年齡 -1)</span>
                                            </div>
                                        )}
                                        {(prodType === 'Life' || prodType === 'CI') && (
                                            <div className="bg-blue-50 p-2 rounded border border-blue-100">
                                                <div className="flex items-center gap-1 mb-1 text-blue-800 font-bold text-xs"><Scale size={14}/> 體格 (Body Build)</div>
                                                <div className="grid grid-cols-2 gap-2">
                                                    <div><label className="text-[10px] text-slate-500 font-bold">身高 (cm)</label><input type="number" value={height} onChange={(e) =>setHeight(e.target.value)} className="w-full border rounded p-1.5 text-sm"/></div>
                                                    <div><label className="text-[10px] text-slate-500 font-bold">體重 (kg)</label><input type="number" value={weight} onChange={(e) =>setWeight(e.target.value)} className="w-full border rounded p-1.5 text-sm"/></div>
                                                </div>
                                                {bmiResult && (
                                                    <div className="mt-1 flex justify-between items-center">
                                                        <span className="text-[10px] text-slate-500 font-bold">BMI: {bmiResult.toFixed(1)}</span>
                                                        {bmiWarning && <span className="text-[10px] text-red-600 font-bold flex items-center gap-1"><AlertTriangle size={10}/> {bmiWarning}</span>}
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                        
                                        <div>
                                            <label className="text-xs font-bold text-slate-500">{(prodType === "Life" || prodType === "CI") ? "受保人的職業身分" : "職業身分"}</label>
                                            <select value={occupationStatus} onChange={(e) =>setOccupationStatus(e.target.value)} className="w-full border rounded p-1.5 text-sm bg-slate-50 font-medium">
                                                <option value="Employed">受僱 (Employed)</option><option value="SelfEmployed">自僱 (Self-Employed)</option><option value="Housewife">家庭主婦 (Housewife)</option><option value="Student">全日制學生 (Student)</option><option value="Juvenile">兒童 (Juvenile)</option><option value="Unemployed">非在職人士 (Unemployed)</option><option value="Retiree">退休人士 (Retiree)</option>
                                            </select>
                                        </div>

                                        {/* v1.9 Non-employed supplementary UI (LionAchiever Elite / LionPrima) */}
                                        {isNonEmployedElitePrimaCase && (
                                            <div className="p-3 rounded border bg-amber-50 border-amber-200 text-xs">
                                                <div className="flex items-center gap-2 font-bold text-amber-800">
                                                    <AlertTriangle size={14} />
                                                    Source(s) of Funds/Wealth Supplementary Information Questionnaire is required
                                                </div>
                                                <div className="mt-2 flex flex-wrap gap-2">
                                                    <button
                                                        type="button"
                                                        onClick={() => setSofWealthSupplementType('PreviousOccupation')}
                                                        className={`px-3 py-1 rounded border text-xs font-bold ${sofWealthSupplementType==='PreviousOccupation' ? 'bg-amber-600 text-white border-amber-600' : 'bg-white text-amber-800 border-amber-300 hover:bg-amber-100'}`}
                                                    >
                                                        Previous Occupation
                                                    </button>
                                                    <button
                                                        type="button"
                                                        onClick={() => setSofWealthSupplementType('FinancialSupporter')}
                                                        className={`px-3 py-1 rounded border text-xs font-bold ${sofWealthSupplementType==='FinancialSupporter' ? 'bg-amber-600 text-white border-amber-600' : 'bg-white text-amber-800 border-amber-300 hover:bg-amber-100'}`}
                                                    >
                                                        Financial Supporter
                                                    </button>
                                                </div>
                                            </div>
                                        )}

                                        {/* v1.12 Non-employed supplementary UI (All plans except LionAchiever Elite / LionPrima) */}
                                        {isNonEmployedOtherPlanCase && (
                                            <div className="p-3 rounded border bg-slate-50 border-slate-200 text-xs">
                                                <div className="font-bold text-slate-700">Please select one:</div>
                                                <div className="mt-2 flex flex-wrap gap-2">
                                                    <button
                                                        type="button"
                                                        onClick={() => setSofWealthSupplementType('PreviousOccupation')}
                                                        className={`px-3 py-1 rounded border ${sofWealthSupplementType === 'PreviousOccupation' ? 'bg-slate-200 border-slate-300' : 'bg-white border-slate-300 hover:bg-slate-100'}`}
                                                    >
                                                        Previous occupation
                                                    </button>
                                                    <button
                                                        type="button"
                                                        onClick={() => setSofWealthSupplementType('FinancialSupporter')}
                                                        className={`px-3 py-1 rounded border ${sofWealthSupplementType === 'FinancialSupporter' ? 'bg-slate-200 border-slate-300' : 'bg-white border-slate-300 hover:bg-slate-100'}`}
                                                    >
                                                        Financial supporter
                                                    </button>
                                                </div>
                                            </div>
                                        )}

                                        {/* [UPDATE Req 1] Hide employer info if Life/CI and NOT Trust/HighRisk
                                            + v1.9 special case: hide until supplementary option selected */}
                                        {showEmployerWorkFields && (
                                            <>
                                                <div><label className="text-xs font-bold text-slate-500">僱主名稱</label><input type="text" value={employer} onChange={(e) =>setEmployer(e.target.value)} className="w-full border rounded p-1.5 text-sm"/></div>
                                                <div><label className="text-xs font-bold text-slate-500">工作地點</label><input type="text" value={location} onChange={(e) =>setLocation(e.target.value)} className="w-full border rounded p-1.5 text-sm"/></div>
                                            </>
                                        )}

                                        {/* Nature of Business + Job Title are hidden initially for non-employed cases (v1.9 / v1.12) */}
                                        {showBizJobFields && (
                                            <div>
                                                <div className="flex items-center">
                                                    <label className="text-xs font-bold text-slate-500">業務性質</label>
                                                    <button type="button" onClick={() => setShowBizNatureHint(!showBizNatureHint)} className="ml-1 text-blue-600 text-[10px] underline">提示</button>
                                                    {(prodType === 'Life' || prodType === 'CI') && !(appType === 'Trust' || isHighRisk) && (
                                                        <label className="ml-3 flex items-center gap-1 text-[10px] font-bold text-slate-600">
                                                            <input
                                                                type="checkbox"
                                                                checked={lifeCiEmployerToggle}
                                                                onChange={(e) => setLifeCiEmployerToggle(e.target.checked)}
                                                                className="rounded text-blue-600"
                                                            />
                                                            <span>輸入僱主資料</span>
                                                        </label>
                                                    )}
                                                </div>
                                                <input type="text" value={bizNature} onChange={(e) =>setBizNature(e.target.value)} className="w-full border rounded p-1.5 text-sm"/>
                                                {showBizNatureHint && (
                                                    <div className="mt-1 text-[10px] space-y-1">
                                                        <div className="font-bold text-slate-700">co owner, shareholder, authorized person, beneficial owner or senior management engaged in the following occupation/industries.</div>
                                                        <div className="font-bold text-red-600">高洗錢風險職業/行業（非詳盡示例） / High ML Risk Occupations/Industries (non-exhaustive examples):</div>
                                                        <div className="text-red-600">現金密集型業務（例如：賭場、博彩、貨幣兌換、加密貨幣交易所、餐廳、便利店等） / Cash‑intensive businesses (e.g., casinos and gambling, money service operators such as currency exchange and crypto exchanges, restaurants, convenience stores)</div>
                                                        <div className="text-red-600">高價值交易：房地產經紀、貴金屬及寶石交易商、拍賣行、藝術品、古董和奢侈品經銷商 / High‑value transactions: real estate agents/brokers, dealers in precious metals and stones, auction houses and art, antique and luxury goods dealers</div>
                                                        <div className="text-red-600">加密貨幣相關（例如：礦工、混幣器、錢包提供者、DeFi 協議營運者、NFT 市場、投資者與交易員等） / Cryptocurrency‑related (e.g., miners, mixers, wallet providers, DeFi protocol operators, NFT marketplaces, investors & traders, etc.)</div>
                                                        <div className="text-red-600">自由職業者或收入證明不固定的顧問（包括投資者或其他自僱人士，例如私家導師、私家教車師傅等），並且申報收入不一致或月收入極高（例如每月港幣 50 萬以上） / Freelancers or consultants with inconsistent income documentation (including investors or other self‑employed persons such as private tutors and private driving instructors) and declared inconsistent income, or the monthly income is very large (e.g., HKD 500k etc.)</div>
                                                        <div className="text-red-600">離岸公司或透明度有限的董事 / Offshore companies or directors with limited transparency</div>
                                                        <div className="text-red-600">汽車經銷商 / Car dealer</div>
                                                        <div className="font-bold text-red-600">高反恐/貪污風險（非詳盡示例） / High CTF/Corruption Risk (non-exhaustive examples):</div>
                                                        <div className="text-red-600">建造 / Construction</div>
                                                        <div className="text-red-600">藥品/藥物 / Pharmaceuticals & drugs</div>
                                                        <div className="text-red-600">醫療（包括醫療設備製造及銷售，例如制氧機、血壓計、血氧儀、護具、耗材、消毒用品、口罩等） / Healthcare (including medical equipment manufacturing and sales, e.g., oxygen concentrators, blood pressure monitors, oximeters, protective gear, consumables, disinfectants, masks, etc.)</div>
                                                        <div className="text-red-600">公共採購 / Public procurement</div>
                                                        <div className="text-red-600">武器、軍火交易及防衛 / Weapon & arms trade and defence</div>
                                                        <div className="text-red-600">採掘業（例如採礦、油氣） / Extractive industries (e.g., mining, oil & gas)</div>
                                                    </div>
                                                )}
                                            </div>
                                        )}

                                        {showBizJobFields ? (
                                            <div className="grid grid-cols-2 gap-3">
                                                <div><label className="text-xs font-bold text-slate-500">職位</label><input type="text" value={position} onChange={(e) =>setPosition(e.target.value)} className="w-full border rounded p-1.5 text-sm"/></div>
                                                <div><label className="text-xs font-bold text-slate-500">月薪</label><input type="number" value={monthlyIncome} onChange={(e) =>setMonthlyIncome(e.target.value)} className="w-full border rounded p-1.5 text-sm"/></div>
                                            </div>
                                        ) : (
                                            <div>
                                                <label className="text-xs font-bold text-slate-500">月薪</label>
                                                <input type="number" value={monthlyIncome} onChange={(e) =>setMonthlyIncome(e.target.value)} className="w-full border rounded p-1.5 text-sm"/>
                                            </div>
                                        )}
                                    </div>
                                </div>
                                <div className="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
                                    <div className="flex justify-between items-center mb-2">
                                        <div className="text-sm font-bold text-slate-700 uppercase tracking-wide border-l-4 border-blue-500 pl-2">財務需求分析 (FNA)</div>
                                        <button onClick={() => onNavigate('affordability')} className="text-xs bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 flex items-center gap-1 shadow-sm"><Calculator size={12}/> 計算負擔能力</button>
                                    </div>
                                    {/* [UPDATE Req 8] Checkbox to skip FNA for Supreme Gold / Painter Flexi */}
                                    {canSkipFna && (
                                        <div className="mb-2 p-2 bg-slate-100 rounded flex items-center gap-2">
                                            <input type="checkbox" checked={noFna} onChange={(e) => setNoFna(e.target.checked)} className="rounded text-blue-600"/>
                                            <span className="text-xs font-bold text-slate-700">豁免 FNA (FNA is not required for this plan)</span>
                                        </div>
                                    )}
                                    {!noFna && (
                                    <>
                                        <div className="bg-slate-50 p-4 rounded border border-slate-100 mb-4">
                                            <div className="text-xs font-bold text-slate-600 mb-2 border-b border-slate-200 pb-1">適當性檢查參考</div>
                                            {selectedProductData ? (
                                                <div className="space-y-2 text-xs">
                                                    <div className="flex gap-2"><span className="font-bold text-blue-600 min-w-[60px]">Part 2 Q1:</span><span className="text-slate-700">{selectedProductData.q1}</span></div>
                                                    <div className="flex gap-2"><span className="font-bold text-blue-600 min-w-[60px]">Part 2 Q2:</span><span className="text-slate-700">{selectedProductData.q2}</span></div>
                                                                                                        <div className="flex gap-2"><span className="font-bold text-blue-600 min-w-[60px]">Part 2 Q3:</span><span className="text-slate-700">{selectedProductData.q3}</span></div>
<div className="flex gap-2"><span className="font-bold text-blue-600 min-w-[60px]">Part 3 Q6:</span><span className="text-slate-700">{selectedProductData.q6}</span></div>
                                                </div>
                                            ) : <div className="text-xs text-slate-400 italic py-2 text-center">請選擇計劃名稱</div>}

                                        </div>
                                        <div className="space-y-3">
                                            <div><label className="text-xs font-bold text-slate-500">簽署日期</label><input type="date" value={fnaSigningDate} onChange={(e) =>setFnaSigningDate(e.target.value)} className="w-full border rounded p-1.5 text-sm" /></div>
                                            <div className="grid grid-cols-2 gap-3">
                                                <div><label className="text-xs font-bold text-slate-500">目標儲蓄 (HKD)</label><input type="number" value={targetSavingHKD} onChange={(e) =>setTargetSavingHKD(e.target.value)} className="w-full border rounded p-1.5 text-sm"/></div>
                                                <div><label className="text-xs font-bold text-slate-500">目標年期</label><input type="number" value={targetYear} onChange={(e) =>setTargetYear(e.target.value)} className="w-full border rounded p-1.5 text-sm"/></div>
                                            </div>
                                            <div>
                                                <label className="text-xs font-bold text-slate-500">建議書退保價值 (USD)</label>
                                                <input type="number" value={surrenderValueUSD} onChange={(e) =>setSurrenderValueUSD(e.target.value)} className="w-full border rounded p-1.5 text-sm"/>
                                                <div className="text-[10px] text-slate-400 mt-1">≈ {formatMoney(surrenderValueUSD ? Number(surrenderValueUSD) * 7.8 : 0)} HKD</div>
                                            </div>
                                            {fnaRangeInfo && (
                                                <div className="p-3 rounded border text-sm flex flex-col gap-1 bg-blue-50 border-blue-200 text-blue-800">
                                                    <div className="flex items-center gap-2 font-bold"><Info size={16}/> {fnaRangeInfo.rangeMsg}</div>
                                                    {fnaRangeInfo.status && <div className={`flex items-center gap-2 text-xs ${fnaRangeInfo.status==='PASS'?'text-green-600':'text-slate-500'}`}>{fnaRangeInfo.status==='PASS' ? <Check size={14}/> : <div className="w-4 h-4 rounded-full bg-slate-300 text-white flex items-center justify-center text-[10px]">!</div>}{fnaRangeInfo.msg}</div>}
                                                </div>
                                            )}
                                            {returnCheck && (
                                                <>
                                                <div className={`p-3 rounded border text-sm font-bold flex items-center gap-2 ${returnCheck.status==='PASS'?'bg-green-50 border-green-200 text-green-700':'bg-red-50 border-red-200 text-red-700'}`}>
                                                    {returnCheck.status==='PASS' ? <Check size={16}/> : <AlertTriangle size={16}/>}
                                                    {returnCheck.status==='PASS' ? '適當性檢查通過 (95% Rule)' : '適當性檢查未通過 (95% Rule - 請查看原因)'}
                                                </div>
                                                    {returnCheck.issues && returnCheck.issues.length > 0 && (
                                                        <ul className="mt-2 list-disc pl-5 text-[11px] space-y-1">
                                                            {returnCheck.issues.slice(0, 6).map((it, idx) => <li key={idx}>{it}</li>)}
                                                        </ul>
                                                    )}

                                                </>
                                            )}
                                        </div>
                                        <div className="mt-4 space-y-3">
                                            <div><label className="text-xs font-bold text-slate-500">預期退休年齡</label><input type="number" value={fnaRetireAge} onChange={(e) =>setFnaRetireAge(e.target.value)} className="w-full border rounded p-1.5 text-sm" /></div>
                                            <div className="grid grid-cols-2 gap-3">
                                                <div><label className="text-xs font-bold text-slate-500">可支配月收入 (HKD)</label><input type="number" value={fnaDisposableIncome} onChange={(e) =>setFnaDisposableIncome(e.target.value)} className="w-full border rounded p-1.5 text-sm" /></div>
                                                <div><label className="text-xs font-bold text-slate-500">收入使用比例 (%)</label><input type="number" value={fnaIncomePercent} onChange={(e) =>setFnaIncomePercent(e.target.value)} className="w-full border rounded p-1.5 text-sm" /></div>
                                            </div>
                                            <div className="grid grid-cols-2 gap-3">
                                                <div><label className="text-xs font-bold text-slate-500">資產 (HKD)</label><input type="number" value={fnaLiquidAssets} onChange={(e) =>setFnaLiquidAssets(e.target.value)} className="w-full border rounded p-1.5 text-sm" /></div>
                                                <div><label className="text-xs font-bold text-slate-500">資產使用比例 (%)</label><input type="number" value={fnaAssetPercent} onChange={(e) =>setFnaAssetPercent(e.target.value)} className="w-full border rounded p-1.5 text-sm" /></div>
                                            </div>
                                            <div className="text-[10px] text-blue-600 font-bold">
                                                每月可用收入: {fnaDisposableIncome && fnaIncomePercent ? formatMoney((Number(fnaDisposableIncome) * Number(fnaIncomePercent) / 100)) : '0'}
                                                ，可用資產: {fnaLiquidAssets && fnaAssetPercent ? formatMoney((Number(fnaLiquidAssets) * Number(fnaAssetPercent) / 100)) : '0'}
                                            </div>
                                            {(planName === 'LionAchiever Elite' || planName === 'LionPrima') && (
                                                <div className="grid grid-cols-2 gap-3">
                                                    <div><label className="text-xs font-bold text-slate-500">資金來源 (SoF)</label><MultiSelect options={SOF_OPTIONS} value={fnaSof} onChange={setFnaSof} placeholder="請選擇" /></div>
                                                    <div><label className="text-xs font-bold text-slate-500">財富來源 (SoW)</label><MultiSelect options={SOW_OPTIONS} value={fnaSow} onChange={setFnaSow} placeholder="請選擇" /></div>
                                                </div>
                                            )}
                                        </div>
                                    </>
                                    )}
                                    {noFna && <div className="text-center p-4 text-slate-400 italic">FNA 已豁免 (FNA Skipped)</div>}
                                </div>
                                {/* Trust Beneficiary card removed from this position; it is now rendered below Basic Information */}
                                <div className="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
                                    <div className="text-sm font-bold text-slate-700 uppercase tracking-wide border-l-4 border-blue-500 pl-2 mb-2">付款資料</div>
                                    <div className="space-y-3">
                                        <div className="grid grid-cols-2 gap-3">
                                            <div><label className="text-xs font-bold text-slate-500">付款日期</label><input type="date" value={paymentDate} onChange={(e) =>setPaymentDate(e.target.value)} className="w-full border rounded p-1.5 text-sm" /></div>
                                            <div>
                                                <label className="text-xs font-bold text-slate-500">付款貨幣</label>
                                                <select value={paymentCurrency} onChange={(e) =>setPaymentCurrency(e.target.value)} className="w-full border rounded p-1.5 text-sm"><option value="HKD">HKD</option><option value="USD">USD</option></select>
                                            </div>
                                        </div>
                                        <div className="grid grid-cols-2 gap-3">
                                            <div><label className="text-xs font-bold text-slate-500">付款金額</label><input type="number" value={paymentAmount} onChange={(e) =>setPaymentAmount(e.target.value)} className="w-full border rounded p-1.5 text-sm" /></div>
                                            <div>
                                                <label className="text-xs font-bold text-slate-500">付款人</label>
                                                <select value={paymentPayor} onChange={(e) =>setPaymentPayor(e.target.value)} className="w-full border rounded p-1.5 text-sm"><option value="Policyholder">持有人 (Policyholder)</option><option value="Insured">受保人 (Insured)</option><option value="Bene">受益人 (Beneficiary)</option><option value="Settlor">Settlor</option><option value="Other">其他 (Other)</option></select>
                                            </div>
                                        </div>
                                        <div>
                                            <label className="text-xs font-bold text-slate-500">付款方式</label>
                                            <select value={paymentMethod} onChange={(e) =>setPaymentMethod(e.target.value)} className="w-full border rounded p-1.5 text-sm">
                                                <option value="Bank Transfer">Bank Transfer</option><option value="Direct Deposit">Direct Deposit</option><option value="Bank Draft / Cashier Order">Bank Draft / Cashier Order</option><option value="Credit Card">Credit Card</option><option value="Credit Card Form">Credit Card Form</option><option value="Bravo Payment">Bravo Payment</option><option value="Online Banking">Online Banking</option><option value="TT">TT</option><option value="PPS / FPS">PPS / FPS</option><option value="Cheque">Cheque</option>
                                            </select>
                                            <div className="flex items-center gap-2 mt-2">
                                                <input type="checkbox" checked={unpaidPremium} onChange={(e) => setUnpaidPremium(e.target.checked)} className="rounded text-blue-600" />
                                                <label className="text-xs font-bold text-slate-500">未支付保費 (Unpaid premium)</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Commission Spreading (Standalone section below Payment Information) */}
                                <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                                    <div className="flex items-center gap-2">
                                        <input
                                            type="checkbox"
                                            checked={commissionSpreading}
                                            onChange={(e) => {
                                                const checked = e.target.checked;
                                                setCommissionSpreading(checked);
                                                if (!checked) {
                                                    setPiInvestorType('');
                                                    setPiScenarioKey('');
                                                }
                                            }}
                                            className="rounded text-blue-600"
                                        />
                                        <label className="text-sm font-bold text-slate-700">Commission Spreading</label>
                                    </div>

                                    {commissionSpreading && (
                                        <div className="mt-3 grid grid-cols-1 md:grid-cols-2 gap-3">
                                            <div>
                                                <label className="text-xs font-bold text-slate-500">Investor Type</label>
                                                <select
                                                    value={piInvestorType}
                                                    onChange={(e) => {
                                                        const v = e.target.value;
                                                        setPiInvestorType(v);
                                                        setPiScenarioKey('');
                                                    }}
                                                    className="w-full border rounded p-1.5 text-sm"
                                                >
                                                    <option value="">Please select</option>
                                                    {PI_INVESTOR_TYPES.map((t) => (
                                                        <option key={t} value={t}>{t}</option>
                                                    ))}
                                                </select>
                                            </div>

                                            {piInvestorType && (
                                                <div>
                                                    <label className="text-xs font-bold text-slate-500">Scenario / Category</label>
                                                    <select
                                                        value={piScenarioKey}
                                                        onChange={(e) => setPiScenarioKey(e.target.value)}
                                                        className="w-full border rounded p-1.5 text-sm"
                                                    >
                                                        <option value="">Please select</option>
                                                        {(PI_REQUIREMENTS[piInvestorType] || []).map((s) => (
                                                            <option key={s.key} value={s.key}>{s.label}</option>
                                                        ))}
                                                    </select>
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // ==========================================
        // Tab 4: Case Summary Component
        // ==========================================
        const CaseSummaryTab = ({ onNavigate }) => {
            const [policyData, setPolicyData] = useState(null);
            const [affordData, setAffordData] = useState(null);
            const [fhx, setFhx] = useState('');
            const [selfHistory, setSelfHistory] = useState('');
            const [issueUN, setIssueUN] = useState('');

            // ==========================================
            // Jumbo Case (大額保單) -> Auto fill Issue UN (Reactive)
            // ==========================================
            const isJumboCaseForSummary = useMemo(() => {
                if (!policyData) return false;
                const toNum = (v) => Number(String(v || '').replace(/,/g, ''));
                const prem = toNum(policyData.premAmount);
                const premUSD = (policyData.curr === 'HKD') ? (prem / USD_RATE) : prem;
                let pdfUSD = 0;
                if (policyData.payMode === 'Prepay') {
                    const pdf = toNum(policyData.pdfAmount);
                    pdfUSD = (policyData.curr === 'HKD') ? (pdf / USD_RATE) : pdf;
                }
                return (premUSD > JUMBO_THRESHOLD_USD) || (pdfUSD > JUMBO_THRESHOLD_USD);
            }, [policyData]);

            // Jumbo Case Issue UN text is handled in the Issue UN default-message effect below (reactive).


            /**
             * Build the array of lines that make up the Case Summary copy.  This helper
             * centralizes the string construction logic so that both the normal
             * copy function and the long version can reuse the same summary.
             */
            const getPaymentSummaryLine = () => {
                if (!policyData) return '';
                if (policyData.unpaidPremium) return 'no';
                const payDate = policyData.paymentDate ? formatDateVerbose(policyData.paymentDate) : '';
                if (policyData.paymentMethod === 'Credit Card Form') {
                    const signer = policyData.paymentPayor || '';
                    const parts = ['Credit Card signed'];
                    if (signer) parts.push(`by ${signer}`);
                    if (payDate) parts.push(`on ${payDate}`);
                    return parts.join(' ').trim();
                }
                let line = '';
                if (policyData.paymentCurrency && policyData.paymentAmount) line = `${policyData.paymentCurrency} ${Number(policyData.paymentAmount).toLocaleString()}`;
                if (line) line += ` paid by ${policyData.paymentPayor || ''}`;
                if (policyData.paymentMethod) line += ` via ${policyData.paymentMethod}`;
                if (payDate) line += ` on ${payDate}`;
                return line || '';
            };

            const getNiceActimizeLines = () => {
                if (policyData?.niceActimize === 'No') return ['NiceActimize checked:', 'no hit'];
                if (policyData?.niceActimize === 'false') return ['NiceActimize checked:', 'Agree all false hit, AS400 & Actimize updated'];
                if (policyData?.niceActimize === 'with possible') return ['NiceActimize checked:'];
                return [];
            };

            const buildSummaryLines = () => {
                if (!policyData) return [];
                const lines = [];
                const niceActimizeLines = getNiceActimizeLines();
                if (niceActimizeLines.length) {
                    lines.push(...niceActimizeLines);
                }
                const pdfSuffixStr = (policyData.payMode === 'Prepay' && policyData.pdfAmount)
                    ? ` (PDF amount: ${formatMoney(Number(policyData.pdfAmount), policyData.curr || 'HKD')})`
                    : '';
                // Show residency for non‑HK residents
                if (policyData.phResidency && policyData.phResidency !== 'HK') {
                    let country = '';
                    if (policyData.phOtherCountry) {
                        country = policyData.phOtherCountry;
                    } else {
                        const map = { CN: 'China', TW: 'Taiwan', MO: 'Macau', KR: 'South Korea' };
                        country = map[policyData.phResidency] || policyData.phResidency;
                    }
                    lines.push(`${country} resident`);
                }
                // Entry proof for non‑HK residents
                if (policyData.phResidency !== 'HK' && policyData.appType !== 'Trust') {
                    const entryProof = policyData.entryProofDate ? formatDateVerbose(policyData.entryProofDate) : 'N/A';
                    lines.push(`Entry Proof date: ${entryProof}`);
                }
                // Dates: FNA/App/Proposal or individual dates
                const fDate = policyData.fnaSignDate;
                const pDate = policyData.proposalDate;
                const aDate = policyData.applicationSignDate;
                if (fDate && pDate && aDate && fDate === pDate && pDate === aDate) {
                    lines.push(`Dates: FNA/App/Proposal: ${formatDateVerbose(fDate)}`);
                } else {
                    const fStr = fDate ? formatDateVerbose(fDate) : 'N/A';
                    const pStr = pDate ? formatDateVerbose(pDate) : 'N/A';
                    const aStr = aDate ? formatDateVerbose(aDate) : 'N/A';
                    lines.push(`Dates: FNA sign: ${fStr} / Proposal print: ${pStr} / Application sign: ${aStr}`);
                }

                // [v1.8] IFS-MP sign date (China residents only)
                if (policyData.phResidency === 'CN') {
                    const ifsMpSignStr = policyData.applicationSignDate ? formatDateVerbose(policyData.applicationSignDate) : 'N/A';
                    lines.push(`IFS-MP sign date: ${ifsMpSignStr}`);
                }
                // Address proof
                if (policyData.addressProofType) lines.push(`Address proof: ${policyData.addressProofType}`);
                // Reason of purchase insurance in HK
                if (policyData.phResidency && policyData.phResidency !== 'HK' && policyData.reasonPurchaseHK) {
                    lines.push(`Reason of purchase insurance in HK: ${policyData.reasonPurchaseHK}`);
                }
                lines.push('--------');
                lines.push(`Insured Info: ${getInsuredInfo()}`);
// [UPDATE] Owner info for all plans when Policyholder != Insured
                if (!policyData.isSamePerson) {
                    lines.push(`Policyholder Info: ${getPolicyholderInfo()}`);
                }
// [UPDATE v1.4] For specific plans, explicitly show Job Position & Monthly Income in Basic Information
const plan = (policyData.planName || '').trim();
const isJobMonthlyPlan = (plan === 'LionTycoon Beyond 2' || plan === 'LionHarvest Prime');
if (isJobMonthlyPlan) {
    const pos = (policyData.position && String(policyData.position).trim()) ? String(policyData.position).trim() : 'N/A';
    lines.push(`Job Position: ${pos}`);
    lines.push(`Monthly Income: ${formatHKDPlain(policyData.monthlyIncome)}`);
}

                lines.push(`Applying: ${policyData.planName || ''} ${policyData.curr || ''} ${policyData.sumAssured || ''}${pdfSuffixStr}`);
                // Premium Financing details
                if (policyData.isPremiumFinancing) {
                    lines.push('Premium Financing: Yes');
                    const loan = policyData.pfLoanAmount || '';
                    const rate = policyData.pfLoanRate || '';
                    const tenor = policyData.pfLoanTenor || '';
                    // Compute projected interest for display.  Use numeric conversion with fallback 0.
                    const proj = (Number(loan) || 0) * ((Number(rate) || 0) / 100) * (Number(tenor) || 0);
                    lines.push(`Loan: $${loan}, Rate: ${rate}% , Tenor: ${tenor} yrs, Interest: $${Math.round(proj).toLocaleString()}`);
                } else {
                    lines.push('Premium Financing: No');
                }
                // Trust beneficiary details
                if (policyData.appType === 'Trust' && policyData.trustBeneficiaries && policyData.trustBeneficiaries.length > 0) {
                    lines.push('Trust Beneficiary:');
                    policyData.trustBeneficiaries.forEach(ben => {
                        const rel = ben.relationType === 'Self' ? 'Self' : (ben.relationDetail || '');
                        lines.push(`   ${(ben.name || '')} - ${rel} - ${(ben.percent || '')}%`);
                    });
                }
                if (policyData.appType === 'Trust') {
                    lines.push(`Declaration for Trust: ${policyData.trustDeclaration || ''}`);
                }

                lines.push('');
                // TSA (Med) and (All)
// [UPDATE] Med/TSA display rule (GIO special handling)
const isPHNotSame = !policyData.isSamePerson;
const isGIOPlan = (policyData.planName || '') === 'GIO';
const sa = Number(String(policyData.sumAssured || '').replace(/,/g, '')) || 0;
const saUSD = (policyData.curr === 'HKD') ? (sa / USD_RATE) : sa;
const isLifeOrCI = (policyData.prodType === 'Life' || policyData.prodType === 'CI');
// [v1.6] Third-party exception: hide TSA(Med) + Medically for Non-Life/Non-CI products even when Owner != Insured
const showMed = (isPHNotSame && !isLifeOrCI)
    ? false
    : ((isGIOPlan && isPHNotSame) ? (saUSD > 2500000) : (isLifeOrCI || isPHNotSame));
                const tsaMed = getTsaMedUSD();
                if (showMed && tsaMed !== null) {
                    lines.push(`TSA (Med): USD ${tsaMed.toLocaleString()}`);
                }
                let tsaAllLine = null;
                const tsaAll = getTsaAllUSD();
                if (tsaAll && (policyData.prodType === 'Life' || policyData.prodType === 'CI')) {
                    tsaAllLine = `TSA (All): USD ${tsaAll.toLocaleString()}`;
                } else if (tsaAll) {
                    lines.push(`TSA (All): USD ${tsaAll.toLocaleString()}`);
                }
                let totalPremLine = null;
                const totalPrem = getTotalPremiumUSD();
                if (totalPrem !== null) {
                    if (policyData.prodType === 'Life' || policyData.prodType === 'CI') {
                        totalPremLine = `Total Premium: USD ${totalPrem.toLocaleString()}`;
                    } else {
                        lines.push(`Total Premium: USD ${totalPrem.toLocaleString()}`);
                    }
                }
                lines.push('--------');
                // Medically section
                if (showMed) {
                    lines.push('Medically:');
                    // Build should appear before BMI per requirements
                    if (policyData.height || policyData.weight) {
                        const buildParts = [];
                        if (policyData.height) buildParts.push(`${policyData.height}cm`);
                        if (policyData.weight) buildParts.push(`${policyData.weight}kg`);
                        lines.push(`   build: ${buildParts.join(', ')}`);
                    }
                    const bmiVal = getBmiInfo();
                    if (bmiVal) lines.push(`   BMI: ${bmiVal.toFixed(1)}`);
                    if (policyData.medicalReq && policyData.medicalReq.req && policyData.medicalReq.req !== 'NM (GIO)' && policyData.medicalReq.req !== 'NM') {
                        lines.push(`   Medical Req: ${policyData.medicalReq.req}`);
                    }
                    if (fhx) lines.push(`   FHX: ${fhx}`);
                    if (selfHistory) lines.push(`   Self History: ${selfHistory}`);
                }
                lines.push('--------');
                // Financially section
                if (policyData.prodType === 'Life' || policyData.prodType === 'CI') {
                    lines.push('Financially:');
                    // If Life/CI and employer toggle is selected, Financially section omits employer-related fields
                    if (!policyData.lifeCiEmployerToggle) {
                        lines.push(`   Occupation: ${policyData.position || ''}`);
                    }
                    const annualHKD = policyData.monthlyIncome ? Number(policyData.monthlyIncome) * 12 : 0;
                    lines.push(`   Annual Income: HKD ${Math.round(annualHKD).toLocaleString()}`);
                    if (policyData.financialReq && policyData.financialReq.maxCapMsg) lines.push(`   ${policyData.financialReq.maxCapMsg}`);
                    if (policyData.financialReq && policyData.financialReq.reqs && policyData.financialReq.reqs.length > 0) {
                        policyData.financialReq.reqs.forEach(req => lines.push(`   - ${req}`));
                    }
                    if (tsaAllLine) lines.push(tsaAllLine);
                    if (totalPremLine) lines.push(totalPremLine);
                }
                lines.push('--------');
                // FNA section
                if (policyData.noFna) {
                    lines.push('FNA: FNA is not required for this plan');
                } else if (affordData && affordData.calculationResult) {
                    lines.push('FNA:');
                    const rc = policyData.returnCheck;
                    if (rc && rc.status) {
                        lines.push(`   Suitability ${rc.status === 'PASS' ? 'OK' : 'Not OK'}`);
                        lines.push('');
                    }
                    const res = affordData.calculationResult;
                    const results = res.detailedResults || [];
                    const hasOverhang = results.some(p => p.overhangYears > 0);
                    const annualTotalHKD = results.reduce((sum, p) => sum + (p.premiumInHKD || 0), 0);
                    const postRetTotalHKD = results.reduce((sum, p) => sum + (p.premiumInHKD || 0) * (p.overhangYears || 0), 0);
                    const preRetireShortfallSum = results.reduce((sum, p) => sum + (p.shortfallAnnual || 0) * (p.preRetireYears || 0), 0);
                    const incomeUsed = res.effectiveIncome || 0;
                    const netAssets = res.effectiveAssets || 0;
                    const isSplitScenario = hasOverhang && preRetireShortfallSum === 0 && incomeUsed >= annualTotalHKD && netAssets >= postRetTotalHKD;
                    const preIncomeSufficient = preRetireShortfallSum === 0 && incomeUsed >= annualTotalHKD;
                    const mode = affordData.calcMode;
                    let totalPremHKD = res.grossTotalDisplay;
                    if (isSplitScenario) {
                        lines.push(`   Total Annual Premiums before retirement: ${formatMoney(annualTotalHKD, 'HKD')}`);
                        lines.push(`   Income used for each year prior to retirement: ${formatMoney(incomeUsed)}`);
                        lines.push(`   Total premiums (need to be supported by net asset) after retirement: ${formatMoney(postRetTotalHKD)}`);
                        // When Premium Financing is used, insert Asset Required above Net assets available for use
                        if (affordData.isPremiumFinancing && res.totalRequiredHKD) {
                            lines.push(`   Asset Required: ${formatMoney(res.totalRequiredHKD, 'HKD')}`);
                        }
                        lines.push(`   Net assets available for use: ${formatMoney(netAssets)}`);
                        lines.push('   Premium Affordability Checking - Pass');
                        lines.push('');
                    } else {
                        const policyCount = results.length || 0;
                        const isApplyingOnly = policyCount === 1;
                        if (policyCount > 1) lines.push('   (All policies)');
                        if (!hasOverhang) {
                            lines.push(`   ${isApplyingOnly ? 'Annual premium' : 'Total annual premiums'}: ${formatMoney(annualTotalHKD, 'HKD')}`);
                        } else if (preIncomeSufficient) {
                            // Edge case fix: If pre-retirement income is sufficient, show annual recurring amount even if post-retirement assets fail.
                            lines.push(`   ${isApplyingOnly ? 'Annual premium' : 'Total Annual Premiums'}: ${formatMoney(annualTotalHKD, 'HKD')}`);
                        } else if (mode === 'income') {
                            lines.push(`   ${isApplyingOnly ? 'Annual premium' : 'Total annual premiums'}: ${formatMoney(totalPremHKD, 'HKD')}`);
                        } else {
                            lines.push(`   Total Premiums: ${formatMoney(totalPremHKD, 'HKD')}`);
                        }
                        lines.push(`   Income used for each year prior to retirement: ${formatMoney(incomeUsed)}`);
                        if (!res.isPass && hasOverhang) {
                            lines.push(`   Total premiums (need to be supported by net asset) after retirement: ${formatMoney(postRetTotalHKD)}`);
                        }
                        // Insert Asset Required line above Net assets when Premium Financing is enabled
                        if (affordData.isPremiumFinancing && res.totalRequiredHKD) {
                            lines.push(`   Asset Required: ${formatMoney(res.totalRequiredHKD, 'HKD')}`);
                        }
                        lines.push(`   Net assets available for use: ${formatMoney(netAssets)}`);
                        if (res.diff < 0) {
                            lines.push(`   Shortfall: ${formatMoney(Math.abs(res.diff))}`);
                        }
                        lines.push(`   Premium Affordability Checking - ${res.isPass ? 'Pass' : 'Failed'}`);
                        lines.push('');
                    }

                    // When premium financing is used, append Premium Financing details and over‑leveraging check
                    if (affordData.isPremiumFinancing) {
                        const loanAmt = Number(affordData.pfLoanAmount || 0);
                        const rateVal = Number(affordData.pfLoanRate || 0);
                        const tenorVal = Number(affordData.pfLoanTenor || 0);
                        const repayVal = affordData.pfRepaymentAmount || '';
                        const projInt = Number(affordData.projectedInterest || 0);
                        const totalRequired = Number(res.totalRequiredHKD || 0);
                        const remRaw = (Number(affordData.liquidAsset || 0)) - totalRequired;
                        // Construct PF detail line
                        let pfDetail = '   Premium Financing details: Loan Amount: ' + formatMoney(loanAmt) + ', Rate: ' + rateVal + '% , Tenor: ' + tenorVal + ' yrs';
                        if (repayVal) {
                            pfDetail += ', Repayment Amt: ' + formatMoney(Number(repayVal) || 0);
                        }
                        lines.push(pfDetail);
                        lines.push('   Net assets after premium payments: ' + formatMoney(remRaw));
                        lines.push('   Projected total interest: ' + formatMoney(projInt));
                        lines.push('   Over‑leveraging checking for Premium Financing Policy - ' + (affordData.testBPass ? 'Pass' : 'Failed'));
                        lines.push('');
                    }
                    // AML/SoF details for certain plans or Trust
                    const planNameLower = (policyData.planName || '').toLowerCase();
                    if (
                        policyData.appType === 'Trust' ||
                        policyData.lifeCiEmployerToggle ||
                        planNameLower === 'lionachiever elite'.toLowerCase() ||
                        planNameLower === 'lionprima'.toLowerCase() ||
                        (
                            planNameLower &&
                            planNameLower !== 'lionachiever elite'.toLowerCase() &&
                            planNameLower !== 'lionprima'.toLowerCase() &&
                            (policyData.occupationStatus !== 'Employed' && policyData.occupationStatus !== 'SelfEmployed') &&
                            !!policyData.sofWealthSupplementType
                        )
                    ) {
                        const holderLabel = policyData.appType === 'Trust' ? 'Settlor' : 'Policyholder';
                        const isSpecialNonEmployedCase = (
                            (planNameLower === 'lionachiever elite'.toLowerCase() || planNameLower === 'lionprima'.toLowerCase()) &&
                            ((policyData.occupationStatus || '') !== 'Employed' && (policyData.occupationStatus || '') !== 'SelfEmployed')
                        );
                        const occEng = ((policyData.occupationStatus || '') === 'SelfEmployed') ? 'Self-Employed' : (policyData.occupationStatus || '');
                        const sofCtx = policyData.sofWealthSupplementType || '';
                        if (isSpecialNonEmployedCase && sofCtx) {
                            const ctxLabel = (sofCtx === 'FinancialSupporter')
                                ? "Policyholder's Financial Supporter"
                                : "Policyholder's previous occupation";
                            lines.push(`   ${occEng} - Source of Fund / Wealth (${ctxLabel})`);
                        } else if (
                            planNameLower &&
                            planNameLower !== 'lionachiever elite'.toLowerCase() &&
                            planNameLower !== 'lionprima'.toLowerCase() &&
                            ((policyData.occupationStatus || '') !== 'Employed' && (policyData.occupationStatus || '') !== 'SelfEmployed') &&
                            sofCtx
                        ) {
                            if (sofCtx === 'FinancialSupporter') lines.push(`   ${occEng} - household income from Financial Supporter`);
                            else lines.push(`   ${occEng} - income from previous occupation`);
                        } else {
                            lines.push(`   Source of Fund / Wealth (${holderLabel})`);
                        }
                        if (policyData.employer) lines.push(`   Employer : ${policyData.employer}`);
                        if (policyData.location) lines.push(`   Incorporated in : ${policyData.location}`);
                        if (policyData.bizNature) lines.push(`   Business Nature : ${policyData.bizNature}`);
                        if (policyData.position) lines.push(`   Job Position : ${policyData.position}`);
                        if (policyData.monthlyIncome) lines.push(`   Monthly Income : ${formatMoney(Number(policyData.monthlyIncome), 'HKD')}`);
                        let disposableMonthly = policyData.fnaDisposableIncome ? Number(policyData.fnaDisposableIncome) : 0;
                        if (policyData.fnaDisposableIncome) lines.push(`   Disposable monthly income: ${formatMoney(disposableMonthly)}`);
                        let assetHKD = policyData.fnaLiquidAssets ? Number(policyData.fnaLiquidAssets) : 0;
                        if (policyData.fnaLiquidAssets) {
                            lines.push(`   Assets: ${formatMoney(assetHKD)}`);
                            lines.push('');
                        }
                        if (policyData.fnaSof && policyData.fnaSof.length) lines.push(`   SoF: ${policyData.fnaSof.join(', ')}`);
                        if (policyData.fnaSow && policyData.fnaSow.length) lines.push(`   SoW: ${policyData.fnaSow.join(', ')}`);
                        const yearsToAccumulate = (assetHKD && disposableMonthly) ? (assetHKD / (disposableMonthly * 12)) : 0;
                        if (assetHKD && disposableMonthly) {
                            lines.push(`   Assets take approx ${yearsToAccumulate.toFixed(1)} years of disposable income to accumulate`);
                        }
                        const holder = policyData.appType === 'Trust' ? 'Settlor' : 'Policyholder';
                        const ageStr = policyData.phAge !== undefined ? policyData.phAge : '';
                                                const ageNum = Number(ageStr) || 0;
                        if (assetHKD) {
                            lines.push(`   => SoF and SoW appears to be commensurate with ${holder}’s background and no suspicions are found.`);
                            if (ageNum && (ageNum - yearsToAccumulate) < 18) {
                            lines.push(`   Considering the ${holder}’s age (${ageStr}) and the occupation, it is NOT reasonable to save the asset of ${formatHKDSign(assetHKD)}.`);
                        } else {
                            lines.push(`   Considering the ${holder}’s age (${ageStr}) and the occupation, it is reasonable to save the asset of ${formatHKDSign(assetHKD)} => Suggest accepting AML.`);
                        }
                        }
                    }
                } else if (policyData.planName && (policyData.planName.toLowerCase().includes('supreme gold') || policyData.planName.toLowerCase().includes('painter flexi'))) {
                    lines.push('FNA: Not required for this plan');
                }
                lines.push('--------');
                // Payment section
                const paymentLine = getPaymentSummaryLine();
                lines.push(`Payment: ${paymentLine.trim()}`);
                if (policyData.payMode === 'Prepay' && policyData.pdfAmount) {
                    lines.push(`PDF amount: ${policyData.curr || ''} ${policyData.pdfAmount}`);
                }
                lines.push('--------');
                // Issue UN and PD
                lines.push(`Issue UN: ${issueUN}`);
                lines.push('');
                const pd = getPdDate();
                lines.push(`*PD: ${pd || ''}`);
                return lines;
            };

            // Helper to display residency for non-HK residents
            const getResidencyDisplay = () => {
                if (!policyData || !policyData.phResidency || policyData.phResidency === 'HK') return '';
                // Use phOtherCountry if provided (when 'Other' selected)
                if (policyData.phOtherCountry) return policyData.phOtherCountry;
                // Map known codes to country names
                const map = { CN: 'China', TW: 'Taiwan', MO: 'Macau', KR: 'South Korea' };
                return map[policyData.phResidency] || policyData.phResidency;
            };

            useEffect(() => {
                try {
                    const pStr = localStorage.getItem('caseSummaryPolicyInfo');
                    const aStr = localStorage.getItem('caseSummaryAffordability');
                    if (pStr) setPolicyData(JSON.parse(pStr));
                    if (aStr) setAffordData(JSON.parse(aStr));
                } catch (err) {
                    console.error('Failed to parse case summary data', err);
                }
            }, []);

            useEffect(() => {
                const handler = () => {
                    try {
                        const pStr = localStorage.getItem('caseSummaryPolicyInfo');
                        const aStr = localStorage.getItem('caseSummaryAffordability');
                        setPolicyData(pStr ? JSON.parse(pStr) : null);
                        setAffordData(aStr ? JSON.parse(aStr) : null);
                    } catch (err) {
                        console.error('Failed to update case summary from localStorage', err);
                    }
                };
                window.addEventListener('caseSummaryUpdate', handler);
                return () => {
                    window.removeEventListener('caseSummaryUpdate', handler);
                };
            }, []);

            useEffect(() => {
                if (!policyData) return;
                let msgs = [];
                const plan = policyData.planName || '';
                if (plan === 'LionAchiever Elite' || plan === 'LionPrima') {
                    msgs.push('a. Anonymous/cash payment is not allowed for high return products; b. Payor will be required to submit of Source(s) of Funds/Wealth Supplementary Information Questionnaire if premium payment is not fully made by proposed policyholder.');
                }
                if ((policyData.prodType === 'GIO' || policyData.prodType === 'Annuity') && policyData.birthdayAlert) {
                    msgs.push('Submit revised illustration with new age is required if payment date or document signed date is after insured\'s birthday. No back-dating will be allowed for saving plans or prepayments.');
                }
                if (policyData.appType === 'Trust') {
                    msgs.push('Trust Application is subject to compliance clearance; further requirements may be required');
                }
                const base = (msgs.join(' ') || '').trim();
                const block = (JUMBO_CASE_TEXT || '').trim();
                let combined = base;
                if (isJumboCaseForSummary && block) {
                    combined = combined ? (combined + "\n\n" + block) : block;
                }

                // [v1.13] AML supplementary questions for specific CBI/RBI jurisdictions (Residence-based)
                const AML_JURISDICTIONS = new Set([
                    'antigua and barbuda',
                    'bahamas',
                    'bahrain',
                    'barbados',
                    'cyprus',
                    'dominica',
                    'grenada',
                    'saint kitts and nevis',
                    'saint lucia',
                    'seychelles',
                    'turks and caicos islands',
                    'united arab emirates',
                    'vanuatu'
                ]);
                const norm = (s) => String(s || '').trim().toLowerCase().replace(/\s+/g, ' ');
                const residenceName = (() => {
                    if (!policyData) return '';
                    if (policyData.phOtherCountry) return policyData.phOtherCountry;
                    const map = { CN: 'China', TW: 'Taiwan', MO: 'Macau', KR: 'South Korea' };
                    return map[policyData.phResidency] || policyData.phResidency || '';
                })();
                if (AML_JURISDICTIONS.has(norm(residenceName))) {
                    const amlText = `(Pending) For AML requirement, please submit supplementary form confirm below information:
(A)  Did you obtain residence rights under a CBI/RBI scheme?
(B)  Do you hold residence rights in any other jurisdiction(s)?
(C)  Have you spent more than 90 days in any other jurisdiction(s) during the previous year?
(D)  In which jurisdiction(s) have you filed personal income tax returns during the previous year?`;
                    combined = combined ? (combined + "\n\n" + amlText) : amlText;
                }

                // Commission Spreading (Professional Investor - PI) -> append pending requirements to Issue UN
                if (policyData.commissionSpreading && policyData.piScenarioKey) {
                    const type = policyData.piInvestorType || '';
                    const key = policyData.piScenarioKey || '';
                    const scenario = (PI_REQUIREMENTS[type] || []).find((s) => s.key === key);
                    const reqText = (scenario && scenario.requirementText) ? String(scenario.requirementText).trim() : '';
                    if (reqText) {
                        const csText = `${COMMISSION_SPREADING_PREFIX}\n${reqText}`;
                        // Avoid accidental duplicates if the user has already pasted the prefix manually.
                        if (!String(combined || '').includes(COMMISSION_SPREADING_PREFIX)) {
                            combined = combined ? (combined + "\n\n" + csText) : csText;
                        }
                    }
                }

                setIssueUN(combined);
            }, [policyData, isJumboCaseForSummary]);

            // [UPDATE Req 6] Logic to compute insured info correctly
            const getInsuredInfo = () => {
                if (!policyData) return '';
                // If isSamePerson, display PH info. If NOT same person, display Insured info.
                const age = policyData.isSamePerson ? policyData.phAge : policyData.insAge;
                const genderCode = policyData.isSamePerson ? policyData.phGender : policyData.insGender;
                const smokerCode = policyData.isSamePerson ? policyData.phSmoker : policyData.insSmoker;

                // [BUGFIX] Age = 0 should still be displayed in Case Summary (0 is falsy in JS)
                const ageStr = (age === '' || age === null || age === undefined || Number.isNaN(age)) ? '' : String(age);
                
                const gender = genderCode === 'M' ? 'M' : 'F';
                const smoker = smokerCode === 'Y' ? 'Smoker' : 'Non-Smoker';
                return `${ageStr} / ${gender} / ${smoker}`;
            };

// [UPDATE] Policyholder (Owner) info for Case Summary when Policyholder != Insured
const getPolicyholderInfo = () => {
    if (!policyData) return '';
    const age = policyData.phAge;
    const genderCode = policyData.phGender;
    const smokerCode = policyData.phSmoker;


    // [BUGFIX] Age = 0 should still be displayed in Case Summary (0 is falsy in JS)
    const ageStr = (age === '' || age === null || age === undefined || Number.isNaN(age)) ? '' : String(age);
    const gender = genderCode === 'M' ? 'M' : 'F';
    const smoker = smokerCode === 'Y' ? 'Smoker' : 'Non-Smoker';
    return `${ageStr} / ${gender} / ${smoker}`;
};


// [UTIL] Plain HKD formatter for Case Summary display (e.g., "HKD 50,000").
// Returns "N/A" when value is empty.
const formatHKDPlain = (val) => {
    if (val === null || val === undefined) return 'N/A';
    const raw = String(val).trim();
    if (!raw) return 'N/A';
    const n = Number(raw.replace(/,/g, ''));
    if (!Number.isFinite(n)) return raw;
    return `HKD ${Math.round(n).toLocaleString('en-HK')}`;
};

// [UTIL] HK$ formatter (e.g., "HK$50,000") for AML wording.
// Returns "N/A" when value is empty.
const formatHKDSign = (val) => {
    if (val === null || val === undefined) return 'N/A';
    const n = (typeof val === 'number') ? val : Number(String(val).replace(/,/g, '').trim());
    if (!Number.isFinite(n)) return String(val);
    return `HK$${Math.round(n).toLocaleString('en-HK')}`;
};

// [UPDATE] GIO special rule:
// If Plan = "GIO" AND Policyholder != Insured -> hide TSA(Med) + Medically by default.
// Exception: Only show them when Sum Assured > USD 2,500,000.
const shouldShowMed = () => {
    if (!policyData) return false;
    const isPHNotSame = !policyData.isSamePerson;
    const isLifeOrCI = (policyData.prodType === 'Life' || policyData.prodType === 'CI');

    // [v1.6] Third-party exception:
    // If Owner != Insured AND product is NOT Life/CI -> hide TSA(Med) + Medically
    if (isPHNotSame && !isLifeOrCI) return false;

    const isGIOPlan = (policyData.planName || '') === 'GIO';
    if (isGIOPlan && isPHNotSame) {
        const sa = Number(policyData.sumAssured) || 0;
        const saUSD = (policyData.curr === 'HKD') ? (sa / USD_RATE) : sa;
        return saUSD > 2500000;
    }
    return (isLifeOrCI || isPHNotSame);
};


            const getBmiInfo = () => {
                if (!policyData) return null;
                const h = parseFloat(policyData.height);
                const w = parseFloat(policyData.weight);
                if (!h || !w) return null;
                const bmi = w / ((h / 100) ** 2);
                return bmi;
            };

            const getTsaMedUSD = () => {
                if (!policyData || !policyData.medicalReq) return null;
                const val = policyData.medicalReq.checkSA_USD;
                const num = Number(val);
                // [BUGFIX] Allow TSA(Med)=0 (0 is falsy in JS)
                if (val === '' || val === null || val === undefined || Number.isNaN(num)) return null;
                return Math.round(num);
            };

            const getTsaAllUSD = () => {
                if (!policyData) return null;
                if (!(policyData.prodType === 'Life' || policyData.prodType === 'CI')) return null;
                let base = Number(policyData.sumAssured) || 0;
                if (policyData.planName === 'LionPatron') {
                    base = base * 1.5;
                }
                let otherTotal = 0;
                if (policyData.otherInsurances && Array.isArray(policyData.otherInsurances)) {
                    policyData.otherInsurances.forEach(item => {
                        const val = Number(item.amount);
                        if (!val || isNaN(val)) return;
                        if (item.currency === policyData.curr) {
                            otherTotal += val;
                        } else if (item.currency === 'USD' && policyData.curr === 'HKD') {
                            otherTotal += val * FIN_USD_RATE;
                        } else if (item.currency === 'HKD' && policyData.curr === 'USD') {
                            otherTotal += val / FIN_USD_RATE;
                        } else {
                            otherTotal += val;
                        }
                    });
                }
                let total = base + otherTotal;
                // [UPDATE Req 2] Use FIN_USD_RATE (8.0) for TSA(All) calculation
                if (policyData.curr === 'HKD') {
                    total = total / FIN_USD_RATE;
                }
                return Math.round(total);
            };

            const getTotalPremiumUSD = () => {
                if (!affordData || !affordData.policies) return null;
                let sum = 0;
                affordData.policies.forEach(p => {
                    const premium = Number(p.premium) || 0;
                    let premUSD = p.currency === 'HKD' ? premium / USD_RATE : premium;
                    if (p.status === 'Applying') {
                        if (policyData && policyData.payMode === 'Prepay') {
                            const term = Number(policyData.yearTerm) || 1;
                            premUSD = premUSD * term;
                        }
                    }
                    sum += premUSD;
                });
                return Math.round(sum);
            };

            const getPdDate = () => {
                if (!policyData) return '';
                let latest = null;
                const signDate = policyData.applicationSignDate || policyData.signingDate || null;
                const payDate = policyData.paymentDate || null;
                if (signDate) latest = signDate;
                if (payDate && (!latest || new Date(payDate) > new Date(latest))) latest = payDate;
                if (!latest) return '';

                // Base date should not be in the future when date-back is selected
                let baseDate = new Date(latest);
                const today = new Date();
                if (!isNaN(baseDate.getTime()) && baseDate > today) baseDate = today;

                let outDate = new Date(baseDate);

                if (policyData.isDateBack && (policyData.prodType === 'Life' || policyData.prodType === 'CI')) {
                    // Date back rule: 1 day before birthday (must not be after baseDate)
                    const dobStr = policyData.isSamePerson ? policyData.phDob : policyData.insDob;
                    if (dobStr) {
                        const dob = new Date(dobStr);
                        if (!isNaN(dob.getTime())) {
                            const y = baseDate.getFullYear();
                            const bdayThisYear = new Date(y, dob.getMonth(), dob.getDate());
                            let pd = new Date(bdayThisYear);
                            pd.setDate(pd.getDate() - 1);

                            // If still after baseDate, use previous year's birthday - 1 day
                            if (pd > baseDate) {
                                const bdayPrevYear = new Date(y - 1, dob.getMonth(), dob.getDate());
                                pd = new Date(bdayPrevYear);
                                pd.setDate(pd.getDate() - 1);
                            }

                            outDate = pd;
                        }
                    }
                    return `${formatDateVerbose(outDate)} (date back - 1 day before birthday)`;
                }

                return formatDateVerbose(outDate);
            };

            const copyAll = () => {
                if (!policyData) return;
                if (!policyData?.niceActimize) {
                    window.alert('Please select NiceActimize option before copying case summary.');
                    return;
                }
                const lines = buildSummaryLines();
                const text = lines.join('\n');
                copyToClipboard(text);
            };

            // Copy function that includes detailed calculation formulas for Medical and Financial sections
            const copyAllLong = () => {
                if (!policyData) return;
                if (!policyData?.niceActimize) {
                    window.alert('Please select NiceActimize option before copying case summary.');
                    return;
                }
                const lines = buildSummaryLines();
                // Compute Medical formula
                let medFormula = '';
                const product = PRODUCT_DB.find(p => p.name === policyData.planName);
                if (product) {
                    // Use MED_CHECK_RATE for CI products, FIN_USD_RATE for others (Life)
                    const rate = product.ruleType === 'CI' ? MED_CHECK_RATE : FIN_USD_RATE;
                    const sa = Number(String(policyData.sumAssured || '').replace(/,/g, '')) || 0;
                    const saUSD = policyData.curr === 'HKD' ? sa / rate : sa;
                    const multiplier = product.multiplier ? product.multiplier : 1;
                    const usdBase = Math.round(saUSD);
                    const usdFinal = Math.round(saUSD * multiplier);
                    medFormula = `Medical: ${policyData.planName} USD ${usdBase.toLocaleString()} x ${multiplier} = USD ${usdFinal.toLocaleString()}`;
                }
                // Compute Financial formula
                let financialFormula = '';
                const annualIncomeHKD = policyData.monthlyIncome ? Number(policyData.monthlyIncome) * 12 : 0;
                if (annualIncomeHKD > 0 && product && (product.ruleType === 'CI' || product.ruleType === 'LIFE')) {
                    const age = policyData.isSamePerson ? policyData.phAge : policyData.insAge;
                    const occupationStatus = policyData.occupationStatus || '';
                    let multiple = 0;
                    if (occupationStatus === 'Employed' || occupationStatus === 'SelfEmployed') {
                        if (product.ruleType === 'CI') {
                            if (age >= 18 && age <= 40) multiple = 30;
                            else if (age <= 50) multiple = 25;
                            else if (age <= 55) multiple = 20;
                            else if (age <= 60) multiple = 15;
                            else if (age <= 65) multiple = 10;
                            else multiple = 5;
                        } else {
                            // LIFE products
                            if (age >= 18 && age <= 35) multiple = 30;
                            else if (age <= 50) multiple = 25;
                            else if (age <= 60) multiple = 15;
                            else if (age <= 70) multiple = 10;
                            else multiple = 0;
                        }
                    }
                    if (multiple > 0) {
                        const incomeUSD = annualIncomeHKD / FIN_USD_RATE;
                        const maxCapUSD = incomeUSD * multiple;
                        financialFormula = `Financial: Total annual income HKD ${Math.round(annualIncomeHKD).toLocaleString()} x multiple ${multiple} = max cap. USD ${Math.round(maxCapUSD).toLocaleString()}`;
                    }
                }
                if (medFormula) lines.push(medFormula);
                if (financialFormula) lines.push(financialFormula);
                const text = lines.join('\n');
                copyToClipboard(text);
            };

            const copyIssueMessage = () => {
                if (!issueUN) return;
                // Use global clipboard helper for toast notification
                copyToClipboard(issueUN);
                try {
                    localStorage.setItem('bulkTextA', issueUN);
                    window.dispatchEvent(new CustomEvent('autoPasteIssueUN'));
                } catch (e) {}
                if (onNavigate) onNavigate('splitter');
            };

            return (
                <div className="h-full flex flex-col bg-slate-50 overflow-y-auto custom-scrollbar p-6 tab-content">
                    <div className="flex justify-between items-center mb-4">
                        <h2 className="text-lg font-bold text-slate-700">Case Summary</h2>
                        <div className="flex gap-2">
                            <button onClick={copyAll} className="text-xs bg-blue-600 text-white px-3 py-1.5 rounded hover:bg-blue-700 flex items-center gap-1"><Copy size={12}/> Copy All</button>
                            <button onClick={copyAllLong} className="text-xs bg-green-600 text-white px-3 py-1.5 rounded hover:bg-green-700 flex items-center gap-1"><Copy size={12}/> Copy (Long)</button>
                        </div>
                    </div>
                    {!policyData ? (
                        <div className="text-center text-sm text-slate-500">No data available</div>
                    ) : (
                    <div className="space-y-4 text-sm text-slate-800">
                        {getNiceActimizeLines().length > 0 && (
                            <div>
                                {getNiceActimizeLines().map((line, index) => (
                                    <div key={`nice-actimize-${index}`} className={index === 0 ? 'font-bold' : 'pl-2'}>
                                        {line}
                                    </div>
                                ))}
                            </div>
                        )}
                        {/* [UPDATE] Show residency for all non-HK residents */}
                        {policyData && getResidencyDisplay() && (
                            <div><span className="font-bold">{getResidencyDisplay()} resident</span></div>
                        )}
                        {/* [UPDATE Req 5] Hide entry proof if HK resident */}
                        {policyData.phResidency !== 'HK' && policyData.appType !== 'Trust' && (
                            <div><span className="font-bold">1. Entry Proof date:</span> {policyData.entryProofDate ? formatDateVerbose(policyData.entryProofDate) : 'N/A'}</div>
                        )}
                        <div>
                            <span className="font-bold">2. Dates:</span>{' '}
                            {(() => {
                                const f = policyData.fnaSignDate;
                                const p = policyData.proposalDate;
                                const a = policyData.applicationSignDate;
                                if (f && p && a && f === p && p === a) {
                                    return <>FNA/App/Proposal: {formatDateVerbose(f)}</>;
                                } else {
                                    const fStr = f ? formatDateVerbose(f) : 'N/A';
                                    const pStr = p ? formatDateVerbose(p) : 'N/A';
                                    const aStr = a ? formatDateVerbose(a) : 'N/A';
                                    return <>FNA sign: {fStr} / Proposal print: {pStr} / Application sign: {aStr}</>;
                                }
                            })()}
                        </div>
                        {policyData.phResidency === 'CN' && (
                            <div><span className="font-bold">IFS-MP sign date:</span> {policyData.applicationSignDate ? formatDateVerbose(policyData.applicationSignDate) : 'N/A'}</div>
                        )}
                        {policyData.addressProofType && <div><span className="font-bold">3. Address proof:</span> {policyData.addressProofType}</div>}
                        {/* Show reason of purchase in HK, and insert Trust declaration immediately after when applicable */}
                        {policyData.phResidency && policyData.phResidency !== 'HK' && policyData.reasonPurchaseHK && (
                            <>
                                <div><span className="font-bold">Reason of purchase insurance in HK:</span> {policyData.reasonPurchaseHK}</div>
                                {policyData.appType === 'Trust' && (
                                    <div className="pl-4"><span className="font-bold">Declaration for Trust:</span> {policyData.trustDeclaration || ''}</div>
                                )}
                            </>
                        )}
                        <div><span className="font-bold">4. Insured:</span> {getInsuredInfo()}</div>
{!policyData.isSamePerson && (
    <div className="pl-4"><span className="font-bold">Policyholder:</span> {getPolicyholderInfo()}</div>
)}
{/* If Trust application and reasonPurchaseHK was not displayed above, show declaration here */}
{policyData.appType === 'Trust' && !(policyData.phResidency && policyData.phResidency !== 'HK' && policyData.reasonPurchaseHK) && (
    <div className="pl-4"><span className="font-bold">Declaration for Trust:</span> {policyData.trustDeclaration || ''}</div>
)}
{(policyData.planName === 'LionTycoon Beyond 2' || policyData.planName === 'LionHarvest Prime') && (
    <>
        <div className="pl-4"><span className="font-bold">Job Position:</span> {(policyData.position && String(policyData.position).trim()) ? String(policyData.position).trim() : 'N/A'}</div>
        <div className="pl-4"><span className="font-bold">Monthly Income:</span> {formatHKDPlain(policyData.monthlyIncome)}</div>
    </>
)}

                        <div><span className="font-bold">5. Applying:</span> {policyData.planName || ''} {policyData.curr || ''} {policyData.sumAssured || ''}{(policyData.payMode === 'Prepay' && policyData.pdfAmount) ? ` (PDF amount: ${formatMoney(Number(policyData.pdfAmount), policyData.curr || 'HKD')})` : ''}</div>
                        {/* Premium Financing details under Applying */}
                        {policyData.isPremiumFinancing ? (
                            <div className="pl-4 text-sm">
                                <div><span className="font-bold">Premium Financing:</span> Yes</div>
                                <div>
                                    <span className="font-bold">Loan:</span> {`$${policyData.pfLoanAmount || ''}`},
                                    <span className="font-bold"> Rate:</span> {policyData.pfLoanRate || ''}% ,
                                    <span className="font-bold"> Tenor:</span> {policyData.pfLoanTenor || ''} yrs,
                                    <span className="font-bold"> Interest:</span> {(() => { const loan = Number(policyData.pfLoanAmount) || 0; const rate = Number(policyData.pfLoanRate) || 0; const tenor = Number(policyData.pfLoanTenor) || 0; const p = loan * (rate/100) * tenor; return `$${Number.isFinite(p) ? Math.round(p).toLocaleString() : ''}`; })()}
                                </div>
                            </div>
                        ) : (
                            <div className="pl-4 text-sm"><span className="font-bold">Premium Financing:</span> No</div>
                        )}
                        {/* [UPDATE] Show Trust Beneficiary directly under Applying */}
                        {policyData && policyData.appType === 'Trust' && policyData.trustBeneficiaries && policyData.trustBeneficiaries.length > 0 && (
                            <div className="pl-4">
                                <span className="font-bold">Trust Beneficiary:</span>
                                {policyData.trustBeneficiaries.map((ben, idx) => (
                                    <div key={idx} className="pl-4">{(ben.name || '')} - {ben.relationType === 'Self' ? 'Self' : (ben.relationDetail || '')} - {(ben.percent || '')}%</div>
                                ))}
                            </div>
                        )}
                        {/* [v1.6] TSA(Med)/Medically: show for Life/CI third-party; hide for Non-Life/Non-CI third-party */}
                        {shouldShowMed() && (getTsaMedUSD() !== null) && (
                            <div><span className="font-bold">6. TSA (Med):</span> USD {getTsaMedUSD().toLocaleString()}</div>
                        )}
                        {(policyData.prodType === 'Life' || policyData.prodType === 'CI') && getTsaAllUSD() && (
                            <div><span className="font-bold">7. TSA (All):</span> USD {getTsaAllUSD().toLocaleString()}</div>
                        )}
                        {getTotalPremiumUSD() !== null && <div><span className="font-bold">8. Total Premium:</span> USD {getTotalPremiumUSD().toLocaleString()}</div>}
                        {policyData.payMode === 'Prepay' && policyData.pdfAmount && (
                            <div><span className="font-bold">PDF amount:</span> {policyData.curr || ''} {policyData.pdfAmount}</div>
                        )}
                                {shouldShowMed() && (
                            <div>
                                <div className="font-bold">9. Medically:</div>
                                {/* Build first, then BMI per requirements */}
                                {(policyData.height || policyData.weight) && (
                                    <div className="pl-4">
                                        Build: {policyData.height ? `${policyData.height}cm` : ''}{policyData.height && policyData.weight ? ', ' : ''}{policyData.weight ? `${policyData.weight}kg` : ''}
                                    </div>
                                )}
                                {getBmiInfo() && <div className="pl-4">BMI: {getBmiInfo().toFixed(1)}</div>}
                                {policyData.medicalReq && policyData.medicalReq.req && policyData.medicalReq.req !== 'NM (GIO)' && policyData.medicalReq.req !== 'NM' && (
                                    <div className="pl-4">Medical Req: {policyData.medicalReq.req}</div>
                                )}
                                <div className="pl-4">
                                    <label className="block text-[10px] font-bold text-slate-500">FHX (Family History)</label>
                                    <input type="text" value={fhx} onChange={(e) => setFhx(e.target.value)} className="w-full border rounded p-1 text-xs" />
                                </div>
                                <div className="pl-4 mt-1">
                                    <label className="block text-[10px] font-bold text-slate-500">Self History</label>
                                    <input type="text" value={selfHistory} onChange={(e) => setSelfHistory(e.target.value)} className="w-full border rounded p-1 text-xs" />
                                </div>
                            </div>
                        )}
                        {(policyData.prodType === 'Life' || policyData.prodType === 'CI') && (
                            <div>
                                <div className="font-bold">10. Financially:</div>
                                {!policyData.lifeCiEmployerToggle && policyData.employer && <div className="pl-4">Employer : {policyData.employer}</div>}
                                {!policyData.lifeCiEmployerToggle && policyData.location && <div className="pl-4">Incorporated in : {policyData.location}</div>}
                                {!policyData.lifeCiEmployerToggle && policyData.bizNature && <div className="pl-4">Business Nature : {policyData.bizNature}</div>}
                                {!policyData.lifeCiEmployerToggle && policyData.position && <div className="pl-4">Job Position : {policyData.position}</div>}
                                {!policyData.lifeCiEmployerToggle && policyData.monthlyIncome && <div className="pl-4">Monthly Income : {formatMoney(Number(policyData.monthlyIncome), 'HKD')}</div>}
                                {policyData.monthlyIncome && <div className="pl-4">Annual Income : {formatMoney(Number(policyData.monthlyIncome) * 12, 'HKD')}</div>}
                                {policyData.financialReq && policyData.financialReq.maxCapMsg && <div className="pl-4">Max Cap: {policyData.financialReq.maxCapMsg}</div>}
                                {policyData.financialReq && policyData.financialReq.reqs && policyData.financialReq.reqs.length > 0 && (
                                    <ul className="pl-8 list-disc space-y-1">
                                        {policyData.financialReq.reqs.map((r, i) => <li key={i}>{r}</li>)}
                                    </ul>
                                )}
                            </div>
                        )}
                        {/* [UPDATE Req 8] Show skipped message */}
                        {policyData.noFna ? (
                            <div>
                                <div className="font-bold">11. FNA:</div>
                                <div className="pl-4">FNA is not required for this plan</div>
                            </div>
                        ) : (affordData && affordData.calculationResult ? (
                            <div>
                                <div className="font-bold">11. FNA:</div>
                                {policyData.returnCheck && policyData.returnCheck.status && <div className="pl-4">Suitability {policyData.returnCheck.status === 'PASS' ? 'OK' : 'Not OK'}</div>}
                                {(() => {
                                    const res = affordData.calculationResult;
                                    if (!res) return null;
                                    const mode = affordData.calcMode;
                                    let totalPremHKD = res.grossTotalDisplay;
                                    const incomeUsed = res.effectiveIncome || 0;
                                    const netAssets = res.effectiveAssets || 0;
                                    const diff = res.diff;
                                    const results = res.detailedResults || [];
                                    const hasOverhang = results.some(p => p.overhangYears > 0);
                                    const annualTotalHKD = results.reduce((sum, p) => sum + (p.premiumInHKD || 0), 0);
                                    const postRetTotalHKD = results.reduce((sum, p) => sum + (p.premiumInHKD || 0) * (p.overhangYears || 0), 0);
                                    const preRetireShortfallSum = results.reduce((sum, p) => sum + (p.shortfallAnnual || 0) * (p.preRetireYears || 0), 0);
                                    const isSplitScenario = hasOverhang && preRetireShortfallSum === 0 && incomeUsed >= annualTotalHKD && netAssets >= postRetTotalHKD;
                                    const preIncomeSufficient = preRetireShortfallSum === 0 && incomeUsed >= annualTotalHKD;
                                    const lines = [];
                                    const pdfSuffix = (policyData.payMode === 'Prepay' && policyData.pdfAmount) ? ` (PDF amount: ${formatMoney(Number(policyData.pdfAmount), policyData.curr || 'HKD')})` : '';
                                    const policyCount = results.length || 0;
                        const isApplyingOnly = policyCount === 1;
                                    const prefix = policyCount > 1 ? '(All policies) - ' : '';
                                    if (isSplitScenario) {
                                        lines.push(<div key="fnaSplit1" className="pl-4">Total Annual Premiums before retirement: {formatMoney(annualTotalHKD, 'HKD')}</div>);
                                        lines.push(<div key="fnaSplit2" className="pl-4">Income used for each year prior to retirement: {formatMoney(incomeUsed)}</div>);
                                        lines.push(<div key="fnaSplit3" className="pl-4">Total premiums (need to be supported by net asset) after retirement: {formatMoney(postRetTotalHKD)}</div>);
                                        // Insert Asset Required row when Premium Financing is active
                                        if (affordData.isPremiumFinancing && res.totalRequiredHKD) {
                                            lines.push(<div key="fnaSplitAsset" className="pl-4">Asset Required: {formatMoney(res.totalRequiredHKD, 'HKD')}</div>);
                                        }
                                        lines.push(<div key="fnaSplit4" className="pl-4">Net assets available for use: {formatMoney(netAssets)}</div>);
                                    } else {
                                        if (!hasOverhang) {
                                            lines.push(<div key="fna1" className="pl-4">{prefix}{isApplyingOnly ? 'Annual premium' : 'Total annual premiums'}: {formatMoney(annualTotalHKD, 'HKD')}{pdfSuffix}</div>);
                                        } else if (preIncomeSufficient) {
                                            // Edge case fix: If pre-retirement income is sufficient, show annual recurring amount even if post-retirement assets fail.
                                            lines.push(<div key="fna1" className="pl-4">{prefix}{isApplyingOnly ? 'Annual premium' : 'Total Annual Premiums'}: {formatMoney(annualTotalHKD, 'HKD')}{pdfSuffix}</div>);
                                        } else {
                                            if (mode === 'income') {
                                                lines.push(<div key="fna1" className="pl-4">{prefix}{isApplyingOnly ? 'Annual premium' : 'Total annual premiums'}: {formatMoney(totalPremHKD, 'HKD')}{pdfSuffix}</div>);
                                            } else {
                                                lines.push(<div key="fna1" className="pl-4">{prefix}Total Premiums: {formatMoney(totalPremHKD, 'HKD')}{pdfSuffix}</div>);
                                            }
                                        }
                                        lines.push(<div key="fna2" className="pl-4">Income used for each year prior to retirement: {formatMoney(incomeUsed)}</div>);
                                        if (!res.isPass && hasOverhang) {
                                            lines.push(<div key="fna2b" className="pl-4">Total premiums (need to be supported by net asset) after retirement: {formatMoney(postRetTotalHKD)}</div>);
                                        }
                                        // Insert Asset Required row above Net assets when Premium Financing is enabled
                                        if (affordData.isPremiumFinancing && res.totalRequiredHKD) {
                                            lines.push(<div key="fnaAsset" className="pl-4">Asset Required: {formatMoney(res.totalRequiredHKD, 'HKD')}</div>);
                                        }
                                        lines.push(<div key="fna3" className="pl-4">Net assets available for use: {formatMoney(netAssets)}</div>);
                                        if (diff < 0) lines.push(<div key="fna4" className="pl-4">Shortfall: {formatMoney(Math.abs(diff))}</div>);
                                    }
                                    return lines;
                                })()}
                                <div className="pl-4">=> Affordability {affordData.calculationResult.isPass ? 'Pass' : 'Failed'}</div>
                                {policyData && (
                                    (policyData.appType === 'Trust') ||
                                    policyData.lifeCiEmployerToggle ||
                                    (policyData.planName && (
                                        policyData.planName.toLowerCase() === 'lionachiever elite'.toLowerCase() ||
                                        policyData.planName.toLowerCase() === 'lionprima'.toLowerCase()
                                    )) ||
                                    (
                                        policyData.planName &&
                                        policyData.planName.toLowerCase() !== 'lionachiever elite'.toLowerCase() &&
                                        policyData.planName.toLowerCase() !== 'lionprima'.toLowerCase() &&
                                        (policyData.occupationStatus !== 'Employed' && policyData.occupationStatus !== 'SelfEmployed') &&
                                        !!policyData.sofWealthSupplementType
                                    )
                                ) && (() => {
                                    let disposableMonthly = policyData.fnaDisposableIncome ? Number(policyData.fnaDisposableIncome) : 0;
                                    let assetHKD = policyData.fnaLiquidAssets ? Number(policyData.fnaLiquidAssets) : 0;
                                    const years = (assetHKD && disposableMonthly) ? (assetHKD / (disposableMonthly * 12)) : 0;
                                    const holder = policyData.appType === 'Trust' ? 'Settlor' : 'Policyholder';
                                    const ageStr = policyData.phAge !== undefined ? policyData.phAge : '';
                                    const ageNum = Number(ageStr) || 0;
                                    return (
                                        <div className="pl-4 mt-2 space-y-1">
                                            <div>{(() => {
                                                const holder = (policyData.isSamePerson ? "Policyholder" : "Insured");
                                                const planLower = (policyData.planName || '').toLowerCase();
                                                const isElitePrima = (planLower === 'lionachiever elite'.toLowerCase() || planLower === 'lionprima'.toLowerCase());
                                                const nonEmp = ((policyData.occupationStatus || '') !== 'Employed' && (policyData.occupationStatus || '') !== 'SelfEmployed');
                                                const occEng = ((policyData.occupationStatus || '') === 'SelfEmployed') ? 'Self-Employed' : (policyData.occupationStatus || '');
                                                const ctx = policyData.sofWealthSupplementType || '';

                                                if (isElitePrima && nonEmp && ctx) {
                                                    const ctxLabel = (ctx === 'FinancialSupporter')
                                                        ? "Policyholder's Financial Supporter"
                                                        : "Policyholder's previous occupation";
                                                    return `${occEng} - Source of Fund / Wealth (${ctxLabel})`;
                                                }

                                                if (!isElitePrima && nonEmp && ctx) {
                                                    if (ctx === 'FinancialSupporter') return `${occEng} - household income from Financial Supporter`;
                                                    return `${occEng} - income from previous occupation`;
                                                }

                                                return `Source of Fund / Wealth (${holder})`;
                                            })()}</div>
                                            {policyData.employer && <div>Employer : {policyData.employer}</div>}
                                            {policyData.location && <div>Incorporated in : {policyData.location}</div>}
                                            {policyData.bizNature && <div>Business Nature : {policyData.bizNature}</div>}
                                            {policyData.position && <div>Job Position : {policyData.position}</div>}
                                            {policyData.monthlyIncome && <div>Monthly Income : {formatMoney(Number(policyData.monthlyIncome), 'HKD')}</div>}
                                            {disposableMonthly ? <div>Disposable monthly income: {formatMoney(disposableMonthly)}</div> : null}
                                            {assetHKD ? <div>Assets: {formatMoney(assetHKD)}</div> : null}
                                            {policyData.fnaSof && policyData.fnaSof.length ? <div>SoF: {policyData.fnaSof.join(', ')}</div> : null}
                                            {policyData.fnaSow && policyData.fnaSow.length ? <div>SoW: {policyData.fnaSow.join(', ')}</div> : null}
                                            {assetHKD && disposableMonthly ? <div>Assets take approx {years.toFixed(1)} years of disposable income to accumulate</div> : null}
                                            {assetHKD ? <div>=> SoF and SoW appears to be commensurate with {holder}’s background and no suspicions are found.</div> : null}
                                            {assetHKD ? <div>{(ageNum && (ageNum - years) < 18) ? `Considering the ${holder}’s age (${ageStr}) and the occupation, it is NOT reasonable to save the asset of ${formatHKDSign(assetHKD)}.` : `Considering the ${holder}’s age (${ageStr}) and the occupation, it is reasonable to save the asset of ${formatHKDSign(assetHKD)} => Suggest accepting AML.`}</div> : null}
                                        </div>
                                    );
                                })()}
                            </div>
                        ) : ((policyData.planName && (policyData.planName.toLowerCase().includes('supreme gold') || policyData.planName.toLowerCase().includes('painter flexi'))) ? (
                            <div>
                                <div className="font-bold">11. FNA:</div>
                                <div className="pl-4">Not required for this plan</div>
                            </div>
                        ) : null))}
                        <div>
                            <span className="font-bold">12. Payment:</span>{' '}
                            {getPaymentSummaryLine()}
                        </div>
                        {/* Trust Beneficiary display moved under point 5 (Applying) */}
                        <div>
                            <span className="font-bold">14. Issue UN:</span>
                            <textarea value={issueUN} onChange={(e) => setIssueUN(e.target.value)} className="w-full border rounded p-2 text-xs mt-1"></textarea>
                            <button onClick={copyIssueMessage} className="mt-1 text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700">Copy Issue UN</button>
                        </div>
                        <div><span className="font-bold">15. *PD:</span> {getPdDate()}</div>
                    </div>
                    )}
                </div>
            );
        };

        // ==========================================
        // Tab 5: Exclusion Code Component
        // ==========================================
        const ExclusionCodeTab = () => {
            const [ncMajorEn, setNcMajorEn] = useState('');
            const [ncMajorCn, setNcMajorCn] = useState('');
            const [ncMinorEn, setNcMinorEn] = useState('');
            const [ncMinorCn, setNcMinorCn] = useState('');
            const [cMajorEn, setCMajorEn] = useState('');
            const [cMajorCn, setCMajorCn] = useState('');
            const [cMinorEn, setCMinorEn] = useState('');
            const [cMinorCn, setCMinorCn] = useState('');
            const [metastasis, setMetastasis] = useState(false);

            const nonCancerItems = useMemo(() => {
                if (!ncMajorEn && !ncMajorCn && !ncMinorEn && !ncMinorCn) return [];
                const majorEn = ncMajorEn || ncMinorEn || '';
                const minorEn = ncMinorEn || ncMajorEn || '';
                const majorCn = ncMajorCn || ncMinorCn || '';
                const minorCn = ncMinorCn || ncMajorCn || '';
                const items = [];
                items.push({
                    prefix: '@@@E',
                    messages: [`Critical Illness Benefit for Major Critical Illness will not be payable if the loss or claim is directly or indirectly due to ${majorEn} and its complications.`]
                });
                items.push({
                    prefix: '@@@E',
                    messages: [`Critical Illness Benefit for Early Stage or Minor Critical Illnesses will not be payable if the loss or claim is directly or indirectly due to ${minorEn} and its complications.`]
                });
                items.push({
                    prefix: '@@@C',
                    messages: [`嚴重疾病 - 不保事項: ${majorCn} 及其併發症。`, `早期及/或非嚴重疾病- 不保事項: ${minorCn} 及其併發症。`]
                });
                return items;
            }, [ncMajorEn, ncMinorEn, ncMajorCn, ncMinorCn]);

            const cancerItems = useMemo(() => {
                if (!cMajorEn && !cMajorCn && !cMinorEn && !cMinorCn) return [];
                const majorEn = cMajorEn || cMinorEn || '';
                const minorEn = cMinorEn || cMajorEn || '';
                const majorCn = cMajorCn || cMinorCn || '';
                const minorCn = cMinorCn || cMajorCn || '';
                const items = [];
                let majorEngLine = metastasis ? 
                    `Critical Illness Benefit for Major Critical Illness will not be payable if the loss or claim is directly or indirectly due to Cancer of ${majorEn}, its treatment, metastasis and complications.` :
                    `Critical Illness Benefit for Major Critical Illness will not be payable if the loss or claim is directly or indirectly due to cancer of ${majorEn} and its complications.`;
                items.push({ prefix: '@@@E', messages: [majorEngLine] });
                items.push({
                    prefix: '@@@E',
                    messages: [`Critical Illness Benefit for Early Stage or Minor Critical Illnesses will not be payable if the loss or claim is directly or indirectly due to Early Stage Malignancy / Carcinoma-in-situ of ${minorEn}, surgical excision of benign tumour of ${minorEn} and its complications.`]
                });
                let majorCnLine = metastasis ? `嚴重疾病 - 不保事項: ${majorCn}癌症及其治療、轉移及併發症。` : `嚴重疾病 - 不保事項: ${majorCn}癌症及其併發症。`;
                items.push({
                    prefix: '@@@C',
                    messages: [majorCnLine, `早期及/或非嚴重疾病- 不保事項: ${minorCn}早期惡性腫瘤/原位癌及${minorCn}良性腫廇切除手術及其併發症。`]
                });
                return items;
            }, [cMajorEn, cMinorEn, cMajorCn, cMinorCn, metastasis]);

            // Use global copyToClipboard helper. Local alerts removed; toast will be shown globally.

            return (
                <div className="h-full flex flex-col bg-slate-50 overflow-y-auto custom-scrollbar p-6 tab-content">
                    <h2 className="text-lg font-bold text-slate-700 mb-4 flex items-center gap-2"><Info size={18}/> Exclusion Code</h2>
                    <div className="space-y-6">
                        <div className="bg-white p-4 rounded border border-slate-200 shadow-sm">
                            <div className="font-bold mb-2 text-slate-700">(Non-cancer) Major CI & Minor CI</div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <div><label className="text-xs font-bold text-slate-500">Major CI (English)</label><input type="text" value={ncMajorEn} onChange={(e) => setNcMajorEn(e.target.value)} className="w-full border rounded p-1 text-sm" /></div>
                                <div><label className="text-xs font-bold text-slate-500">Major CI (Chinese)</label><input type="text" value={ncMajorCn} onChange={(e) => setNcMajorCn(e.target.value)} className="w-full border rounded p-1 text-sm" /></div>
                                <div><label className="text-xs font-bold text-slate-500">Minor CI (English)</label><input type="text" value={ncMinorEn} onChange={(e) => setNcMinorEn(e.target.value)} className="w-full border rounded p-1 text-sm" /></div>
                                <div><label className="text-xs font-bold text-slate-500">Minor CI (Chinese)</label><input type="text" value={ncMinorCn} onChange={(e) => setNcMinorCn(e.target.value)} className="w-full border rounded p-1 text-sm" /></div>
                            </div>
                            {nonCancerItems.length > 0 && (
                                <div className="mt-3 space-y-2">
                                    {nonCancerItems.map((item, idx) => {
                                        const displayText = item.messages.map(msg => `${item.prefix}\n${msg}`).join('\n');
                                        return (
                                            <div key={idx} className="flex justify-between items-start gap-2 border border-slate-200 rounded p-2 bg-slate-50">
                                                <div className="text-sm whitespace-pre-line text-slate-700 flex-1">{displayText}</div>
                                                <button onClick={() => copyToClipboard(displayText)} className="text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700">Copy</button>
                                            </div>
                                        );
                                    })}
                                </div>
                            )}
                        </div>
                        <div className="bg-white p-4 rounded border border-slate-200 shadow-sm">
                            <div className="font-bold mb-2 text-slate-700">(Cancer related) Major CI & Minor CI</div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <div><label className="text-xs font-bold text-slate-500">Major CI (English)</label><input type="text" value={cMajorEn} onChange={(e) => setCMajorEn(e.target.value)} className="w-full border rounded p-1 text-sm" /></div>
                                <div><label className="text-xs font-bold text-slate-500">Major CI (Chinese)</label><input type="text" value={cMajorCn} onChange={(e) => setCMajorCn(e.target.value)} className="w-full border rounded p-1 text-sm" /></div>
                                <div><label className="text-xs font-bold text-slate-500">Minor CI (English)</label><input type="text" value={cMinorEn} onChange={(e) => setCMinorEn(e.target.value)} className="w-full border rounded p-1 text-sm" /></div>
                                <div><label className="text-xs font-bold text-slate-500">Minor CI (Chinese)</label><input type="text" value={cMinorCn} onChange={(e) => setCMinorCn(e.target.value)} className="w-full border rounded p-1 text-sm" /></div>
                                <div className="col-span-full flex items-center mt-2">
                                    <input type="checkbox" id="metastasis" checked={metastasis} onChange={(e) => setMetastasis(e.target.checked)} className="mr-2" />
                                    <label htmlFor="metastasis" className="text-xs font-bold text-slate-500">Metastasis is required</label>
                                </div>
                            </div>
                            {cancerItems.length > 0 && (
                                <div className="mt-3 space-y-2">
                                    {cancerItems.map((item, idx) => {
                                        const displayText = item.messages.map(msg => `${item.prefix}\n${msg}`).join('\n');
                                        return (
                                            <div key={idx} className="flex justify-between items-start gap-2 border border-slate-200 rounded p-2 bg-slate-50">
                                                <div className="text-sm whitespace-pre-line text-slate-700 flex-1">{displayText}</div>
                                                <button onClick={() => copyToClipboard(displayText)} className="text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700">Copy</button>
                                            </div>
                                        );
                                    })}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // ==========================================
        // Tab: Master Broker List
        // ==========================================
        /**
         * The BrokerListTab renders the master broker hierarchy with a search bar. Users may
         * search by broker name, RM name or support staff name. The result will show all
         * matching brokers and their associated RMs and support staff. Empty matches display
         * a friendly message. The data source is defined in MASTER_BROKER_DATA.
         */
        const BrokerListTab = () => {
            const [query, setQuery] = useState('');
            const data = MASTER_BROKER_DATA;
            // Group broker data into one row per broker with multi-pill RM / Support display
            const brokerRows = useMemo(() => {
                const rows = [];
                Object.entries(data).forEach(([broker, rms]) => {
                    const rmSet = new Set();
                    const supSet = new Set();
                    Object.entries(rms || {}).forEach(([rm, supports]) => {
                        if (rm) rmSet.add(rm);
                        if (Array.isArray(supports)) {
                            supports.forEach((s) => {
                                const v = (s ?? '').toString().trim();
                                if (v) supSet.add(v);
                            });
                        }
                    });
                    rows.push({
                        broker,
                        rms: Array.from(rmSet),
                        supports: Array.from(supSet)
                    });
                });
                // stable sort by broker name
                rows.sort((a, b) => a.broker.localeCompare(b.broker));
                return rows;
            }, [data]);

            // Filter the grouped rows based on query
            const filtered = useMemo(() => {
                const q = query.toLowerCase().trim();
                if (!q) return brokerRows;
                return brokerRows.filter(({ broker, rms, supports }) => {
                    const brokerHit = broker.toLowerCase().includes(q);
                    const rmHit = (rms || []).some(r => r.toLowerCase().includes(q));
                    const supHit = (supports || []).some(s => s.toLowerCase().includes(q));
                    return brokerHit || rmHit || supHit;
                });
            }, [query, brokerRows]);
            return (
                <div className="h-full flex flex-col bg-slate-50 overflow-y-auto custom-scrollbar tab-content">
                    <div className="sticky top-0 z-50 bg-slate-50 px-6 pt-6 pb-4 border-b border-slate-200 shadow-sm">
                        <h2 className="text-lg font-bold text-slate-700 mb-3 flex items-center gap-2">Master Broker List</h2>
                        <div className="flex items-center gap-2 flex-wrap">
                            <input
                                type="text"
                                placeholder="Keyword search: Broker / RM / Support"
                                value={query}
                                onChange={(e) => setQuery(e.target.value)}
                                className="flex-1 border rounded p-2 text-sm"
                            />
                            <span className="text-xs text-slate-500 whitespace-nowrap">{filtered.length} results</span>
                        </div>
                    </div>
                    <div className="p-6 pt-4">
                        {filtered.length === 0 ? (
                            <div className="text-sm text-slate-500">No matching brokers found.</div>
                        ) : (
                            <div className="overflow-x-auto">
                                <table className="min-w-full text-sm">
                                    <thead className="text-xs font-bold text-slate-600 uppercase tracking-wide">
                                        <tr>
                                            <th className="py-2 pr-2 text-left">Broker Name</th>
                                            <th className="py-2 pr-2 text-left">RM</th>
                                            <th className="py-2 text-left">Support</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-200">
                                        {filtered.map(({ broker, rms, supports }, idx) => (
                                            <tr key={idx} className="hover:bg-slate-50">
                                                <td className="py-1 pr-2 whitespace-nowrap">{broker}</td>
                                                <td className="py-1 pr-2">
                                                    <div className="flex flex-wrap gap-1">
                                                        {(rms || []).length > 0 ? (
                                                            (rms || []).map((rm) => (
                                                                <span key={rm} className="inline-block px-2 py-0.5 rounded-full text-xs bg-slate-100 text-slate-700 border border-slate-200 whitespace-nowrap">
                                                                    {rm}
                                                                </span>
                                                            ))
                                                        ) : (
                                                            <span className="inline-block px-2 py-0.5 rounded-full text-xs bg-slate-100 text-slate-500 border border-slate-200">—</span>
                                                        )}
                                                    </div>
                                                </td>
                                                <td className="py-1">
                                                    <div className="flex flex-wrap gap-1">
                                                        {(supports || []).length > 0 ? (
                                                            (supports || []).map((support) => (
                                                                <span key={support} className="inline-block px-2 py-0.5 rounded-full text-xs bg-blue-100 text-blue-700 border border-blue-200 whitespace-nowrap">
                                                                    {support}
                                                                </span>
                                                            ))
                                                        ) : (
                                                            <span className="inline-block px-2 py-0.5 rounded-full text-xs bg-slate-100 text-slate-500 border border-slate-200">—</span>
                                                        )}
                                                    </div>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // ==========================================
        // Tab 6: Pending Message Sample
        // ==========================================
        const PendingMessageTab = () => {
            const [searchTerm, setSearchTerm] = useState('');
            const [editedMessages, setEditedMessages] = useState(() => PENDING_MESSAGES.map(m => m.text));
            // Use global copy helper; no local toast state needed
            const normalizePrefix = (p) => {
                if (!p) return '';
                return (p === '(Pending)') ? '(pending)' : p;
            };
            const handleCopy = (prefix, text) => {
                const p = normalizePrefix(prefix);
                const t = (text ?? '').toString();
                copyToClipboard(`${p} ${t}`.trim());
            };

            const filtered = useMemo(() => {
                return PENDING_MESSAGES.map((msg, index) => ({
                    ...msg,
                    index,
                    text: editedMessages[index]
                })).filter(item => {
                    if (!searchTerm) return true;
                    return item.text.toLowerCase().includes(searchTerm.toLowerCase());
                });
            }, [searchTerm, editedMessages]);

            const updateMessage = (idx, value) => {
                setEditedMessages(prev => {
                    const copy = [...prev];
                    copy[idx] = value;
                    return copy;
                });
            };

            return (
                <div className="h-full flex flex-col bg-slate-50 overflow-y-auto custom-scrollbar tab-content relative">
                    <div className="sticky top-0 z-50 bg-slate-50 px-6 pt-6 pb-4 border-b border-slate-200 shadow-sm">
                        <h2 className="text-lg font-bold text-slate-700 mb-3 flex items-center gap-2"><Info size={18}/> Pending Message Sample</h2>
                        <div className="flex items-center gap-2">
                            <Search size={18} className="text-slate-500" />
                            <input
                                type="text"
                                placeholder="Enter keyword to search..."
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                                className="flex-1 border rounded p-2 text-sm"
                            />
                        </div>
                    </div>

                    <div className="p-6 pt-4">
                        <div className="space-y-4">
                            {filtered.map(item => (
                                <div key={item.index} className="bg-white p-3 rounded border border-slate-200 shadow-sm">
                                    <div className="flex items-start gap-2">
                                        <span className="text-xs font-semibold text-slate-500 whitespace-nowrap" style={{ minWidth: '70px' }}>{item.prefix}</span>
                                        <textarea
                                            value={editedMessages[item.index]}
                                            onChange={(e) => updateMessage(item.index, e.target.value)}
                                            className="flex-1 border rounded p-2 text-sm"
                                            rows={2}
                                        ></textarea>
                                        <button
                                            onClick={() => handleCopy(item.prefix, editedMessages[item.index])}
                                            className="ml-2 text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700"
                                        >Copy</button>
                                    </div>
                                </div>
                            ))}
                            {filtered.length === 0 && <div className="text-sm text-slate-500">No messages found.</div>}
                        </div>
                        {/* No local toast; global toast will handle notifications */}
                    </div>
                </div>
            );
        };

        
        /* ========= Versioning & Update Log ========= */
        // Updated version constant to reflect latest enhancements
        const CURRENT_VERSION = "v2.8.630";
        const UPDATE_LOG_PASSWORD = "admin123";
        const versionHistory = [
{
    version: "v2.8.630",
    date: "05 Feb 2026",
    type: "Patch Update",
    changes: [
        "Other Insurance Coverage: Added a per-row 'PF in Generali' checkbox.",
        "TSA(Med) / Medical Requirement total SA now includes rows marked 'PF in Generali' (even if status is not Applying).",
        "Added inline reminder for manual multiplier handling: LionPatron x1.5 and LionGuardian Beyond x1.3."
    ]
},
{
    version: "v2.8.629",
    date: "01 Feb 2026",
    type: "Patch Update",
    changes: [
        "Policy Info: Added NiceActimize dropdown near Application Type.",
        "Case Summary: Display NiceActimize wording between Payment and Issue UN, and block copy when left blank."
    ]
},
{
    version: "v2.8.628",
    date: "31 Jan 2026",
    type: "Patch Update",
    changes: [
        "Payment Info: Added a 'Credit Card Form' payment method option.",
        "Case Summary: When 'Credit Card Form' is selected, show 'Credit Card signed by {payor} on {date}' in preview and copy output."
    ]
},
{
    version: "v2.8.627",
    date: "30 Jan 2026",
    type: "Patch Update",
    changes: [
        "Policy Info: When 'Broker = Everest Global' is ticked, also require/display Employer Name and Work Location fields (same as Trust/High Risk trigger).",
        "Case Summary: When (Policyholder’s age − Assets take approx. years) < 18, show 'it is NOT reasonable to save the asset of xxxxx' and hide '=> Suggest accepting AML.' (Preview and Copy All synced)."
    ]
},

{
    version: "v2.8.625",
    date: "29 Jan 2026",
    type: "Patch Update",
    changes: [
        "Policy Info: Added 'Broker = Everest Global' checkbox under Application Type.",
        "If ticked, Address Proof Type field will be required/displayed (same trigger as High Risk / Trust)."
    ]
},
{
    version: "v2.8.62",
    date: "28 Jan 2026",
    type: "Patch Update",
    changes: [
        "Case Summary: When (Policyholder’s age − Assets take approx. years) < 18, show 'it is NOT reasonable to save the asset of xxxxx' and hide '=> Suggest accepting AML.' (Preview and Copy All synced)."
    ]
},
{
    version: "v2.8.6",
    date: "22 Jan 2026",
    type: "Patch Update",
    changes: [
        "Updated Occupation label for Life/CI, added new GIO plans, and revised FNA Suitability Mapping."
    ]
},

{
    version: "v2.8.5",
    date: "16 Jan 2026",
    type: "Patch Update",
    changes: [
        "Implemented Commission Spreading module and PI Investor logic.",
        "Added Commission Spreading inputs (checkbox + Investor Type + Scenario/Category) as a standalone row below Payment Information.",
        "Case Summary (Section 13 - Issue UN): Appends Commission Spreading pending prefix + scenario requirement text from PI.txt when applicable.",
        "Bumped application version to v2.8.5."
    ]
},

{
    version: "v2.8.4",
    date: "16 Jan 2026",
    type: "Patch Update",
    changes: [
        "Master Broker List: Grouped multiple RM / Support entries into a single broker row (multi-pill display).",
        "HNW case summary comment format updated to the new required layout including annual premium, resident line, annual income and max SA formula, and TSA(All) section.",
        "Pending Message Sample: Added new pending item for financial supporting document (certified true copy) to prove portfolio >= HKD 8 million (Departure from Commission Spreading Requirement).",
        "Bumped application version to v2.8.4."
    ]
},

{
    version: "v2.8.3",
    date: "14 Jan 2026",
    type: "Minor Update",
    changes: [
        "Adjusted the Master Broker List display to a tabular layout with broker, RM and support columns. Added keyword search placeholder and results count.",
        "Expanded the High Net Worth residency dropdown to include the full country group list with issue limits and eligible cities based on the provided Country Group manual.",
        "Implemented High Net Worth medical requirements according to the Routine Medical Requirements table and updated financial requirements thresholds to match the Financial guidelines.",
        "Added an 'Annual Income (USD)' input to the HNW module and computed an income requirement using the formula (75 − age capped at 35) × annual income; displayed the resulting maximum sum assured in warnings.",
        "Bumped application version to v2.8.3."
    ]
},

{
    version: "v2.8.2",
    date: "13 Jan 2026",
    type: "Minor Update",
    changes: [
        "Updated payment mode logic so that Prepay is treated as Regular Pay rather than Single Pay during affordability calculations.",
        "Revised the Case Summary FNA layout to show ‘Asset Required’ above ‘Net assets available for use’ when Premium Financing is selected.",
        "Adjusted the positioning of the Trust declaration so that it appears immediately after the ‘Reason of purchase insurance in HK’ when the application type is Trust.",
        "Added a new 'Master Broker List' tab with searchable broker–RM–support hierarchy based on the supplied master list.",
        "Introduced a new plan category ‘HNW’ with the ‘LionMaster’ plan. Selecting this plan reveals a dedicated High Net Worth (HNW) input form, age calculation, residency group lookup, simplified financial/medical requirement checks and generates a formatted case summary for HNW applications.",
        "Bumped application version to v2.8.2."
    ]
},
{
    version: "v2.8.1",
    date: "12 Jan 2026",
    type: "Patch Update",
    changes: [
        "Refined Premium Financing UI: removed yellow background from PF container and applied highlight only to loan amount, interest rate, tenor and repayment inputs.",
        "Corrected Test B logic: Over-leveraging check now uses net liquid assets (100%) instead of effective assets (capped at 70%).",
        "Renamed tests in Affordability Tab to 'Premium Affordability Checking' and 'Over-leveraging checking for Premium Financing Policy'.",
        "Updated case summary output to reflect new naming and include premium financing details: displays Premium Affordability Checking result, Over-leveraging check with net assets vs projected interest, and lists PF input values.",
        "Bumped application version to v2.8.1."
    ]
},

{
    version: "v2.8",
    date: "12 Jan 2026",
    type: "Major Update",
    changes: [
        "Added new pay mode option 'Single Pay' in Policy Info and Affordability pages.",
        "Introduced Premium Financing checkbox and input fields (Loan amount, Loan rate %, Loan tenor, Repayment amount) in Policy Info and Affordability pages.",
        "Added 'pay type' selector (Regular Pay/Single Pay) for each policy in Affordability page; Applying policy automatically switches to Single Pay when Premium Financing is selected.",
        "Modified Affordability calculation logic to handle single pay (lump-sum) premiums and added two tests: Test A (Premium Affordability Check) and Test B (Over-leveraging Check) when Premium Financing is used.",
        "Updated results section to display separate PASS/FAIL cards and differences for Test A and Test B when Premium Financing is selected.",
        "Enhanced Export/Import and case summary to include pay type, premium financing fields and Test B results."
    ]
},


{
    version: "v2.7",
    date: "10 Jan 2026",
    type: "Minor Update",
    changes: [
        "Added warning when FNA signing date is after Proposal print date or Application signing date."
    ]
},
{
    version: "v2.6",
    date: "09 Jan 2026",
    type: "Minor Update",
    changes: [
        "Implemented UN message sorting (Pending first), added Trust Declaration field, and enabled file-based Export/Import options."
    ]
},




{
    version: "v2.5",
    date: "08 Jan 2026",
    type: "Minor Update",
    changes: [
        "Refactored Export/Import to use internal temporary storage with file renaming and list selection, replacing local file download/upload."
    ]
},


{
    version: "v2.4",
    date: "07 Jan 2026",
    type: "Minor Update",
    changes: [
        "Fixed date-back PD date to avoid future dates and appended '(date back - 1 day before birthday)' in Section 14."
    ]
},

{
    version: "v2.3",
    date: "05 Jan 2026",
    type: "Minor Update",
    changes: [
        "When Life/CI and '輸入僱主資料' is selected, hid Employer/Incorporated/Business Nature/Job Position/Monthly Income in Financially section while keeping Annual Income."
    ]
},




{
    version: "v2.2",
    date: "05 Jan 2026",
    type: "Minor Update",
    changes: [
        "Added optional employer/work fields toggle for Life/CI and enhanced Case Summary Financially & FNA AML narrative."
    ]
},



{
    version: "v2.1",
    date: "02 Jan 2026",
    type: "Minor (Bug Fix)",
    changes: [
        "Fixed Export/Import to include Application signing date, FNA signing date, Target saving, Target year, and Proposal surrender value."
    ]
},

{
    version: "v2.0",
    date: "02 Jan 2026",
    type: "Major Update",
    changes: [
        "Fixed Age calculation logic for 3rd party cases in Affordability section; Added full Export/Import functionality."
    ]
},

{
    version: "v1.15",
    date: "30 Dec 2025",
    type: "Minor (Text Logic Update)",
    changes: [
        "Refined FNA premium label: Display 'Annual premium' instead of 'Total' when only the applying policy is involved."
    ]
},


{
    version: "v1.14",
    date: "30 Dec 2025",
    type: "Minor (Bug Fix)",
    changes: [
        "Fixed Policy Input tab crash: prevent undefined '.includes' in Medical Requirements display (e.g., CI age > 70)."
    ]
},



{
    version: "v1.13",
    date: "30 Dec 2025",
    type: "Minor (Logic Update)",
    changes: [
        "Added AML supplementary text for specific jurisdictions in Section 13 and hidden entry proof date for Trust cases."
    ]
},


{
    version: "v1.12",
    date: "29 Dec 2025",
    type: "Minor (Logic/UI Update)",
    changes: [
        "Fixed Pending Message copy prefix and implemented dynamic UI/FNA logic for non-employed cases (excluding LionAchiever Elite/Prima)."
    ]
},

{
    version: "v1.11",
    date: "29 Dec 2025",
    type: "Minor (Bug Fix)",
    changes: [
        "Fixed Copy All: ensured DOB fields won't cause blank/missing output issues when inputs are empty."
    ]
},

{
    version: "v1.10",
    date: "29 Dec 2025",
    type: "Minor (Bug Fix)",
    changes: [
        "Fixed JSX syntax error in Policy Input (Non-Employed supplementary UI): removed an extra closing </div> that caused 'Adjacent JSX elements' compile error."
    ]
},






{
    version: "v1.9",
    date: "29 Dec 2025",
    type: "UI/Logic Improvement (Minor)",
    changes: [
        "Implemented dynamic UI for Non-Employed cases (LionAchiever Elite/Prima) and updated Case Summary Source of Fund wording."
    ]
},


{
    version: "v1.8",
    date: "24 Dec 2025",
    type: "Minor (Case Summary Update)",
    changes: [
        "Updated IFS-MP display for China residents, refined FNA policy count labeling, and updated retirement premium wording."
    ]
},



{
    version: "v1.7",
    date: "19 Dec 2025",
    type: "UI/UX Improvement",
    changes: [
        "Made the Search Bar in 'Pending message sample' tab sticky on scroll."
    ]
},



{
    version: "v1.6",
    date: "18 Dec 2025",
    type: "Minor (Case Summary Update)",
    changes: [
        "Updated Case Summary logic: Hidden TSA(Med) and Medically fields for Non-Life/Non-CI products even when Owner differs from Insured."
    ]
},
{
    version: "v1.5",
    date: "18 Dec 2025",
    type: "Minor (Trust Reason Update)",
    changes: [
        "Added 'METIS' to Trust Reason options and fixed line-break formatting for all trust copy texts."
    ]
},
{
    version: "v1.4",
    date: "17 Dec 2025",
    type: "Minor (Case Summary Update)",
    changes: [
        "Added Job Position and Monthly Income to Case Summary for LionTycoon Beyond 2 and LionHarvest Prime."
    ]
},
            {
                version: "v1.3",
                date: "17 Dec 2025",
                type: "Minor (Display Logic Fix)",
                changes: [
                    "Fixed Affordability display logic: Show 'Total Annual Premiums' if pre-retirement income is sufficient, even if post-retirement assets are insufficient."
                ]
            },
            {
                version: "v1.2",
                date: "17 Dec 2025",
                type: "Minor (Logic Update)",
                changes: [
                    "Updated HKD-to-USD exchange rate from 7.8 to 8.0 for 'Other Insurance Sum Assured'."
                ]
            },
            {
                version: "v1.1",
                date: "16 Dec 2025",
                type: "Minor (Bug Fix)",
                changes: [
                    "Fix Update Log button error (handleOpenUpdateLog scope) so it works in header without ReferenceError.",
                    "Improve global toast timer handling/cleanup to prevent stale timers when multiple copy events happen."
                ]
            },
            {
                version: "v1.0",
                date: "16 Dec 2025",
                type: "Baseline (Reset)",
                changes: [
                    "Core insurance input + policy management (multi-policy).",
                    "Affordability calculations (Income / Assets / Both) with retirement handling.",
                    "Split affordability scenario display in Case Summary FNA (income pre-retirement + assets post-retirement).",
                    "Show post-retirement assets required even when affordability fails (when overhang exists).",
                    "Trust / Trust Reason logic + reactive Trust Beneficiary updates in Case Summary.",
                    "Jumbo case handling and related warnings/toasts.",
                    "Medical Requirements + TSA(Med) / TSA(All) logic (always based on Insured Age).",
                    "Bug fixes: Insured Age captured separately when Policyholder != Insured; Age=0 displays in Case Summary; TSA(Med) also displays when age=0."
                ]
            }
        ];
        /* =========================================== */

const App = () => {
            const [activeTab, setActiveTab] = useState('policyInfo');
            // Global toast state. When copyToClipboard dispatches the 'showToast' event,
            // this state is set to show a temporary notification.
            const [toast, setToast] = useState({ show: false, message: '' });

            
            const [isUpdateLogOpen, setIsUpdateLogOpen] = useState(false);
            const [isSaveCaseOpen, setIsSaveCaseOpen] = useState(false);
            const [isLoadCaseOpen, setIsLoadCaseOpen] = useState(false);
            const [isExportOptionsOpen, setIsExportOptionsOpen] = useState(false);
            const [isImportOptionsOpen, setIsImportOptionsOpen] = useState(false);
            const fileImportRef = useRef(null);
            const [saveCaseName, setSaveCaseName] = useState('');
            const [caseSaves, setCaseSaves] = useState([]);
            const [selectedSaveId, setSelectedSaveId] = useState(null);
            const toastTimerRef = useRef(null);

            const handleOpenUpdateLog = () => {
                const pwd = window.prompt('請輸入密碼以查看更新記錄 (Enter password):');
                if (pwd === null) return;
                if (pwd === UPDATE_LOG_PASSWORD) {
                    setIsUpdateLogOpen(true);
                } else {
                    alert('Incorrect Password');
                }
            };

            // ===== v2.0 Export / Import (Policy Input + Affordability) =====
            // ===== Utilities (Export/Import via Internal Temporary Storage) =====
            const safeParseJSON = (str) => {
                try { return str ? JSON.parse(str) : null; } catch (e) { return null; }
            };

            const CASE_SAVES_INDEX_KEY = 'uw_case_saves_index';
            const CASE_SAVE_PREFIX = 'uw_case_save:';

            const getCaseSavesIndex = () => {
                const idx = safeParseJSON(localStorage.getItem(CASE_SAVES_INDEX_KEY));
                return Array.isArray(idx) ? idx : [];
            };
            const setCaseSavesIndex = (arr) => {
                localStorage.setItem(CASE_SAVES_INDEX_KEY, JSON.stringify(Array.isArray(arr) ? arr : []));
            };

            const formatTs = (ts) => {
                try {
                    const d = new Date(ts);
                    // e.g. 08/01/2026, 17:25
                    return d.toLocaleString('en-GB', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' });
                } catch (e) {
                    return String(ts || '');
                }
            };

            const readCurrentCasePayload = () => {
                const policyInputFullState = safeParseJSON(localStorage.getItem('policyInputFullState')) || {};
                const affordabilityFullState = safeParseJSON(localStorage.getItem('affordabilityFullState')) || {};

                // Ensure key fields are always present (even if some tabs were not opened)
                const policyInputImportant = {
                    applicationSigningDate: policyInputFullState.applicationSigningDate ?? null,
                    fnaSigningDate: policyInputFullState.fnaSigningDate ?? null,
                    targetSavingHKD: policyInputFullState.targetSavingHKD ?? null,
                    targetYear: policyInputFullState.targetYear ?? null,
                    surrenderValueUSD: policyInputFullState.surrenderValueUSD ?? null,
                };

                return {
                    meta: {
                        version: CURRENT_VERSION,
                        exportedAt: Date.now(),
                    },
                    data: {
                        policyInputFullState,
                        affordabilityFullState,
                        policyInputImportant,
                    }
                };
            };

            const downloadCaseAsFile = () => {
                try {
                    const payload = readCurrentCasePayload();
                    const ts = payload && payload.meta && payload.meta.exportedAt ? payload.meta.exportedAt : Date.now();
                    const defaultName = `UW_case_${ts}.json`;
                    const name = (window.prompt('Filename for download (e.g., ABC client - Jan09):', defaultName) || '').trim();
                    if (!name) return;
                    const filename = name.toLowerCase().endsWith('.json') ? name : `${name}.json`;
                    const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                    URL.revokeObjectURL(url);
                    window.dispatchEvent(new CustomEvent('showToast', { detail: `Downloaded: ${filename}` }));
                } catch (err) {
                    console.error('Download failed', err);
                    alert('Download failed. Please check console.');
                }
            };

            const handleUploadCaseFile = (file) => {
                if (!file) return;
                const reader = new FileReader();
                reader.onload = () => {
                    try {
                        const payload = safeParseJSON(String(reader.result || ''));
                        const d = payload && payload.data ? payload.data : payload;

                        if (d && d.policyInputFullState) {
                            localStorage.setItem('policyInputFullState', JSON.stringify(d.policyInputFullState));
                        } else if (d && d.policyInput) {
                            localStorage.setItem('policyInputFullState', JSON.stringify(d.policyInput));
                        }

                        if (d && d.affordabilityFullState) {
                            localStorage.setItem('affordabilityFullState', JSON.stringify(d.affordabilityFullState));
                        } else if (d && d.affordability) {
                            localStorage.setItem('affordabilityFullState', JSON.stringify(d.affordability));
                        }

                        if (d && d.policyInputImportant) {
                            const cur = safeParseJSON(localStorage.getItem('policyInputFullState')) || {};
                            const merged = { ...cur, ...d.policyInputImportant };
                            localStorage.setItem('policyInputFullState', JSON.stringify(merged));
                        }

                        window.dispatchEvent(new CustomEvent('showToast', { detail: `Imported: ${file.name}` }));
                        window.location.reload();
                    } catch (err) {
                        console.error('Upload import failed', err);
                        alert('Import failed. Please check console.');
                    }
                };
                reader.onerror = () => {
                    alert('Failed to read file.');
                };
                reader.readAsText(file);
            };


            const openSaveToStorage = () => {
                setSaveCaseName('');
                setIsSaveCaseOpen(true);
            };

            const handleExportCase = () => {
                setIsExportOptionsOpen(true);
            };

            const handleConfirmSaveCase = () => {
                const name = String(saveCaseName || '').trim();
                if (!name) {
                    alert('Please input a filename.');
                    return;
                }
                try {
                    const payload = readCurrentCasePayload();
                    const ts = Date.now();
                    const id = `${ts}_${Math.random().toString(16).slice(2)}`;

                    // Save data blob
                    localStorage.setItem(CASE_SAVE_PREFIX + id, JSON.stringify(payload));

                    // Update index (latest first, keep name + timestamp)
                    const idx = getCaseSavesIndex()
                        .filter((x) => x && x.id && x.id !== id);
                    idx.unshift({ id, name, ts, version: CURRENT_VERSION });
                    setCaseSavesIndex(idx);

                    setIsSaveCaseOpen(false);
                    setSaveCaseName('');
                    window.dispatchEvent(new CustomEvent('showToast', { detail: `Saved case: ${name}` }));
                } catch (err) {
                    console.error('Save failed', err);
                    alert('Save failed. Please check console.');
                }
            };

            const openLoadFromStorage = () => {
                const idx = getCaseSavesIndex()
                    .slice()
                    .sort((a, b) => (b.ts || 0) - (a.ts || 0));
                setCaseSaves(idx);
                setSelectedSaveId(idx.length ? idx[0].id : null);
                setIsLoadCaseOpen(true);
            };

            const handleImportClick = () => {
                setIsImportOptionsOpen(true);
            };

            const handleLoadSelectedCase = () => {
                if (!selectedSaveId) {
                    alert('Please select a saved case.');
                    return;
                }
                try {
                    const raw = localStorage.getItem(CASE_SAVE_PREFIX + selectedSaveId);
                    if (!raw) {
                        alert('Selected case data not found.');
                        return;
                    }
                    const payload = safeParseJSON(raw);
                    const d = payload && payload.data ? payload.data : payload;

                    if (d && d.policyInputFullState) {
                        localStorage.setItem('policyInputFullState', JSON.stringify(d.policyInputFullState));
                    } else if (d && d.policyInput) {
                        localStorage.setItem('policyInputFullState', JSON.stringify(d.policyInput));
                    }

                    if (d && d.affordabilityFullState) {
                        localStorage.setItem('affordabilityFullState', JSON.stringify(d.affordabilityFullState));
                    } else if (d && d.affordability) {
                        localStorage.setItem('affordabilityFullState', JSON.stringify(d.affordability));
                    }

                    // Merge important fields if provided
                    if (d && d.policyInputImportant) {
                        const cur = safeParseJSON(localStorage.getItem('policyInputFullState')) || {};
                        const merged = { ...cur, ...d.policyInputImportant };
                        localStorage.setItem('policyInputFullState', JSON.stringify(merged));
                    }

                    setIsLoadCaseOpen(false);
                    window.dispatchEvent(new CustomEvent('showToast', { detail: 'Loaded saved case' }));
                    // Reload to ensure all derived states rehydrate
                    window.location.reload();
                } catch (err) {
                    console.error('Load failed', err);
                    alert('Load failed. Please check console.');
                }
            };

            const handleDeleteSavedCase = (id) => {
                if (!id) return;
                if (!confirm('Delete this saved case from internal storage?')) return;
                try {
                    localStorage.removeItem(CASE_SAVE_PREFIX + id);
                    const idx = getCaseSavesIndex().filter((x) => x && x.id !== id);
                    setCaseSavesIndex(idx);
                    const sorted = idx.slice().sort((a, b) => (b.ts || 0) - (a.ts || 0));
                    setCaseSaves(sorted);
                    setSelectedSaveId(sorted.length ? sorted[0].id : null);
                    window.dispatchEvent(new CustomEvent('showToast', { detail: 'Deleted saved case' }));
                } catch (err) {
                    console.error('Delete failed', err);
                    alert('Delete failed. Please check console.');
                }
            };
            // =========================================================
// =========================================================


            useEffect(() => {
                const handler = (e) => {
                    const msg = e && e.detail ? e.detail : 'Copied';
                    setToast({ show: true, message: msg });

                    if (toastTimerRef.current) clearTimeout(toastTimerRef.current);
                    toastTimerRef.current = setTimeout(
                        () => setToast({ show: false, message: '' }),
                        2000
                    );
                };

                window.addEventListener('showToast', handler);
                return () => {
                    window.removeEventListener('showToast', handler);
                    if (toastTimerRef.current) clearTimeout(toastTimerRef.current);
                };
            }, []);


            const handleResetAll = () => {
                try {
                    localStorage.removeItem('caseSummaryPolicyInfo');
                    localStorage.removeItem('caseSummaryAffordability');
                    localStorage.removeItem('bulkTextA');
                    localStorage.removeItem('policyInfoForAffordability');
                    localStorage.removeItem('policyInputFullState');
                    localStorage.removeItem('affordabilityFullState');
                } catch (e) {}
                window.location.reload();
            };
            return (
                <div className="flex flex-col h-screen bg-slate-50 font-sans text-slate-800">
                    {isUpdateLogOpen && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4">
                            <div className="w-full max-w-2xl bg-white rounded-xl shadow-xl border border-slate-200 overflow-hidden">
                                <div className="flex items-center justify-between px-4 py-3 border-b border-slate-200">
                                    <div className="flex items-center gap-2">
                                        <ClipboardList className="text-blue-600" size={18}/>
                                        <div>
                                            <div className="font-semibold text-slate-800">更新記錄 (Update Log)</div>
                                            <div className="text-xs text-slate-500">Current version: {CURRENT_VERSION}</div>
                                        </div>
                                    </div>
                                    <button
                                        onClick={() => setIsUpdateLogOpen(false)}
                                        className="text-xs bg-slate-100 text-slate-700 border border-slate-200 px-3 py-2 rounded hover:bg-slate-200 transition-colors"
                                    >
                                        Close
                                    </button>
                                </div>
                                <div className="p-4 max-h-[70vh] overflow-y-auto space-y-4">
                                    {versionHistory.map((v) => (
                                        <div key={v.version} className="border border-slate-200 rounded-lg p-3 bg-slate-50">
                                            <div className="flex items-center justify-between">
                                                <div className="font-semibold text-slate-800">{v.version} <span className="text-xs text-slate-500 font-normal">({v.type})</span></div>
                                                <div className="text-xs text-slate-500">{v.date}</div>
                                            </div>
                                            <ul className="list-disc pl-5 mt-2 text-sm text-slate-700 space-y-1">
                                                {v.changes.map((c, idx) => (
                                                    <li key={idx}>{c}</li>
                                                ))}
                                            </ul>
                                        </div>
                                    ))}
                                    <div className="text-xs text-slate-500">
                                        註：之後每次更新程式碼，我哋會按 Major / Minor 自動升版本（例如 v1.1 或 v2.0），並把改動追加到 versionHistory。
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    

                    {/* Export Options Modal (Hybrid Mode) */}
                    {isExportOptionsOpen && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4">
                            <div className="w-full max-w-lg bg-white rounded-xl shadow-xl border border-slate-200 overflow-hidden">
                                <div className="flex items-center justify-between px-4 py-3 border-b border-slate-200">
                                    <div className="font-semibold text-slate-800">Export options</div>
                                    <button
                                        onClick={() => setIsExportOptionsOpen(false)}
                                        className="text-xs bg-slate-100 border border-slate-200 px-3 py-2 rounded hover:bg-slate-200 transition-colors"
                                    >
                                        Close
                                    </button>
                                </div>
                                <div className="p-4 space-y-3">
                                    <div className="text-sm text-slate-600">Choose how to export the case data.</div>
                                    <div className="grid grid-cols-1 gap-2">
                                        <button
                                            onClick={() => { setIsExportOptionsOpen(false); openSaveToStorage(); }}
                                            className="text-sm bg-blue-600 text-white px-3 py-2 rounded hover:bg-blue-700 transition-colors"
                                        >
                                            Save to Internal Storage (Rename)
                                        </button>
                                        <button
                                            onClick={() => { setIsExportOptionsOpen(false); downloadCaseAsFile(); }}
                                            className="text-sm bg-white border border-slate-300 text-slate-800 px-3 py-2 rounded hover:bg-slate-50 transition-colors"
                                        >
                                            Download as File (.json)
                                        </button>
                                    </div>
                                    <div className="text-xs text-slate-500">
                                        Tip: Internal Storage is tied to this browser/device. Download is portable.
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Import Options Modal (Hybrid Mode) */}
                    {isImportOptionsOpen && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4">
                            <div className="w-full max-w-lg bg-white rounded-xl shadow-xl border border-slate-200 overflow-hidden">
                                <div className="flex items-center justify-between px-4 py-3 border-b border-slate-200">
                                    <div className="font-semibold text-slate-800">Import options</div>
                                    <button
                                        onClick={() => setIsImportOptionsOpen(false)}
                                        className="text-xs bg-slate-100 border border-slate-200 px-3 py-2 rounded hover:bg-slate-200 transition-colors"
                                    >
                                        Close
                                    </button>
                                </div>
                                <div className="p-4 space-y-3">
                                    <div className="text-sm text-slate-600">Choose how to import the case data.</div>
                                    <div className="grid grid-cols-1 gap-2">
                                        <button
                                            onClick={() => { setIsImportOptionsOpen(false); openLoadFromStorage(); }}
                                            className="text-sm bg-blue-600 text-white px-3 py-2 rounded hover:bg-blue-700 transition-colors"
                                        >
                                            Load from Internal Storage list
                                        </button>
                                        <button
                                            onClick={() => { setIsImportOptionsOpen(false); if (fileImportRef.current) fileImportRef.current.click(); }}
                                            className="text-sm bg-white border border-slate-300 text-slate-800 px-3 py-2 rounded hover:bg-slate-50 transition-colors"
                                        >
                                            Upload File (.json)
                                        </button>
                                    </div>
                                    <div className="text-xs text-slate-500">
                                        Tip: Uploaded file will overwrite current inputs after reload.
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Hidden file input for Import (File Upload) */}
                    <input
                        ref={fileImportRef}
                        type="file"
                        accept="application/json,.json"
                        style={{ display: 'none' }}
                        onChange={(e) => {
                            const f = e && e.target && e.target.files ? e.target.files[0] : null;
                            // reset so same file can be re-selected
                            if (e && e.target) e.target.value = '';
                            handleUploadCaseFile(f);
                        }}
                    />
{isSaveCaseOpen && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4">
                            <div className="w-full max-w-lg bg-white rounded-xl shadow-xl border border-slate-200 overflow-hidden">
                                <div className="flex items-center justify-between px-4 py-3 border-b border-slate-200">
                                    <div className="font-semibold text-slate-800">Save case to internal storage</div>
                                    <button
                                        onClick={() => setIsSaveCaseOpen(false)}
                                        className="text-xs bg-slate-100 border border-slate-200 px-3 py-2 rounded hover:bg-slate-200 transition-colors"
                                    >
                                        Close
                                    </button>
                                </div>
                                <div className="p-4 space-y-3">
                                    <div className="text-sm text-slate-600">
                                        Please input a filename. The case will be saved in this browser’s internal temporary storage (no download).
                                    </div>
                                    <div>
                                        <label className="block text-xs text-slate-500 mb-1">Filename</label>
                                        <input
                                            value={saveCaseName}
                                            onChange={(e) => setSaveCaseName(e.target.value)}
                                            placeholder="e.g. ABC client - Jan08"
                                            className="w-full border border-slate-300 rounded px-3 py-2 text-sm bg-white"
                                        />
                                    </div>
                                </div>
                                <div className="flex items-center justify-end gap-2 px-4 py-3 border-t border-slate-200 bg-slate-50">
                                    <button
                                        onClick={() => setIsSaveCaseOpen(false)}
                                        className="text-xs bg-white border border-slate-200 px-3 py-2 rounded hover:bg-slate-100 transition-colors"
                                    >
                                        Cancel
                                    </button>
                                    <button
                                        onClick={handleConfirmSaveCase}
                                        className="text-xs bg-blue-600 text-white px-3 py-2 rounded hover:bg-blue-700 transition-colors"
                                    >
                                        Save
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {isLoadCaseOpen && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4">
                            <div className="w-full max-w-2xl bg-white rounded-xl shadow-xl border border-slate-200 overflow-hidden">
                                <div className="flex items-center justify-between px-4 py-3 border-b border-slate-200">
                                    <div className="font-semibold text-slate-800">Load case from internal storage</div>
                                    <button
                                        onClick={() => setIsLoadCaseOpen(false)}
                                        className="text-xs bg-slate-100 border border-slate-200 px-3 py-2 rounded hover:bg-slate-200 transition-colors"
                                    >
                                        Close
                                    </button>
                                </div>
                                <div className="p-4 max-h-[60vh] overflow-y-auto">
                                    {caseSaves && caseSaves.length ? (
                                        <div className="space-y-2">
                                            {caseSaves.map((s) => (
                                                <div key={s.id} className="flex items-center justify-between gap-3 border border-slate-200 rounded-lg px-3 py-2 bg-slate-50">
                                                    <label className="flex items-center gap-3 cursor-pointer w-full">
                                                        <input
                                                            type="radio"
                                                            name="savedCase"
                                                            checked={selectedSaveId === s.id}
                                                            onChange={() => setSelectedSaveId(s.id)}
                                                        />
                                                        <div className="min-w-0">
                                                            <div className="text-sm font-medium text-slate-800 truncate">{s.name}</div>
                                                            <div className="text-xs text-slate-500">
                                                                {formatTs(s.ts)} {s.version ? ` • ${s.version}` : ''}
                                                            </div>
                                                        </div>
                                                    </label>
                                                    <button
                                                        onClick={() => handleDeleteSavedCase(s.id)}
                                                        className="text-xs text-red-600 hover:text-red-700 px-2 py-1"
                                                        title="Delete"
                                                    >
                                                        Delete
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    ) : (
                                        <div className="text-sm text-slate-600">No saved cases found in internal storage.</div>
                                    )}
                                </div>
                                <div className="flex items-center justify-end gap-2 px-4 py-3 border-t border-slate-200 bg-slate-50">
                                    <button
                                        onClick={() => setIsLoadCaseOpen(false)}
                                        className="text-xs bg-white border border-slate-200 px-3 py-2 rounded hover:bg-slate-100 transition-colors"
                                    >
                                        Cancel
                                    </button>
                                    <button
                                        onClick={handleLoadSelectedCase}
                                        className="text-xs bg-blue-600 text-white px-3 py-2 rounded hover:bg-blue-700 transition-colors disabled:opacity-50"
                                        disabled={!caseSaves || !caseSaves.length}
                                    >
                                        Load
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="bg-white border-b border-slate-200 px-4 pt-4 flex-none z-20 shadow-sm">
                        <div className="flex justify-between items-center mb-4">
                          <div className="flex items-center gap-2">
                            <h1 className="text-xl font-bold text-slate-800 flex items-center gap-2">
                              <Calculator className="text-blue-600" /> UW assessment tool
                            </h1>
                            <div className="text-xs text-slate-400 font-mono">{CURRENT_VERSION}</div>
                          </div>
                          <div className="flex items-center gap-2">
                            <button onClick={handleOpenUpdateLog} className="text-xs bg-slate-100 text-slate-700 border border-slate-200 px-3 py-2 rounded hover:bg-slate-200 transition-colors flex items-center gap-1">
                              <ClipboardList size={12}/> 更新記錄
                            </button>
                            <button onClick={handleExportCase} className="text-xs bg-slate-100 text-slate-700 border border-slate-200 px-3 py-2 rounded hover:bg-slate-200 transition-colors flex items-center gap-1">
                              <FileText size={12}/> Export
                            </button>
                            <button onClick={handleImportClick} className="text-xs bg-slate-100 text-slate-700 border border-slate-200 px-3 py-2 rounded hover:bg-slate-200 transition-colors flex items-center gap-1">
                              <FileText size={12}/> Import
                            </button>
                            <button onClick={handleResetAll} className="text-xs bg-white border border-slate-300 text-red-500 px-3 py-1.5 rounded hover:bg-red-50 transition-colors flex items-center gap-1">
                               <RotateCw size={12}/> 重設資料
                            </button>                          </div>

                        </div>
                        <div className="flex gap-6 overflow-x-auto">
                            {/* Navigation order adjusted per requirements */}
                            <button onClick={() => setActiveTab('policyInfo')} className={`pb-3 px-2 flex items-center gap-2 transition-all border-b-2 ${activeTab === 'policyInfo' ? 'border-blue-600 text-blue-600 font-bold' : 'border-transparent text-slate-500 hover:text-slate-700'}`}><FileText size={18}/> 保單資料輸入</button>
                            <button onClick={() => setActiveTab('affordability')} className={`pb-3 px-2 flex items-center gap-2 transition-all border-b-2 ${activeTab === 'affordability' ? 'border-blue-600 text-blue-600 font-bold' : 'border-transparent text-slate-500 hover:text-slate-700'}`}><Calculator size={18}/> 負擔能力計算</button>
                            <button onClick={() => setActiveTab('summary')} className={`pb-3 px-2 flex items-center gap-2 transition-all border-b-2 ${activeTab === 'summary' ? 'border-blue-600 text-blue-600 font-bold' : 'border-transparent text-slate-500 hover:text-slate-700'}`}><FileText size={18}/> Case Summary</button>
                            <button onClick={() => setActiveTab('splitter')} className={`pb-3 px-2 flex items-center gap-2 transition-all border-b-2 ${activeTab === 'splitter' ? 'border-blue-600 text-blue-600 font-bold' : 'border-transparent text-slate-500 hover:text-slate-700'}`}><Split size={18}/> UN Screen</button>
                            <button onClick={() => setActiveTab('pending')} className={`pb-3 px-2 flex items-center gap-2 transition-all border-b-2 ${activeTab === 'pending' ? 'border-blue-600 text-blue-600 font-bold' : 'border-transparent text-slate-500 hover:text-slate-700'}`}><FileText size={18}/> Pending message sample</button>
                            <button onClick={() => setActiveTab('exclusion')} className={`pb-3 px-2 flex items-center gap-2 transition-all border-b-2 ${activeTab === 'exclusion' ? 'border-blue-600 text-blue-600 font-bold' : 'border-transparent text-slate-500 hover:text-slate-700'}`}><Info size={18}/> Exclusion Code</button>
                            {/* Occupation tab moved to last */}
                            <button onClick={() => setActiveTab('occupation')} className={`pb-3 px-2 flex items-center gap-2 transition-all border-b-2 ${activeTab === 'occupation' ? 'border-blue-600 text-blue-600 font-bold' : 'border-transparent text-slate-500 hover:text-slate-700'}`}><Briefcase size={18}/> Occupation Rating</button>
                            {/* New Master Broker List tab */}
                            <button onClick={() => setActiveTab('broker')} className={`pb-3 px-2 flex items-center gap-2 transition-all border-b-2 ${activeTab === 'broker' ? 'border-blue-600 text-blue-600 font-bold' : 'border-transparent text-slate-500 hover:text-slate-700'}`}>Master Broker List</button>
                        </div>
                    </div>
                    <div className="flex-1 overflow-hidden relative">
                        {/* Tab content order adjusted per requirements */}
                        <div style={{ display: activeTab === 'policyInfo' ? 'block' : 'none', height: '100%' }}><PolicyInfoTab onNavigate={setActiveTab} /></div>
                        <div style={{ display: activeTab === 'affordability' ? 'block' : 'none', height: '100%' }}><AffordabilityTab /></div>
                        <div style={{ display: activeTab === 'summary' ? 'block' : 'none', height: '100%' }}><CaseSummaryTab onNavigate={setActiveTab} /></div>
                        <div style={{ display: activeTab === 'splitter' ? 'block' : 'none', height: '100%' }}><TextSplitterTab /></div>
                        <div style={{ display: activeTab === 'pending' ? 'block' : 'none', height: '100%' }}><PendingMessageTab /></div>
                        <div style={{ display: activeTab === 'exclusion' ? 'block' : 'none', height: '100%' }}><ExclusionCodeTab /></div>
                        <div style={{ display: activeTab === 'occupation' ? 'block' : 'none', height: '100%' }}><OccupationTab /></div>
                        <div style={{ display: activeTab === 'broker' ? 'block' : 'none', height: '100%' }}><BrokerListTab /></div>
                    </div>
                    {toast.show && (
                        <div className="fixed bottom-4 right-4 bg-green-600 text-white px-3 py-2 rounded shadow-lg text-xs z-50">
                            {toast.message}
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
